============================================= 
Merged Source Files - Mon 02/09/2026 16:37:10.28 
Excluded: bin, obj, Migrations folders 
============================================= 
 
 
==================== Program.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\ 
 
﻿using Microsoft.AspNetCore.Authentication.JwtBearer;
using Microsoft.EntityFrameworkCore;
using Microsoft.IdentityModel.Tokens;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Infrastructure.Authentication;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Infrastructure.Services;
using System.Text;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container
builder.Services.AddControllers();
builder.Services.AddEndpointsApiExplorer();
builder.Services.AddSwaggerGen();

// Database
builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));

// Authentication Services
builder.Services.AddScoped<IAuthenticationProvider, ActiveDirectoryProvider>();
builder.Services.AddScoped<ErpAuthenticationProvider>();
builder.Services.AddScoped<OtpAuthenticationProvider>();
builder.Services.AddScoped<IAuthenticationManager, AuthenticationManager>();
builder.Services.AddScoped<ISmsService, SmsService>();

// HTTP Client
builder.Services.AddHttpClient();

// JWT Authentication
var jwtKey = builder.Configuration["Jwt:Key"] ?? throw new InvalidOperationException("JWT Key not configured");
var jwtIssuer = builder.Configuration["Jwt:Issuer"] ?? throw new InvalidOperationException("JWT Issuer not configured");
var jwtAudience = builder.Configuration["Jwt:Audience"] ?? throw new InvalidOperationException("JWT Audience not configured");

builder.Services.AddAuthentication(options =>
{
    options.DefaultAuthenticateScheme = JwtBearerDefaults.AuthenticationScheme;
    options.DefaultChallengeScheme = JwtBearerDefaults.AuthenticationScheme;
})
.AddJwtBearer(options =>
{
    options.TokenValidationParameters = new TokenValidationParameters
    {
        ValidateIssuer = true,
        ValidateAudience = true,
        ValidateLifetime = true,
        ValidateIssuerSigningKey = true,
        ValidIssuer = jwtIssuer,
        ValidAudience = jwtAudience,
        IssuerSigningKey = new SymmetricSecurityKey(Encoding.UTF8.GetBytes(jwtKey))
    };
});

builder.Services.AddAuthorization();

// CORS
builder.Services.AddCors(options =>
{
    options.AddPolicy("AllowAll", policy =>
    {
        policy.AllowAnyOrigin()
              .AllowAnyMethod()
              .AllowAnyHeader();
    });
});

var app = builder.Build();

// Configure the HTTP request pipeline
if (app.Environment.IsDevelopment())
{
    app.UseSwagger();
    app.UseSwaggerUI();
}

app.UseHttpsRedirection();
app.UseCors("AllowAll");
app.UseAuthentication();
app.UseAuthorization();
app.MapControllers();

app.Run();
 
 
==================== WeatherForecast.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\ 
 
namespace OrganizationalMessenger.API
{
    public class WeatherForecast
    {
        public DateOnly Date { get; set; }

        public int TemperatureC { get; set; }

        public int TemperatureF => 32 + (int)(TemperatureC / 0.5556);

        public string? Summary { get; set; }
    }
}
 
 
==================== AuthController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;

namespace OrganizationalMessenger.API.Controllers
{
    public class AuthController : Controller
    {
        public IActionResult Index()
        {
            return View();
        }
    }
}
 
 
==================== GroupsController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;

namespace OrganizationalMessenger.API.Controllers
{
    public class GroupsController : Controller
    {
        public IActionResult Index()
        {
            return View();
        }
    }
}
 
 
==================== MessagesController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;

namespace OrganizationalMessenger.API.Controllers
{
    public class MessagesController : Controller
    {
        public IActionResult Index()
        {
            return View();
        }
    }
}
 
 
==================== UsersController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;

namespace OrganizationalMessenger.API.Controllers
{
    public class UsersController : Controller
    {
        public IActionResult Index()
        {
            return View();
        }
    }
}
 
 
==================== ErrorHandlingMiddleware.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\Middleware\ 
 
﻿namespace OrganizationalMessenger.API.Middleware
{
    public class ErrorHandlingMiddleware
    {
    }
}
 
 
==================== .NETCoreApp,Version=v8.0.AssemblyAttributes.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\obj\Debug\net8.0\ 
 
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
 
 
==================== OrganizationalMessenger.API.AssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("OrganizationalMessenger.API")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("OrganizationalMessenger.API")]
[assembly: System.Reflection.AssemblyTitleAttribute("OrganizationalMessenger.API")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== OrganizationalMessenger.API.GlobalUsings.g.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\obj\Debug\net8.0\ 
 
// <auto-generated/>
global using global::Microsoft.AspNetCore.Builder;
global using global::Microsoft.AspNetCore.Hosting;
global using global::Microsoft.AspNetCore.Http;
global using global::Microsoft.AspNetCore.Routing;
global using global::Microsoft.Extensions.Configuration;
global using global::Microsoft.Extensions.DependencyInjection;
global using global::Microsoft.Extensions.Hosting;
global using global::Microsoft.Extensions.Logging;
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Net.Http.Json;
global using global::System.Threading;
global using global::System.Threading.Tasks;
 
 
==================== OrganizationalMessenger.API.MvcApplicationPartsAssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.API\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: Microsoft.AspNetCore.Mvc.ApplicationParts.ApplicationPartAttribute("Swashbuckle.AspNetCore.SwaggerGen")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== IAuthenticationManager.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Application\Interfaces\ 
 
﻿namespace OrganizationalMessenger.Application.Interfaces
{
    public interface IAuthenticationManager
    {
        Task<AuthenticationResult> AuthenticateAsync(string username, string password, AuthenticationType type);
        Task<(bool Success, string Message)> SendOtpAsync(string phoneNumber);
        IAuthenticationProvider GetProvider(AuthenticationType type);
    }

    public enum AuthenticationType
    {
        ActiveDirectory,
        ERP,
        OTP
    }
}
 
 
==================== IAuthenticationProvider.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Application\Interfaces\ 
 
﻿namespace OrganizationalMessenger.Application.Interfaces
{
    public interface IAuthenticationProvider
    {
        Task<AuthenticationResult> AuthenticateAsync(string username, string password);
    }

    public class AuthenticationResult
    {
        public bool IsSuccess { get; set; }
        public string? ErrorMessage { get; set; }
        public string? UserId { get; set; }
        public string? FirstName { get; set; }
        public string? LastName { get; set; }
        public string? Email { get; set; }
        public string? PhoneNumber { get; set; }
    }
}
 
 
==================== ISmsService.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Application\Interfaces\ 
 
﻿namespace OrganizationalMessenger.Application.Interfaces
{
    public interface ISmsService
    {
        Task<SmsResult> SendOtpAsync(string phoneNumber, string otpCode);
        Task<SmsResult> SendMessageAsync(string phoneNumber, string message);
    }

    public class SmsResult
    {
        public bool Success { get; set; }
        public string Message { get; set; } = "";
        public string? MessageId { get; set; }
    }
}
 
 
==================== .NETCoreApp,Version=v8.0.AssemblyAttributes.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Application\obj\Debug\net8.0\ 
 
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
 
 
==================== OrganizationalMessenger.Application.AssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Application\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("OrganizationalMessenger.Application")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("OrganizationalMessenger.Application")]
[assembly: System.Reflection.AssemblyTitleAttribute("OrganizationalMessenger.Application")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== OrganizationalMessenger.Application.GlobalUsings.g.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Application\obj\Debug\net8.0\ 
 
// <auto-generated/>
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Threading;
global using global::System.Threading.Tasks;
 
 
==================== AdminUser.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class AdminUser
    {
        public int Id { get; set; }
        public string Username { get; set; } = string.Empty;
        public string PasswordHash { get; set; } = string.Empty;
        public string FirstName { get; set; } = string.Empty;
        public string LastName { get; set; } = string.Empty;
        public string? Email { get; set; }
        public bool IsActive { get; set; } = true;
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? LastLoginAt { get; set; }

        public string FullName => $"{FirstName} {LastName}";
    }
}
 
 
==================== BaseEntity.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public abstract class BaseEntity
    {
        public int Id { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? UpdatedAt { get; set; }
        public bool IsDeleted { get; set; } = false;
        public DateTime? DeletedAt { get; set; }
    }
}
 
 
==================== Call.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class Call : BaseEntity
    {
        public int InitiatorId { get; set; }
        public int? ReceiverId { get; set; }
        public CallType Type { get; set; }
        public CallDestinationType DestinationType { get; set; }

        // مقصد تماس
        public int? GroupId { get; set; }
        public int? ChannelId { get; set; }

        // وضعیت
        public CallStatus Status { get; set; } = CallStatus.Initiated;
        public DateTime StartedAt { get; set; } = DateTime.Now;
        public DateTime? EndedAt { get; set; }
        public int? Duration { get; set; }

        // لینک جلسه گروهی
        public string? MeetingLink { get; set; }
        public string? MeetingPassword { get; set; }

        // Navigation Properties
        public User Initiator { get; set; } = null!;
        public User? Receiver { get; set; }
        public Group? Group { get; set; }
        public Channel? Channel { get; set; }
        public ICollection<Message> Messages { get; set; } = new List<Message>();
    }
}
 
 
==================== Channel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace OrganizationalMessenger.Domain.Entities
{
    /// <summary>
    /// Entity کانال - برای ارتباطات یک‌طرفه (اطلاع‌رسانی)
    /// </summary>
    public class Channel
    {
        public int Id { get; set; }

        [Required]
        [StringLength(200)]
        public string Name { get; set; } = string.Empty;

        [StringLength(1000)]
        public string? Description { get; set; }

        [StringLength(500)]
        public string? AvatarUrl { get; set; }

        public int CreatorId { get; set; }

        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? UpdatedAt { get; set; }

        public bool IsActive { get; set; } = true;
        public bool IsPublic { get; set; } = true;

        // ==================== حذف نرم ====================
        public bool IsDeleted { get; set; } = false;
        public DateTime? DeletedAt { get; set; }

        // ==================== تنظیمات کانال ====================

        /// <summary>
        /// آیا فقط ادمین‌ها می‌توانند پیام ارسال کنند
        /// </summary>
        public bool OnlyAdminsCanPost { get; set; } = true;

        /// <summary>
        /// آیا کامنت‌گذاری فعال است
        /// </summary>
        public bool AllowComments { get; set; } = false;

        /// <summary>
        /// آیا کانال خصوصی است (نیاز به لینک دعوت)
        /// </summary>
        public bool IsPrivate { get; set; } = false;

        /// <summary>
        /// لینک دعوت یکتا
        /// </summary>
        [StringLength(100)]
        public string? InviteLink { get; set; }

        // ==================== آمار ====================

        public int MemberCount { get; set; } = 0;

        // ==================== Navigation Properties ====================

        [ForeignKey(nameof(CreatorId))]
        public virtual User Creator { get; set; } = null!;

        public virtual ICollection<UserChannel> UserChannels { get; set; } = new List<UserChannel>();
        public virtual ICollection<Message> Messages { get; set; } = new List<Message>();
        public virtual ICollection<Call> Calls { get; set; } = new List<Call>();

        // ==================== متدهای کمکی ====================

        /// <summary>
        /// علامت‌گذاری به عنوان حذف شده
        /// </summary>
        public void MarkAsDeleted()
        {
            IsDeleted = true;
            DeletedAt = DateTime.Now;
            IsActive = false;
        }

        /// <summary>
        /// بازیابی کانال حذف شده
        /// </summary>
        public void Restore()
        {
            IsDeleted = false;
            DeletedAt = null;
            IsActive = true;
        }

        /// <summary>
        /// تولید لینک دعوت جدید
        /// </summary>
        public string GenerateInviteLink()
        {
            InviteLink = Guid.NewGuid().ToString("N")[..16];
            return InviteLink;
        }

        /// <summary>
        /// به‌روزرسانی تعداد اعضا
        /// </summary>
        public void UpdateMemberCount(int count)
        {
            MemberCount = count;
            UpdatedAt = DateTime.Now;
        }
    }
}
 
 
==================== FileAttachment.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace OrganizationalMessenger.Domain.Entities
{
    /// <summary>
    /// Entity برای مدیریت فایل‌های ضمیمه شده به پیام‌ها
    /// </summary>
    public class FileAttachment
    {
        public int Id { get; set; }

        // ==================== اطلاعات فایل ====================

        [Required]
        [StringLength(255)]
        public string FileName { get; set; } = string.Empty;

        [Required]
        [StringLength(255)]
        public string OriginalFileName { get; set; } = string.Empty;

        [Required]
        [StringLength(500)]
        public string FilePath { get; set; } = string.Empty;

        [StringLength(500)]
        public string? FileUrl { get; set; }

        [StringLength(100)]
        public string? ContentType { get; set; }

        [StringLength(10)]
        public string? Extension { get; set; }

        public long FileSize { get; set; }

        // ==================== نوع فایل ====================

        [StringLength(50)]
        public string FileType { get; set; } = "File";

        // ==================== Thumbnail ====================

        [StringLength(500)]
        public string? ThumbnailPath { get; set; }

        [StringLength(500)]
        public string? ThumbnailUrl { get; set; }

        public int? Width { get; set; }
        public int? Height { get; set; }

        // ==================== برای فایل‌های صوتی/ویدیویی ====================

        public int? Duration { get; set; }

        // ==================== آپلودکننده ====================

        public int UploaderId { get; set; }

        [ForeignKey(nameof(UploaderId))]
        public virtual User Uploader { get; set; } = null!;

        // ==================== پیام مرتبط ====================

        /// <summary>
        /// ⚠️ نوع باید با Message.Id یکسان باشد (int)
        /// </summary>
        public int? MessageId { get; set; }  // ✅ تغییر از long? به int?

        [ForeignKey(nameof(MessageId))]
        public virtual Message? Message { get; set; }

        // ==================== تاریخ‌ها ====================

        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? DeletedAt { get; set; }
        public bool IsDeleted { get; set; } = false;

        // ==================== Hash ====================

        [StringLength(64)]
        public string? FileHash { get; set; }

        // ==================== اسکن آنتی‌ویروس ====================

        public bool IsScanned { get; set; } = false;
        public bool IsSafe { get; set; } = true;
        public DateTime? ScannedAt { get; set; }

        [StringLength(500)]
        public string? ScanResult { get; set; }

        // ==================== آمار دانلود ====================

        public int DownloadCount { get; set; } = 0;
        public DateTime? LastDownloadAt { get; set; }

        // ==================== متدهای کمکی ====================

        [NotMapped]
        public string ReadableFileSize
        {
            get
            {
                string[] sizes = { "B", "KB", "MB", "GB", "TB" };
                double len = FileSize;
                int order = 0;
                while (len >= 1024 && order < sizes.Length - 1)
                {
                    order++;
                    len = len / 1024;
                }
                return $"{len:0.##} {sizes[order]}";
            }
        }

        [NotMapped]
        public string? ReadableDuration
        {
            get
            {
                if (!Duration.HasValue) return null;
                var ts = TimeSpan.FromSeconds(Duration.Value);
                if (ts.Hours > 0)
                    return $"{ts.Hours:D2}:{ts.Minutes:D2}:{ts.Seconds:D2}";
                return $"{ts.Minutes:D2}:{ts.Seconds:D2}";
            }
        }

        [NotMapped]
        public bool IsImage => FileType?.ToLower() == "image" ||
            new[] { ".jpg", ".jpeg", ".png", ".gif", ".bmp", ".webp", ".svg" }
            .Contains(Extension?.ToLower());

        [NotMapped]
        public bool IsVideo => FileType?.ToLower() == "video" ||
            new[] { ".mp4", ".avi", ".mkv", ".mov", ".wmv", ".webm" }
            .Contains(Extension?.ToLower());

        [NotMapped]
        public bool IsAudio => FileType?.ToLower() == "audio" ||
            new[] { ".mp3", ".wav", ".ogg", ".m4a", ".aac", ".flac" }
            .Contains(Extension?.ToLower());

        [NotMapped]
        public bool IsDocument => FileType?.ToLower() == "document" ||
            new[] { ".pdf", ".doc", ".docx", ".xls", ".xlsx", ".ppt", ".pptx", ".txt", ".rtf" }
            .Contains(Extension?.ToLower());

        public void IncrementDownloadCount()
        {
            DownloadCount++;
            LastDownloadAt = DateTime.Now;
        }

        public void MarkAsDeleted()
        {
            IsDeleted = true;
            DeletedAt = DateTime.Now;
        }

        public void SetScanResult(bool isSafe, string? result = null)
        {
            IsScanned = true;
            IsSafe = isSafe;
            ScannedAt = DateTime.Now;
            ScanResult = result;
        }
    }
}
 
 
==================== FileUploadSetting.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class FileUploadSetting
    {
        public int Id { get; set; }
        public string FileType { get; set; } = string.Empty; // مثل: jpg, png, pdf, mp4
        public string Category { get; set; } = string.Empty; // Image, Video, Audio, Document
        public long MaxSize { get; set; } // بایت
        public bool IsAllowed { get; set; } = true;
    }
}
 
 
==================== ForbiddenWord.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class ForbiddenWord
    {
        public int Id { get; set; }
        public string Word { get; set; } = string.Empty;
        public bool IsActive { get; set; } = true;
        public DateTime CreatedAt { get; set; } = DateTime.Now;
    }
}
 
 
==================== Group.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class Group : BaseEntity
    {
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string? AvatarUrl { get; set; }
        public int CreatorId { get; set; }
        public bool IsActive { get; set; } = true;
        public bool IsPublic { get; set; } = false;
        public int MaxMembers { get; set; } = 200;

        // Navigation Properties
        public User Creator { get; set; } = null!;
        public ICollection<UserGroup> UserGroups { get; set; } = new List<UserGroup>();
        public ICollection<GroupMember> Members { get; set; } = new List<GroupMember>();
        public ICollection<Message> Messages { get; set; } = new List<Message>();
        public ICollection<Call> Calls { get; set; } = new List<Call>();
    }
}
 
 
==================== GroupMember.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class GroupMember
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int GroupId { get; set; }
        public GroupRole Role { get; set; } = GroupRole.Member;
        public DateTime JoinedAt { get; set; } = DateTime.Now;
        public bool IsMuted { get; set; } = false;
        public DateTime? MutedUntil { get; set; }
        public bool IsActive { get; set; } = true;

        // Navigation Properties
        public User User { get; set; } = null!;
        public Group Group { get; set; } = null!;
    }
}
 
 
==================== LoginLog.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class LoginLog
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public AuthenticationType AuthType { get; set; }
        public string? IpAddress { get; set; }
        public string? UserAgent { get; set; }
        public bool IsSuccessful { get; set; }
        public string? FailureReason { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public User User { get; set; } = null!;
    }
}
 
 
==================== Message.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class Message : BaseEntity
    {
        // فرستنده و گیرنده
        public int SenderId { get; set; }
        public int? ReceiverId { get; set; } // برای پیام خصوصی

        // گروه یا کانال
        public int? GroupId { get; set; }
        public int? ChannelId { get; set; }

        // محتوای پیام
        public string? MessageText { get; set; } // ⭐ اضافه شد - نام قدیمی
        public string? Content { get; set; } // نام جدید (هر دو را نگه می‌داریم)
        public string? EncryptedContent { get; set; }

        // نوع پیام
        public MessageType Type { get; set; } = MessageType.Text;

        // فایل پیوست
        public string? AttachmentUrl { get; set; }
        public string? AttachmentName { get; set; }
        public string? AttachmentType { get; set; }
        public long? AttachmentSize { get; set; }

        // زمان‌ها
        public DateTime SentAt { get; set; } = DateTime.Now; // ⭐ اضافه شد
        public DateTime? DeliveredAt { get; set; }
        public DateTime? ReadAt { get; set; }

        // وضعیت‌ها
        public bool IsRead { get; set; } = false;
        public bool IsDelivered { get; set; } = false;
        public bool IsEdited { get; set; } = false;
        public DateTime? EditedAt { get; set; }

        // Reply و Forward
        public int? ReplyToMessageId { get; set; }
        public int? ForwardedFromMessageId { get; set; }

        // تماس مرتبط
        public int? CallId { get; set; }

        // پیام سیستمی
        public bool IsSystemMessage { get; set; } = false;

        // Navigation Properties
        public User Sender { get; set; } = null!;
        public User? Receiver { get; set; }
        public Group? Group { get; set; }
        public Channel? Channel { get; set; }
        public Message? ReplyToMessage { get; set; }
        public Message? ForwardedFromMessage { get; set; }
        public Call? Call { get; set; }

        public ICollection<Message> Replies { get; set; } = new List<Message>();
        public ICollection<MessageReaction> Reactions { get; set; } = new List<MessageReaction>();
        public ICollection<MessageRead> ReadReceipts { get; set; } = new List<MessageRead>();

        public virtual ICollection<FileAttachment> Attachments { get; set; } = new List<FileAttachment>();

    }
}
 
 
==================== MessageReaction.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class MessageReaction
    {
        public int Id { get; set; }
        public int MessageId { get; set; }
        public int UserId { get; set; }
        public string Emoji { get; set; } = string.Empty;
        public DateTime CreatedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public Message Message { get; set; } = null!;
        public User User { get; set; } = null!;
    }
}
 
 
==================== MessageRead.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class MessageRead
    {
        public int Id { get; set; }
        public int MessageId { get; set; }
        public int UserId { get; set; }
        public DateTime ReadAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public Message Message { get; set; } = null!;
        public User User { get; set; } = null!;
    }
}
 
 
==================== MessageReport.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class MessageReport
    {
        public int Id { get; set; }
        public int MessageId { get; set; }
        public int ReporterId { get; set; }
        public string? Description { get; set; }
        public bool IsReviewed { get; set; } = false;
        public int? ReviewedByAdminId { get; set; }
        public DateTime? ReviewedAt { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public Message Message { get; set; } = null!;
        public User Reporter { get; set; } = null!;
        public User? ReviewedByAdmin { get; set; }
    }
}
 
 
==================== Poll.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class Poll
    {
        public int Id { get; set; }
        public string Question { get; set; } = string.Empty;
        public int CreatorId { get; set; }
        public int? GroupId { get; set; }
        public int? ChannelId { get; set; }
        public bool AllowMultipleAnswers { get; set; } = false;
        public bool IsAnonymous { get; set; } = false;
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? ExpiresAt { get; set; }
        public bool IsActive { get; set; } = true;

        // Navigation Properties
        public User Creator { get; set; } = null!;
        public Group? Group { get; set; }
        public Channel? Channel { get; set; }
        public ICollection<PollOption> Options { get; set; } = new List<PollOption>();
    }
}
 
 
==================== PollOption.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class PollOption
    {
        public int Id { get; set; }
        public int PollId { get; set; }
        public string Text { get; set; } = string.Empty;
        public int DisplayOrder { get; set; } = 0;

        // Navigation Properties
        public Poll Poll { get; set; } = null!;
        public ICollection<PollVote> Votes { get; set; } = new List<PollVote>();
    }
}
 
 
==================== PollVote.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class PollVote
    {
        public int Id { get; set; }
        public int PollOptionId { get; set; }
        public int UserId { get; set; }
        public DateTime VotedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public PollOption PollOption { get; set; } = null!;
        public User User { get; set; } = null!;
    }
}
 
 
==================== Report.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿// Path: OrganizationalMessenger.Domain/Entities/Report.cs

using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class Report
    {
        public int Id { get; set; }

        // گزارش‌دهنده
        public int ReporterId { get; set; }

        // نوع آیتم گزارش شده
        public ReportItemType ItemType { get; set; }

        // شناسه آیتم گزارش شده
        public int? ReportedUserId { get; set; }
        public int? ReportedMessageId { get; set; }
        public int? ReportedGroupId { get; set; }
        public int? ReportedChannelId { get; set; }

        // جزئیات
        public string Reason { get; set; } = string.Empty;
        public string? Description { get; set; }

        // وضعیت
        public ReportStatus Status { get; set; } = ReportStatus.Pending;

        // پاسخ ادمین
        public long? ReviewedByAdminId { get; set; }
        public string? AdminNote { get; set; }
        public DateTime? ReviewedAt { get; set; }

        // زمان‌ها
        public DateTime CreatedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public User Reporter { get; set; } = null!;
        public User? ReportedUser { get; set; }
        public Message? ReportedMessage { get; set; }
        public Group? ReportedGroup { get; set; }
        public Channel? ReportedChannel { get; set; }
        public User? ReviewedByAdmin { get; set; }
    }
}
 
 
==================== ReportedMessage.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class ReportedMessage
    {
        public int Id { get; set; }
        public long MessageId { get; set; }
        public int ReporterId { get; set; } // کسی که گزارش داده
        public string? Reason { get; set; }
        public ReportStatus Status { get; set; } = ReportStatus.Pending;
        public DateTime ReportedAt { get; set; } = DateTime.Now;
        public DateTime? ReviewedAt { get; set; }
        public int? ReviewedByAdminId { get; set; }
        public string? AdminNote { get; set; }

        // Navigation
        public Message Message { get; set; } = null!;
        public User Reporter { get; set; } = null!;
        public AdminUser? ReviewedByAdmin { get; set; }
    }
}
 
 
==================== ServiceLink.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class ServiceLink
    {
        public int Id { get; set; }
        public string Title { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string Url { get; set; } = string.Empty;
        public string IconUrl { get; set; } = string.Empty;
        public string? IconClass { get; set; } // برای Font Awesome
        public int DisplayOrder { get; set; } = 0;
        public bool IsActive { get; set; } = true;
        public bool OpenInNewTab { get; set; } = true;
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public int CreatedByAdminId { get; set; }

        // Navigation
        public AdminUser CreatedByAdmin { get; set; } = null!;
    }
}
 
 
==================== SmsCreditLog.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class SmsCreditLog
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int Amount { get; set; } // مثبت: شارژ، منفی: مصرف
        public string Description { get; set; } = string.Empty;
        public int? RelatedMessageId { get; set; }
        public DateTime CreatedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public User User { get; set; } = null!;
        public Message? RelatedMessage { get; set; }
    }
}
 
 
==================== SmsCreditRequest.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class SmsCreditRequest
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int RequestedAmount { get; set; }
        public string? Reason { get; set; }
        public SmsCreditRequestStatus Status { get; set; } = SmsCreditRequestStatus.Pending;
        public DateTime RequestedAt { get; set; } = DateTime.Now;
        public DateTime? ProcessedAt { get; set; }
        public int? ProcessedByAdminId { get; set; }
        public int? ApprovedAmount { get; set; }
        public string? AdminNote { get; set; }

        // Navigation
        public User User { get; set; } = null!;
        public AdminUser? ProcessedByAdmin { get; set; }
    }
}
 
 
==================== StarredMessage.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class StarredMessage
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int MessageId { get; set; }
        public DateTime StarredAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public User User { get; set; } = null!;
        public Message Message { get; set; } = null!;
    }
}
 
 
==================== SystemAlert.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class SystemAlert
    {
        public int Id { get; set; }
        public string Title { get; set; } = string.Empty;
        public string Content { get; set; } = string.Empty;
        public AlertType Type { get; set; } = AlertType.Info;
        public AlertDeliveryType DeliveryType { get; set; } = AlertDeliveryType.Immediate;
        public bool IsActive { get; set; } = true;
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? ExpiresAt { get; set; }
        public int CreatedByAdminId { get; set; }

        // Navigation
        public AdminUser CreatedByAdmin { get; set; } = null!;
        public ICollection<SystemAlertRead> ReadBy { get; set; } = new List<SystemAlertRead>();
    }

    public class SystemAlertRead
    {
        public int Id { get; set; }
        public int AlertId { get; set; }
        public int UserId { get; set; }
        public DateTime ReadAt { get; set; } = DateTime.Now;

        // Navigation
        public SystemAlert Alert { get; set; } = null!;
        public User User { get; set; } = null!;
    }
}
 
 
==================== SystemNotification.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class SystemNotification
    {
        public int Id { get; set; }
        public string Title { get; set; } = string.Empty;
        public string Content { get; set; } = string.Empty;
        public int SenderId { get; set; }
        public bool SendImmediately { get; set; } = true;
        public bool ShowOnLogin { get; set; } = false;
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? ExpiresAt { get; set; }
        public bool IsActive { get; set; } = true;

        // Navigation Properties
        public User Sender { get; set; } = null!;
    }
}
 
 
==================== SystemSetting.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class SystemSetting
    {
        public int Id { get; set; }
        public string Key { get; set; } = string.Empty;
        public string Value { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string Category { get; set; } = "General";
        public DateTime UpdatedAt { get; set; } = DateTime.Now;
        public int? UpdatedByAdminId { get; set; }

        // Navigation
        public AdminUser? UpdatedByAdmin { get; set; }
    }

    /// <summary>
    /// کلیدهای استاندارد تنظیمات - برای استفاده در کد
    /// </summary>
    public static class SettingKeys
    {
        // احراز هویت
        public const string AuthType = "Auth.Type";
        public const string ADServer = "Auth.AD.Server";
        public const string ADDomain = "Auth.AD.Domain";
        public const string ERPApiUrl = "Auth.ERP.ApiUrl";
        public const string ERPApiKey = "Auth.ERP.ApiKey";
        public const string SMSProviderUrl = "Auth.SMS.ProviderUrl";
        public const string SMSApiKey = "Auth.SMS.ApiKey";
        public const string SMSSenderNumber = "Auth.SMS.SenderNumber";
        public const string OTPExpirationMinutes = "Auth.OTP.ExpirationMinutes";

        // VoIP
        public const string VoIPEnabled = "VoIP.Enabled";
        public const string VoIPServerUrl = "VoIP.ServerUrl";
        public const string VoIPUsername = "VoIP.Username";
        public const string VoIPPassword = "VoIP.Password";
        public const string VoIPProtocol = "VoIP.Protocol";

        // تلگرام
        public const string TelegramEnabled = "Telegram.Enabled";
        public const string TelegramBotToken = "Telegram.BotToken";

        // فایل
        public const string MaxImageSize = "File.MaxImageSize";
        public const string MaxVideoSize = "File.MaxVideoSize";
        public const string MaxFileSize = "File.MaxFileSize";
        public const string AllowedImageTypes = "File.AllowedImageTypes";
        public const string AllowedVideoTypes = "File.AllowedVideoTypes";
        public const string AllowedFileTypes = "File.AllowedFileTypes";

        // پیام
        public const string MessageEditEnabled = "Message.EditEnabled";
        public const string MessageDeleteEnabled = "Message.DeleteEnabled";
        public const string MessageEditTimeLimit = "Message.EditTimeLimit";
        public const string MessageDeleteTimeLimit = "Message.DeleteTimeLimit";
        public const string MessageDeleteAfterRead = "Message.DeleteAfterRead";
        public const string AdminCanDeleteMessages = "Message.AdminCanDelete";
        public const string EncryptionEnabled = "Message.EncryptionEnabled";

        // گروه و کانال
        public const string AllUsersCanCreateGroup = "Group.AllCanCreate";
        public const string AllUsersCanCreateChannel = "Channel.AllCanCreate";
        public const string MaxGroupMembers = "Group.MaxMembers";
        public const string MaxChannelMembers = "Channel.MaxMembers";

        // عمومی
        public const string CompanyName = "General.CompanyName";
        public const string CompanyLogo = "General.CompanyLogo";
        public const string DefaultSmsCredit = "General.DefaultSmsCredit";
    }
}
 
 
==================== TelegramMessage.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class TelegramMessage
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public string TelegramChatId { get; set; } = string.Empty;
        public string? TelegramUsername { get; set; }
        public string? Content { get; set; }
        public string? AttachmentUrl { get; set; }
        public bool IsIncoming { get; set; } // true = از تلگرام به سیستم
        public bool IsRead { get; set; } = false;
        public DateTime CreatedAt { get; set; } = DateTime.Now;

        // Navigation Properties
        public User User { get; set; } = null!;
    }
}
 
 
==================== User.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace OrganizationalMessenger.Domain.Entities
{
    public class User : BaseEntity
    {
        [Required]
        [StringLength(50)]
        public string Username { get; set; } = string.Empty;

        [Required]
        [StringLength(50)]
        public string FirstName { get; set; } = string.Empty;

        [Required]
        [StringLength(50)]
        public string LastName { get; set; } = string.Empty;

        [NotMapped]
        public string FullName => $"{FirstName} {LastName}";

        [StringLength(15)]
        public string? PhoneNumber { get; set; }

        [StringLength(100)]
        [EmailAddress]
        public string? Email { get; set; }

        [StringLength(256)]
        public string? PasswordHash { get; set; }

        // ==================== تصویر پروفایل ====================
        [StringLength(500)]
        public string? ProfilePicture { get; set; }

        [StringLength(500)]
        public string? AvatarUrl { get; set; } // اضافه شد برای سازگاری با ChatController

        [StringLength(200)]
        public string? Bio { get; set; }

        // ==================== وضعیت آنلاین ====================
        public bool IsOnline { get; set; } = false;
        public DateTime? LastSeen { get; set; }
        public DateTime? LastSeenAt { get; set; }

        // ==================== احراز هویت Active Directory ====================
        [StringLength(100)]
        public string? ActiveDirectoryId { get; set; }

        public bool IsADAuthenticated { get; set; } = false;

        // ==================== احراز هویت ERP ====================
        [StringLength(50)]
        public string? ErpUserId { get; set; }

        public bool IsErpAuthenticated { get; set; } = false;

        // ==================== احراز هویت OTP ====================
        [StringLength(10)]
        public string? OtpCode { get; set; }

        public DateTime? OtpExpireTime { get; set; }
        public bool IsOtpVerified { get; set; } = false;

        // ==================== مجوزها و دسترسی‌ها ====================
        public bool CanCreateGroup { get; set; } = true;
        public bool CanCreateChannel { get; set; } = true;
        public bool CanMakeVoiceCall { get; set; } = true;
        public bool CanMakeVideoCall { get; set; } = true;
        public bool IsAdmin { get; set; } = false;

        // ==================== اعتبار پیامک ====================
        public int SmsCredit { get; set; } = 10;

        // ==================== تنظیمات VoIP ====================
        [StringLength(50)]
        public string? VoipExtension { get; set; }

        [StringLength(100)]
        public string? VoipPassword { get; set; }

        public bool VoipEnabled { get; set; } = false;

        // ==================== تنظیمات اعلان‌ها ====================
        public bool NotificationsEnabled { get; set; } = true;
        public bool SoundEnabled { get; set; } = true;
        public bool ShowPreview { get; set; } = true;

        // ==================== وضعیت حساب ====================
        public bool IsActive { get; set; } = true;
        public bool IsBlocked { get; set; } = false;

        [StringLength(500)]
        public string? BlockReason { get; set; }

        public DateTime? BlockedAt { get; set; }

        // ==================== کلید عمومی E2E ====================
        [StringLength(1000)]
        public string? PublicKey { get; set; }

        // ==================== Refresh Token ====================
        [StringLength(500)]
        public string? RefreshToken { get; set; }

        public DateTime? RefreshTokenExpiry { get; set; }

        // ==================== Navigation Properties ====================

        // پیام‌های ارسالی
        public virtual ICollection<Message> SentMessages { get; set; } = new List<Message>();

        // پیام‌های دریافتی
        public virtual ICollection<Message> ReceivedMessages { get; set; } = new List<Message>();

        // گروه‌های ایجاد شده
        public virtual ICollection<Group> CreatedGroups { get; set; } = new List<Group>();

        // عضویت در گروه‌ها
        public virtual ICollection<UserGroup> UserGroups { get; set; } = new List<UserGroup>();

        // کانال‌های ایجاد شده
        public virtual ICollection<Channel> CreatedChannels { get; set; } = new List<Channel>();

        // عضویت در کانال‌ها
        public virtual ICollection<UserChannel> UserChannels { get; set; } = new List<UserChannel>();

        // تماس‌های شروع شده
        public virtual ICollection<Call> InitiatedCalls { get; set; } = new List<Call>();

        // تماس‌های دریافت شده
        public virtual ICollection<Call> ReceivedCalls { get; set; } = new List<Call>();

        // فایل‌های آپلود شده
        public virtual ICollection<FileAttachment> UploadedFiles { get; set; } = new List<FileAttachment>();

        // واکنش‌ها
        public virtual ICollection<MessageReaction> Reactions { get; set; } = new List<MessageReaction>();

        // پیام‌های ستاره‌دار
        public virtual ICollection<StarredMessage> StarredMessages { get; set; } = new List<StarredMessage>();

        // گزارش‌های پیام
        public virtual ICollection<MessageReport> MessageReports { get; set; } = new List<MessageReport>();

        // لاگ‌های ورود
        public virtual ICollection<LoginLog> LoginLogs { get; set; } = new List<LoginLog>();

        // لاگ‌های اعتبار پیامک
        public virtual ICollection<SmsCreditLog> SmsCreditLogs { get; set; } = new List<SmsCreditLog>();

        // ==================== متدهای کمکی ====================

        /// <summary>
        /// به‌روزرسانی زمان آخرین مشاهده
        /// </summary>
        public void UpdateLastSeen()
        {
            LastSeen = DateTime.Now;
            LastSeenAt = DateTime.Now;
        }

        /// <summary>
        /// تنظیم کاربر به حالت آنلاین
        /// </summary>
        public void SetOnline()
        {
            IsOnline = true;
            UpdateLastSeen();
        }

        /// <summary>
        /// تنظیم کاربر به حالت آفلاین
        /// </summary>
        public void SetOffline()
        {
            IsOnline = false;
            UpdateLastSeen();
        }

        /// <summary>
        /// تولید کد OTP جدید
        /// </summary>
        public string GenerateOtp(int expirationMinutes = 5)
        {
            var random = new Random();
            OtpCode = random.Next(100000, 999999).ToString();
            OtpExpireTime = DateTime.Now.AddMinutes(expirationMinutes);
            IsOtpVerified = false;
            return OtpCode;
        }

        /// <summary>
        /// اعتبارسنجی کد OTP
        /// </summary>
        public bool ValidateOtp(string code)
        {
            if (string.IsNullOrEmpty(OtpCode) || OtpExpireTime == null)
                return false;

            if (OtpExpireTime < DateTime.Now)
                return false;

            if (OtpCode != code)
                return false;

            IsOtpVerified = true;
            OtpCode = null;
            OtpExpireTime = null;
            return true;
        }

        /// <summary>
        /// کاهش اعتبار پیامک
        /// </summary>
        public bool DeductSmsCredit(int amount = 1)
        {
            if (SmsCredit < amount)
                return false;

            SmsCredit -= amount;
            return true;
        }

        /// <summary>
        /// افزایش اعتبار پیامک
        /// </summary>
        public void AddSmsCredit(int amount)
        {
            SmsCredit += amount;
        }
    }
}
 
 
==================== UserChannel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;
using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    /// <summary>
    /// جدول واسط برای ارتباط Many-to-Many بین User و Channel
    /// </summary>
    public class UserChannel
    {
        public int Id { get; set; }

        public int UserId { get; set; }
        public int ChannelId { get; set; }

        // ==================== نقش و دسترسی‌ها ====================

        /// <summary>
        /// نقش کاربر در کانال
        /// </summary>
        public ChannelRole Role { get; set; } = ChannelRole.Subscriber;

        /// <summary>
        /// آیا کاربر ادمین کانال است
        /// </summary>
        public bool IsAdmin { get; set; } = false;

        /// <summary>
        /// آیا کاربر مالک/سازنده کانال است
        /// </summary>
        public bool IsOwner { get; set; } = false;

        /// <summary>
        /// آیا کاربر می‌تواند پیام ارسال کند
        /// </summary>
        public bool CanPost { get; set; } = false;

        /// <summary>
        /// آیا کاربر می‌تواند پیام حذف کند
        /// </summary>
        public bool CanDeleteMessages { get; set; } = false;

        /// <summary>
        /// آیا کاربر می‌تواند اعضا را مدیریت کند
        /// </summary>
        public bool CanManageMembers { get; set; } = false;

        // ==================== وضعیت عضویت ====================

        /// <summary>
        /// آیا عضویت فعال است
        /// </summary>
        public bool IsActive { get; set; } = true;

        /// <summary>
        /// تاریخ عضویت
        /// </summary>
        public DateTime JoinedAt { get; set; } = DateTime.Now;

        /// <summary>
        /// تاریخ لغو عضویت
        /// </summary>
        public DateTime? LeftAt { get; set; }

        // ==================== تنظیمات اعلان ====================

        /// <summary>
        /// آیا اعلان‌های کانال برای کاربر فعال است
        /// </summary>
        public bool NotificationsEnabled { get; set; } = true;

        /// <summary>
        /// آیا کانال برای کاربر بی‌صدا شده
        /// </summary>
        public bool IsMuted { get; set; } = false;

        /// <summary>
        /// تاریخ پایان بی‌صدا بودن
        /// </summary>
        public DateTime? MutedUntil { get; set; }

        /// <summary>
        /// آیا کانال پین شده است
        /// </summary>
        public bool IsPinned { get; set; } = false;

        // ==================== وضعیت خواندن پیام‌ها ====================

        /// <summary>
        /// آخرین پیام خوانده شده
        /// </summary>
        public long? LastReadMessageId { get; set; }

        /// <summary>
        /// تعداد پیام‌های خوانده نشده
        /// </summary>
        public int UnreadCount { get; set; } = 0;

        // ==================== Navigation Properties ====================

        [ForeignKey(nameof(UserId))]
        public virtual User User { get; set; } = null!;

        [ForeignKey(nameof(ChannelId))]
        public virtual Channel Channel { get; set; } = null!;

        // ==================== متدهای کمکی ====================

        /// <summary>
        /// ترک کانال
        /// </summary>
        public void Leave()
        {
            IsActive = false;
            LeftAt = DateTime.Now;
        }

        /// <summary>
        /// پیوستن مجدد به کانال
        /// </summary>
        public void Rejoin()
        {
            IsActive = true;
            LeftAt = null;
            JoinedAt = DateTime.Now;
        }

        /// <summary>
        /// بی‌صدا کردن کانال
        /// </summary>
        public void Mute(DateTime? until = null)
        {
            IsMuted = true;
            MutedUntil = until;
            NotificationsEnabled = false;
        }

        /// <summary>
        /// فعال کردن صدای کانال
        /// </summary>
        public void Unmute()
        {
            IsMuted = false;
            MutedUntil = null;
            NotificationsEnabled = true;
        }

        /// <summary>
        /// علامت‌گذاری همه پیام‌ها به عنوان خوانده شده
        /// </summary>
        public void MarkAllAsRead(long lastMessageId)
        {
            LastReadMessageId = lastMessageId;
            UnreadCount = 0;
        }

        /// <summary>
        /// افزایش تعداد پیام‌های خوانده نشده
        /// </summary>
        public void IncrementUnread()
        {
            UnreadCount++;
        }

        /// <summary>
        /// ارتقا به ادمین
        /// </summary>
        public void PromoteToAdmin()
        {
            IsAdmin = true;
            CanPost = true;
            CanDeleteMessages = true;
            CanManageMembers = true;
            Role = ChannelRole.Admin;
        }

        /// <summary>
        /// تنزل از ادمین
        /// </summary>
        public void DemoteFromAdmin()
        {
            IsAdmin = false;
            CanDeleteMessages = false;
            CanManageMembers = false;
            Role = CanPost ? ChannelRole.Publisher : ChannelRole.Subscriber;
        }

        /// <summary>
        /// تنظیم به عنوان مالک
        /// </summary>
        public void SetAsOwner()
        {
            IsOwner = true;
            IsAdmin = true;
            CanPost = true;
            CanDeleteMessages = true;
            CanManageMembers = true;
            Role = ChannelRole.Owner;
        }
    }
}
 
 
==================== UserGroup.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿using OrganizationalMessenger.Domain.Enums;

namespace OrganizationalMessenger.Domain.Entities
{
    public class UserGroup
    {
        public int Id { get; set; }
        public int UserId { get; set; }
        public int GroupId { get; set; }

        // نقش کاربر در گروه
        public GroupRole Role { get; set; } = GroupRole.Member;
        public bool IsAdmin { get; set; } = false; // ⭐ اضافه شد

        // تنظیمات
        public bool IsMuted { get; set; } = false;
        public DateTime? MutedUntil { get; set; }

        // زمان‌ها
        public DateTime JoinedAt { get; set; } = DateTime.Now;
        public bool IsActive { get; set; } = true;

        // Navigation Properties
        public User User { get; set; } = null!;
        public Group Group { get; set; } = null!;
    }
}
 
 
==================== UserPermission.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Entities\ 
 
﻿namespace OrganizationalMessenger.Domain.Entities
{
    public class UserPermission
    {
        public int Id { get; set; }
        public int UserId { get; set; }

        // مجوزهای گروه و کانال
        public bool CanCreateGroup { get; set; } = false;
        public bool CanCreateChannel { get; set; } = false;
        public bool CanCreatePoll { get; set; } = false;

        // مجوزهای ارتباطی
        public bool CanSendBroadcast { get; set; } = false; // آلرت به همه
        public bool CanUseTelegram { get; set; } = false;
        public bool CanUseVoIP { get; set; } = false;

        // اعتبار پیامک
        public int SmsCredit { get; set; } = 0;
        public int SmsCreditUsedThisYear { get; set; } = 0;
        public int SmsCreditYear { get; set; } = DateTime.Now.Year;

        // شماره داخلی VoIP
        public string? VoIPExtension { get; set; }

        // تاریخ‌ها
        public DateTime CreatedAt { get; set; } = DateTime.Now;
        public DateTime? UpdatedAt { get; set; }

        // Navigation
        public User User { get; set; } = null!;
    }
}
 
 
==================== Enums.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\Enums\ 
 
﻿namespace OrganizationalMessenger.Domain.Enums
{
    public enum GroupRole
    {
        Member = 0,
        Admin = 1,
        Owner = 2
    }

  
    public enum ChannelRole
    {
        Subscriber = 0,  // فقط خواندن
        Publisher = 1,   // ارسال پست
        Admin = 2,       // مدیریت
        Owner = 3        // مالک
    }



    public enum MessageType
    {
        Text = 0,
        Image = 1,
        Video = 2,
        Audio = 3,
        Voice = 4,
        File = 5,
        Location = 6,
        Contact = 7,
        Poll = 8,
        System = 9
    }

  
    public enum CallType
    {
        Voice = 0,
        Video = 1
    }

    public enum CallDestinationType
    {
        Private = 0,
        Group = 1,
        Channel = 2
    }

    public enum CallStatus
    {
        Initiated = 0,
        Ringing = 1,
        InProgress = 2,
        Ended = 3,
        Missed = 4,
        Rejected = 5,
        Failed = 6
    }


    public enum ReportStatus
    {
        Pending = 0,
        Reviewed = 1,
        Resolved = 2,
        Dismissed = 3,
        ActionTaken = 4
    }
    public enum AuthenticationType
    {
        Database = 0,      // شماره موبایل از دیتابیس
        ActiveDirectory = 1,
        ERP = 2,
        SMS = 3           // اضافه شد - OTP پیامکی
    }

    public enum MessageDestinationType
    {
        Direct = 1,
        Group = 2,
        Channel = 3
    }


   
    // === Enum های جدید ===

    public enum AlertType
    {
        Info = 0,
        Warning = 1,
        Error = 2,
        Success = 3
    }

    public enum AlertDeliveryType
    {
        Immediate = 0,      // فقط کاربران آنلاین
        Persistent = 1      // همه کاربران (ذخیره در پیام‌های سیستم)
    }

    public enum SmsCreditRequestStatus
    {
        Pending = 0,
        Approved = 1,
        Rejected = 2,
        PartiallyApproved = 3
    }

    public enum SettingCategory
    {
        Authentication = 0,
        VoIP = 1,
        Telegram = 2,
        FileUpload = 3,
        Message = 4,
        GroupChannel = 5,
        General = 6
    }
    public enum ReportItemType
    {
        User = 1,
        Message = 2,
        Group = 3,
        Channel = 4
    }






}
 
 
==================== .NETCoreApp,Version=v8.0.AssemblyAttributes.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\obj\Debug\net8.0\ 
 
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
 
 
==================== OrganizationalMessenger.Domain.AssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("OrganizationalMessenger.Domain")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("OrganizationalMessenger.Domain")]
[assembly: System.Reflection.AssemblyTitleAttribute("OrganizationalMessenger.Domain")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== OrganizationalMessenger.Domain.GlobalUsings.g.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Domain\obj\Debug\net8.0\ 
 
// <auto-generated/>
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Threading;
global using global::System.Threading.Tasks;
 
 
==================== ActiveDirectoryProvider.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Authentication\ 
 
﻿using Microsoft.Extensions.Configuration;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Domain.Entities;
using System.DirectoryServices.AccountManagement;

namespace OrganizationalMessenger.Infrastructure.Authentication
{
    public class ActiveDirectoryProvider : IAuthenticationProvider
    {
        private readonly IConfiguration _configuration;

        public ActiveDirectoryProvider(IConfiguration configuration)
        {
            _configuration = configuration;
        }

        public async Task<AuthenticationResult> AuthenticateAsync(string username, string password)
        {
            return await Task.Run(() =>
            {
                try
                {
                    var domain = _configuration["Authentication:ActiveDirectory:Domain"];

                    using var context = new PrincipalContext(ContextType.Domain, domain);

                    bool isValid = context.ValidateCredentials(username, password);

                    if (!isValid)
                    {
                        return new AuthenticationResult
                        {
                            IsSuccess = false,
                            ErrorMessage = "نام کاربری یا رمز عبور اشتباه است."
                        };
                    }

                    using var userPrincipal = UserPrincipal.FindByIdentity(context, username);

                    if (userPrincipal == null)
                    {
                        return new AuthenticationResult
                        {
                            IsSuccess = false,
                            ErrorMessage = "کاربر یافت نشد."
                        };
                    }

                    return new AuthenticationResult
                    {
                        IsSuccess = true,
                        UserId = userPrincipal.SamAccountName,
                        FirstName = userPrincipal.GivenName,
                        LastName = userPrincipal.Surname,
                        Email = userPrincipal.EmailAddress,
                        PhoneNumber = userPrincipal.VoiceTelephoneNumber
                    };
                }
                catch (Exception ex)
                {
                    return new AuthenticationResult
                    {
                        IsSuccess = false,
                        ErrorMessage = $"خطا در احراز هویت: {ex.Message}"
                    };
                }
            });
        }
    }
}
 
 
==================== AuthenticationManager.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Authentication\ 
 
﻿using Microsoft.Extensions.DependencyInjection;
using OrganizationalMessenger.Application.Interfaces;

namespace OrganizationalMessenger.Infrastructure.Authentication
{
    public class AuthenticationManager : IAuthenticationManager
    {
        private readonly IServiceProvider _serviceProvider;

        public AuthenticationManager(IServiceProvider serviceProvider)
        {
            _serviceProvider = serviceProvider;
        }

        public async Task<AuthenticationResult> AuthenticateAsync(
            string username,
            string password,
            AuthenticationType type)
        {
            var provider = GetProvider(type);
            return await provider.AuthenticateAsync(username, password);
        }

        public async Task<(bool Success, string Message)> SendOtpAsync(string phoneNumber)
        {
            var otpProvider = _serviceProvider.GetRequiredService<OtpAuthenticationProvider>();
            return await otpProvider.SendOtpAsync(phoneNumber);
        }

        public IAuthenticationProvider GetProvider(AuthenticationType type)
        {
            return type switch
            {
                AuthenticationType.ActiveDirectory =>
                    _serviceProvider.GetRequiredService<ActiveDirectoryProvider>(),

                AuthenticationType.ERP =>
                    _serviceProvider.GetRequiredService<ErpAuthenticationProvider>(),

                AuthenticationType.OTP =>
                    _serviceProvider.GetRequiredService<OtpAuthenticationProvider>(),

                _ => throw new NotSupportedException($"Authentication type {type} is not supported.")
            };
        }
    }
}
 
 
==================== ErpAuthenticationProvider.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Authentication\ 
 
﻿using Microsoft.Extensions.Configuration;
using OrganizationalMessenger.Application.Interfaces;
using System.Net.Http.Json;

namespace OrganizationalMessenger.Infrastructure.Authentication
{
    public class ErpAuthenticationProvider : IAuthenticationProvider
    {
        private readonly HttpClient _httpClient;
        private readonly IConfiguration _configuration;

        public ErpAuthenticationProvider(
            IConfiguration configuration,
            IHttpClientFactory httpClientFactory)
        {
            _configuration = configuration;
            _httpClient = httpClientFactory.CreateClient();
        }

        public async Task<AuthenticationResult> AuthenticateAsync(string username, string password)
        {
            try
            {
                var apiUrl = _configuration["Authentication:ERP:ApiUrl"];
                var apiKey = _configuration["Authentication:ERP:ApiKey"];

                var request = new
                {
                    username = username,
                    password = password
                };

                _httpClient.DefaultRequestHeaders.Add("X-API-Key", apiKey);

                var response = await _httpClient.PostAsJsonAsync(
                    $"{apiUrl}/api/auth/validate",
                    request);

                if (!response.IsSuccessStatusCode)
                {
                    return new AuthenticationResult
                    {
                        IsSuccess = false,
                        ErrorMessage = "نام کاربری یا رمز عبور اشتباه است."
                    };
                }

                var result = await response.Content.ReadFromJsonAsync<ErpAuthResponse>();

                return new AuthenticationResult
                {
                    IsSuccess = true,
                    UserId = result?.UserId,
                    FirstName = result?.FirstName,
                    LastName = result?.LastName,
                    Email = result?.Email,
                    PhoneNumber = result?.PhoneNumber
                };
            }
            catch (Exception ex)
            {
                return new AuthenticationResult
                {
                    IsSuccess = false,
                    ErrorMessage = $"خطا در اتصال به سیستم ERP: {ex.Message}"
                };
            }
        }

        private class ErpAuthResponse
        {
            public string? UserId { get; set; }
            public string? FirstName { get; set; }
            public string? LastName { get; set; }
            public string? Email { get; set; }
            public string? PhoneNumber { get; set; }
        }
    }
}
 
 
==================== OtpAuthenticationProvider.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Authentication\ 
 
﻿using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Infrastructure.Data;

namespace OrganizationalMessenger.Infrastructure.Authentication
{
    public class OtpAuthenticationProvider : IAuthenticationProvider
    {
        private readonly ApplicationDbContext _context;
        private readonly ISmsService _smsService;
        private static readonly Dictionary<string, (string Code, DateTime Expiry)> _otpCache = new();

        public OtpAuthenticationProvider(
            ApplicationDbContext context,
            ISmsService smsService)
        {
            _context = context;
            _smsService = smsService;
        }

        public async Task<AuthenticationResult> AuthenticateAsync(string phoneNumber, string otpCode)
        {
            if (!_otpCache.TryGetValue(phoneNumber, out var cachedOtp))
            {
                return new AuthenticationResult
                {
                    IsSuccess = false,
                    ErrorMessage = "کد تایید یافت نشد. لطفاً دوباره درخواست دهید."
                };
            }

            if (cachedOtp.Expiry < DateTime.UtcNow)
            {
                _otpCache.Remove(phoneNumber);
                return new AuthenticationResult
                {
                    IsSuccess = false,
                    ErrorMessage = "کد تایید منقضی شده است."
                };
            }

            if (cachedOtp.Code != otpCode)
            {
                return new AuthenticationResult
                {
                    IsSuccess = false,
                    ErrorMessage = "کد تایید اشتباه است."
                };
            }

            _otpCache.Remove(phoneNumber);

            var user = await _context.Users
                .FirstOrDefaultAsync(u => u.PhoneNumber == phoneNumber);

            if (user == null)
            {
                return new AuthenticationResult
                {
                    IsSuccess = false,
                    ErrorMessage = "کاربر با این شماره تلفن یافت نشد."
                };
            }

            return new AuthenticationResult
            {
                IsSuccess = true,
                UserId = user.Id.ToString(),
                FirstName = user.FirstName,
                LastName = user.LastName,
                Email = user.Email,
                PhoneNumber = user.PhoneNumber
            };
        }

        public async Task<(bool Success, string Message)> SendOtpAsync(string phoneNumber)
        {
            var user = await _context.Users
                .FirstOrDefaultAsync(u => u.PhoneNumber == phoneNumber);

            if (user == null)
            {
                return (false, "کاربر با این شماره تلفن یافت نشد.");
            }

            var otpCode = new Random().Next(100000, 999999).ToString();
            var expiry = DateTime.UtcNow.AddMinutes(5);

            _otpCache[phoneNumber] = (otpCode, expiry);

            var smsResult = await _smsService.SendOtpAsync(phoneNumber, otpCode);

            return (smsResult.Success, smsResult.Message);
        }
    }
}
 
 
==================== ApplicationDbContext.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Data\ 
 
﻿using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;

namespace OrganizationalMessenger.Infrastructure.Data
{
    public class ApplicationDbContext : DbContext
    {
        public ApplicationDbContext(DbContextOptions<ApplicationDbContext> options)
            : base(options)
        {
        }

        // ==================== DbSets ====================
        public DbSet<User> Users { get; set; }
        public DbSet<AdminUser> AdminUsers { get; set; }
        public DbSet<UserPermission> UserPermissions { get; set; }

        public DbSet<Message> Messages { get; set; }
        public DbSet<Group> Groups { get; set; }
        public DbSet<Channel> Channels { get; set; }
        public DbSet<UserGroup> UserGroups { get; set; }
        public DbSet<UserChannel> UserChannels { get; set; }
        public DbSet<GroupMember> GroupMembers { get; set; }
        public DbSet<Call> Calls { get; set; }
        public DbSet<MessageReaction> MessageReactions { get; set; }
        public DbSet<MessageRead> MessageReads { get; set; }
        public DbSet<StarredMessage> StarredMessages { get; set; }
        public DbSet<MessageReport> MessageReports { get; set; }
        public DbSet<ForbiddenWord> ForbiddenWords { get; set; }
        public DbSet<FileUploadSetting> FileUploadSettings { get; set; }
        public DbSet<SystemSetting> SystemSettings { get; set; }
        public DbSet<SystemNotification> SystemNotifications { get; set; }
        public DbSet<ServiceLink> ServiceLinks { get; set; }
        public DbSet<SmsCreditLog> SmsCreditLogs { get; set; }
        public DbSet<Poll> Polls { get; set; }
        public DbSet<PollOption> PollOptions { get; set; }
        public DbSet<PollVote> PollVotes { get; set; }
        public DbSet<LoginLog> LoginLogs { get; set; }
        public DbSet<TelegramMessage> TelegramMessages { get; set; }
        public DbSet<FileAttachment> FileAttachments { get; set; }

        public DbSet<Report> Reports { get; set; }

        protected override void OnModelCreating(ModelBuilder modelBuilder)
        {
            base.OnModelCreating(modelBuilder);

            // ==================== User Configuration ====================
            modelBuilder.Entity<User>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Username)
                    .IsRequired()
                    .HasMaxLength(100);
                entity.HasIndex(e => e.Username).IsUnique();

                entity.Property(e => e.PhoneNumber)
                    .HasMaxLength(20);
                entity.HasIndex(e => e.PhoneNumber).IsUnique();

                entity.Property(e => e.Email).HasMaxLength(200);
                entity.Property(e => e.FirstName).HasMaxLength(100);
                entity.Property(e => e.LastName).HasMaxLength(100);
                entity.Property(e => e.PasswordHash).HasMaxLength(500);
                entity.Property(e => e.AvatarUrl).HasMaxLength(500);
                entity.Property(e => e.ActiveDirectoryId).HasMaxLength(200);
                entity.Property(e => e.ErpUserId).HasMaxLength(200);
                entity.Property(e => e.OtpCode).HasMaxLength(10);
                entity.Property(e => e.VoipExtension).HasMaxLength(50);
            });

            // ==================== AdminUser Configuration ====================
            modelBuilder.Entity<AdminUser>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Username)
                    .IsRequired()
                    .HasMaxLength(100);
                entity.HasIndex(e => e.Username).IsUnique();

                entity.Property(e => e.Email).HasMaxLength(200);
                entity.Property(e => e.FirstName).HasMaxLength(100);
                entity.Property(e => e.LastName).HasMaxLength(100);
                entity.Property(e => e.PasswordHash).HasMaxLength(500);

                // Seed Admin User
                entity.HasData(new AdminUser
                {
                    Id = 1,
                    Username = "admin",
                    PasswordHash = BCrypt.Net.BCrypt.HashPassword("Admin@123"),
                    FirstName = "مدیر",
                    LastName = "سیستم",
                    Email = "admin@company.com",
                    IsActive = true,
                    CreatedAt = DateTime.Now
                });
            });

            // ==================== Message Configuration ====================
            modelBuilder.Entity<Message>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Content).HasMaxLength(4000);
                entity.Property(e => e.EncryptedContent).HasMaxLength(8000);
                entity.Property(e => e.AttachmentUrl).HasMaxLength(500);
                entity.Property(e => e.AttachmentName).HasMaxLength(255);
                entity.Property(e => e.AttachmentType).HasMaxLength(100);

                // Sender Relationship
                entity.HasOne(e => e.Sender)
                    .WithMany(u => u.SentMessages)
                    .HasForeignKey(e => e.SenderId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Receiver Relationship (Private Chat)
                entity.HasOne(e => e.Receiver)
                    .WithMany(u => u.ReceivedMessages)
                    .HasForeignKey(e => e.ReceiverId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Group Relationship
                entity.HasOne(e => e.Group)
                    .WithMany(g => g.Messages)
                    .HasForeignKey(e => e.GroupId)
                    .OnDelete(DeleteBehavior.Cascade);

                // Channel Relationship
                entity.HasOne(e => e.Channel)
                    .WithMany(c => c.Messages)
                    .HasForeignKey(e => e.ChannelId)
                    .OnDelete(DeleteBehavior.Cascade);

                // Reply Relationship
                entity.HasOne(e => e.ReplyToMessage)
                    .WithMany(m => m.Replies)
                    .HasForeignKey(e => e.ReplyToMessageId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Forward Relationship
                entity.HasOne(e => e.ForwardedFromMessage)
                    .WithMany()
                    .HasForeignKey(e => e.ForwardedFromMessageId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Call Relationship
                entity.HasOne(e => e.Call)
                    .WithMany(c => c.Messages)
                    .HasForeignKey(e => e.CallId)
                    .OnDelete(DeleteBehavior.SetNull);

                // Indexes
                entity.HasIndex(e => e.SenderId);
                entity.HasIndex(e => e.ReceiverId);
                entity.HasIndex(e => e.GroupId);
                entity.HasIndex(e => e.ChannelId);
                entity.HasIndex(e => e.CreatedAt);
            });

            // ==================== Group Configuration ====================
            modelBuilder.Entity<Group>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Name)
                    .IsRequired()
                    .HasMaxLength(100);

                entity.Property(e => e.Description).HasMaxLength(500);
                entity.Property(e => e.AvatarUrl).HasMaxLength(500);

                // Creator Relationship
                entity.HasOne(e => e.Creator)
                    .WithMany(u => u.CreatedGroups)
                    .HasForeignKey(e => e.CreatorId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasIndex(e => e.CreatorId);
            });

            // ==================== Channel Configuration ====================
            modelBuilder.Entity<Channel>(entity =>
            {
                entity.HasKey(e => e.Id);

                entity.Property(e => e.Name)
                    .IsRequired()
                    .HasMaxLength(200);

                entity.Property(e => e.AvatarUrl)
                    .HasMaxLength(500);

                entity.HasOne(e => e.Creator)
                    .WithMany(u => u.CreatedChannels)
                    .HasForeignKey(e => e.CreatorId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Query Filter for Soft Delete
                entity.HasQueryFilter(e => !e.IsDeleted);
            });

            // FileAttachment Configuration
            modelBuilder.Entity<FileAttachment>(entity =>
            {
                entity.HasKey(e => e.Id);

                entity.HasIndex(e => e.FileHash);
                entity.HasIndex(e => e.UploaderId);
                entity.HasIndex(e => e.MessageId);
                entity.HasIndex(e => e.CreatedAt);

                entity.HasOne(e => e.Uploader)
                    .WithMany(u => u.UploadedFiles)
                    .HasForeignKey(e => e.UploaderId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(e => e.Message)
                    .WithMany(m => m.Attachments)
                    .HasForeignKey(e => e.MessageId)
                    .OnDelete(DeleteBehavior.Cascade);

                // Query Filter for Soft Delete
                entity.HasQueryFilter(e => !e.IsDeleted);
            });


            // ==================== UserGroup Configuration ====================
            modelBuilder.Entity<UserGroup>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                // Unique Index for User-Group combination
                entity.HasIndex(e => new { e.UserId, e.GroupId }).IsUnique();

                // User Relationship
                entity.HasOne(e => e.User)
                    .WithMany(u => u.UserGroups)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                // Group Relationship
                entity.HasOne(e => e.Group)
                    .WithMany(g => g.UserGroups)
                    .HasForeignKey(e => e.GroupId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== UserChannel Configuration ====================
            // UserChannel Configuration
            modelBuilder.Entity<UserChannel>(entity =>
            {
                entity.HasKey(e => e.Id);

                entity.HasIndex(e => new { e.UserId, e.ChannelId }).IsUnique();

                entity.Property(e => e.Role)
                    .HasConversion<int>();

                entity.HasOne(e => e.User)
                    .WithMany(u => u.UserChannels)
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Channel)
                    .WithMany(c => c.UserChannels)
                    .HasForeignKey(e => e.ChannelId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== GroupMember Configuration ====================
            modelBuilder.Entity<GroupMember>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.HasIndex(e => new { e.UserId, e.GroupId }).IsUnique();

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Group)
                    .WithMany(g => g.Members)
                    .HasForeignKey(e => e.GroupId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== Call Configuration ====================
            modelBuilder.Entity<Call>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.MeetingLink).HasMaxLength(500);
                entity.Property(e => e.MeetingPassword).HasMaxLength(100);

                // Initiator Relationship
                entity.HasOne(e => e.Initiator)
                    .WithMany(u => u.InitiatedCalls)
                    .HasForeignKey(e => e.InitiatorId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Receiver Relationship
                entity.HasOne(e => e.Receiver)
                    .WithMany(u => u.ReceivedCalls)
                    .HasForeignKey(e => e.ReceiverId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Group Relationship
                entity.HasOne(e => e.Group)
                    .WithMany(g => g.Calls)
                    .HasForeignKey(e => e.GroupId)
                    .OnDelete(DeleteBehavior.Restrict);

                // Channel Relationship
                entity.HasOne(e => e.Channel)
                    .WithMany(c => c.Calls)
                    .HasForeignKey(e => e.ChannelId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasIndex(e => e.InitiatorId);
                entity.HasIndex(e => e.ReceiverId);
                entity.HasIndex(e => e.StartedAt);
            });

            // ==================== MessageReaction Configuration ====================
            modelBuilder.Entity<MessageReaction>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Emoji)
                    .IsRequired()
                    .HasMaxLength(50);

                entity.HasIndex(e => new { e.MessageId, e.UserId, e.Emoji }).IsUnique();

                entity.HasOne(e => e.Message)
                    .WithMany(m => m.Reactions)
                    .HasForeignKey(e => e.MessageId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== MessageRead Configuration ====================
            modelBuilder.Entity<MessageRead>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.HasIndex(e => new { e.MessageId, e.UserId }).IsUnique();

                entity.HasOne(e => e.Message)
                    .WithMany(m => m.ReadReceipts)
                    .HasForeignKey(e => e.MessageId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== StarredMessage Configuration ====================
            modelBuilder.Entity<StarredMessage>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.HasIndex(e => new { e.UserId, e.MessageId }).IsUnique();

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Message)
                    .WithMany()
                    .HasForeignKey(e => e.MessageId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== MessageReport Configuration ====================
            modelBuilder.Entity<MessageReport>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Description).HasMaxLength(1000);

                entity.HasOne(e => e.Message)
                    .WithMany()
                    .HasForeignKey(e => e.MessageId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Reporter)
                    .WithMany()
                    .HasForeignKey(e => e.ReporterId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(e => e.ReviewedByAdmin)
                    .WithMany()
                    .HasForeignKey(e => e.ReviewedByAdminId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // ==================== ForbiddenWord Configuration ====================
            modelBuilder.Entity<ForbiddenWord>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Word)
                    .IsRequired()
                    .HasMaxLength(100);

                entity.HasIndex(e => e.Word).IsUnique();
            });

            // ==================== FileUploadSetting Configuration ====================
            modelBuilder.Entity<FileUploadSetting>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.FileType)
                    .IsRequired()
                    .HasMaxLength(50);

                entity.Property(e => e.Category)
                    .IsRequired()
                    .HasMaxLength(50);

                entity.HasIndex(e => e.FileType).IsUnique();

                // Seed Default Settings
                entity.HasData(
                    new FileUploadSetting { Id = 1, FileType = "jpg", Category = "Image", MaxSize = 10 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 2, FileType = "jpeg", Category = "Image", MaxSize = 10 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 3, FileType = "png", Category = "Image", MaxSize = 10 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 4, FileType = "gif", Category = "Image", MaxSize = 5 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 5, FileType = "mp4", Category = "Video", MaxSize = 100 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 6, FileType = "webm", Category = "Video", MaxSize = 100 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 7, FileType = "mp3", Category = "Audio", MaxSize = 20 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 8, FileType = "wav", Category = "Audio", MaxSize = 20 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 9, FileType = "ogg", Category = "Audio", MaxSize = 20 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 10, FileType = "pdf", Category = "Document", MaxSize = 50 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 11, FileType = "doc", Category = "Document", MaxSize = 50 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 12, FileType = "docx", Category = "Document", MaxSize = 50 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 13, FileType = "xls", Category = "Document", MaxSize = 50 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 14, FileType = "xlsx", Category = "Document", MaxSize = 50 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 15, FileType = "zip", Category = "Archive", MaxSize = 100 * 1024 * 1024, IsAllowed = true },
                    new FileUploadSetting { Id = 16, FileType = "rar", Category = "Archive", MaxSize = 100 * 1024 * 1024, IsAllowed = true }
                );
            });

            // ==================== SystemSetting Configuration ====================
            modelBuilder.Entity<SystemSetting>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Key)
                    .IsRequired()
                    .HasMaxLength(100);

                entity.Property(e => e.Value)
                    .IsRequired()
                    .HasMaxLength(1000);

                entity.Property(e => e.Description).HasMaxLength(500);

                entity.HasIndex(e => e.Key).IsUnique();

                // Seed Default Settings
                entity.HasData(
                    new SystemSetting { Id = 1, Key = "AuthenticationType", Value = "Database", Description = "نوع احراز هویت: Database, ActiveDirectory, ERP" },
                    new SystemSetting { Id = 2, Key = "AllowUserGroupCreation", Value = "true", Description = "آیا کاربران می‌توانند گروه ایجاد کنند" },
                    new SystemSetting { Id = 3, Key = "AllowUserChannelCreation", Value = "true", Description = "آیا کاربران می‌توانند کانال ایجاد کنند" },
                    new SystemSetting { Id = 4, Key = "MessageEditTimeLimit", Value = "3600", Description = "زمان مجاز ویرایش پیام (ثانیه)" },
                    new SystemSetting { Id = 5, Key = "MessageDeleteTimeLimit", Value = "7200", Description = "زمان مجاز حذف پیام (ثانیه)" },
                    new SystemSetting { Id = 6, Key = "VoipEnabled", Value = "true", Description = "فعال بودن تماس VoIP" },
                    new SystemSetting { Id = 7, Key = "TelegramIntegrationEnabled", Value = "false", Description = "فعال بودن یکپارچگی تلگرام" },
                    new SystemSetting { Id = 8, Key = "MaxGroupMembers", Value = "200", Description = "حداکثر تعداد اعضای گروه" },
                    new SystemSetting { Id = 9, Key = "OtpExpiryMinutes", Value = "5", Description = "زمان انقضای کد OTP (دقیقه)" },
                    new SystemSetting { Id = 10, Key = "CompanyName", Value = "سازمان", Description = "نام سازمان" },
                    new SystemSetting { Id = 11, Key = "CompanyLogoUrl", Value = "/images/logo.png", Description = "آدرس لوگوی سازمان" }
                );
            });

            // ==================== SystemNotification Configuration ====================
            modelBuilder.Entity<SystemNotification>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Title)
                    .IsRequired()
                    .HasMaxLength(200);

                entity.Property(e => e.Content)
                    .IsRequired()
                    .HasMaxLength(2000);

                entity.HasOne(e => e.Sender)
                    .WithMany()
                    .HasForeignKey(e => e.SenderId)
                    .OnDelete(DeleteBehavior.Restrict);
            });

            // ==================== ServiceLink Configuration ====================
            modelBuilder.Entity<ServiceLink>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Title)
                    .IsRequired()
                    .HasMaxLength(100);

                entity.Property(e => e.Url)
                    .IsRequired()
                    .HasMaxLength(500);

                entity.Property(e => e.IconUrl).HasMaxLength(500);
            });

            // ==================== SmsCreditLog Configuration ====================
            modelBuilder.Entity<SmsCreditLog>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Description)
                    .IsRequired()
                    .HasMaxLength(500);

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.RelatedMessage)
                    .WithMany()
                    .HasForeignKey(e => e.RelatedMessageId)
                    .OnDelete(DeleteBehavior.SetNull);

                entity.HasIndex(e => e.UserId);
                entity.HasIndex(e => e.CreatedAt);
            });

            // ==================== Poll Configuration ====================
            modelBuilder.Entity<Poll>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Question)
                    .IsRequired()
                    .HasMaxLength(500);

                entity.HasOne(e => e.Creator)
                    .WithMany()
                    .HasForeignKey(e => e.CreatorId)
                    .OnDelete(DeleteBehavior.Restrict);

                entity.HasOne(e => e.Group)
                    .WithMany()
                    .HasForeignKey(e => e.GroupId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.Channel)
                    .WithMany()
                    .HasForeignKey(e => e.ChannelId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== PollOption Configuration ====================
            modelBuilder.Entity<PollOption>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.Text)
                    .IsRequired()
                    .HasMaxLength(200);

                entity.HasOne(e => e.Poll)
                    .WithMany(p => p.Options)
                    .HasForeignKey(e => e.PollId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== PollVote Configuration ====================
            modelBuilder.Entity<PollVote>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.HasIndex(e => new { e.PollOptionId, e.UserId }).IsUnique();

                entity.HasOne(e => e.PollOption)
                    .WithMany(o => o.Votes)
                    .HasForeignKey(e => e.PollOptionId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);
            });

            // ==================== LoginLog Configuration ====================
            modelBuilder.Entity<LoginLog>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.IpAddress).HasMaxLength(50);
                entity.Property(e => e.UserAgent).HasMaxLength(500);
                entity.Property(e => e.FailureReason).HasMaxLength(500);

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasIndex(e => e.UserId);
                entity.HasIndex(e => e.CreatedAt);
            });

            // ==================== TelegramMessage Configuration ====================
            modelBuilder.Entity<TelegramMessage>(entity =>
            {
                entity.HasKey(e => e.Id);
                entity.Property(e => e.Id).ValueGeneratedOnAdd();

                entity.Property(e => e.TelegramChatId)
                    .IsRequired()
                    .HasMaxLength(100);

                entity.Property(e => e.TelegramUsername).HasMaxLength(100);
                entity.Property(e => e.Content).HasMaxLength(4000);
                entity.Property(e => e.AttachmentUrl).HasMaxLength(500);

                entity.HasOne(e => e.User)
                    .WithMany()
                    .HasForeignKey(e => e.UserId)
                    .OnDelete(DeleteBehavior.Cascade);

                entity.HasIndex(e => e.UserId);
                entity.HasIndex(e => e.TelegramChatId);
            });
        }
    }
}
 
 
==================== 20260209061809_initDB.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Migrations\ 
 
﻿using System;
using Microsoft.EntityFrameworkCore.Migrations;

#nullable disable

#pragma warning disable CA1814 // Prefer jagged arrays over multidimensional

namespace OrganizationalMessenger.Infrastructure.Migrations
{
    /// <inheritdoc />
    public partial class initDB : Migration
    {
        /// <inheritdoc />
        protected override void Up(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.CreateTable(
                name: "AdminUsers",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Username = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    PasswordHash = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: false),
                    FirstName = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    LastName = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    Email = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: true),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    LastLoginAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_AdminUsers", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "FileUploadSettings",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    FileType = table.Column<string>(type: "nvarchar(50)", maxLength: 50, nullable: false),
                    Category = table.Column<string>(type: "nvarchar(50)", maxLength: 50, nullable: false),
                    MaxSize = table.Column<long>(type: "bigint", nullable: false),
                    IsAllowed = table.Column<bool>(type: "bit", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FileUploadSettings", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ForbiddenWords",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Word = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ForbiddenWords", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "Users",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Username = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    FirstName = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    LastName = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    PhoneNumber = table.Column<string>(type: "nvarchar(20)", maxLength: 20, nullable: true),
                    Email = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: true),
                    PasswordHash = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    ProfilePicture = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    AvatarUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    Bio = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: true),
                    IsOnline = table.Column<bool>(type: "bit", nullable: false),
                    LastSeen = table.Column<DateTime>(type: "datetime2", nullable: true),
                    LastSeenAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    ActiveDirectoryId = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: true),
                    IsADAuthenticated = table.Column<bool>(type: "bit", nullable: false),
                    ErpUserId = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: true),
                    IsErpAuthenticated = table.Column<bool>(type: "bit", nullable: false),
                    OtpCode = table.Column<string>(type: "nvarchar(10)", maxLength: 10, nullable: true),
                    OtpExpireTime = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsOtpVerified = table.Column<bool>(type: "bit", nullable: false),
                    CanCreateGroup = table.Column<bool>(type: "bit", nullable: false),
                    CanCreateChannel = table.Column<bool>(type: "bit", nullable: false),
                    CanMakeVoiceCall = table.Column<bool>(type: "bit", nullable: false),
                    CanMakeVideoCall = table.Column<bool>(type: "bit", nullable: false),
                    IsAdmin = table.Column<bool>(type: "bit", nullable: false),
                    SmsCredit = table.Column<int>(type: "int", nullable: false),
                    VoipExtension = table.Column<string>(type: "nvarchar(50)", maxLength: 50, nullable: true),
                    VoipPassword = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: true),
                    VoipEnabled = table.Column<bool>(type: "bit", nullable: false),
                    NotificationsEnabled = table.Column<bool>(type: "bit", nullable: false),
                    SoundEnabled = table.Column<bool>(type: "bit", nullable: false),
                    ShowPreview = table.Column<bool>(type: "bit", nullable: false),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    IsBlocked = table.Column<bool>(type: "bit", nullable: false),
                    BlockReason = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    BlockedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    PublicKey = table.Column<string>(type: "nvarchar(1000)", maxLength: 1000, nullable: true),
                    RefreshToken = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    RefreshTokenExpiry = table.Column<DateTime>(type: "datetime2", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsDeleted = table.Column<bool>(type: "bit", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Users", x => x.Id);
                });

            migrationBuilder.CreateTable(
                name: "ServiceLinks",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Title = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    Description = table.Column<string>(type: "nvarchar(max)", nullable: true),
                    Url = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: false),
                    IconUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: false),
                    IconClass = table.Column<string>(type: "nvarchar(max)", nullable: true),
                    DisplayOrder = table.Column<int>(type: "int", nullable: false),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    OpenInNewTab = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    CreatedByAdminId = table.Column<int>(type: "int", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_ServiceLinks", x => x.Id);
                    table.ForeignKey(
                        name: "FK_ServiceLinks_AdminUsers_CreatedByAdminId",
                        column: x => x.CreatedByAdminId,
                        principalTable: "AdminUsers",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "SystemSettings",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Key = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    Value = table.Column<string>(type: "nvarchar(1000)", maxLength: 1000, nullable: false),
                    Description = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    Category = table.Column<string>(type: "nvarchar(max)", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedByAdminId = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_SystemSettings", x => x.Id);
                    table.ForeignKey(
                        name: "FK_SystemSettings_AdminUsers_UpdatedByAdminId",
                        column: x => x.UpdatedByAdminId,
                        principalTable: "AdminUsers",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "Channels",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Name = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: false),
                    Description = table.Column<string>(type: "nvarchar(1000)", maxLength: 1000, nullable: true),
                    AvatarUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    CreatorId = table.Column<int>(type: "int", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    IsPublic = table.Column<bool>(type: "bit", nullable: false),
                    IsDeleted = table.Column<bool>(type: "bit", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    OnlyAdminsCanPost = table.Column<bool>(type: "bit", nullable: false),
                    AllowComments = table.Column<bool>(type: "bit", nullable: false),
                    IsPrivate = table.Column<bool>(type: "bit", nullable: false),
                    InviteLink = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: true),
                    MemberCount = table.Column<int>(type: "int", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Channels", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Channels_Users_CreatorId",
                        column: x => x.CreatorId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "Groups",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Name = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    Description = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    AvatarUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    CreatorId = table.Column<int>(type: "int", nullable: false),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    IsPublic = table.Column<bool>(type: "bit", nullable: false),
                    MaxMembers = table.Column<int>(type: "int", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsDeleted = table.Column<bool>(type: "bit", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Groups", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Groups_Users_CreatorId",
                        column: x => x.CreatorId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "LoginLogs",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    AuthType = table.Column<int>(type: "int", nullable: false),
                    IpAddress = table.Column<string>(type: "nvarchar(50)", maxLength: 50, nullable: true),
                    UserAgent = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    IsSuccessful = table.Column<bool>(type: "bit", nullable: false),
                    FailureReason = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UserId1 = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_LoginLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_LoginLogs_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_LoginLogs_Users_UserId1",
                        column: x => x.UserId1,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "SystemNotifications",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Title = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: false),
                    Content = table.Column<string>(type: "nvarchar(2000)", maxLength: 2000, nullable: false),
                    SenderId = table.Column<int>(type: "int", nullable: false),
                    SendImmediately = table.Column<bool>(type: "bit", nullable: false),
                    ShowOnLogin = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    ExpiresAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsActive = table.Column<bool>(type: "bit", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_SystemNotifications", x => x.Id);
                    table.ForeignKey(
                        name: "FK_SystemNotifications_Users_SenderId",
                        column: x => x.SenderId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "TelegramMessages",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    TelegramChatId = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: false),
                    TelegramUsername = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: true),
                    Content = table.Column<string>(type: "nvarchar(4000)", maxLength: 4000, nullable: true),
                    AttachmentUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    IsIncoming = table.Column<bool>(type: "bit", nullable: false),
                    IsRead = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_TelegramMessages", x => x.Id);
                    table.ForeignKey(
                        name: "FK_TelegramMessages_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "UserPermissions",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    CanCreateGroup = table.Column<bool>(type: "bit", nullable: false),
                    CanCreateChannel = table.Column<bool>(type: "bit", nullable: false),
                    CanCreatePoll = table.Column<bool>(type: "bit", nullable: false),
                    CanSendBroadcast = table.Column<bool>(type: "bit", nullable: false),
                    CanUseTelegram = table.Column<bool>(type: "bit", nullable: false),
                    CanUseVoIP = table.Column<bool>(type: "bit", nullable: false),
                    SmsCredit = table.Column<int>(type: "int", nullable: false),
                    SmsCreditUsedThisYear = table.Column<int>(type: "int", nullable: false),
                    SmsCreditYear = table.Column<int>(type: "int", nullable: false),
                    VoIPExtension = table.Column<string>(type: "nvarchar(max)", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_UserPermissions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_UserPermissions_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "UserChannels",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    ChannelId = table.Column<int>(type: "int", nullable: false),
                    Role = table.Column<int>(type: "int", nullable: false),
                    IsAdmin = table.Column<bool>(type: "bit", nullable: false),
                    IsOwner = table.Column<bool>(type: "bit", nullable: false),
                    CanPost = table.Column<bool>(type: "bit", nullable: false),
                    CanDeleteMessages = table.Column<bool>(type: "bit", nullable: false),
                    CanManageMembers = table.Column<bool>(type: "bit", nullable: false),
                    IsActive = table.Column<bool>(type: "bit", nullable: false),
                    JoinedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    LeftAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    NotificationsEnabled = table.Column<bool>(type: "bit", nullable: false),
                    IsMuted = table.Column<bool>(type: "bit", nullable: false),
                    MutedUntil = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsPinned = table.Column<bool>(type: "bit", nullable: false),
                    LastReadMessageId = table.Column<long>(type: "bigint", nullable: true),
                    UnreadCount = table.Column<int>(type: "int", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_UserChannels", x => x.Id);
                    table.ForeignKey(
                        name: "FK_UserChannels_Channels_ChannelId",
                        column: x => x.ChannelId,
                        principalTable: "Channels",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_UserChannels_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Calls",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    InitiatorId = table.Column<int>(type: "int", nullable: false),
                    ReceiverId = table.Column<int>(type: "int", nullable: true),
                    Type = table.Column<int>(type: "int", nullable: false),
                    DestinationType = table.Column<int>(type: "int", nullable: false),
                    GroupId = table.Column<int>(type: "int", nullable: true),
                    ChannelId = table.Column<int>(type: "int", nullable: true),
                    Status = table.Column<int>(type: "int", nullable: false),
                    StartedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    EndedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    Duration = table.Column<int>(type: "int", nullable: true),
                    MeetingLink = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    MeetingPassword = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsDeleted = table.Column<bool>(type: "bit", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Calls", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Calls_Channels_ChannelId",
                        column: x => x.ChannelId,
                        principalTable: "Channels",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Calls_Groups_GroupId",
                        column: x => x.GroupId,
                        principalTable: "Groups",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Calls_Users_InitiatorId",
                        column: x => x.InitiatorId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Calls_Users_ReceiverId",
                        column: x => x.ReceiverId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "GroupMembers",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    GroupId = table.Column<int>(type: "int", nullable: false),
                    Role = table.Column<int>(type: "int", nullable: false),
                    JoinedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    IsMuted = table.Column<bool>(type: "bit", nullable: false),
                    MutedUntil = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsActive = table.Column<bool>(type: "bit", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_GroupMembers", x => x.Id);
                    table.ForeignKey(
                        name: "FK_GroupMembers_Groups_GroupId",
                        column: x => x.GroupId,
                        principalTable: "Groups",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_GroupMembers_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Polls",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    Question = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: false),
                    CreatorId = table.Column<int>(type: "int", nullable: false),
                    GroupId = table.Column<int>(type: "int", nullable: true),
                    ChannelId = table.Column<int>(type: "int", nullable: true),
                    AllowMultipleAnswers = table.Column<bool>(type: "bit", nullable: false),
                    IsAnonymous = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    ExpiresAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsActive = table.Column<bool>(type: "bit", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Polls", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Polls_Channels_ChannelId",
                        column: x => x.ChannelId,
                        principalTable: "Channels",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Polls_Groups_GroupId",
                        column: x => x.GroupId,
                        principalTable: "Groups",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Polls_Users_CreatorId",
                        column: x => x.CreatorId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "UserGroups",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    GroupId = table.Column<int>(type: "int", nullable: false),
                    Role = table.Column<int>(type: "int", nullable: false),
                    IsAdmin = table.Column<bool>(type: "bit", nullable: false),
                    IsMuted = table.Column<bool>(type: "bit", nullable: false),
                    MutedUntil = table.Column<DateTime>(type: "datetime2", nullable: true),
                    JoinedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    IsActive = table.Column<bool>(type: "bit", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_UserGroups", x => x.Id);
                    table.ForeignKey(
                        name: "FK_UserGroups_Groups_GroupId",
                        column: x => x.GroupId,
                        principalTable: "Groups",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_UserGroups_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "Messages",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    SenderId = table.Column<int>(type: "int", nullable: false),
                    ReceiverId = table.Column<int>(type: "int", nullable: true),
                    GroupId = table.Column<int>(type: "int", nullable: true),
                    ChannelId = table.Column<int>(type: "int", nullable: true),
                    MessageText = table.Column<string>(type: "nvarchar(max)", nullable: true),
                    Content = table.Column<string>(type: "nvarchar(4000)", maxLength: 4000, nullable: true),
                    EncryptedContent = table.Column<string>(type: "nvarchar(max)", maxLength: 8000, nullable: true),
                    Type = table.Column<int>(type: "int", nullable: false),
                    AttachmentUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    AttachmentName = table.Column<string>(type: "nvarchar(255)", maxLength: 255, nullable: true),
                    AttachmentType = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: true),
                    AttachmentSize = table.Column<long>(type: "bigint", nullable: true),
                    SentAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    DeliveredAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    ReadAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsRead = table.Column<bool>(type: "bit", nullable: false),
                    IsDelivered = table.Column<bool>(type: "bit", nullable: false),
                    IsEdited = table.Column<bool>(type: "bit", nullable: false),
                    EditedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    ReplyToMessageId = table.Column<int>(type: "int", nullable: true),
                    ForwardedFromMessageId = table.Column<int>(type: "int", nullable: true),
                    CallId = table.Column<int>(type: "int", nullable: true),
                    IsSystemMessage = table.Column<bool>(type: "bit", nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UpdatedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsDeleted = table.Column<bool>(type: "bit", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Messages", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Messages_Calls_CallId",
                        column: x => x.CallId,
                        principalTable: "Calls",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.SetNull);
                    table.ForeignKey(
                        name: "FK_Messages_Channels_ChannelId",
                        column: x => x.ChannelId,
                        principalTable: "Channels",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Messages_Groups_GroupId",
                        column: x => x.GroupId,
                        principalTable: "Groups",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Messages_Messages_ForwardedFromMessageId",
                        column: x => x.ForwardedFromMessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Messages_Messages_ReplyToMessageId",
                        column: x => x.ReplyToMessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Messages_Users_ReceiverId",
                        column: x => x.ReceiverId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_Messages_Users_SenderId",
                        column: x => x.SenderId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "PollOptions",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    PollId = table.Column<int>(type: "int", nullable: false),
                    Text = table.Column<string>(type: "nvarchar(200)", maxLength: 200, nullable: false),
                    DisplayOrder = table.Column<int>(type: "int", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PollOptions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_PollOptions_Polls_PollId",
                        column: x => x.PollId,
                        principalTable: "Polls",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "FileAttachments",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    FileName = table.Column<string>(type: "nvarchar(255)", maxLength: 255, nullable: false),
                    OriginalFileName = table.Column<string>(type: "nvarchar(255)", maxLength: 255, nullable: false),
                    FilePath = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: false),
                    FileUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    ContentType = table.Column<string>(type: "nvarchar(100)", maxLength: 100, nullable: true),
                    Extension = table.Column<string>(type: "nvarchar(10)", maxLength: 10, nullable: true),
                    FileSize = table.Column<long>(type: "bigint", nullable: false),
                    FileType = table.Column<string>(type: "nvarchar(50)", maxLength: 50, nullable: false),
                    ThumbnailPath = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    ThumbnailUrl = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    Width = table.Column<int>(type: "int", nullable: true),
                    Height = table.Column<int>(type: "int", nullable: true),
                    Duration = table.Column<int>(type: "int", nullable: true),
                    UploaderId = table.Column<int>(type: "int", nullable: false),
                    MessageId = table.Column<int>(type: "int", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    DeletedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    IsDeleted = table.Column<bool>(type: "bit", nullable: false),
                    FileHash = table.Column<string>(type: "nvarchar(64)", maxLength: 64, nullable: true),
                    IsScanned = table.Column<bool>(type: "bit", nullable: false),
                    IsSafe = table.Column<bool>(type: "bit", nullable: false),
                    ScannedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    ScanResult = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: true),
                    DownloadCount = table.Column<int>(type: "int", nullable: false),
                    LastDownloadAt = table.Column<DateTime>(type: "datetime2", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_FileAttachments", x => x.Id);
                    table.ForeignKey(
                        name: "FK_FileAttachments_Messages_MessageId",
                        column: x => x.MessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_FileAttachments_Users_UploaderId",
                        column: x => x.UploaderId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                });

            migrationBuilder.CreateTable(
                name: "MessageReactions",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    MessageId = table.Column<int>(type: "int", nullable: false),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    Emoji = table.Column<string>(type: "nvarchar(50)", maxLength: 50, nullable: false),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UserId1 = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_MessageReactions", x => x.Id);
                    table.ForeignKey(
                        name: "FK_MessageReactions_Messages_MessageId",
                        column: x => x.MessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_MessageReactions_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_MessageReactions_Users_UserId1",
                        column: x => x.UserId1,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "MessageReads",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    MessageId = table.Column<int>(type: "int", nullable: false),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    ReadAt = table.Column<DateTime>(type: "datetime2", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_MessageReads", x => x.Id);
                    table.ForeignKey(
                        name: "FK_MessageReads_Messages_MessageId",
                        column: x => x.MessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_MessageReads_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.CreateTable(
                name: "MessageReports",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    MessageId = table.Column<int>(type: "int", nullable: false),
                    ReporterId = table.Column<int>(type: "int", nullable: false),
                    Description = table.Column<string>(type: "nvarchar(1000)", maxLength: 1000, nullable: true),
                    IsReviewed = table.Column<bool>(type: "bit", nullable: false),
                    ReviewedByAdminId = table.Column<int>(type: "int", nullable: true),
                    ReviewedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UserId = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_MessageReports", x => x.Id);
                    table.ForeignKey(
                        name: "FK_MessageReports_Messages_MessageId",
                        column: x => x.MessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_MessageReports_Users_ReporterId",
                        column: x => x.ReporterId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_MessageReports_Users_ReviewedByAdminId",
                        column: x => x.ReviewedByAdminId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Restrict);
                    table.ForeignKey(
                        name: "FK_MessageReports_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "Reports",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    ReporterId = table.Column<int>(type: "int", nullable: false),
                    ItemType = table.Column<int>(type: "int", nullable: false),
                    ReportedUserId = table.Column<int>(type: "int", nullable: true),
                    ReportedMessageId = table.Column<int>(type: "int", nullable: true),
                    ReportedGroupId = table.Column<int>(type: "int", nullable: true),
                    ReportedChannelId = table.Column<int>(type: "int", nullable: true),
                    Reason = table.Column<string>(type: "nvarchar(max)", nullable: false),
                    Description = table.Column<string>(type: "nvarchar(max)", nullable: true),
                    Status = table.Column<int>(type: "int", nullable: false),
                    ReviewedByAdminId = table.Column<long>(type: "bigint", nullable: true),
                    AdminNote = table.Column<string>(type: "nvarchar(max)", nullable: true),
                    ReviewedAt = table.Column<DateTime>(type: "datetime2", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    ReviewedByAdminId1 = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_Reports", x => x.Id);
                    table.ForeignKey(
                        name: "FK_Reports_Channels_ReportedChannelId",
                        column: x => x.ReportedChannelId,
                        principalTable: "Channels",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Reports_Groups_ReportedGroupId",
                        column: x => x.ReportedGroupId,
                        principalTable: "Groups",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Reports_Messages_ReportedMessageId",
                        column: x => x.ReportedMessageId,
                        principalTable: "Messages",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Reports_Users_ReportedUserId",
                        column: x => x.ReportedUserId,
                        principalTable: "Users",
                        principalColumn: "Id");
                    table.ForeignKey(
                        name: "FK_Reports_Users_ReporterId",
                        column: x => x.ReporterId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_Reports_Users_ReviewedByAdminId1",
                        column: x => x.ReviewedByAdminId1,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "SmsCreditLogs",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    Amount = table.Column<int>(type: "int", nullable: false),
                    Description = table.Column<string>(type: "nvarchar(500)", maxLength: 500, nullable: false),
                    RelatedMessageId = table.Column<int>(type: "int", nullable: true),
                    CreatedAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UserId1 = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_SmsCreditLogs", x => x.Id);
                    table.ForeignKey(
                        name: "FK_SmsCreditLogs_Messages_RelatedMessageId",
                        column: x => x.RelatedMessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.SetNull);
                    table.ForeignKey(
                        name: "FK_SmsCreditLogs_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_SmsCreditLogs_Users_UserId1",
                        column: x => x.UserId1,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "StarredMessages",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    MessageId = table.Column<int>(type: "int", nullable: false),
                    StarredAt = table.Column<DateTime>(type: "datetime2", nullable: false),
                    UserId1 = table.Column<int>(type: "int", nullable: true)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_StarredMessages", x => x.Id);
                    table.ForeignKey(
                        name: "FK_StarredMessages_Messages_MessageId",
                        column: x => x.MessageId,
                        principalTable: "Messages",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_StarredMessages_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_StarredMessages_Users_UserId1",
                        column: x => x.UserId1,
                        principalTable: "Users",
                        principalColumn: "Id");
                });

            migrationBuilder.CreateTable(
                name: "PollVotes",
                columns: table => new
                {
                    Id = table.Column<int>(type: "int", nullable: false)
                        .Annotation("SqlServer:Identity", "1, 1"),
                    PollOptionId = table.Column<int>(type: "int", nullable: false),
                    UserId = table.Column<int>(type: "int", nullable: false),
                    VotedAt = table.Column<DateTime>(type: "datetime2", nullable: false)
                },
                constraints: table =>
                {
                    table.PrimaryKey("PK_PollVotes", x => x.Id);
                    table.ForeignKey(
                        name: "FK_PollVotes_PollOptions_PollOptionId",
                        column: x => x.PollOptionId,
                        principalTable: "PollOptions",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                    table.ForeignKey(
                        name: "FK_PollVotes_Users_UserId",
                        column: x => x.UserId,
                        principalTable: "Users",
                        principalColumn: "Id",
                        onDelete: ReferentialAction.Cascade);
                });

            migrationBuilder.InsertData(
                table: "AdminUsers",
                columns: new[] { "Id", "CreatedAt", "Email", "FirstName", "IsActive", "LastLoginAt", "LastName", "PasswordHash", "Username" },
                values: new object[] { 1, new DateTime(2026, 2, 9, 9, 48, 8, 65, DateTimeKind.Local).AddTicks(9793), "admin@company.com", "مدیر", true, null, "سیستم", "$2a$11$9t1CsubdkLWzCxr5Nf2TvOGRMtSnqC.7Y2/jbkJXRIXFOrAw8nQby", "admin" });

            migrationBuilder.InsertData(
                table: "FileUploadSettings",
                columns: new[] { "Id", "Category", "FileType", "IsAllowed", "MaxSize" },
                values: new object[,]
                {
                    { 1, "Image", "jpg", true, 10485760L },
                    { 2, "Image", "jpeg", true, 10485760L },
                    { 3, "Image", "png", true, 10485760L },
                    { 4, "Image", "gif", true, 5242880L },
                    { 5, "Video", "mp4", true, 104857600L },
                    { 6, "Video", "webm", true, 104857600L },
                    { 7, "Audio", "mp3", true, 20971520L },
                    { 8, "Audio", "wav", true, 20971520L },
                    { 9, "Audio", "ogg", true, 20971520L },
                    { 10, "Document", "pdf", true, 52428800L },
                    { 11, "Document", "doc", true, 52428800L },
                    { 12, "Document", "docx", true, 52428800L },
                    { 13, "Document", "xls", true, 52428800L },
                    { 14, "Document", "xlsx", true, 52428800L },
                    { 15, "Archive", "zip", true, 104857600L },
                    { 16, "Archive", "rar", true, 104857600L }
                });

            migrationBuilder.InsertData(
                table: "SystemSettings",
                columns: new[] { "Id", "Category", "Description", "Key", "UpdatedAt", "UpdatedByAdminId", "Value" },
                values: new object[,]
                {
                    { 1, "General", "نوع احراز هویت: Database, ActiveDirectory, ERP", "AuthenticationType", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6596), null, "Database" },
                    { 2, "General", "آیا کاربران می‌توانند گروه ایجاد کنند", "AllowUserGroupCreation", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6614), null, "true" },
                    { 3, "General", "آیا کاربران می‌توانند کانال ایجاد کنند", "AllowUserChannelCreation", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6615), null, "true" },
                    { 4, "General", "زمان مجاز ویرایش پیام (ثانیه)", "MessageEditTimeLimit", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6616), null, "3600" },
                    { 5, "General", "زمان مجاز حذف پیام (ثانیه)", "MessageDeleteTimeLimit", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6617), null, "7200" },
                    { 6, "General", "فعال بودن تماس VoIP", "VoipEnabled", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6618), null, "true" },
                    { 7, "General", "فعال بودن یکپارچگی تلگرام", "TelegramIntegrationEnabled", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6619), null, "false" },
                    { 8, "General", "حداکثر تعداد اعضای گروه", "MaxGroupMembers", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6620), null, "200" },
                    { 9, "General", "زمان انقضای کد OTP (دقیقه)", "OtpExpiryMinutes", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6621), null, "5" },
                    { 10, "General", "نام سازمان", "CompanyName", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6622), null, "سازمان" },
                    { 11, "General", "آدرس لوگوی سازمان", "CompanyLogoUrl", new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6623), null, "/images/logo.png" }
                });

            migrationBuilder.CreateIndex(
                name: "IX_AdminUsers_Username",
                table: "AdminUsers",
                column: "Username",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_Calls_ChannelId",
                table: "Calls",
                column: "ChannelId");

            migrationBuilder.CreateIndex(
                name: "IX_Calls_GroupId",
                table: "Calls",
                column: "GroupId");

            migrationBuilder.CreateIndex(
                name: "IX_Calls_InitiatorId",
                table: "Calls",
                column: "InitiatorId");

            migrationBuilder.CreateIndex(
                name: "IX_Calls_ReceiverId",
                table: "Calls",
                column: "ReceiverId");

            migrationBuilder.CreateIndex(
                name: "IX_Calls_StartedAt",
                table: "Calls",
                column: "StartedAt");

            migrationBuilder.CreateIndex(
                name: "IX_Channels_CreatorId",
                table: "Channels",
                column: "CreatorId");

            migrationBuilder.CreateIndex(
                name: "IX_FileAttachments_CreatedAt",
                table: "FileAttachments",
                column: "CreatedAt");

            migrationBuilder.CreateIndex(
                name: "IX_FileAttachments_FileHash",
                table: "FileAttachments",
                column: "FileHash");

            migrationBuilder.CreateIndex(
                name: "IX_FileAttachments_MessageId",
                table: "FileAttachments",
                column: "MessageId");

            migrationBuilder.CreateIndex(
                name: "IX_FileAttachments_UploaderId",
                table: "FileAttachments",
                column: "UploaderId");

            migrationBuilder.CreateIndex(
                name: "IX_FileUploadSettings_FileType",
                table: "FileUploadSettings",
                column: "FileType",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_ForbiddenWords_Word",
                table: "ForbiddenWords",
                column: "Word",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_GroupMembers_GroupId",
                table: "GroupMembers",
                column: "GroupId");

            migrationBuilder.CreateIndex(
                name: "IX_GroupMembers_UserId_GroupId",
                table: "GroupMembers",
                columns: new[] { "UserId", "GroupId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_Groups_CreatorId",
                table: "Groups",
                column: "CreatorId");

            migrationBuilder.CreateIndex(
                name: "IX_LoginLogs_CreatedAt",
                table: "LoginLogs",
                column: "CreatedAt");

            migrationBuilder.CreateIndex(
                name: "IX_LoginLogs_UserId",
                table: "LoginLogs",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_LoginLogs_UserId1",
                table: "LoginLogs",
                column: "UserId1");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReactions_MessageId_UserId_Emoji",
                table: "MessageReactions",
                columns: new[] { "MessageId", "UserId", "Emoji" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_MessageReactions_UserId",
                table: "MessageReactions",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReactions_UserId1",
                table: "MessageReactions",
                column: "UserId1");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReads_MessageId_UserId",
                table: "MessageReads",
                columns: new[] { "MessageId", "UserId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_MessageReads_UserId",
                table: "MessageReads",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReports_MessageId",
                table: "MessageReports",
                column: "MessageId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReports_ReporterId",
                table: "MessageReports",
                column: "ReporterId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReports_ReviewedByAdminId",
                table: "MessageReports",
                column: "ReviewedByAdminId");

            migrationBuilder.CreateIndex(
                name: "IX_MessageReports_UserId",
                table: "MessageReports",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_CallId",
                table: "Messages",
                column: "CallId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_ChannelId",
                table: "Messages",
                column: "ChannelId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_CreatedAt",
                table: "Messages",
                column: "CreatedAt");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_ForwardedFromMessageId",
                table: "Messages",
                column: "ForwardedFromMessageId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_GroupId",
                table: "Messages",
                column: "GroupId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_ReceiverId",
                table: "Messages",
                column: "ReceiverId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_ReplyToMessageId",
                table: "Messages",
                column: "ReplyToMessageId");

            migrationBuilder.CreateIndex(
                name: "IX_Messages_SenderId",
                table: "Messages",
                column: "SenderId");

            migrationBuilder.CreateIndex(
                name: "IX_PollOptions_PollId",
                table: "PollOptions",
                column: "PollId");

            migrationBuilder.CreateIndex(
                name: "IX_Polls_ChannelId",
                table: "Polls",
                column: "ChannelId");

            migrationBuilder.CreateIndex(
                name: "IX_Polls_CreatorId",
                table: "Polls",
                column: "CreatorId");

            migrationBuilder.CreateIndex(
                name: "IX_Polls_GroupId",
                table: "Polls",
                column: "GroupId");

            migrationBuilder.CreateIndex(
                name: "IX_PollVotes_PollOptionId_UserId",
                table: "PollVotes",
                columns: new[] { "PollOptionId", "UserId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_PollVotes_UserId",
                table: "PollVotes",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReportedChannelId",
                table: "Reports",
                column: "ReportedChannelId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReportedGroupId",
                table: "Reports",
                column: "ReportedGroupId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReportedMessageId",
                table: "Reports",
                column: "ReportedMessageId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReportedUserId",
                table: "Reports",
                column: "ReportedUserId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReporterId",
                table: "Reports",
                column: "ReporterId");

            migrationBuilder.CreateIndex(
                name: "IX_Reports_ReviewedByAdminId1",
                table: "Reports",
                column: "ReviewedByAdminId1");

            migrationBuilder.CreateIndex(
                name: "IX_ServiceLinks_CreatedByAdminId",
                table: "ServiceLinks",
                column: "CreatedByAdminId");

            migrationBuilder.CreateIndex(
                name: "IX_SmsCreditLogs_CreatedAt",
                table: "SmsCreditLogs",
                column: "CreatedAt");

            migrationBuilder.CreateIndex(
                name: "IX_SmsCreditLogs_RelatedMessageId",
                table: "SmsCreditLogs",
                column: "RelatedMessageId");

            migrationBuilder.CreateIndex(
                name: "IX_SmsCreditLogs_UserId",
                table: "SmsCreditLogs",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_SmsCreditLogs_UserId1",
                table: "SmsCreditLogs",
                column: "UserId1");

            migrationBuilder.CreateIndex(
                name: "IX_StarredMessages_MessageId",
                table: "StarredMessages",
                column: "MessageId");

            migrationBuilder.CreateIndex(
                name: "IX_StarredMessages_UserId_MessageId",
                table: "StarredMessages",
                columns: new[] { "UserId", "MessageId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_StarredMessages_UserId1",
                table: "StarredMessages",
                column: "UserId1");

            migrationBuilder.CreateIndex(
                name: "IX_SystemNotifications_SenderId",
                table: "SystemNotifications",
                column: "SenderId");

            migrationBuilder.CreateIndex(
                name: "IX_SystemSettings_Key",
                table: "SystemSettings",
                column: "Key",
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_SystemSettings_UpdatedByAdminId",
                table: "SystemSettings",
                column: "UpdatedByAdminId");

            migrationBuilder.CreateIndex(
                name: "IX_TelegramMessages_TelegramChatId",
                table: "TelegramMessages",
                column: "TelegramChatId");

            migrationBuilder.CreateIndex(
                name: "IX_TelegramMessages_UserId",
                table: "TelegramMessages",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_UserChannels_ChannelId",
                table: "UserChannels",
                column: "ChannelId");

            migrationBuilder.CreateIndex(
                name: "IX_UserChannels_UserId_ChannelId",
                table: "UserChannels",
                columns: new[] { "UserId", "ChannelId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_UserGroups_GroupId",
                table: "UserGroups",
                column: "GroupId");

            migrationBuilder.CreateIndex(
                name: "IX_UserGroups_UserId_GroupId",
                table: "UserGroups",
                columns: new[] { "UserId", "GroupId" },
                unique: true);

            migrationBuilder.CreateIndex(
                name: "IX_UserPermissions_UserId",
                table: "UserPermissions",
                column: "UserId");

            migrationBuilder.CreateIndex(
                name: "IX_Users_PhoneNumber",
                table: "Users",
                column: "PhoneNumber",
                unique: true,
                filter: "[PhoneNumber] IS NOT NULL");

            migrationBuilder.CreateIndex(
                name: "IX_Users_Username",
                table: "Users",
                column: "Username",
                unique: true);
        }

        /// <inheritdoc />
        protected override void Down(MigrationBuilder migrationBuilder)
        {
            migrationBuilder.DropTable(
                name: "FileAttachments");

            migrationBuilder.DropTable(
                name: "FileUploadSettings");

            migrationBuilder.DropTable(
                name: "ForbiddenWords");

            migrationBuilder.DropTable(
                name: "GroupMembers");

            migrationBuilder.DropTable(
                name: "LoginLogs");

            migrationBuilder.DropTable(
                name: "MessageReactions");

            migrationBuilder.DropTable(
                name: "MessageReads");

            migrationBuilder.DropTable(
                name: "MessageReports");

            migrationBuilder.DropTable(
                name: "PollVotes");

            migrationBuilder.DropTable(
                name: "Reports");

            migrationBuilder.DropTable(
                name: "ServiceLinks");

            migrationBuilder.DropTable(
                name: "SmsCreditLogs");

            migrationBuilder.DropTable(
                name: "StarredMessages");

            migrationBuilder.DropTable(
                name: "SystemNotifications");

            migrationBuilder.DropTable(
                name: "SystemSettings");

            migrationBuilder.DropTable(
                name: "TelegramMessages");

            migrationBuilder.DropTable(
                name: "UserChannels");

            migrationBuilder.DropTable(
                name: "UserGroups");

            migrationBuilder.DropTable(
                name: "UserPermissions");

            migrationBuilder.DropTable(
                name: "PollOptions");

            migrationBuilder.DropTable(
                name: "Messages");

            migrationBuilder.DropTable(
                name: "AdminUsers");

            migrationBuilder.DropTable(
                name: "Polls");

            migrationBuilder.DropTable(
                name: "Calls");

            migrationBuilder.DropTable(
                name: "Channels");

            migrationBuilder.DropTable(
                name: "Groups");

            migrationBuilder.DropTable(
                name: "Users");
        }
    }
}
 
 
==================== 20260209061809_initDB.Designer.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Migrations\ 
 
﻿// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Metadata;
using Microsoft.EntityFrameworkCore.Migrations;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using OrganizationalMessenger.Infrastructure.Data;

#nullable disable

namespace OrganizationalMessenger.Infrastructure.Migrations
{
    [DbContext(typeof(ApplicationDbContext))]
    [Migration("20260209061809_initDB")]
    partial class initDB
    {
        /// <inheritdoc />
        protected override void BuildTargetModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.23")
                .HasAnnotation("Relational:MaxIdentifierLength", 128);

            SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.AdminUser", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Email")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("FirstName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("LastName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.HasKey("Id");

                    b.HasIndex("Username")
                        .IsUnique();

                    b.ToTable("AdminUsers");

                    b.HasData(
                        new
                        {
                            Id = 1,
                            CreatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 65, DateTimeKind.Local).AddTicks(9793),
                            Email = "admin@company.com",
                            FirstName = "مدیر",
                            IsActive = true,
                            LastName = "سیستم",
                            PasswordHash = "$2a$11$9t1CsubdkLWzCxr5Nf2TvOGRMtSnqC.7Y2/jbkJXRIXFOrAw8nQby",
                            Username = "admin"
                        });
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Call", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int?>("ChannelId")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("DestinationType")
                        .HasColumnType("int");

                    b.Property<int?>("Duration")
                        .HasColumnType("int");

                    b.Property<DateTime?>("EndedAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("GroupId")
                        .HasColumnType("int");

                    b.Property<int>("InitiatorId")
                        .HasColumnType("int");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<string>("MeetingLink")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("MeetingPassword")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<int?>("ReceiverId")
                        .HasColumnType("int");

                    b.Property<DateTime>("StartedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("Status")
                        .HasColumnType("int");

                    b.Property<int>("Type")
                        .HasColumnType("int");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("ChannelId");

                    b.HasIndex("GroupId");

                    b.HasIndex("InitiatorId");

                    b.HasIndex("ReceiverId");

                    b.HasIndex("StartedAt");

                    b.ToTable("Calls");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Channel", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("AllowComments")
                        .HasColumnType("bit");

                    b.Property<string>("AvatarUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatorId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.Property<string>("InviteLink")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPrivate")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPublic")
                        .HasColumnType("bit");

                    b.Property<int>("MemberCount")
                        .HasColumnType("int");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<bool>("OnlyAdminsCanPost")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("CreatorId");

                    b.ToTable("Channels");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.FileAttachment", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("ContentType")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("DownloadCount")
                        .HasColumnType("int");

                    b.Property<int?>("Duration")
                        .HasColumnType("int");

                    b.Property<string>("Extension")
                        .HasMaxLength(10)
                        .HasColumnType("nvarchar(10)");

                    b.Property<string>("FileHash")
                        .HasMaxLength(64)
                        .HasColumnType("nvarchar(64)");

                    b.Property<string>("FileName")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("nvarchar(255)");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<long>("FileSize")
                        .HasColumnType("bigint");

                    b.Property<string>("FileType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<string>("FileUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int?>("Height")
                        .HasColumnType("int");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsSafe")
                        .HasColumnType("bit");

                    b.Property<bool>("IsScanned")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("LastDownloadAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("MessageId")
                        .HasColumnType("int");

                    b.Property<string>("OriginalFileName")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("nvarchar(255)");

                    b.Property<string>("ScanResult")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime?>("ScannedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("ThumbnailPath")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("ThumbnailUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int>("UploaderId")
                        .HasColumnType("int");

                    b.Property<int?>("Width")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("FileHash");

                    b.HasIndex("MessageId");

                    b.HasIndex("UploaderId");

                    b.ToTable("FileAttachments");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.FileUploadSetting", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<string>("FileType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<bool>("IsAllowed")
                        .HasColumnType("bit");

                    b.Property<long>("MaxSize")
                        .HasColumnType("bigint");

                    b.HasKey("Id");

                    b.HasIndex("FileType")
                        .IsUnique();

                    b.ToTable("FileUploadSettings");

                    b.HasData(
                        new
                        {
                            Id = 1,
                            Category = "Image",
                            FileType = "jpg",
                            IsAllowed = true,
                            MaxSize = 10485760L
                        },
                        new
                        {
                            Id = 2,
                            Category = "Image",
                            FileType = "jpeg",
                            IsAllowed = true,
                            MaxSize = 10485760L
                        },
                        new
                        {
                            Id = 3,
                            Category = "Image",
                            FileType = "png",
                            IsAllowed = true,
                            MaxSize = 10485760L
                        },
                        new
                        {
                            Id = 4,
                            Category = "Image",
                            FileType = "gif",
                            IsAllowed = true,
                            MaxSize = 5242880L
                        },
                        new
                        {
                            Id = 5,
                            Category = "Video",
                            FileType = "mp4",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        },
                        new
                        {
                            Id = 6,
                            Category = "Video",
                            FileType = "webm",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        },
                        new
                        {
                            Id = 7,
                            Category = "Audio",
                            FileType = "mp3",
                            IsAllowed = true,
                            MaxSize = 20971520L
                        },
                        new
                        {
                            Id = 8,
                            Category = "Audio",
                            FileType = "wav",
                            IsAllowed = true,
                            MaxSize = 20971520L
                        },
                        new
                        {
                            Id = 9,
                            Category = "Audio",
                            FileType = "ogg",
                            IsAllowed = true,
                            MaxSize = 20971520L
                        },
                        new
                        {
                            Id = 10,
                            Category = "Document",
                            FileType = "pdf",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 11,
                            Category = "Document",
                            FileType = "doc",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 12,
                            Category = "Document",
                            FileType = "docx",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 13,
                            Category = "Document",
                            FileType = "xls",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 14,
                            Category = "Document",
                            FileType = "xlsx",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 15,
                            Category = "Archive",
                            FileType = "zip",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        },
                        new
                        {
                            Id = 16,
                            Category = "Archive",
                            FileType = "rar",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        });
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.ForbiddenWord", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<string>("Word")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.HasKey("Id");

                    b.HasIndex("Word")
                        .IsUnique();

                    b.ToTable("ForbiddenWords");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Group", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AvatarUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatorId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPublic")
                        .HasColumnType("bit");

                    b.Property<int>("MaxMembers")
                        .HasColumnType("int");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("CreatorId");

                    b.ToTable("Groups");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.GroupMember", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsMuted")
                        .HasColumnType("bit");

                    b.Property<DateTime>("JoinedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("MutedUntil")
                        .HasColumnType("datetime2");

                    b.Property<int>("Role")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("GroupId");

                    b.HasIndex("UserId", "GroupId")
                        .IsUnique();

                    b.ToTable("GroupMembers");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.LoginLog", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("AuthType")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("FailureReason")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("IpAddress")
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<bool>("IsSuccessful")
                        .HasColumnType("bit");

                    b.Property<string>("UserAgent")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("UserId");

                    b.HasIndex("UserId1");

                    b.ToTable("LoginLogs");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Message", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AttachmentName")
                        .HasMaxLength(255)
                        .HasColumnType("nvarchar(255)");

                    b.Property<long?>("AttachmentSize")
                        .HasColumnType("bigint");

                    b.Property<string>("AttachmentType")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("AttachmentUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int?>("CallId")
                        .HasColumnType("int");

                    b.Property<int?>("ChannelId")
                        .HasColumnType("int");

                    b.Property<string>("Content")
                        .HasMaxLength(4000)
                        .HasColumnType("nvarchar(4000)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("EncryptedContent")
                        .HasMaxLength(8000)
                        .HasColumnType("nvarchar(max)");

                    b.Property<int?>("ForwardedFromMessageId")
                        .HasColumnType("int");

                    b.Property<int?>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDelivered")
                        .HasColumnType("bit");

                    b.Property<bool>("IsEdited")
                        .HasColumnType("bit");

                    b.Property<bool>("IsRead")
                        .HasColumnType("bit");

                    b.Property<bool>("IsSystemMessage")
                        .HasColumnType("bit");

                    b.Property<string>("MessageText")
                        .HasColumnType("nvarchar(max)");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("ReceiverId")
                        .HasColumnType("int");

                    b.Property<int?>("ReplyToMessageId")
                        .HasColumnType("int");

                    b.Property<int>("SenderId")
                        .HasColumnType("int");

                    b.Property<DateTime>("SentAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("Type")
                        .HasColumnType("int");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("CallId");

                    b.HasIndex("ChannelId");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("ForwardedFromMessageId");

                    b.HasIndex("GroupId");

                    b.HasIndex("ReceiverId");

                    b.HasIndex("ReplyToMessageId");

                    b.HasIndex("SenderId");

                    b.ToTable("Messages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReaction", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Emoji")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.HasIndex("UserId1");

                    b.HasIndex("MessageId", "UserId", "Emoji")
                        .IsUnique();

                    b.ToTable("MessageReactions");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageRead", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<DateTime>("ReadAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.HasIndex("MessageId", "UserId")
                        .IsUnique();

                    b.ToTable("MessageReads");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReport", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.Property<bool>("IsReviewed")
                        .HasColumnType("bit");

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<int>("ReporterId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("ReviewedAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("ReviewedByAdminId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("MessageId");

                    b.HasIndex("ReporterId");

                    b.HasIndex("ReviewedByAdminId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageReports");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Poll", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("AllowMultipleAnswers")
                        .HasColumnType("bit");

                    b.Property<int?>("ChannelId")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatorId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("ExpiresAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAnonymous")
                        .HasColumnType("bit");

                    b.Property<string>("Question")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.HasKey("Id");

                    b.HasIndex("ChannelId");

                    b.HasIndex("CreatorId");

                    b.HasIndex("GroupId");

                    b.ToTable("Polls");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollOption", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("DisplayOrder")
                        .HasColumnType("int");

                    b.Property<int>("PollId")
                        .HasColumnType("int");

                    b.Property<string>("Text")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.HasKey("Id");

                    b.HasIndex("PollId");

                    b.ToTable("PollOptions");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollVote", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("PollOptionId")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<DateTime>("VotedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.HasIndex("PollOptionId", "UserId")
                        .IsUnique();

                    b.ToTable("PollVotes");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Report", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AdminNote")
                        .HasColumnType("nvarchar(max)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasColumnType("nvarchar(max)");

                    b.Property<int>("ItemType")
                        .HasColumnType("int");

                    b.Property<string>("Reason")
                        .IsRequired()
                        .HasColumnType("nvarchar(max)");

                    b.Property<int?>("ReportedChannelId")
                        .HasColumnType("int");

                    b.Property<int?>("ReportedGroupId")
                        .HasColumnType("int");

                    b.Property<int?>("ReportedMessageId")
                        .HasColumnType("int");

                    b.Property<int?>("ReportedUserId")
                        .HasColumnType("int");

                    b.Property<int>("ReporterId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("ReviewedAt")
                        .HasColumnType("datetime2");

                    b.Property<long?>("ReviewedByAdminId")
                        .HasColumnType("bigint");

                    b.Property<int?>("ReviewedByAdminId1")
                        .HasColumnType("int");

                    b.Property<int>("Status")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("ReportedChannelId");

                    b.HasIndex("ReportedGroupId");

                    b.HasIndex("ReportedMessageId");

                    b.HasIndex("ReportedUserId");

                    b.HasIndex("ReporterId");

                    b.HasIndex("ReviewedByAdminId1");

                    b.ToTable("Reports");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.ServiceLink", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatedByAdminId")
                        .HasColumnType("int");

                    b.Property<string>("Description")
                        .HasColumnType("nvarchar(max)");

                    b.Property<int>("DisplayOrder")
                        .HasColumnType("int");

                    b.Property<string>("IconClass")
                        .HasColumnType("nvarchar(max)");

                    b.Property<string>("IconUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("OpenInNewTab")
                        .HasColumnType("bit");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.HasKey("Id");

                    b.HasIndex("CreatedByAdminId");

                    b.ToTable("ServiceLinks");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SmsCreditLog", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("Amount")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int?>("RelatedMessageId")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("RelatedMessageId");

                    b.HasIndex("UserId");

                    b.HasIndex("UserId1");

                    b.ToTable("SmsCreditLogs");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.StarredMessage", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<DateTime>("StarredAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("MessageId");

                    b.HasIndex("UserId1");

                    b.HasIndex("UserId", "MessageId")
                        .IsUnique();

                    b.ToTable("StarredMessages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemNotification", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasMaxLength(2000)
                        .HasColumnType("nvarchar(2000)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("ExpiresAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("SendImmediately")
                        .HasColumnType("bit");

                    b.Property<int>("SenderId")
                        .HasColumnType("int");

                    b.Property<bool>("ShowOnLogin")
                        .HasColumnType("bit");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.HasKey("Id");

                    b.HasIndex("SenderId");

                    b.ToTable("SystemNotifications");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemSetting", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasColumnType("nvarchar(max)");

                    b.Property<string>("Description")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Key")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("UpdatedByAdminId")
                        .HasColumnType("int");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.HasKey("Id");

                    b.HasIndex("Key")
                        .IsUnique();

                    b.HasIndex("UpdatedByAdminId");

                    b.ToTable("SystemSettings");

                    b.HasData(
                        new
                        {
                            Id = 1,
                            Category = "General",
                            Description = "نوع احراز هویت: Database, ActiveDirectory, ERP",
                            Key = "AuthenticationType",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6596),
                            Value = "Database"
                        },
                        new
                        {
                            Id = 2,
                            Category = "General",
                            Description = "آیا کاربران می‌توانند گروه ایجاد کنند",
                            Key = "AllowUserGroupCreation",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6614),
                            Value = "true"
                        },
                        new
                        {
                            Id = 3,
                            Category = "General",
                            Description = "آیا کاربران می‌توانند کانال ایجاد کنند",
                            Key = "AllowUserChannelCreation",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6615),
                            Value = "true"
                        },
                        new
                        {
                            Id = 4,
                            Category = "General",
                            Description = "زمان مجاز ویرایش پیام (ثانیه)",
                            Key = "MessageEditTimeLimit",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6616),
                            Value = "3600"
                        },
                        new
                        {
                            Id = 5,
                            Category = "General",
                            Description = "زمان مجاز حذف پیام (ثانیه)",
                            Key = "MessageDeleteTimeLimit",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6617),
                            Value = "7200"
                        },
                        new
                        {
                            Id = 6,
                            Category = "General",
                            Description = "فعال بودن تماس VoIP",
                            Key = "VoipEnabled",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6618),
                            Value = "true"
                        },
                        new
                        {
                            Id = 7,
                            Category = "General",
                            Description = "فعال بودن یکپارچگی تلگرام",
                            Key = "TelegramIntegrationEnabled",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6619),
                            Value = "false"
                        },
                        new
                        {
                            Id = 8,
                            Category = "General",
                            Description = "حداکثر تعداد اعضای گروه",
                            Key = "MaxGroupMembers",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6620),
                            Value = "200"
                        },
                        new
                        {
                            Id = 9,
                            Category = "General",
                            Description = "زمان انقضای کد OTP (دقیقه)",
                            Key = "OtpExpiryMinutes",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6621),
                            Value = "5"
                        },
                        new
                        {
                            Id = 10,
                            Category = "General",
                            Description = "نام سازمان",
                            Key = "CompanyName",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6622),
                            Value = "سازمان"
                        },
                        new
                        {
                            Id = 11,
                            Category = "General",
                            Description = "آدرس لوگوی سازمان",
                            Key = "CompanyLogoUrl",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6623),
                            Value = "/images/logo.png"
                        });
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.TelegramMessage", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AttachmentUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Content")
                        .HasMaxLength(4000)
                        .HasColumnType("nvarchar(4000)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("bit");

                    b.Property<bool>("IsRead")
                        .HasColumnType("bit");

                    b.Property<string>("TelegramChatId")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("TelegramUsername")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("TelegramChatId");

                    b.HasIndex("UserId");

                    b.ToTable("TelegramMessages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.User", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("ActiveDirectoryId")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("AvatarUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Bio")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("BlockReason")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime?>("BlockedAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("CanCreateChannel")
                        .HasColumnType("bit");

                    b.Property<bool>("CanCreateGroup")
                        .HasColumnType("bit");

                    b.Property<bool>("CanMakeVideoCall")
                        .HasColumnType("bit");

                    b.Property<bool>("CanMakeVoiceCall")
                        .HasColumnType("bit");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Email")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("ErpUserId")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("FirstName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("IsADAuthenticated")
                        .HasColumnType("bit");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAdmin")
                        .HasColumnType("bit");

                    b.Property<bool>("IsBlocked")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsErpAuthenticated")
                        .HasColumnType("bit");

                    b.Property<bool>("IsOnline")
                        .HasColumnType("bit");

                    b.Property<bool>("IsOtpVerified")
                        .HasColumnType("bit");

                    b.Property<string>("LastName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime?>("LastSeen")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("LastSeenAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("NotificationsEnabled")
                        .HasColumnType("bit");

                    b.Property<string>("OtpCode")
                        .HasMaxLength(10)
                        .HasColumnType("nvarchar(10)");

                    b.Property<DateTime?>("OtpExpireTime")
                        .HasColumnType("datetime2");

                    b.Property<string>("PasswordHash")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("PhoneNumber")
                        .HasMaxLength(20)
                        .HasColumnType("nvarchar(20)");

                    b.Property<string>("ProfilePicture")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("PublicKey")
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.Property<string>("RefreshToken")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("datetime2");

                    b.Property<bool>("ShowPreview")
                        .HasColumnType("bit");

                    b.Property<int>("SmsCredit")
                        .HasColumnType("int");

                    b.Property<bool>("SoundEnabled")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("VoipEnabled")
                        .HasColumnType("bit");

                    b.Property<string>("VoipExtension")
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<string>("VoipPassword")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.HasKey("Id");

                    b.HasIndex("PhoneNumber")
                        .IsUnique()
                        .HasFilter("[PhoneNumber] IS NOT NULL");

                    b.HasIndex("Username")
                        .IsUnique();

                    b.ToTable("Users");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserChannel", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("CanDeleteMessages")
                        .HasColumnType("bit");

                    b.Property<bool>("CanManageMembers")
                        .HasColumnType("bit");

                    b.Property<bool>("CanPost")
                        .HasColumnType("bit");

                    b.Property<int>("ChannelId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAdmin")
                        .HasColumnType("bit");

                    b.Property<bool>("IsMuted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsOwner")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("bit");

                    b.Property<DateTime>("JoinedAt")
                        .HasColumnType("datetime2");

                    b.Property<long?>("LastReadMessageId")
                        .HasColumnType("bigint");

                    b.Property<DateTime?>("LeftAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("MutedUntil")
                        .HasColumnType("datetime2");

                    b.Property<bool>("NotificationsEnabled")
                        .HasColumnType("bit");

                    b.Property<int>("Role")
                        .HasColumnType("int");

                    b.Property<int>("UnreadCount")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("ChannelId");

                    b.HasIndex("UserId", "ChannelId")
                        .IsUnique();

                    b.ToTable("UserChannels");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserGroup", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAdmin")
                        .HasColumnType("bit");

                    b.Property<bool>("IsMuted")
                        .HasColumnType("bit");

                    b.Property<DateTime>("JoinedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("MutedUntil")
                        .HasColumnType("datetime2");

                    b.Property<int>("Role")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("GroupId");

                    b.HasIndex("UserId", "GroupId")
                        .IsUnique();

                    b.ToTable("UserGroups");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserPermission", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("CanCreateChannel")
                        .HasColumnType("bit");

                    b.Property<bool>("CanCreateGroup")
                        .HasColumnType("bit");

                    b.Property<bool>("CanCreatePoll")
                        .HasColumnType("bit");

                    b.Property<bool>("CanSendBroadcast")
                        .HasColumnType("bit");

                    b.Property<bool>("CanUseTelegram")
                        .HasColumnType("bit");

                    b.Property<bool>("CanUseVoIP")
                        .HasColumnType("bit");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("SmsCredit")
                        .HasColumnType("int");

                    b.Property<int>("SmsCreditUsedThisYear")
                        .HasColumnType("int");

                    b.Property<int>("SmsCreditYear")
                        .HasColumnType("int");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<string>("VoIPExtension")
                        .HasColumnType("nvarchar(max)");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Call", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany("Calls")
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("Calls")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Initiator")
                        .WithMany("InitiatedCalls")
                        .HasForeignKey("InitiatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Receiver")
                        .WithMany("ReceivedCalls")
                        .HasForeignKey("ReceiverId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Channel");

                    b.Navigation("Group");

                    b.Navigation("Initiator");

                    b.Navigation("Receiver");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Channel", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Creator")
                        .WithMany("CreatedChannels")
                        .HasForeignKey("CreatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Creator");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.FileAttachment", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany("Attachments")
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Uploader")
                        .WithMany("UploadedFiles")
                        .HasForeignKey("UploaderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Message");

                    b.Navigation("Uploader");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Group", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Creator")
                        .WithMany("CreatedGroups")
                        .HasForeignKey("CreatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Creator");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.GroupMember", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("Members")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Group");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.LoginLog", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("LoginLogs")
                        .HasForeignKey("UserId1");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Message", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Call", "Call")
                        .WithMany("Messages")
                        .HasForeignKey("CallId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany("Messages")
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "ForwardedFromMessage")
                        .WithMany()
                        .HasForeignKey("ForwardedFromMessageId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("Messages")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Receiver")
                        .WithMany("ReceivedMessages")
                        .HasForeignKey("ReceiverId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "ReplyToMessage")
                        .WithMany("Replies")
                        .HasForeignKey("ReplyToMessageId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Sender")
                        .WithMany("SentMessages")
                        .HasForeignKey("SenderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Call");

                    b.Navigation("Channel");

                    b.Navigation("ForwardedFromMessage");

                    b.Navigation("Group");

                    b.Navigation("Receiver");

                    b.Navigation("ReplyToMessage");

                    b.Navigation("Sender");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReaction", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany("Reactions")
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("Reactions")
                        .HasForeignKey("UserId1");

                    b.Navigation("Message");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageRead", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany("ReadReceipts")
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Message");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReport", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany()
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Reporter")
                        .WithMany()
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "ReviewedByAdmin")
                        .WithMany()
                        .HasForeignKey("ReviewedByAdminId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("MessageReports")
                        .HasForeignKey("UserId");

                    b.Navigation("Message");

                    b.Navigation("Reporter");

                    b.Navigation("ReviewedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Poll", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany()
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Creator")
                        .WithMany()
                        .HasForeignKey("CreatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany()
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.Navigation("Channel");

                    b.Navigation("Creator");

                    b.Navigation("Group");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollOption", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Poll", "Poll")
                        .WithMany("Options")
                        .HasForeignKey("PollId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Poll");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollVote", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.PollOption", "PollOption")
                        .WithMany("Votes")
                        .HasForeignKey("PollOptionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("PollOption");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Report", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "ReportedChannel")
                        .WithMany()
                        .HasForeignKey("ReportedChannelId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "ReportedGroup")
                        .WithMany()
                        .HasForeignKey("ReportedGroupId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "ReportedMessage")
                        .WithMany()
                        .HasForeignKey("ReportedMessageId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "ReportedUser")
                        .WithMany()
                        .HasForeignKey("ReportedUserId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Reporter")
                        .WithMany()
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "ReviewedByAdmin")
                        .WithMany()
                        .HasForeignKey("ReviewedByAdminId1");

                    b.Navigation("ReportedChannel");

                    b.Navigation("ReportedGroup");

                    b.Navigation("ReportedMessage");

                    b.Navigation("ReportedUser");

                    b.Navigation("Reporter");

                    b.Navigation("ReviewedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.ServiceLink", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.AdminUser", "CreatedByAdmin")
                        .WithMany()
                        .HasForeignKey("CreatedByAdminId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("CreatedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SmsCreditLog", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "RelatedMessage")
                        .WithMany()
                        .HasForeignKey("RelatedMessageId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("SmsCreditLogs")
                        .HasForeignKey("UserId1");

                    b.Navigation("RelatedMessage");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.StarredMessage", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany()
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("StarredMessages")
                        .HasForeignKey("UserId1");

                    b.Navigation("Message");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemNotification", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Sender")
                        .WithMany()
                        .HasForeignKey("SenderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Sender");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemSetting", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.AdminUser", "UpdatedByAdmin")
                        .WithMany()
                        .HasForeignKey("UpdatedByAdminId");

                    b.Navigation("UpdatedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.TelegramMessage", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserChannel", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany("UserChannels")
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany("UserChannels")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Channel");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserGroup", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("UserGroups")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany("UserGroups")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Group");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserPermission", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Call", b =>
                {
                    b.Navigation("Messages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Channel", b =>
                {
                    b.Navigation("Calls");

                    b.Navigation("Messages");

                    b.Navigation("UserChannels");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Group", b =>
                {
                    b.Navigation("Calls");

                    b.Navigation("Members");

                    b.Navigation("Messages");

                    b.Navigation("UserGroups");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Message", b =>
                {
                    b.Navigation("Attachments");

                    b.Navigation("Reactions");

                    b.Navigation("ReadReceipts");

                    b.Navigation("Replies");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Poll", b =>
                {
                    b.Navigation("Options");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollOption", b =>
                {
                    b.Navigation("Votes");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.User", b =>
                {
                    b.Navigation("CreatedChannels");

                    b.Navigation("CreatedGroups");

                    b.Navigation("InitiatedCalls");

                    b.Navigation("LoginLogs");

                    b.Navigation("MessageReports");

                    b.Navigation("Reactions");

                    b.Navigation("ReceivedCalls");

                    b.Navigation("ReceivedMessages");

                    b.Navigation("SentMessages");

                    b.Navigation("SmsCreditLogs");

                    b.Navigation("StarredMessages");

                    b.Navigation("UploadedFiles");

                    b.Navigation("UserChannels");

                    b.Navigation("UserGroups");
                });
#pragma warning restore 612, 618
        }
    }
}
 
 
==================== ApplicationDbContextModelSnapshot.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Migrations\ 
 
﻿// <auto-generated />
using System;
using Microsoft.EntityFrameworkCore;
using Microsoft.EntityFrameworkCore.Infrastructure;
using Microsoft.EntityFrameworkCore.Metadata;
using Microsoft.EntityFrameworkCore.Storage.ValueConversion;
using OrganizationalMessenger.Infrastructure.Data;

#nullable disable

namespace OrganizationalMessenger.Infrastructure.Migrations
{
    [DbContext(typeof(ApplicationDbContext))]
    partial class ApplicationDbContextModelSnapshot : ModelSnapshot
    {
        protected override void BuildModel(ModelBuilder modelBuilder)
        {
#pragma warning disable 612, 618
            modelBuilder
                .HasAnnotation("ProductVersion", "8.0.23")
                .HasAnnotation("Relational:MaxIdentifierLength", 128);

            SqlServerModelBuilderExtensions.UseIdentityColumns(modelBuilder);

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.AdminUser", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Email")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("FirstName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("LastLoginAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("LastName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("PasswordHash")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.HasKey("Id");

                    b.HasIndex("Username")
                        .IsUnique();

                    b.ToTable("AdminUsers");

                    b.HasData(
                        new
                        {
                            Id = 1,
                            CreatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 65, DateTimeKind.Local).AddTicks(9793),
                            Email = "admin@company.com",
                            FirstName = "مدیر",
                            IsActive = true,
                            LastName = "سیستم",
                            PasswordHash = "$2a$11$9t1CsubdkLWzCxr5Nf2TvOGRMtSnqC.7Y2/jbkJXRIXFOrAw8nQby",
                            Username = "admin"
                        });
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Call", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int?>("ChannelId")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("DestinationType")
                        .HasColumnType("int");

                    b.Property<int?>("Duration")
                        .HasColumnType("int");

                    b.Property<DateTime?>("EndedAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("GroupId")
                        .HasColumnType("int");

                    b.Property<int>("InitiatorId")
                        .HasColumnType("int");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<string>("MeetingLink")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("MeetingPassword")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<int?>("ReceiverId")
                        .HasColumnType("int");

                    b.Property<DateTime>("StartedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("Status")
                        .HasColumnType("int");

                    b.Property<int>("Type")
                        .HasColumnType("int");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("ChannelId");

                    b.HasIndex("GroupId");

                    b.HasIndex("InitiatorId");

                    b.HasIndex("ReceiverId");

                    b.HasIndex("StartedAt");

                    b.ToTable("Calls");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Channel", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("AllowComments")
                        .HasColumnType("bit");

                    b.Property<string>("AvatarUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatorId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.Property<string>("InviteLink")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPrivate")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPublic")
                        .HasColumnType("bit");

                    b.Property<int>("MemberCount")
                        .HasColumnType("int");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<bool>("OnlyAdminsCanPost")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("CreatorId");

                    b.ToTable("Channels");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.FileAttachment", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("ContentType")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("DownloadCount")
                        .HasColumnType("int");

                    b.Property<int?>("Duration")
                        .HasColumnType("int");

                    b.Property<string>("Extension")
                        .HasMaxLength(10)
                        .HasColumnType("nvarchar(10)");

                    b.Property<string>("FileHash")
                        .HasMaxLength(64)
                        .HasColumnType("nvarchar(64)");

                    b.Property<string>("FileName")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("nvarchar(255)");

                    b.Property<string>("FilePath")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<long>("FileSize")
                        .HasColumnType("bigint");

                    b.Property<string>("FileType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<string>("FileUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int?>("Height")
                        .HasColumnType("int");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsSafe")
                        .HasColumnType("bit");

                    b.Property<bool>("IsScanned")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("LastDownloadAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("MessageId")
                        .HasColumnType("int");

                    b.Property<string>("OriginalFileName")
                        .IsRequired()
                        .HasMaxLength(255)
                        .HasColumnType("nvarchar(255)");

                    b.Property<string>("ScanResult")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime?>("ScannedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("ThumbnailPath")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("ThumbnailUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int>("UploaderId")
                        .HasColumnType("int");

                    b.Property<int?>("Width")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("FileHash");

                    b.HasIndex("MessageId");

                    b.HasIndex("UploaderId");

                    b.ToTable("FileAttachments");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.FileUploadSetting", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<string>("FileType")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<bool>("IsAllowed")
                        .HasColumnType("bit");

                    b.Property<long>("MaxSize")
                        .HasColumnType("bigint");

                    b.HasKey("Id");

                    b.HasIndex("FileType")
                        .IsUnique();

                    b.ToTable("FileUploadSettings");

                    b.HasData(
                        new
                        {
                            Id = 1,
                            Category = "Image",
                            FileType = "jpg",
                            IsAllowed = true,
                            MaxSize = 10485760L
                        },
                        new
                        {
                            Id = 2,
                            Category = "Image",
                            FileType = "jpeg",
                            IsAllowed = true,
                            MaxSize = 10485760L
                        },
                        new
                        {
                            Id = 3,
                            Category = "Image",
                            FileType = "png",
                            IsAllowed = true,
                            MaxSize = 10485760L
                        },
                        new
                        {
                            Id = 4,
                            Category = "Image",
                            FileType = "gif",
                            IsAllowed = true,
                            MaxSize = 5242880L
                        },
                        new
                        {
                            Id = 5,
                            Category = "Video",
                            FileType = "mp4",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        },
                        new
                        {
                            Id = 6,
                            Category = "Video",
                            FileType = "webm",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        },
                        new
                        {
                            Id = 7,
                            Category = "Audio",
                            FileType = "mp3",
                            IsAllowed = true,
                            MaxSize = 20971520L
                        },
                        new
                        {
                            Id = 8,
                            Category = "Audio",
                            FileType = "wav",
                            IsAllowed = true,
                            MaxSize = 20971520L
                        },
                        new
                        {
                            Id = 9,
                            Category = "Audio",
                            FileType = "ogg",
                            IsAllowed = true,
                            MaxSize = 20971520L
                        },
                        new
                        {
                            Id = 10,
                            Category = "Document",
                            FileType = "pdf",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 11,
                            Category = "Document",
                            FileType = "doc",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 12,
                            Category = "Document",
                            FileType = "docx",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 13,
                            Category = "Document",
                            FileType = "xls",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 14,
                            Category = "Document",
                            FileType = "xlsx",
                            IsAllowed = true,
                            MaxSize = 52428800L
                        },
                        new
                        {
                            Id = 15,
                            Category = "Archive",
                            FileType = "zip",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        },
                        new
                        {
                            Id = 16,
                            Category = "Archive",
                            FileType = "rar",
                            IsAllowed = true,
                            MaxSize = 104857600L
                        });
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.ForbiddenWord", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<string>("Word")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.HasKey("Id");

                    b.HasIndex("Word")
                        .IsUnique();

                    b.ToTable("ForbiddenWords");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Group", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AvatarUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatorId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPublic")
                        .HasColumnType("bit");

                    b.Property<int>("MaxMembers")
                        .HasColumnType("int");

                    b.Property<string>("Name")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("CreatorId");

                    b.ToTable("Groups");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.GroupMember", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsMuted")
                        .HasColumnType("bit");

                    b.Property<DateTime>("JoinedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("MutedUntil")
                        .HasColumnType("datetime2");

                    b.Property<int>("Role")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("GroupId");

                    b.HasIndex("UserId", "GroupId")
                        .IsUnique();

                    b.ToTable("GroupMembers");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.LoginLog", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("AuthType")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("FailureReason")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("IpAddress")
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<bool>("IsSuccessful")
                        .HasColumnType("bit");

                    b.Property<string>("UserAgent")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("UserId");

                    b.HasIndex("UserId1");

                    b.ToTable("LoginLogs");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Message", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AttachmentName")
                        .HasMaxLength(255)
                        .HasColumnType("nvarchar(255)");

                    b.Property<long?>("AttachmentSize")
                        .HasColumnType("bigint");

                    b.Property<string>("AttachmentType")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("AttachmentUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int?>("CallId")
                        .HasColumnType("int");

                    b.Property<int?>("ChannelId")
                        .HasColumnType("int");

                    b.Property<string>("Content")
                        .HasMaxLength(4000)
                        .HasColumnType("nvarchar(4000)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeliveredAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("EditedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("EncryptedContent")
                        .HasMaxLength(8000)
                        .HasColumnType("nvarchar(max)");

                    b.Property<int?>("ForwardedFromMessageId")
                        .HasColumnType("int");

                    b.Property<int?>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDelivered")
                        .HasColumnType("bit");

                    b.Property<bool>("IsEdited")
                        .HasColumnType("bit");

                    b.Property<bool>("IsRead")
                        .HasColumnType("bit");

                    b.Property<bool>("IsSystemMessage")
                        .HasColumnType("bit");

                    b.Property<string>("MessageText")
                        .HasColumnType("nvarchar(max)");

                    b.Property<DateTime?>("ReadAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("ReceiverId")
                        .HasColumnType("int");

                    b.Property<int?>("ReplyToMessageId")
                        .HasColumnType("int");

                    b.Property<int>("SenderId")
                        .HasColumnType("int");

                    b.Property<DateTime>("SentAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("Type")
                        .HasColumnType("int");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("CallId");

                    b.HasIndex("ChannelId");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("ForwardedFromMessageId");

                    b.HasIndex("GroupId");

                    b.HasIndex("ReceiverId");

                    b.HasIndex("ReplyToMessageId");

                    b.HasIndex("SenderId");

                    b.ToTable("Messages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReaction", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Emoji")
                        .IsRequired()
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.HasIndex("UserId1");

                    b.HasIndex("MessageId", "UserId", "Emoji")
                        .IsUnique();

                    b.ToTable("MessageReactions");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageRead", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<DateTime>("ReadAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.HasIndex("MessageId", "UserId")
                        .IsUnique();

                    b.ToTable("MessageReads");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReport", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.Property<bool>("IsReviewed")
                        .HasColumnType("bit");

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<int>("ReporterId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("ReviewedAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("ReviewedByAdminId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("MessageId");

                    b.HasIndex("ReporterId");

                    b.HasIndex("ReviewedByAdminId");

                    b.HasIndex("UserId");

                    b.ToTable("MessageReports");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Poll", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("AllowMultipleAnswers")
                        .HasColumnType("bit");

                    b.Property<int?>("ChannelId")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatorId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("ExpiresAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAnonymous")
                        .HasColumnType("bit");

                    b.Property<string>("Question")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.HasKey("Id");

                    b.HasIndex("ChannelId");

                    b.HasIndex("CreatorId");

                    b.HasIndex("GroupId");

                    b.ToTable("Polls");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollOption", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("DisplayOrder")
                        .HasColumnType("int");

                    b.Property<int>("PollId")
                        .HasColumnType("int");

                    b.Property<string>("Text")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.HasKey("Id");

                    b.HasIndex("PollId");

                    b.ToTable("PollOptions");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollVote", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("PollOptionId")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<DateTime>("VotedAt")
                        .HasColumnType("datetime2");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.HasIndex("PollOptionId", "UserId")
                        .IsUnique();

                    b.ToTable("PollVotes");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Report", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AdminNote")
                        .HasColumnType("nvarchar(max)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .HasColumnType("nvarchar(max)");

                    b.Property<int>("ItemType")
                        .HasColumnType("int");

                    b.Property<string>("Reason")
                        .IsRequired()
                        .HasColumnType("nvarchar(max)");

                    b.Property<int?>("ReportedChannelId")
                        .HasColumnType("int");

                    b.Property<int?>("ReportedGroupId")
                        .HasColumnType("int");

                    b.Property<int?>("ReportedMessageId")
                        .HasColumnType("int");

                    b.Property<int?>("ReportedUserId")
                        .HasColumnType("int");

                    b.Property<int>("ReporterId")
                        .HasColumnType("int");

                    b.Property<DateTime?>("ReviewedAt")
                        .HasColumnType("datetime2");

                    b.Property<long?>("ReviewedByAdminId")
                        .HasColumnType("bigint");

                    b.Property<int?>("ReviewedByAdminId1")
                        .HasColumnType("int");

                    b.Property<int>("Status")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("ReportedChannelId");

                    b.HasIndex("ReportedGroupId");

                    b.HasIndex("ReportedMessageId");

                    b.HasIndex("ReportedUserId");

                    b.HasIndex("ReporterId");

                    b.HasIndex("ReviewedByAdminId1");

                    b.ToTable("Reports");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.ServiceLink", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("CreatedByAdminId")
                        .HasColumnType("int");

                    b.Property<string>("Description")
                        .HasColumnType("nvarchar(max)");

                    b.Property<int>("DisplayOrder")
                        .HasColumnType("int");

                    b.Property<string>("IconClass")
                        .HasColumnType("nvarchar(max)");

                    b.Property<string>("IconUrl")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("OpenInNewTab")
                        .HasColumnType("bit");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("Url")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.HasKey("Id");

                    b.HasIndex("CreatedByAdminId");

                    b.ToTable("ServiceLinks");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SmsCreditLog", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("Amount")
                        .HasColumnType("int");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Description")
                        .IsRequired()
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<int?>("RelatedMessageId")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("CreatedAt");

                    b.HasIndex("RelatedMessageId");

                    b.HasIndex("UserId");

                    b.HasIndex("UserId1");

                    b.ToTable("SmsCreditLogs");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.StarredMessage", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("MessageId")
                        .HasColumnType("int");

                    b.Property<DateTime>("StarredAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<int?>("UserId1")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("MessageId");

                    b.HasIndex("UserId1");

                    b.HasIndex("UserId", "MessageId")
                        .IsUnique();

                    b.ToTable("StarredMessages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemNotification", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("Content")
                        .IsRequired()
                        .HasMaxLength(2000)
                        .HasColumnType("nvarchar(2000)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("ExpiresAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("SendImmediately")
                        .HasColumnType("bit");

                    b.Property<int>("SenderId")
                        .HasColumnType("int");

                    b.Property<bool>("ShowOnLogin")
                        .HasColumnType("bit");

                    b.Property<string>("Title")
                        .IsRequired()
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.HasKey("Id");

                    b.HasIndex("SenderId");

                    b.ToTable("SystemNotifications");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemSetting", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("Category")
                        .IsRequired()
                        .HasColumnType("nvarchar(max)");

                    b.Property<string>("Description")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Key")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int?>("UpdatedByAdminId")
                        .HasColumnType("int");

                    b.Property<string>("Value")
                        .IsRequired()
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.HasKey("Id");

                    b.HasIndex("Key")
                        .IsUnique();

                    b.HasIndex("UpdatedByAdminId");

                    b.ToTable("SystemSettings");

                    b.HasData(
                        new
                        {
                            Id = 1,
                            Category = "General",
                            Description = "نوع احراز هویت: Database, ActiveDirectory, ERP",
                            Key = "AuthenticationType",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6596),
                            Value = "Database"
                        },
                        new
                        {
                            Id = 2,
                            Category = "General",
                            Description = "آیا کاربران می‌توانند گروه ایجاد کنند",
                            Key = "AllowUserGroupCreation",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6614),
                            Value = "true"
                        },
                        new
                        {
                            Id = 3,
                            Category = "General",
                            Description = "آیا کاربران می‌توانند کانال ایجاد کنند",
                            Key = "AllowUserChannelCreation",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6615),
                            Value = "true"
                        },
                        new
                        {
                            Id = 4,
                            Category = "General",
                            Description = "زمان مجاز ویرایش پیام (ثانیه)",
                            Key = "MessageEditTimeLimit",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6616),
                            Value = "3600"
                        },
                        new
                        {
                            Id = 5,
                            Category = "General",
                            Description = "زمان مجاز حذف پیام (ثانیه)",
                            Key = "MessageDeleteTimeLimit",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6617),
                            Value = "7200"
                        },
                        new
                        {
                            Id = 6,
                            Category = "General",
                            Description = "فعال بودن تماس VoIP",
                            Key = "VoipEnabled",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6618),
                            Value = "true"
                        },
                        new
                        {
                            Id = 7,
                            Category = "General",
                            Description = "فعال بودن یکپارچگی تلگرام",
                            Key = "TelegramIntegrationEnabled",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6619),
                            Value = "false"
                        },
                        new
                        {
                            Id = 8,
                            Category = "General",
                            Description = "حداکثر تعداد اعضای گروه",
                            Key = "MaxGroupMembers",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6620),
                            Value = "200"
                        },
                        new
                        {
                            Id = 9,
                            Category = "General",
                            Description = "زمان انقضای کد OTP (دقیقه)",
                            Key = "OtpExpiryMinutes",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6621),
                            Value = "5"
                        },
                        new
                        {
                            Id = 10,
                            Category = "General",
                            Description = "نام سازمان",
                            Key = "CompanyName",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6622),
                            Value = "سازمان"
                        },
                        new
                        {
                            Id = 11,
                            Category = "General",
                            Description = "آدرس لوگوی سازمان",
                            Key = "CompanyLogoUrl",
                            UpdatedAt = new DateTime(2026, 2, 9, 9, 48, 8, 103, DateTimeKind.Local).AddTicks(6623),
                            Value = "/images/logo.png"
                        });
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.TelegramMessage", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("AttachmentUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Content")
                        .HasMaxLength(4000)
                        .HasColumnType("nvarchar(4000)");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("IsIncoming")
                        .HasColumnType("bit");

                    b.Property<bool>("IsRead")
                        .HasColumnType("bit");

                    b.Property<string>("TelegramChatId")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<string>("TelegramUsername")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("TelegramChatId");

                    b.HasIndex("UserId");

                    b.ToTable("TelegramMessages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.User", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<string>("ActiveDirectoryId")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("AvatarUrl")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("Bio")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("BlockReason")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime?>("BlockedAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("CanCreateChannel")
                        .HasColumnType("bit");

                    b.Property<bool>("CanCreateGroup")
                        .HasColumnType("bit");

                    b.Property<bool>("CanMakeVideoCall")
                        .HasColumnType("bit");

                    b.Property<bool>("CanMakeVoiceCall")
                        .HasColumnType("bit");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("DeletedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Email")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("ErpUserId")
                        .HasMaxLength(200)
                        .HasColumnType("nvarchar(200)");

                    b.Property<string>("FirstName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("IsADAuthenticated")
                        .HasColumnType("bit");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAdmin")
                        .HasColumnType("bit");

                    b.Property<bool>("IsBlocked")
                        .HasColumnType("bit");

                    b.Property<bool>("IsDeleted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsErpAuthenticated")
                        .HasColumnType("bit");

                    b.Property<bool>("IsOnline")
                        .HasColumnType("bit");

                    b.Property<bool>("IsOtpVerified")
                        .HasColumnType("bit");

                    b.Property<string>("LastName")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<DateTime?>("LastSeen")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("LastSeenAt")
                        .HasColumnType("datetime2");

                    b.Property<bool>("NotificationsEnabled")
                        .HasColumnType("bit");

                    b.Property<string>("OtpCode")
                        .HasMaxLength(10)
                        .HasColumnType("nvarchar(10)");

                    b.Property<DateTime?>("OtpExpireTime")
                        .HasColumnType("datetime2");

                    b.Property<string>("PasswordHash")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("PhoneNumber")
                        .HasMaxLength(20)
                        .HasColumnType("nvarchar(20)");

                    b.Property<string>("ProfilePicture")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<string>("PublicKey")
                        .HasMaxLength(1000)
                        .HasColumnType("nvarchar(1000)");

                    b.Property<string>("RefreshToken")
                        .HasMaxLength(500)
                        .HasColumnType("nvarchar(500)");

                    b.Property<DateTime?>("RefreshTokenExpiry")
                        .HasColumnType("datetime2");

                    b.Property<bool>("ShowPreview")
                        .HasColumnType("bit");

                    b.Property<int>("SmsCredit")
                        .HasColumnType("int");

                    b.Property<bool>("SoundEnabled")
                        .HasColumnType("bit");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.Property<string>("Username")
                        .IsRequired()
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.Property<bool>("VoipEnabled")
                        .HasColumnType("bit");

                    b.Property<string>("VoipExtension")
                        .HasMaxLength(50)
                        .HasColumnType("nvarchar(50)");

                    b.Property<string>("VoipPassword")
                        .HasMaxLength(100)
                        .HasColumnType("nvarchar(100)");

                    b.HasKey("Id");

                    b.HasIndex("PhoneNumber")
                        .IsUnique()
                        .HasFilter("[PhoneNumber] IS NOT NULL");

                    b.HasIndex("Username")
                        .IsUnique();

                    b.ToTable("Users");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserChannel", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("CanDeleteMessages")
                        .HasColumnType("bit");

                    b.Property<bool>("CanManageMembers")
                        .HasColumnType("bit");

                    b.Property<bool>("CanPost")
                        .HasColumnType("bit");

                    b.Property<int>("ChannelId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAdmin")
                        .HasColumnType("bit");

                    b.Property<bool>("IsMuted")
                        .HasColumnType("bit");

                    b.Property<bool>("IsOwner")
                        .HasColumnType("bit");

                    b.Property<bool>("IsPinned")
                        .HasColumnType("bit");

                    b.Property<DateTime>("JoinedAt")
                        .HasColumnType("datetime2");

                    b.Property<long?>("LastReadMessageId")
                        .HasColumnType("bigint");

                    b.Property<DateTime?>("LeftAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("MutedUntil")
                        .HasColumnType("datetime2");

                    b.Property<bool>("NotificationsEnabled")
                        .HasColumnType("bit");

                    b.Property<int>("Role")
                        .HasColumnType("int");

                    b.Property<int>("UnreadCount")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("ChannelId");

                    b.HasIndex("UserId", "ChannelId")
                        .IsUnique();

                    b.ToTable("UserChannels");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserGroup", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<int>("GroupId")
                        .HasColumnType("int");

                    b.Property<bool>("IsActive")
                        .HasColumnType("bit");

                    b.Property<bool>("IsAdmin")
                        .HasColumnType("bit");

                    b.Property<bool>("IsMuted")
                        .HasColumnType("bit");

                    b.Property<DateTime>("JoinedAt")
                        .HasColumnType("datetime2");

                    b.Property<DateTime?>("MutedUntil")
                        .HasColumnType("datetime2");

                    b.Property<int>("Role")
                        .HasColumnType("int");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.HasKey("Id");

                    b.HasIndex("GroupId");

                    b.HasIndex("UserId", "GroupId")
                        .IsUnique();

                    b.ToTable("UserGroups");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserPermission", b =>
                {
                    b.Property<int>("Id")
                        .ValueGeneratedOnAdd()
                        .HasColumnType("int");

                    SqlServerPropertyBuilderExtensions.UseIdentityColumn(b.Property<int>("Id"));

                    b.Property<bool>("CanCreateChannel")
                        .HasColumnType("bit");

                    b.Property<bool>("CanCreateGroup")
                        .HasColumnType("bit");

                    b.Property<bool>("CanCreatePoll")
                        .HasColumnType("bit");

                    b.Property<bool>("CanSendBroadcast")
                        .HasColumnType("bit");

                    b.Property<bool>("CanUseTelegram")
                        .HasColumnType("bit");

                    b.Property<bool>("CanUseVoIP")
                        .HasColumnType("bit");

                    b.Property<DateTime>("CreatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("SmsCredit")
                        .HasColumnType("int");

                    b.Property<int>("SmsCreditUsedThisYear")
                        .HasColumnType("int");

                    b.Property<int>("SmsCreditYear")
                        .HasColumnType("int");

                    b.Property<DateTime?>("UpdatedAt")
                        .HasColumnType("datetime2");

                    b.Property<int>("UserId")
                        .HasColumnType("int");

                    b.Property<string>("VoIPExtension")
                        .HasColumnType("nvarchar(max)");

                    b.HasKey("Id");

                    b.HasIndex("UserId");

                    b.ToTable("UserPermissions");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Call", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany("Calls")
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("Calls")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Initiator")
                        .WithMany("InitiatedCalls")
                        .HasForeignKey("InitiatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Receiver")
                        .WithMany("ReceivedCalls")
                        .HasForeignKey("ReceiverId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.Navigation("Channel");

                    b.Navigation("Group");

                    b.Navigation("Initiator");

                    b.Navigation("Receiver");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Channel", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Creator")
                        .WithMany("CreatedChannels")
                        .HasForeignKey("CreatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Creator");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.FileAttachment", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany("Attachments")
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Uploader")
                        .WithMany("UploadedFiles")
                        .HasForeignKey("UploaderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Message");

                    b.Navigation("Uploader");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Group", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Creator")
                        .WithMany("CreatedGroups")
                        .HasForeignKey("CreatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Creator");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.GroupMember", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("Members")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Group");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.LoginLog", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("LoginLogs")
                        .HasForeignKey("UserId1");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Message", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Call", "Call")
                        .WithMany("Messages")
                        .HasForeignKey("CallId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany("Messages")
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "ForwardedFromMessage")
                        .WithMany()
                        .HasForeignKey("ForwardedFromMessageId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("Messages")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Receiver")
                        .WithMany("ReceivedMessages")
                        .HasForeignKey("ReceiverId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "ReplyToMessage")
                        .WithMany("Replies")
                        .HasForeignKey("ReplyToMessageId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Sender")
                        .WithMany("SentMessages")
                        .HasForeignKey("SenderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Call");

                    b.Navigation("Channel");

                    b.Navigation("ForwardedFromMessage");

                    b.Navigation("Group");

                    b.Navigation("Receiver");

                    b.Navigation("ReplyToMessage");

                    b.Navigation("Sender");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReaction", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany("Reactions")
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("Reactions")
                        .HasForeignKey("UserId1");

                    b.Navigation("Message");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageRead", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany("ReadReceipts")
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Message");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.MessageReport", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany()
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Reporter")
                        .WithMany()
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "ReviewedByAdmin")
                        .WithMany()
                        .HasForeignKey("ReviewedByAdminId")
                        .OnDelete(DeleteBehavior.Restrict);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("MessageReports")
                        .HasForeignKey("UserId");

                    b.Navigation("Message");

                    b.Navigation("Reporter");

                    b.Navigation("ReviewedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Poll", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany()
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Creator")
                        .WithMany()
                        .HasForeignKey("CreatorId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany()
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade);

                    b.Navigation("Channel");

                    b.Navigation("Creator");

                    b.Navigation("Group");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollOption", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Poll", "Poll")
                        .WithMany("Options")
                        .HasForeignKey("PollId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Poll");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollVote", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.PollOption", "PollOption")
                        .WithMany("Votes")
                        .HasForeignKey("PollOptionId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("PollOption");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Report", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "ReportedChannel")
                        .WithMany()
                        .HasForeignKey("ReportedChannelId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "ReportedGroup")
                        .WithMany()
                        .HasForeignKey("ReportedGroupId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "ReportedMessage")
                        .WithMany()
                        .HasForeignKey("ReportedMessageId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "ReportedUser")
                        .WithMany()
                        .HasForeignKey("ReportedUserId");

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Reporter")
                        .WithMany()
                        .HasForeignKey("ReporterId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "ReviewedByAdmin")
                        .WithMany()
                        .HasForeignKey("ReviewedByAdminId1");

                    b.Navigation("ReportedChannel");

                    b.Navigation("ReportedGroup");

                    b.Navigation("ReportedMessage");

                    b.Navigation("ReportedUser");

                    b.Navigation("Reporter");

                    b.Navigation("ReviewedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.ServiceLink", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.AdminUser", "CreatedByAdmin")
                        .WithMany()
                        .HasForeignKey("CreatedByAdminId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("CreatedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SmsCreditLog", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "RelatedMessage")
                        .WithMany()
                        .HasForeignKey("RelatedMessageId")
                        .OnDelete(DeleteBehavior.SetNull);

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("SmsCreditLogs")
                        .HasForeignKey("UserId1");

                    b.Navigation("RelatedMessage");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.StarredMessage", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Message", "Message")
                        .WithMany()
                        .HasForeignKey("MessageId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", null)
                        .WithMany("StarredMessages")
                        .HasForeignKey("UserId1");

                    b.Navigation("Message");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemNotification", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "Sender")
                        .WithMany()
                        .HasForeignKey("SenderId")
                        .OnDelete(DeleteBehavior.Restrict)
                        .IsRequired();

                    b.Navigation("Sender");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.SystemSetting", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.AdminUser", "UpdatedByAdmin")
                        .WithMany()
                        .HasForeignKey("UpdatedByAdminId");

                    b.Navigation("UpdatedByAdmin");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.TelegramMessage", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserChannel", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Channel", "Channel")
                        .WithMany("UserChannels")
                        .HasForeignKey("ChannelId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany("UserChannels")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Channel");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserGroup", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.Group", "Group")
                        .WithMany("UserGroups")
                        .HasForeignKey("GroupId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany("UserGroups")
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("Group");

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.UserPermission", b =>
                {
                    b.HasOne("OrganizationalMessenger.Domain.Entities.User", "User")
                        .WithMany()
                        .HasForeignKey("UserId")
                        .OnDelete(DeleteBehavior.Cascade)
                        .IsRequired();

                    b.Navigation("User");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Call", b =>
                {
                    b.Navigation("Messages");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Channel", b =>
                {
                    b.Navigation("Calls");

                    b.Navigation("Messages");

                    b.Navigation("UserChannels");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Group", b =>
                {
                    b.Navigation("Calls");

                    b.Navigation("Members");

                    b.Navigation("Messages");

                    b.Navigation("UserGroups");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Message", b =>
                {
                    b.Navigation("Attachments");

                    b.Navigation("Reactions");

                    b.Navigation("ReadReceipts");

                    b.Navigation("Replies");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.Poll", b =>
                {
                    b.Navigation("Options");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.PollOption", b =>
                {
                    b.Navigation("Votes");
                });

            modelBuilder.Entity("OrganizationalMessenger.Domain.Entities.User", b =>
                {
                    b.Navigation("CreatedChannels");

                    b.Navigation("CreatedGroups");

                    b.Navigation("InitiatedCalls");

                    b.Navigation("LoginLogs");

                    b.Navigation("MessageReports");

                    b.Navigation("Reactions");

                    b.Navigation("ReceivedCalls");

                    b.Navigation("ReceivedMessages");

                    b.Navigation("SentMessages");

                    b.Navigation("SmsCreditLogs");

                    b.Navigation("StarredMessages");

                    b.Navigation("UploadedFiles");

                    b.Navigation("UserChannels");

                    b.Navigation("UserGroups");
                });
#pragma warning restore 612, 618
        }
    }
}
 
 
==================== .NETCoreApp,Version=v8.0.AssemblyAttributes.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\obj\Debug\net8.0\ 
 
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
 
 
==================== OrganizationalMessenger.Infrastructure.AssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("OrganizationalMessenger.Infrastructure")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("OrganizationalMessenger.Infrastructure")]
[assembly: System.Reflection.AssemblyTitleAttribute("OrganizationalMessenger.Infrastructure")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== OrganizationalMessenger.Infrastructure.GlobalUsings.g.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\obj\Debug\net8.0\ 
 
// <auto-generated/>
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Threading;
global using global::System.Threading.Tasks;
 
 
==================== ISmsSender.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Services\ 
 
﻿using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace OrganizationalMessenger.Infrastructure.Services
{
    public interface ISmsSender
    {
        Task<string> SendSmsAsync(string messageBody, string phoneNumber, int? memberId = null, string smsType = "");
    }
}
 
 
==================== SmsService.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Services\ 
 
﻿using System.Net.Http.Json;
using Microsoft.Extensions.Configuration;
using OrganizationalMessenger.Application.Interfaces;

namespace OrganizationalMessenger.Infrastructure.Services
{
    public class SmsService : ISmsService
    {
        private readonly HttpClient _httpClient;
        private readonly IConfiguration _configuration;
        private readonly string _apiKey;
        private readonly string _sender;
        private readonly string _apiUrl;

        public SmsService(IHttpClientFactory httpClientFactory, IConfiguration configuration)
        {
            _httpClient = httpClientFactory.CreateClient();
            _configuration = configuration;

            // تنظیمات پنل SMS (مثلاً کاوه‌نگار، ملی‌پیامک و...)
            _apiKey = _configuration["Sms:ApiKey"] ?? "";
            _sender = _configuration["Sms:Sender"] ?? "";
            _apiUrl = _configuration["Sms:ApiUrl"] ?? "";
        }

        public async Task<SmsResult> SendOtpAsync(string phoneNumber, string otpCode)
        {
            var message = $"کد تایید شما: {otpCode}\nاین کد تا 5 دقیقه معتبر است.";
            return await SendMessageAsync(phoneNumber, message);
        }

        public async Task<SmsResult> SendMessageAsync(string phoneNumber, string message)
        {
            try
            {
                // مثال برای Kavenegar API
                var request = new
                {
                    sender = _sender,
                    receptor = phoneNumber,
                    message = message
                };

                _httpClient.DefaultRequestHeaders.Add("apikey", _apiKey);

                var response = await _httpClient.PostAsJsonAsync(
                    $"{_apiUrl}/v1/{_apiKey}/sms/send.json",
                    request);

                if (response.IsSuccessStatusCode)
                {
                    var result = await response.Content.ReadFromJsonAsync<SmsApiResponse>();

                    return new SmsResult
                    {
                        Success = result?.Return?.Status == 200,
                        Message = "پیامک با موفقیت ارسال شد",
                        MessageId = result?.Entries?.FirstOrDefault()?.Messageid.ToString()
                    };
                }

                return new SmsResult
                {
                    Success = false,
                    Message = "خطا در ارسال پیامک"
                };
            }
            catch (Exception ex)
            {
                return new SmsResult
                {
                    Success = false,
                    Message = $"خطا: {ex.Message}"
                };
            }
        }

        private class SmsApiResponse
        {
            public ReturnData? Return { get; set; }
            public List<EntryData>? Entries { get; set; }
        }

        private class ReturnData
        {
            public int Status { get; set; }
            public string? Message { get; set; }
        }

        private class EntryData
        {
            public long Messageid { get; set; }
            public string? Message { get; set; }
            public int Status { get; set; }
            public string? Statustext { get; set; }
            public string? Sender { get; set; }
            public string? Receptor { get; set; }
            public int Date { get; set; }
            public int Cost { get; set; }
        }
    }
}
 
 
==================== TopTipSmsSender.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Infrastructure\Services\ 
 
﻿using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Infrastructure.Services;

public class TopTipSmsSender : ISmsSender
{
    private readonly ApplicationDbContext _context;

    public TopTipSmsSender(ApplicationDbContext context)
    {
        _context = context;
    }

    public async Task<string> SendSmsAsync(string messageBody, string phoneNumber, int? memberId = null, string smsType = "")
    {
        // ✅ تمیز کردن شماره
        phoneNumber = CleanPhoneNumber(phoneNumber);

        try
        {
            // ✅ خواندن تنظیمات از SystemSettings شما
            var apiKey = await GetSettingValueAsync("SmsApiKey");
            var senderNumber = await GetSettingValueAsync("SmsSenderNumber");

            if (string.IsNullOrWhiteSpace(apiKey) || string.IsNullOrWhiteSpace(senderNumber))
            {
                return "تنظیمات TopTip کامل نیست";
            }

            // ✅ اضافه کردن "لغو 11"
            messageBody = EnsureUnsubscribeText(messageBody);

            // ✅ درخواست TopTip
            using var httpClient = new HttpClient { Timeout = TimeSpan.FromSeconds(15) };
            string apiUrl = $"http://toptip.ir/webservice/rest/sms_send" +
                $"?note_arr[]={Uri.EscapeDataString(messageBody)}" +
                $"&api_key={apiKey}" +
                $"&receiver_number={phoneNumber}" +
                $"&sender_number={senderNumber}";

            var response = await httpClient.GetAsync(apiUrl);
            var responseContent = await response.Content.ReadAsStringAsync();

            return response.IsSuccessStatusCode &&
                   (responseContent.Contains("\"result\":true") || responseContent.Contains("\"result\": true"))
                ? "ارسال شد"
                : $"خطا: {responseContent}";
        }
        catch (Exception ex)
        {
            return $"خطا: {ex.Message}";
        }
    }

    private string CleanPhoneNumber(string phoneNumber)
    {
        return phoneNumber?.Trim()
            .Replace(" ", "").Replace("-", "")
            .Replace("۰", "0").Replace("۱", "1").Replace("۲", "2")
            .Replace("۳", "3").Replace("۴", "4").Replace("۵", "5")
            .Replace("۶", "6").Replace("۷", "7").Replace("۸", "8").Replace("۹", "9") ?? "";
    }

    private string EnsureUnsubscribeText(string message)
    {
        return message + " | لغو 11";
    }

    private async Task<string?> GetSettingValueAsync(string key)
    {
        var setting = await _context.SystemSettings.FirstOrDefaultAsync(s => s.Key == key);
        return setting?.Value;
    }
}
 
 
==================== Program.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\ 
 
﻿using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Identity;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Infrastructure.Authentication;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Infrastructure.Services;

var builder = WebApplication.CreateBuilder(args);

// =====================================================
// SERVICES (فقط موارد موجود)
builder.Services.AddControllersWithViews();
builder.Services.AddRazorPages();
builder.Services.AddSignalR();

// ✅ Database
builder.Services.AddDbContext<ApplicationDbContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("DefaultConnection")));

// ✅ Session
builder.Services.AddDistributedMemoryCache();
builder.Services.AddSession(options =>
{
    options.IdleTimeout = TimeSpan.FromMinutes(30);
    options.Cookie.HttpOnly = true;
    options.Cookie.IsEssential = true;
});

// ✅ HttpClient
builder.Services.AddHttpClient();

// ✅ Services موجود
builder.Services.AddScoped<ISmsService, SmsService>();
builder.Services.AddScoped<IAuthenticationManager, AuthenticationManager>();
builder.Services.AddScoped<ISmsSender, TopTipSmsSender>();

builder.Services.AddHttpContextAccessor();

builder.Services.AddControllersWithViews();


builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(options =>
    {
        options.LoginPath = "/Account/Login";
        options.LogoutPath = "/Account/Logout";
        options.AccessDeniedPath = "/Account/AccessDenied";
        options.ExpireTimeSpan = TimeSpan.FromDays(14);
        options.SlidingExpiration = true;
    });
// Providers موجود
builder.Services.AddScoped<IAuthenticationProvider, ActiveDirectoryProvider>();
builder.Services.AddScoped<IAuthenticationProvider, ErpAuthenticationProvider>();
builder.Services.AddScoped<IAuthenticationProvider, OtpAuthenticationProvider>();



builder.Services.AddHttpContextAccessor();
builder.Services.AddSignalR();






var app = builder.Build();

// =====================================================
// MIDDLEWARE (ترتیب صحیح)
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Home/Error");
    app.UseHsts();
}

app.UseHttpsRedirection();
app.UseStaticFiles();

app.UseRouting();

// ✅ ترتیب CRITICAL
app.UseSession();
app.UseAuthentication();  // اول
app.UseAuthorization();   // بعد

// =====================================================
// ROUTES
app.MapRazorPages();

// Admin Area
app.MapControllerRoute(
    name: "admin",
    pattern: "{area:exists}/{controller=Dashboard}/{action=Index}/{id?}");

// ✅ CHAT ROUTE
app.MapControllerRoute(
    name: "chat",
    pattern: "chat/{action=Index}/{id?}",
    defaults: new { controller = "Chat", action = "Index" });

// ✅ DEFAULT ROUTE → مستقیم لاگین!
app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Account}/{action=Login}/{id?}");





app.MapHub<ChatHub>("/hubs/chat");




app.Run();
 
 
==================== AccountController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Areas.Admin.Models;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    public class AccountController : Controller
    {
        private readonly ApplicationDbContext _context;

        public AccountController(ApplicationDbContext context)
        {
            _context = context;
        }

        [HttpGet]
        public IActionResult Login(string? returnUrl = null)
        {
            // If already logged in, redirect to dashboard
            if (HttpContext.Session.GetInt32("AdminId") != null)
            {
                return RedirectToAction("Index", "Dashboard");
            }

            ViewBag.ReturnUrl = returnUrl;
            return View();
        }

        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Login(LoginViewModel model)
        {
            if (!ModelState.IsValid)
            {
                return View(model);
            }

            var admin = await _context.AdminUsers
                .FirstOrDefaultAsync(a => a.Username == model.Username && a.IsActive);

            if (admin == null || !BCrypt.Net.BCrypt.Verify(model.Password, admin.PasswordHash))
            {
                ModelState.AddModelError("", "نام کاربری یا رمز عبور اشتباه است");
                return View(model);
            }

            // به‌روزرسانی آخرین ورود
            admin.LastLoginAt = DateTime.Now;
            await _context.SaveChangesAsync();

            // ✅ ذخیره در Session - همه به صورت یکپارچه
            HttpContext.Session.SetInt32("AdminId", (int)admin.Id);  // ✅ تغییر به SetInt32
            HttpContext.Session.SetString("AdminUsername", admin.Username);
            HttpContext.Session.SetString("AdminFullName", $"{admin.FirstName} {admin.LastName}");

            // اگر IsSuperAdmin دارید
           // HttpContext.Session.SetInt32("IsSuperAdmin", admin.IsSuperAdmin ? 1 : 0);

            return RedirectToAction("Index", "Dashboard");
        }

        [HttpPost]
        [ValidateAntiForgeryToken]
        public IActionResult Logout()
        {
            HttpContext.Session.Clear();
            return RedirectToAction("Login");
        }
    }
}
 
 
==================== BaseAdminController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Filters;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    public class BaseAdminController : Controller
    {
        public override void OnActionExecuting(ActionExecutingContext context)
        {
            // Check if admin is logged in
            var adminId = HttpContext.Session.GetInt32("AdminId");
            if (adminId == null)
            {
                context.Result = new RedirectToActionResult("Login", "Account", new { area = "Admin" });
                return;
            }

            // Pass admin info to ViewBag
            ViewBag.AdminUsername = HttpContext.Session.GetString("AdminUsername");
            ViewBag.AdminFullName = HttpContext.Session.GetString("AdminFullName");
            ViewBag.IsSuperAdmin = HttpContext.Session.GetInt32("IsSuperAdmin") == 1;

            base.OnActionExecuting(context);
        }
    }
}
 
 
==================== ChannelsController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Models.ViewModels;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    public class ChannelsController : BaseAdminController
    {
        private readonly ApplicationDbContext _context;

        public ChannelsController(ApplicationDbContext context)
        {
            _context = context;
        }

        // GET: Admin/Channels
        public async Task<IActionResult> Index(string searchTerm = "", bool? isActive = null)
        {
            var query = _context.Channels
                .Include(c => c.Creator)
                .Include(c => c.UserChannels)
                .AsQueryable();

            if (!string.IsNullOrEmpty(searchTerm))
            {
                query = query.Where(c => c.Name.Contains(searchTerm) ||
                                        (c.Description != null && c.Description.Contains(searchTerm)));
            }

            if (isActive.HasValue)
            {
                query = query.Where(c => c.IsActive == isActive.Value);
            }

            var channels = await query
                .OrderByDescending(c => c.CreatedAt)
                .Select(c => new ChannelListViewModel
                {
                    Id = c.Id,
                    Name = c.Name,
                    Description = c.Description,
                    CreatorName = c.Creator.FirstName + " " + c.Creator.LastName,
                    SubscriberCount = c.UserChannels.Count(uc => uc.IsActive),
                    IsActive = c.IsActive,
                    IsPublic = c.IsPublic,
                    CreatedAt = c.CreatedAt
                })
                .ToListAsync();

            ViewBag.SearchTerm = searchTerm;
            ViewBag.IsActive = isActive;

            return View(channels);
        }

        // GET: Admin/Channels/Details/5
        public async Task<IActionResult> Details(int id)
        {
            var channel = await _context.Channels
                .Include(c => c.Creator)
                .Include(c => c.UserChannels.Where(uc => uc.IsActive))
                    .ThenInclude(uc => uc.User)
                .Include(c => c.Messages.Where(m => !m.IsDeleted))
                .FirstOrDefaultAsync(c => c.Id == id);

            if (channel == null)
            {
                TempData["ErrorMessage"] = "کانال یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            ViewBag.MessageCount = channel.Messages.Count;
            ViewBag.SubscriberCount = channel.UserChannels.Count(uc => uc.IsActive);
            ViewBag.AdminCount = channel.UserChannels.Count(uc => uc.IsActive && uc.IsAdmin);
            ViewBag.PublisherCount = channel.UserChannels.Count(uc => uc.IsActive && uc.CanPost);

            return View(channel);
        }

        // GET: Admin/Channels/Create
        public async Task<IActionResult> Create()
        {
            ViewBag.Users = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted)
                .OrderBy(u => u.FirstName)
                .ThenBy(u => u.LastName)
                .ToListAsync();

            return View(new ChannelCreateViewModel
            {
                IsActive = true,
                IsPublic = false
            });
        }

        // POST: Admin/Channels/Create
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Create(ChannelCreateViewModel model)
        {
            if (ModelState.IsValid)
            {
                // بررسی یکتا بودن نام
                var existingChannel = await _context.Channels
                    .AnyAsync(c => c.Name == model.Name);

                if (existingChannel)
                {
                    ModelState.AddModelError("Name", "کانالی با این نام قبلاً وجود دارد.");
                    ViewBag.Users = await _context.Users
                        .Where(u => u.IsActive && !u.IsDeleted)
                        .ToListAsync();
                    return View(model);
                }

                var channel = new Channel
                {
                    Name = model.Name,
                    Description = model.Description,
                    CreatorId = model.CreatorId,
                    IsPublic = model.IsPublic,
                    IsActive = model.IsActive,
                    CreatedAt = DateTime.Now
                };

                _context.Channels.Add(channel);
                await _context.SaveChangesAsync();

                // افزودن سازنده به عنوان Owner
                var userChannel = new UserChannel
                {
                    UserId = model.CreatorId,
                    ChannelId = channel.Id,
                    IsAdmin = true,
                    CanPost = true,
                    Role = ChannelRole.Owner,
                    JoinedAt = DateTime.Now,
                    IsActive = true
                };

                _context.UserChannels.Add(userChannel);
                await _context.SaveChangesAsync();

                TempData["SuccessMessage"] = "کانال با موفقیت ایجاد شد.";
                return RedirectToAction(nameof(Index));
            }

            ViewBag.Users = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted)
                .ToListAsync();

            return View(model);
        }

        // GET: Admin/Channels/Edit/5
        public async Task<IActionResult> Edit(int id)
        {
            var channel = await _context.Channels.FindAsync(id);

            if (channel == null)
            {
                TempData["ErrorMessage"] = "کانال یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            var model = new ChannelEditViewModel
            {
                Id = channel.Id,
                Name = channel.Name,
                Description = channel.Description,
                IsPublic = channel.IsPublic,
                IsActive = channel.IsActive,
                CreatorId = channel.CreatorId,
                CreatedAt = channel.CreatedAt
            };

            return View(model);
        }

        // POST: Admin/Channels/Edit/5
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Edit(int id, ChannelEditViewModel model)
        {
            if (id != model.Id)
            {
                return NotFound();
            }

            if (ModelState.IsValid)
            {
                var channel = await _context.Channels.FindAsync(id);

                if (channel == null)
                {
                    TempData["ErrorMessage"] = "کانال یافت نشد.";
                    return RedirectToAction(nameof(Index));
                }

                // بررسی یکتا بودن نام
                if (channel.Name != model.Name)
                {
                    var nameExists = await _context.Channels
                        .AnyAsync(c => c.Name == model.Name && c.Id != id);

                    if (nameExists)
                    {
                        ModelState.AddModelError("Name", "کانالی با این نام قبلاً وجود دارد.");
                        return View(model);
                    }
                }

                channel.Name = model.Name;
                channel.Description = model.Description;
                channel.IsPublic = model.IsPublic;
                channel.IsActive = model.IsActive;

                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "کانال با موفقیت ویرایش شد.";

                return RedirectToAction(nameof(Index));
            }

            return View(model);
        }

        // POST: Admin/Channels/Delete/5
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Delete(int id)
        {
            var channel = await _context.Channels.FindAsync(id);

            if (channel != null)
            {
                channel.IsActive = false;
                channel.IsDeleted = true;
                channel.DeletedAt = DateTime.Now;

                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "کانال با موفقیت حذف شد.";
            }
            else
            {
                TempData["ErrorMessage"] = "کانال یافت نشد.";
            }

            return RedirectToAction(nameof(Index));
        }

        // GET: Admin/Channels/Subscribers/5
        public async Task<IActionResult> Subscribers(int id)
        {
            var channel = await _context.Channels
                .Include(c => c.UserChannels.Where(uc => uc.IsActive))
                    .ThenInclude(uc => uc.User)
                .FirstOrDefaultAsync(c => c.Id == id);

            if (channel == null)
            {
                TempData["ErrorMessage"] = "کانال یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            var subscriberIds = channel.UserChannels
                .Where(uc => uc.IsActive)
                .Select(uc => uc.UserId)
                .ToList();

            ViewBag.AvailableUsers = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted && !subscriberIds.Contains(u.Id))
                .OrderBy(u => u.FirstName)
                .ToListAsync();

            ViewBag.ChannelId = id;
            ViewBag.ChannelName = channel.Name;

            return View(channel);
        }

        // POST: Admin/Channels/AddSubscriber
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> AddSubscriber(int channelId, int userId, bool canPost = false, bool isAdmin = false)
        {
            var channel = await _context.Channels.FindAsync(channelId);

            if (channel == null)
            {
                TempData["ErrorMessage"] = "کانال یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            var existingSubscription = await _context.UserChannels
                .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == userId);

            if (existingSubscription != null)
            {
                if (existingSubscription.IsActive)
                {
                    TempData["ErrorMessage"] = "این کاربر قبلاً عضو کانال است.";
                    return RedirectToAction(nameof(Subscribers), new { id = channelId });
                }
                else
                {
                    existingSubscription.IsActive = true;
                    existingSubscription.CanPost = canPost;
                    existingSubscription.IsAdmin = isAdmin;
                    existingSubscription.JoinedAt = DateTime.Now;

                    await _context.SaveChangesAsync();
                    TempData["SuccessMessage"] = "کاربر با موفقیت به کانال اضافه شد.";
                    return RedirectToAction(nameof(Subscribers), new { id = channelId });
                }
            }

            var role = isAdmin ? ChannelRole.Admin : (canPost ? ChannelRole.Publisher : ChannelRole.Subscriber);

            var userChannel = new UserChannel
            {
                UserId = userId,
                ChannelId = channelId,
                IsAdmin = isAdmin,
                CanPost = canPost,
                Role = role,
                JoinedAt = DateTime.Now,
                IsActive = true
            };

            _context.UserChannels.Add(userChannel);
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "کاربر با موفقیت به کانال اضافه شد.";
            return RedirectToAction(nameof(Subscribers), new { id = channelId });
        }

        // POST: Admin/Channels/RemoveSubscriber
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> RemoveSubscriber(int channelId, int userId)
        {
            var userChannel = await _context.UserChannels
                .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == userId);

            if (userChannel != null)
            {
                if (userChannel.Role == ChannelRole.Owner)
                {
                    TempData["ErrorMessage"] = "مالک کانال قابل حذف نیست.";
                    return RedirectToAction(nameof(Subscribers), new { id = channelId });
                }

                userChannel.IsActive = false;
                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "کاربر از کانال حذف شد.";
            }

            return RedirectToAction(nameof(Subscribers), new { id = channelId });
        }

        // POST: Admin/Channels/TogglePublisher
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> TogglePublisher(int channelId, int userId)
        {
            var userChannel = await _context.UserChannels
                .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == userId && uc.IsActive);

            if (userChannel != null)
            {
                userChannel.CanPost = !userChannel.CanPost;
                await _context.SaveChangesAsync();

                TempData["SuccessMessage"] = userChannel.CanPost
                    ? "دسترسی ارسال پست به کاربر داده شد."
                    : "دسترسی ارسال پست کاربر لغو شد.";
            }

            return RedirectToAction(nameof(Subscribers), new { id = channelId });
        }

        // POST: Admin/Channels/ToggleAdmin
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> ToggleAdmin(int channelId, int userId)
        {
            var userChannel = await _context.UserChannels
                .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == userId && uc.IsActive);

            if (userChannel != null)
            {
                if (userChannel.Role == ChannelRole.Owner)
                {
                    TempData["ErrorMessage"] = "نقش مالک کانال قابل تغییر نیست.";
                    return RedirectToAction(nameof(Subscribers), new { id = channelId });
                }

                userChannel.IsAdmin = !userChannel.IsAdmin;
                userChannel.Role = userChannel.IsAdmin ? ChannelRole.Admin :
                                   (userChannel.CanPost ? ChannelRole.Publisher : ChannelRole.Subscriber);

                await _context.SaveChangesAsync();

                TempData["SuccessMessage"] = userChannel.IsAdmin
                    ? "کاربر به ادمین ارتقا یافت."
                    : "دسترسی ادمین کاربر لغو شد.";
            }

            return RedirectToAction(nameof(Subscribers), new { id = channelId });
        }

        // متد کمکی
        private async Task<bool> ChannelExistsAsync(int id)
        {
            return await _context.Channels.AnyAsync(e => e.Id == id);
        }
    }
}
 
 
==================== DashboardController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using System.Globalization;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    [Route("Admin/[controller]")]
    public class DashboardController : Controller
    {
        private readonly ApplicationDbContext _context;

        public DashboardController(ApplicationDbContext context)
        {
            _context = context;
        }

        #region Main Dashboard View

        [HttpGet]
        [HttpGet("Index")]
        public async Task<IActionResult> Index()
        {
            var today = DateTime.Today;
            var todayStart = today;
            var todayEnd = today.AddDays(1);
            var weekStart = today.AddDays(-7);
            var onlineThreshold = DateTime.Now.AddMinutes(-5);

            // ==================== کارت‌های آمار اصلی ====================

            // کل کاربران
            ViewBag.TotalUsers = await _context.Users.CountAsync();

            // کاربران آنلاین
            ViewBag.OnlineUsers = await _context.Users
                .CountAsync(u => u.IsOnline || (u.LastSeen.HasValue && u.LastSeen > onlineThreshold));

            // کاربران جدید امروز
            ViewBag.NewUsersToday = await _context.Users
                .CountAsync(u => u.CreatedAt >= todayStart && u.CreatedAt < todayEnd);

            // کل پیام‌ها
            ViewBag.TotalMessages = await _context.Messages.CountAsync(m => !m.IsDeleted);

            // پیام‌های امروز
            ViewBag.MessagesToday = await _context.Messages
                .CountAsync(m => m.CreatedAt >= todayStart && m.CreatedAt < todayEnd && !m.IsDeleted);

            // کل گروه‌ها
            ViewBag.TotalGroups = await _context.Groups.CountAsync(g => g.IsActive);

            // گروه‌های جدید این هفته
            ViewBag.NewGroupsThisWeek = await _context.Groups
                .CountAsync(g => g.CreatedAt >= weekStart && g.IsActive);

            // کل کانال‌ها
            ViewBag.TotalChannels = await _context.Channels.CountAsync(c => c.IsActive);

            // کانال‌های جدید این هفته
            ViewBag.NewChannelsThisWeek = await _context.Channels
                .CountAsync(c => c.CreatedAt >= weekStart && c.IsActive);

            // کل تماس‌ها
            ViewBag.TotalCalls = await _context.Calls.CountAsync();

            // تماس‌های امروز
            ViewBag.CallsToday = await _context.Calls
                .CountAsync(c => c.StartedAt >= todayStart && c.StartedAt < todayEnd);

            // کل فایل‌ها (استفاده از AttachmentUrl به جای FileUrl)
            ViewBag.TotalFiles = await _context.Messages
                .CountAsync(m => !m.IsDeleted && !string.IsNullOrEmpty(m.AttachmentUrl));

            // حجم کل فایل‌ها (استفاده از AttachmentSize به جای FileSize)
            var totalStorageBytes = await _context.Messages
                .Where(m => !m.IsDeleted && m.AttachmentSize.HasValue)
                .SumAsync(m => m.AttachmentSize ?? 0);
            ViewBag.TotalStorageUsed = FormatFileSize(totalStorageBytes);

            // گزارشات در انتظار
            ViewBag.PendingReports = await GetPendingReportsCountAsync();

            // ==================== داده‌های نمودار پیام‌ها (هفتگی) ====================
            var messageChartData = await GetMessageChartDataAsync(7);
            ViewBag.MessageChartLabels = System.Text.Json.JsonSerializer.Serialize(messageChartData.Labels);
            ViewBag.MessageChartData = System.Text.Json.JsonSerializer.Serialize(messageChartData.Values);

            // ==================== داده‌های نمودار نوع پیام‌ها ====================
            var messageTypesData = await GetMessageTypesDataAsync(30);
            ViewBag.MessageTypesData = System.Text.Json.JsonSerializer.Serialize(messageTypesData);

            // ==================== داده‌های نمودار فعالیت کاربران (ساعتی) ====================
            var userActivityData = await GetUserActivityDataAsync();
            ViewBag.UserActivityData = System.Text.Json.JsonSerializer.Serialize(userActivityData);

            // ==================== داده‌های نمودار تماس‌ها ====================
            var callsChartData = await GetCallsChartDataAsync(7);
            ViewBag.CallsChartLabels = System.Text.Json.JsonSerializer.Serialize(callsChartData.Labels);
            ViewBag.VoiceCallsData = System.Text.Json.JsonSerializer.Serialize(callsChartData.VoiceCalls);
            ViewBag.VideoCallsData = System.Text.Json.JsonSerializer.Serialize(callsChartData.VideoCalls);

            // ==================== جدول کاربران جدید ====================
            ViewBag.NewUsers = await _context.Users
                .OrderByDescending(u => u.CreatedAt)
                .Take(5)
                .Select(u => new NewUserViewModel
                {
                    Id = u.Id,
                    FullName = !string.IsNullOrEmpty(u.FullName)
                        ? u.FullName
                        : $"{u.FirstName} {u.LastName}".Trim(),
                    Username = u.Username,
                    Email = u.Email ?? "",
                    CreatedAt = u.CreatedAt,
                    CreatedAtPersian = ToPersianDate(u.CreatedAt),
                    IsActive = u.IsActive,
                    IsOnline = u.IsOnline
                })
                .ToListAsync();

            // ==================== جدول گزارشات اخیر ====================
            ViewBag.RecentReports = await GetRecentReportsAsync(5);

            // ==================== جدول گروه‌های فعال ====================
            ViewBag.ActiveGroups = await _context.Groups
                .Where(g => g.IsActive)
                .OrderByDescending(g => g.Messages.Count)
                .Take(5)
                .Select(g => new
                {
                    g.Id,
                    g.Name,
                    MemberCount = g.UserGroups.Count,
                    MessageCount = g.Messages.Count(m => !m.IsDeleted)
                })
                .ToListAsync();

            // ==================== جدول کانال‌های فعال ====================
            ViewBag.ActiveChannels = await _context.Channels
                .Where(c => c.IsActive)
                .OrderByDescending(c => c.UserChannels.Count)
                .Take(5)
                .Select(c => new
                {
                    c.Id,
                    c.Name,
                    SubscriberCount = c.UserChannels.Count,
                    PostCount = c.Messages.Count(m => !m.IsDeleted)
                })
                .ToListAsync();

            // ==================== جدول آخرین تماس‌ها ====================
            ViewBag.RecentCalls = await _context.Calls
                .Include(c => c.Initiator)
                .OrderByDescending(c => c.StartedAt)
                .Take(5)
                .Select(c => new
                {
                    c.Id,
                    InitiatorName = !string.IsNullOrEmpty(c.Initiator.FullName)
                        ? c.Initiator.FullName
                        : $"{c.Initiator.FirstName} {c.Initiator.LastName}".Trim(),
                    Type = c.Type == CallType.Voice ? "صوتی" : "تصویری",
                    Duration = FormatDuration(c.Duration),
                    Status = GetCallStatusPersian(c.Status)
                })
                .ToListAsync();

            // ==================== تاریخ شمسی ====================
            ViewBag.TodayPersianDate = GetPersianDateFull();
            ViewBag.TodayPersianDateTime = GetPersianDateTime();

            return View();
        }

        #endregion

        #region Chart Data API Endpoints

        /// <summary>
        /// دریافت داده‌های نمودار بر اساس نوع و بازه زمانی
        /// </summary>
        [HttpGet("GetChartData")]
        public async Task<IActionResult> GetChartData([FromQuery] string type, [FromQuery] string period)
        {
            int days = period switch
            {
                "week" => 7,
                "month" => 30,
                "year" => 365,
                _ => 7
            };

            if (type == "messages")
            {
                var data = await GetMessageChartDataAsync(days);
                return Json(new
                {
                    labels = data.Labels,
                    values = data.Values
                });
            }
            else if (type == "calls")
            {
                var data = await GetCallsChartDataAsync(days);
                return Json(new
                {
                    labels = data.Labels,
                    voiceCalls = data.VoiceCalls,
                    videoCalls = data.VideoCalls
                });
            }

            return Json(new { error = "Invalid type" });
        }

        /// <summary>
        /// دریافت آمار پیام‌ها برای نمودار
        /// </summary>
        [HttpGet("api/messages-stats")]
        public async Task<IActionResult> GetMessagesStats([FromQuery] int days = 7)
        {
            var data = await GetMessageChartDataAsync(days);
            return Json(new
            {
                success = true,
                labels = data.Labels,
                values = data.Values,
                total = data.Values.Sum()
            });
        }

        /// <summary>
        /// دریافت آمار نوع پیام‌ها برای نمودار دایره‌ای
        /// </summary>
        [HttpGet("api/message-types")]
        public async Task<IActionResult> GetMessageTypes([FromQuery] int days = 30)
        {
            var startDate = DateTime.Today.AddDays(-days);

            var messageTypes = await _context.Messages
                .Where(m => m.CreatedAt >= startDate && !m.IsDeleted)
                .GroupBy(m => m.Type)
                .Select(g => new
                {
                    Type = g.Key,
                    Count = g.Count()
                })
                .ToListAsync();

            var result = messageTypes.Select(mt => new
            {
                Type = mt.Type.ToString(),
                TypePersian = GetMessageTypePersianName(mt.Type),
                Count = mt.Count,
                Color = GetMessageTypeColor(mt.Type)
            }).OrderByDescending(x => x.Count).ToList();

            return Json(new
            {
                success = true,
                data = result,
                labels = result.Select(r => r.TypePersian).ToArray(),
                values = result.Select(r => r.Count).ToArray(),
                colors = result.Select(r => r.Color).ToArray()
            });
        }

        /// <summary>
        /// دریافت آمار کاربران جدید
        /// </summary>
        [HttpGet("api/users-stats")]
        public async Task<IActionResult> GetUsersStats([FromQuery] int days = 7)
        {
            var endDate = DateTime.Today.AddDays(1);
            var startDate = DateTime.Today.AddDays(-days + 1);

            var usersPerDay = await _context.Users
                .Where(u => u.CreatedAt >= startDate && u.CreatedAt < endDate)
                .GroupBy(u => u.CreatedAt.Date)
                .Select(g => new
                {
                    Date = g.Key,
                    Count = g.Count()
                })
                .OrderBy(x => x.Date)
                .ToListAsync();

            var labels = new List<string>();
            var values = new List<int>();

            for (var date = startDate; date < endDate; date = date.AddDays(1))
            {
                labels.Add(GetPersianDayName(date));
                var dayData = usersPerDay.FirstOrDefault(x => x.Date == date);
                values.Add(dayData?.Count ?? 0);
            }

            return Json(new
            {
                success = true,
                labels = labels,
                values = values,
                total = values.Sum()
            });
        }

        /// <summary>
        /// دریافت آمار تماس‌ها
        /// </summary>
        [HttpGet("api/calls-stats")]
        public async Task<IActionResult> GetCallsStats([FromQuery] int days = 7)
        {
            var data = await GetCallsChartDataAsync(days);
            return Json(new
            {
                success = true,
                labels = data.Labels,
                voiceCalls = data.VoiceCalls,
                videoCalls = data.VideoCalls,
                totalVoice = data.VoiceCalls.Sum(),
                totalVideo = data.VideoCalls.Sum()
            });
        }

        /// <summary>
        /// دریافت فعالیت ساعتی کاربران (24 ساعت گذشته)
        /// </summary>
        [HttpGet("api/hourly-activity")]
        public async Task<IActionResult> GetHourlyActivity()
        {
            var data = await GetUserActivityDataAsync();
            return Json(new
            {
                success = true,
                labels = data.Labels,
                values = data.Values,
                peakHour = data.Labels[Array.IndexOf(data.Values.ToArray(), data.Values.Max())]
            });
        }

        #endregion

        #region Table Data API Endpoints

        /// <summary>
        /// دریافت لیست کاربران جدید
        /// </summary>
        [HttpGet("api/new-users")]
        public async Task<IActionResult> GetNewUsers([FromQuery] int count = 10)
        {
            var users = await _context.Users
                .OrderByDescending(u => u.CreatedAt)
                .Take(count)
                .Select(u => new
                {
                    u.Id,
                    FullName = !string.IsNullOrEmpty(u.FullName)
                        ? u.FullName
                        : $"{u.FirstName} {u.LastName}".Trim(),
                    u.Username,
                    Email = u.Email ?? "",
                    u.CreatedAt,
                    CreatedAtPersian = ToPersianDate(u.CreatedAt),
                    u.IsActive,
                    u.IsOnline
                })
                .ToListAsync();

            return Json(new { success = true, data = users });
        }

        /// <summary>
        /// دریافت لیست گزارشات اخیر
        /// </summary>
        [HttpGet("api/recent-reports")]
        public async Task<IActionResult> GetRecentReportsApi([FromQuery] int count = 10)
        {
            var reports = await GetRecentReportsAsync(count);
            return Json(new { success = true, data = reports });
        }

        /// <summary>
        /// دریافت لیست گروه‌های فعال
        /// </summary>
        [HttpGet("api/active-groups")]
        public async Task<IActionResult> GetActiveGroups([FromQuery] int count = 10)
        {
            var groups = await _context.Groups
                .Where(g => g.IsActive)
                .OrderByDescending(g => g.Messages.Count)
                .Take(count)
                .Select(g => new
                {
                    g.Id,
                    g.Name,
                    g.Description,
                    MemberCount = g.UserGroups.Count,
                    MessageCount = g.Messages.Count(m => !m.IsDeleted),
                    CreatedAt = g.CreatedAt,
                    CreatedAtPersian = ToPersianDate(g.CreatedAt)
                })
                .ToListAsync();

            return Json(new { success = true, data = groups });
        }

        /// <summary>
        /// دریافت لیست کانال‌های فعال
        /// </summary>
        [HttpGet("api/active-channels")]
        public async Task<IActionResult> GetActiveChannels([FromQuery] int count = 10)
        {
            var channels = await _context.Channels
                .Where(c => c.IsActive)
                .OrderByDescending(c => c.UserChannels.Count)
                .Take(count)
                .Select(c => new
                {
                    c.Id,
                    c.Name,
                    c.Description,
                    SubscriberCount = c.UserChannels.Count,
                    PostCount = c.Messages.Count(m => !m.IsDeleted),
                    CreatedAt = c.CreatedAt,
                    CreatedAtPersian = ToPersianDate(c.CreatedAt)
                })
                .ToListAsync();

            return Json(new { success = true, data = channels });
        }

        /// <summary>
        /// دریافت آخرین تماس‌ها
        /// </summary>
        [HttpGet("api/recent-calls")]
        public async Task<IActionResult> GetRecentCalls([FromQuery] int count = 10)
        {
            var calls = await _context.Calls
                .Include(c => c.Initiator)
                .OrderByDescending(c => c.StartedAt)
                .Take(count)
                .Select(c => new
                {
                    c.Id,
                    InitiatorId = c.InitiatorId,
                    InitiatorName = !string.IsNullOrEmpty(c.Initiator.FullName)
                        ? c.Initiator.FullName
                        : $"{c.Initiator.FirstName} {c.Initiator.LastName}".Trim(),
                    Type = c.Type.ToString(),
                    TypePersian = c.Type == CallType.Voice ? "صوتی" : "تصویری",
                    c.Duration,
                    DurationFormatted = FormatDuration(c.Duration),
                    Status = c.Status.ToString(),
                    StatusPersian = GetCallStatusPersian(c.Status),
                    c.StartedAt,
                    StartedAtPersian = ToPersianDateTime(c.StartedAt)
                })
                .ToListAsync();

            return Json(new { success = true, data = calls });
        }

        #endregion

        #region Real-time Stats API

        /// <summary>
        /// دریافت آمار لحظه‌ای برای به‌روزرسانی داشبورد
        /// </summary>
        [HttpGet("api/realtime-stats")]
        public async Task<IActionResult> GetRealtimeStats()
        {
            var today = DateTime.Today;
            var todayEnd = today.AddDays(1);
            var onlineThreshold = DateTime.Now.AddMinutes(-5);

            var stats = new
            {
                TotalUsers = await _context.Users.CountAsync(),
                OnlineUsers = await _context.Users
                    .CountAsync(u => u.IsOnline || (u.LastSeen.HasValue && u.LastSeen > onlineThreshold)),
                TotalMessages = await _context.Messages.CountAsync(m => !m.IsDeleted),
                MessagesToday = await _context.Messages
                    .CountAsync(m => m.CreatedAt >= today && m.CreatedAt < todayEnd && !m.IsDeleted),
                TotalGroups = await _context.Groups.CountAsync(g => g.IsActive),
                TotalChannels = await _context.Channels.CountAsync(c => c.IsActive),
                TotalCalls = await _context.Calls.CountAsync(),
                CallsToday = await _context.Calls
                    .CountAsync(c => c.StartedAt >= today && c.StartedAt < todayEnd),
                PendingReports = await GetPendingReportsCountAsync(),
                LastUpdate = DateTime.Now,
                LastUpdatePersian = GetPersianDateTime()
            };

            return Json(new { success = true, data = stats });
        }

        /// <summary>
        /// دریافت آمار کامل داشبورد
        /// </summary>
        [HttpGet("api/full-stats")]
        public async Task<IActionResult> GetFullStats()
        {
            var today = DateTime.Today;
            var todayEnd = today.AddDays(1);
            var weekStart = today.AddDays(-7);
            var onlineThreshold = DateTime.Now.AddMinutes(-5);

            // آمار اصلی
            var totalUsers = await _context.Users.CountAsync();
            var onlineUsers = await _context.Users
                .CountAsync(u => u.IsOnline || (u.LastSeen.HasValue && u.LastSeen > onlineThreshold));
            var newUsersToday = await _context.Users
                .CountAsync(u => u.CreatedAt >= today && u.CreatedAt < todayEnd);

            var totalMessages = await _context.Messages.CountAsync(m => !m.IsDeleted);
            var messagesToday = await _context.Messages
                .CountAsync(m => m.CreatedAt >= today && m.CreatedAt < todayEnd && !m.IsDeleted);

            var totalGroups = await _context.Groups.CountAsync(g => g.IsActive);
            var newGroupsThisWeek = await _context.Groups
                .CountAsync(g => g.CreatedAt >= weekStart && g.IsActive);

            var totalChannels = await _context.Channels.CountAsync(c => c.IsActive);
            var newChannelsThisWeek = await _context.Channels
                .CountAsync(c => c.CreatedAt >= weekStart && c.IsActive);

            var totalCalls = await _context.Calls.CountAsync();
            var callsToday = await _context.Calls
                .CountAsync(c => c.StartedAt >= today && c.StartedAt < todayEnd);

            var totalFiles = await _context.Messages
                .CountAsync(m => !m.IsDeleted && !string.IsNullOrEmpty(m.AttachmentUrl));

            var totalStorageBytes = await _context.Messages
                .Where(m => !m.IsDeleted && m.AttachmentSize.HasValue)
                .SumAsync(m => m.AttachmentSize ?? 0);

            var pendingReports = await GetPendingReportsCountAsync();

            // نمودارها
            var messageChartData = await GetMessageChartDataAsync(7);
            var messageTypesData = await GetMessageTypesDataAsync(30);
            var userActivityData = await GetUserActivityDataAsync();
            var callsChartData = await GetCallsChartDataAsync(7);

            return Json(new
            {
                success = true,
                data = new
                {
                    // آمار کارت‌ها
                    Cards = new
                    {
                        TotalUsers = totalUsers,
                        OnlineUsers = onlineUsers,
                        NewUsersToday = newUsersToday,
                        TotalMessages = totalMessages,
                        MessagesToday = messagesToday,
                        TotalGroups = totalGroups,
                        NewGroupsThisWeek = newGroupsThisWeek,
                        TotalChannels = totalChannels,
                        NewChannelsThisWeek = newChannelsThisWeek,
                        TotalCalls = totalCalls,
                        CallsToday = callsToday,
                        TotalFiles = totalFiles,
                        TotalStorageUsed = FormatFileSize(totalStorageBytes),
                        PendingReports = pendingReports
                    },
                    // نمودارها
                    Charts = new
                    {
                        Messages = new
                        {
                            Labels = messageChartData.Labels,
                            Values = messageChartData.Values
                        },
                        MessageTypes = messageTypesData,
                        UserActivity = new
                        {
                            Labels = userActivityData.Labels,
                            Values = userActivityData.Values
                        },
                        Calls = new
                        {
                            Labels = callsChartData.Labels,
                            VoiceCalls = callsChartData.VoiceCalls,
                            VideoCalls = callsChartData.VideoCalls
                        }
                    },
                    // متادیتا
                    Meta = new
                    {
                        LastUpdate = DateTime.Now,
                        LastUpdatePersian = GetPersianDateTime(),
                        TodayPersian = GetPersianDateFull()
                    }
                }
            });
        }

        #endregion

        #region Private Helper Methods

        /// <summary>
        /// دریافت داده‌های نمودار پیام‌ها
        /// </summary>
        private async Task<ChartData> GetMessageChartDataAsync(int days)
        {
            var endDate = DateTime.Today.AddDays(1);
            var startDate = DateTime.Today.AddDays(-days + 1);

            var messagesPerDay = await _context.Messages
                .Where(m => m.CreatedAt >= startDate && m.CreatedAt < endDate && !m.IsDeleted)
                .GroupBy(m => m.CreatedAt.Date)
                .Select(g => new
                {
                    Date = g.Key,
                    Count = g.Count()
                })
                .OrderBy(x => x.Date)
                .ToListAsync();

            var labels = new List<string>();
            var values = new List<int>();

            for (var date = startDate; date < endDate; date = date.AddDays(1))
            {
                labels.Add(GetPersianDayName(date));
                var dayData = messagesPerDay.FirstOrDefault(x => x.Date == date);
                values.Add(dayData?.Count ?? 0);
            }

            return new ChartData { Labels = labels, Values = values };
        }

        /// <summary>
        /// دریافت داده‌های نوع پیام‌ها
        /// </summary>
        private async Task<List<MessageTypeData>> GetMessageTypesDataAsync(int days)
        {
            var startDate = DateTime.Today.AddDays(-days);

            var messageTypes = await _context.Messages
                .Where(m => m.CreatedAt >= startDate && !m.IsDeleted)
                .GroupBy(m => m.Type)
                .Select(g => new
                {
                    Type = g.Key,
                    Count = g.Count()
                })
                .ToListAsync();

            return messageTypes.Select(mt => new MessageTypeData
            {
                Type = mt.Type.ToString(),
                TypePersian = GetMessageTypePersianName(mt.Type),
                Count = mt.Count,
                Color = GetMessageTypeColor(mt.Type)
            }).OrderByDescending(x => x.Count).ToList();
        }

        /// <summary>
        /// دریافت داده‌های فعالیت ساعتی کاربران
        /// </summary>
        private async Task<HourlyActivityData> GetUserActivityDataAsync()
        {
            var last24Hours = DateTime.Now.AddHours(-24);

            var hourlyActivity = await _context.Messages
                .Where(m => m.CreatedAt >= last24Hours && !m.IsDeleted)
                .GroupBy(m => m.CreatedAt.Hour)
                .Select(g => new
                {
                    Hour = g.Key,
                    Count = g.Count()
                })
                .ToListAsync();

            var labels = new List<string>();
            var values = new List<int>();

            for (int hour = 0; hour < 24; hour++)
            {
                labels.Add($"{hour:00}:00");
                var hourData = hourlyActivity.FirstOrDefault(x => x.Hour == hour);
                values.Add(hourData?.Count ?? 0);
            }

            return new HourlyActivityData { Labels = labels, Values = values };
        }

        /// <summary>
        /// دریافت داده‌های نمودار تماس‌ها
        /// </summary>
        private async Task<CallsChartData> GetCallsChartDataAsync(int days)
        {
            var endDate = DateTime.Today.AddDays(1);
            var startDate = DateTime.Today.AddDays(-days + 1);

            var callsPerDay = await _context.Calls
                .Where(c => c.StartedAt >= startDate && c.StartedAt < endDate)
                .GroupBy(c => new { Date = c.StartedAt.Date, c.Type })
                .Select(g => new
                {
                    g.Key.Date,
                    g.Key.Type,
                    Count = g.Count()
                })
                .ToListAsync();

            var labels = new List<string>();
            var voiceCalls = new List<int>();
            var videoCalls = new List<int>();

            for (var date = startDate; date < endDate; date = date.AddDays(1))
            {
                labels.Add(GetPersianDayName(date));

                var voiceCount = callsPerDay
                    .FirstOrDefault(x => x.Date == date && x.Type == CallType.Voice)?.Count ?? 0;
                var videoCount = callsPerDay
                    .FirstOrDefault(x => x.Date == date && x.Type == CallType.Video)?.Count ?? 0;

                voiceCalls.Add(voiceCount);
                videoCalls.Add(videoCount);
            }

            return new CallsChartData
            {
                Labels = labels,
                VoiceCalls = voiceCalls,
                VideoCalls = videoCalls
            };
        }

        /// <summary>
        /// دریافت تعداد گزارشات در انتظار
        /// </summary>
        private async Task<int> GetPendingReportsCountAsync()
        {
            // اگر Entity Report وجود دارد
            if (_context.Model.FindEntityType(typeof(Report)) != null)
            {
                return await _context.Set<Report>()
                    .CountAsync(r => r.Status == ReportStatus.Pending);
            }
            return 0;
        }

        /// <summary>
        /// دریافت گزارشات اخیر
        /// </summary>
        private async Task<List<ReportViewModel>> GetRecentReportsAsync(int count)
        {
            // اگر Entity Report وجود دارد
            if (_context.Model.FindEntityType(typeof(Report)) != null)
            {
                return await _context.Set<Report>()
                    .Include(r => r.Reporter)
                    .OrderByDescending(r => r.CreatedAt)
                    .Take(count)
                    .Select(r => new ReportViewModel
                    {
                        Id = r.Id,
                        ReporterName = !string.IsNullOrEmpty(r.Reporter.FullName)
                            ? r.Reporter.FullName
                            : $"{r.Reporter.FirstName} {r.Reporter.LastName}".Trim(),
                        ItemType = r.ItemType.ToString(),
                        ItemTypePersian = GetReportItemTypePersian(r.ItemType),
                        Reason = r.Reason ?? "",
                        Status = r.Status.ToString(),
                        StatusPersian = GetReportStatusPersian(r.Status),
                        StatusClass = GetReportStatusClass(r.Status),
                        CreatedAt = r.CreatedAt,
                        CreatedAtPersian = ToPersianDate(r.CreatedAt)
                    })
                    .ToListAsync();
            }
            return new List<ReportViewModel>();
        }

        #endregion

        #region Persian Date/Time Helpers

        /// <summary>
        /// تبدیل تاریخ به شمسی
        /// </summary>
        private static string ToPersianDate(DateTime date)
        {
            var pc = new PersianCalendar();
            return $"{pc.GetYear(date)}/{pc.GetMonth(date):00}/{pc.GetDayOfMonth(date):00}";
        }

        /// <summary>
        /// تبدیل تاریخ و زمان به شمسی
        /// </summary>
        private static string ToPersianDateTime(DateTime date)
        {
            var pc = new PersianCalendar();
            return $"{pc.GetYear(date)}/{pc.GetMonth(date):00}/{pc.GetDayOfMonth(date):00} - {date:HH:mm}";
        }

        /// <summary>
        /// دریافت نام روز به فارسی
        /// </summary>
        private static string GetPersianDayName(DateTime date)
        {
            var pc = new PersianCalendar();
            var dayOfWeek = pc.GetDayOfWeek(date);

            var persianDayNames = new Dictionary<DayOfWeek, string>
            {
                { DayOfWeek.Saturday, "شنبه" },
                { DayOfWeek.Sunday, "یکشنبه" },
                { DayOfWeek.Monday, "دوشنبه" },
                { DayOfWeek.Tuesday, "سه‌شنبه" },
                { DayOfWeek.Wednesday, "چهارشنبه" },
                { DayOfWeek.Thursday, "پنجشنبه" },
                { DayOfWeek.Friday, "جمعه" }
            };

            return persianDayNames[dayOfWeek];
        }

        /// <summary>
        /// دریافت تاریخ شمسی کامل
        /// </summary>
        private static string GetPersianDateFull()
        {
            var pc = new PersianCalendar();
            var now = DateTime.Now;

            var persianMonthNames = new[]
            {
                "", "فروردین", "اردیبهشت", "خرداد", "تیر", "مرداد", "شهریور",
                "مهر", "آبان", "آذر", "دی", "بهمن", "اسفند"
            };

            var dayOfWeek = GetPersianDayName(now);
            var day = pc.GetDayOfMonth(now);
            var month = persianMonthNames[pc.GetMonth(now)];
            var year = pc.GetYear(now);

            return $"{dayOfWeek}، {day} {month} {year}";
        }

        /// <summary>
        /// دریافت تاریخ و زمان شمسی
        /// </summary>
        private static string GetPersianDateTime()
        {
            var pc = new PersianCalendar();
            var now = DateTime.Now;
            return $"{pc.GetYear(now)}/{pc.GetMonth(now):00}/{pc.GetDayOfMonth(now):00} - {now:HH:mm:ss}";
        }

        #endregion

        #region Enum Translation Helpers

        /// <summary>
        /// دریافت نام فارسی نوع پیام - اصلاح شده بر اساس Enum واقعی
        /// </summary>
        private static string GetMessageTypePersianName(MessageType type)
        {
            return type switch
            {
                MessageType.Text => "متن",
                MessageType.Image => "تصویر",
                MessageType.Video => "ویدیو",
                MessageType.Audio => "صوت",
                MessageType.Voice => "پیام صوتی",
                MessageType.File => "فایل",
                MessageType.Location => "موقعیت",
                MessageType.Contact => "مخاطب",
                MessageType.Poll => "نظرسنجی",
                MessageType.System => "سیستمی",
                _ => "نامشخص"
            };
        }


        /// <summary>
        /// دریافت رنگ نوع پیام برای نمودار - اصلاح شده بر اساس Enum واقعی
        /// </summary>
        private static string GetMessageTypeColor(MessageType type)
        {
            return type switch
            {
                MessageType.Text => "#3B82F6",      // آبی
                MessageType.Image => "#10B981",     // سبز
                MessageType.Video => "#F59E0B",     // نارنجی
                MessageType.Audio => "#8B5CF6",     // بنفش
                MessageType.Voice => "#EC4899",     // صورتی
                MessageType.File => "#EF4444",      // قرمز
                MessageType.Location => "#06B6D4",  // فیروزه‌ای
                MessageType.Contact => "#6366F1",   // نیلی
                MessageType.Poll => "#14B8A6",      // تیل
                MessageType.System => "#78716C",    // خاکستری تیره
                _ => "#9CA3AF"                      // خاکستری روشن
            };
        }


        /// <summary>
        /// دریافت وضعیت فارسی تماس - اصلاح شده بر اساس Enum واقعی
        /// </summary>
        private static string GetCallStatusPersian(CallStatus status)
        {
            return status switch
            {
                CallStatus.Initiated => "شروع شده",
                CallStatus.Ringing => "در حال زنگ زدن",
                CallStatus.InProgress => "در جریان",
                CallStatus.Ended => "پایان یافته",
                CallStatus.Missed => "بی‌پاسخ",
                CallStatus.Rejected => "رد شده",      // ✅ Rejected وجود دارد
                CallStatus.Failed => "ناموفق",
                _ => "نامشخص"
            };
        }


        /// <summary>
        /// دریافت نام فارسی نوع آیتم گزارش
        /// </summary>
        private static string GetReportItemTypePersian(ReportItemType type)
        {
            return type switch
            {
                ReportItemType.User => "کاربر",
                ReportItemType.Message => "پیام",
                ReportItemType.Group => "گروه",
                ReportItemType.Channel => "کانال",
                _ => "نامشخص"
            };
        }

        /// <summary>
        /// دریافت وضعیت فارسی گزارش - اصلاح شده بر اساس Enum واقعی
        /// </summary>
        private static string GetReportStatusPersian(ReportStatus status)
        {
            return status switch
            {
                ReportStatus.Pending => "در انتظار بررسی",    // 0
                ReportStatus.Reviewed => "بررسی شده",         // 1 (نه UnderReview)
                ReportStatus.Resolved => "حل شده",            // 2
                ReportStatus.Dismissed => "رد شده",           // 3 (نه Rejected)
                _ => "نامشخص"
            };
        }


        /// <summary>
        /// دریافت کلاس CSS برای وضعیت گزارش - اصلاح شده بر اساس Enum واقعی
        /// </summary>
        private static string GetReportStatusClass(ReportStatus status)
        {
            return status switch
            {
                ReportStatus.Pending => "bg-warning text-dark",
                ReportStatus.Reviewed => "bg-info text-white",      // ✅ Reviewed
                ReportStatus.Resolved => "bg-success text-white",
                ReportStatus.Dismissed => "bg-secondary text-white", // ✅ Dismissed
                _ => "bg-light text-dark"
            };
        }


        #endregion

        #region Formatting Helpers

        /// <summary>
        /// فرمت کردن حجم فایل
        /// </summary>
        private static string FormatFileSize(long bytes)
        {
            string[] sizes = { "بایت", "کیلوبایت", "مگابایت", "گیگابایت", "ترابایت" };
            int order = 0;
            double size = bytes;

            while (size >= 1024 && order < sizes.Length - 1)
            {
                order++;
                size /= 1024;
            }

            return $"{size:0.##} {sizes[order]}";
        }

        /// <summary>
        /// فرمت کردن مدت زمان تماس
        /// </summary>
        private static string FormatDuration(int? seconds)
        {
            if (!seconds.HasValue || seconds.Value == 0)
                return "0:00";

            var ts = TimeSpan.FromSeconds(seconds.Value);

            if (ts.TotalHours >= 1)
                return $"{(int)ts.TotalHours}:{ts.Minutes:00}:{ts.Seconds:00}";

            return $"{ts.Minutes}:{ts.Seconds:00}";
        }

        #endregion
    }

    #region DTOs and ViewModels

    /// <summary>
    /// داده‌های نمودار عمومی
    /// </summary>
    public class ChartData
    {
        public List<string> Labels { get; set; } = new();
        public List<int> Values { get; set; } = new();
    }

    /// <summary>
    /// داده‌های نوع پیام
    /// </summary>
    public class MessageTypeData
    {
        public string Type { get; set; } = "";
        public string TypePersian { get; set; } = "";
        public int Count { get; set; }
        public string Color { get; set; } = "";
    }

    /// <summary>
    /// داده‌های فعالیت ساعتی
    /// </summary>
    public class HourlyActivityData
    {
        public List<string> Labels { get; set; } = new();
        public List<int> Values { get; set; } = new();
    }

    /// <summary>
    /// داده‌های نمودار تماس‌ها
    /// </summary>
    public class CallsChartData
    {
        public List<string> Labels { get; set; } = new();
        public List<int> VoiceCalls { get; set; } = new();
        public List<int> VideoCalls { get; set; } = new();
    }

    /// <summary>
    /// ویومدل کاربر جدید
    /// </summary>
    public class NewUserViewModel
    {
        public int Id { get; set; }
        public string FullName { get; set; } = "";
        public string Username { get; set; } = "";
        public string Email { get; set; } = "";
        public DateTime CreatedAt { get; set; }
        public string CreatedAtPersian { get; set; } = "";
        public bool IsActive { get; set; }
        public bool IsOnline { get; set; }
    }

    /// <summary>
    /// ویومدل گزارش
    /// </summary>
    public class ReportViewModel
    {
        public int Id { get; set; }
        public string ReporterName { get; set; } = "";
        public string ItemType { get; set; } = "";
        public string ItemTypePersian { get; set; } = "";
        public string Reason { get; set; } = "";
        public string Status { get; set; } = "";
        public string StatusPersian { get; set; } = "";
        public string StatusClass { get; set; } = "";
        public DateTime CreatedAt { get; set; }
        public string CreatedAtPersian { get; set; } = "";
    }

    #endregion
}
 
 
==================== GroupsController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Models.ViewModels;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    public class GroupsController : BaseAdminController
    {
        private readonly ApplicationDbContext _context;

        public GroupsController(ApplicationDbContext context)
        {
            _context = context;
        }

        // GET: Admin/Groups
        public async Task<IActionResult> Index(string searchTerm = "", bool? isActive = null)
        {
            var query = _context.Groups
                .Include(g => g.Creator)
                .Include(g => g.UserGroups)
                .AsQueryable();

            if (!string.IsNullOrEmpty(searchTerm))
            {
                query = query.Where(g => g.Name.Contains(searchTerm) ||
                                        (g.Description != null && g.Description.Contains(searchTerm)));
            }

            if (isActive.HasValue)
            {
                query = query.Where(g => g.IsActive == isActive.Value);
            }

            var groups = await query
                .OrderByDescending(g => g.CreatedAt)
                .Select(g => new GroupListViewModel
                {
                    Id = g.Id,
                    Name = g.Name,
                    Description = g.Description,
                    CreatorName = g.Creator.FirstName + " " + g.Creator.LastName,
                    MemberCount = g.UserGroups.Count(ug => ug.IsActive),
                    IsActive = g.IsActive,
                    IsPublic = g.IsPublic,
                    CreatedAt = g.CreatedAt
                })
                .ToListAsync();

            ViewBag.SearchTerm = searchTerm;
            ViewBag.IsActive = isActive;

            return View(groups);
        }

        // GET: Admin/Groups/Details/5
        public async Task<IActionResult> Details(int id)
        {
            var group = await _context.Groups
                .Include(g => g.Creator)
                .Include(g => g.UserGroups)
                    .ThenInclude(ug => ug.User)
                .Include(g => g.Messages.Where(m => !m.IsDeleted))
                .FirstOrDefaultAsync(g => g.Id == id);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            ViewBag.MessageCount = group.Messages.Count;
            ViewBag.MemberCount = group.UserGroups.Count(ug => ug.IsActive);
            ViewBag.AdminCount = group.UserGroups.Count(ug => ug.IsActive && ug.IsAdmin);

            return View(group);
        }

        // GET: Admin/Groups/Create
        public async Task<IActionResult> Create()
        {
            ViewBag.Users = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted)
                .OrderBy(u => u.FirstName)
                .ThenBy(u => u.LastName)
                .ToListAsync();

            return View(new GroupCreateViewModel
            {
                MaxMembers = 100,
                IsActive = true,
                IsPublic = false
            });
        }

        // POST: Admin/Groups/Create
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Create(GroupCreateViewModel model)
        {
            if (ModelState.IsValid)
            {
                // بررسی یکتا بودن نام گروه
                var existingGroup = await _context.Groups
                    .AnyAsync(g => g.Name == model.Name);

                if (existingGroup)
                {
                    ModelState.AddModelError("Name", "گروهی با این نام قبلاً وجود دارد.");
                    ViewBag.Users = await _context.Users
                        .Where(u => u.IsActive && !u.IsDeleted)
                        .ToListAsync();
                    return View(model);
                }

                var group = new Group
                {
                    Name = model.Name,
                    Description = model.Description,
                    CreatorId = model.CreatorId,
                    MaxMembers = model.MaxMembers,
                    IsPublic = model.IsPublic,
                    IsActive = model.IsActive,
                    CreatedAt = DateTime.Now
                };

                _context.Groups.Add(group);
                await _context.SaveChangesAsync();

                // افزودن سازنده به عنوان اولین عضو و Owner
                var userGroup = new UserGroup
                {
                    UserId = model.CreatorId,
                    GroupId = group.Id,
                    IsAdmin = true,
                    Role = GroupRole.Owner,
                    JoinedAt = DateTime.Now,
                    IsActive = true
                };

                _context.UserGroups.Add(userGroup);
                await _context.SaveChangesAsync();

                TempData["SuccessMessage"] = "گروه با موفقیت ایجاد شد.";
                return RedirectToAction(nameof(Index));
            }

            ViewBag.Users = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted)
                .ToListAsync();

            return View(model);
        }

        // GET: Admin/Groups/Edit/5
        public async Task<IActionResult> Edit(int id)
        {
            var group = await _context.Groups.FindAsync(id);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            var model = new GroupEditViewModel
            {
                Id = group.Id,
                Name = group.Name,
                Description = group.Description,
                MaxMembers = group.MaxMembers,
                IsPublic = group.IsPublic,
                IsActive = group.IsActive,
                CreatorId = group.CreatorId,
                CreatedAt = group.CreatedAt
            };

            ViewBag.Users = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted)
                .ToListAsync();

            return View(model);
        }

        // POST: Admin/Groups/Edit/5
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Edit(int id, GroupEditViewModel model)
        {
            if (id != model.Id)
            {
                return NotFound();
            }

            if (ModelState.IsValid)
            {
                try
                {
                    var group = await _context.Groups.FindAsync(id);

                    if (group == null)
                    {
                        TempData["ErrorMessage"] = "گروه یافت نشد.";
                        return RedirectToAction(nameof(Index));
                    }

                    // بررسی یکتا بودن نام (اگر تغییر کرده)
                    if (group.Name != model.Name)
                    {
                        var nameExists = await _context.Groups
                            .AnyAsync(g => g.Name == model.Name && g.Id != id);

                        if (nameExists)
                        {
                            ModelState.AddModelError("Name", "گروهی با این نام قبلاً وجود دارد.");
                            ViewBag.Users = await _context.Users
                                .Where(u => u.IsActive && !u.IsDeleted)
                                .ToListAsync();
                            return View(model);
                        }
                    }

                    group.Name = model.Name;
                    group.Description = model.Description;
                    group.MaxMembers = model.MaxMembers;
                    group.IsPublic = model.IsPublic;
                    group.IsActive = model.IsActive;
                    group.UpdatedAt = DateTime.Now;

                    await _context.SaveChangesAsync();
                    TempData["SuccessMessage"] = "گروه با موفقیت ویرایش شد.";
                }
                catch (DbUpdateConcurrencyException)
                {
                    if (!await GroupExistsAsync(model.Id))
                    {
                        TempData["ErrorMessage"] = "گروه یافت نشد.";
                        return RedirectToAction(nameof(Index));
                    }
                    throw;
                }

                return RedirectToAction(nameof(Index));
            }

            ViewBag.Users = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted)
                .ToListAsync();

            return View(model);
        }

        // POST: Admin/Groups/Delete/5
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Delete(int id)
        {
            var group = await _context.Groups
                .Include(g => g.UserGroups)
                .Include(g => g.Messages)
                .FirstOrDefaultAsync(g => g.Id == id);

            if (group != null)
            {
                // حذف نرم (Soft Delete)
                group.IsActive = false;
                group.IsDeleted = true;
                group.DeletedAt = DateTime.Now;

                // غیرفعال کردن تمام عضویت‌ها
                foreach (var ug in group.UserGroups)
                {
                    ug.IsActive = false;
                }

                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "گروه با موفقیت حذف شد.";
            }
            else
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
            }

            return RedirectToAction(nameof(Index));
        }

        // POST: Admin/Groups/HardDelete/5 - حذف کامل
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> HardDelete(int id)
        {
            var group = await _context.Groups
                .Include(g => g.UserGroups)
                .Include(g => g.Messages)
                .FirstOrDefaultAsync(g => g.Id == id);

            if (group != null)
            {
                // حذف تمام پیام‌های گروه
                _context.Messages.RemoveRange(group.Messages);

                // حذف تمام عضویت‌ها
                _context.UserGroups.RemoveRange(group.UserGroups);

                // حذف گروه
                _context.Groups.Remove(group);

                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "گروه به طور کامل حذف شد.";
            }
            else
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
            }

            return RedirectToAction(nameof(Index));
        }

        // GET: Admin/Groups/Members/5
        public async Task<IActionResult> Members(int id)
        {
            var group = await _context.Groups
                .Include(g => g.UserGroups.Where(ug => ug.IsActive))
                    .ThenInclude(ug => ug.User)
                .FirstOrDefaultAsync(g => g.Id == id);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            // کاربرانی که عضو این گروه نیستند
            var memberUserIds = group.UserGroups
                .Where(ug => ug.IsActive)
                .Select(ug => ug.UserId)
                .ToList();

            ViewBag.AvailableUsers = await _context.Users
                .Where(u => u.IsActive && !u.IsDeleted && !memberUserIds.Contains(u.Id))
                .OrderBy(u => u.FirstName)
                .ThenBy(u => u.LastName)
                .ToListAsync();

            ViewBag.GroupId = id;
            ViewBag.GroupName = group.Name;
            ViewBag.MaxMembers = group.MaxMembers;
            ViewBag.CurrentMemberCount = memberUserIds.Count;

            return View(group);
        }

        // POST: Admin/Groups/AddMember
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> AddMember(int groupId, int userId, bool isAdmin = false)
        {
            var group = await _context.Groups
                .Include(g => g.UserGroups.Where(ug => ug.IsActive))
                .FirstOrDefaultAsync(g => g.Id == groupId);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            // بررسی ظرفیت گروه
            var currentMemberCount = group.UserGroups.Count(ug => ug.IsActive);
            if (currentMemberCount >= group.MaxMembers)
            {
                TempData["ErrorMessage"] = $"ظرفیت گروه ({group.MaxMembers} نفر) تکمیل است.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            // بررسی وجود کاربر
            var user = await _context.Users.FindAsync(userId);
            if (user == null || !user.IsActive || user.IsDeleted)
            {
                TempData["ErrorMessage"] = "کاربر یافت نشد یا غیرفعال است.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            // بررسی عضویت قبلی
            var existingMembership = await _context.UserGroups
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId);

            if (existingMembership != null)
            {
                if (existingMembership.IsActive)
                {
                    TempData["ErrorMessage"] = "این کاربر قبلاً عضو گروه است.";
                    return RedirectToAction(nameof(Members), new { id = groupId });
                }
                else
                {
                    // فعال‌سازی مجدد عضویت قبلی
                    existingMembership.IsActive = true;
                    existingMembership.IsAdmin = isAdmin;
                    existingMembership.Role = isAdmin ? GroupRole.Admin : GroupRole.Member;
                    existingMembership.JoinedAt = DateTime.Now;

                    await _context.SaveChangesAsync();
                    TempData["SuccessMessage"] = $"کاربر «{user.FullName}» با موفقیت به گروه اضافه شد.";
                    return RedirectToAction(nameof(Members), new { id = groupId });
                }
            }

            // ایجاد عضویت جدید
            var userGroup = new UserGroup
            {
                UserId = userId,
                GroupId = groupId,
                IsAdmin = isAdmin,
                Role = isAdmin ? GroupRole.Admin : GroupRole.Member,
                JoinedAt = DateTime.Now,
                IsActive = true
            };

            _context.UserGroups.Add(userGroup);
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = $"کاربر «{user.FullName}» با موفقیت به گروه اضافه شد.";
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // POST: Admin/Groups/AddMultipleMembers - افزودن چندین عضو همزمان
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> AddMultipleMembers(int groupId, List<int> userIds)
        {
            if (userIds == null || !userIds.Any())
            {
                TempData["ErrorMessage"] = "لطفاً حداقل یک کاربر انتخاب کنید.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            var group = await _context.Groups
                .Include(g => g.UserGroups.Where(ug => ug.IsActive))
                .FirstOrDefaultAsync(g => g.Id == groupId);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            var currentMemberCount = group.UserGroups.Count(ug => ug.IsActive);
            var availableSlots = group.MaxMembers - currentMemberCount;

            if (userIds.Count > availableSlots)
            {
                TempData["ErrorMessage"] = $"تنها {availableSlots} ظرفیت خالی در گروه وجود دارد.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            var existingMemberIds = group.UserGroups
                .Where(ug => ug.IsActive)
                .Select(ug => ug.UserId)
                .ToList();

            var addedCount = 0;

            foreach (var userId in userIds)
            {
                if (existingMemberIds.Contains(userId))
                    continue;

                var existingInactive = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId && !ug.IsActive);

                if (existingInactive != null)
                {
                    existingInactive.IsActive = true;
                    existingInactive.JoinedAt = DateTime.Now;
                }
                else
                {
                    var userGroup = new UserGroup
                    {
                        UserId = userId,
                        GroupId = groupId,
                        IsAdmin = false,
                        Role = GroupRole.Member,
                        JoinedAt = DateTime.Now,
                        IsActive = true
                    };
                    _context.UserGroups.Add(userGroup);
                }

                addedCount++;
            }

            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = $"{addedCount} کاربر با موفقیت به گروه اضافه شدند.";
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // POST: Admin/Groups/RemoveMember
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> RemoveMember(int groupId, int userId)
        {
            var userGroup = await _context.UserGroups
                .Include(ug => ug.User)
                .Include(ug => ug.Group)
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId);

            if (userGroup == null)
            {
                TempData["ErrorMessage"] = "عضویت یافت نشد.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            // جلوگیری از حذف Owner
            if (userGroup.Role == GroupRole.Owner)
            {
                TempData["ErrorMessage"] = "مالک گروه قابل حذف نیست. ابتدا مالکیت را به کاربر دیگری منتقل کنید.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            // حذف نرم
            userGroup.IsActive = false;
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = $"کاربر «{userGroup.User.FullName}» از گروه حذف شد.";
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // POST: Admin/Groups/ToggleAdmin
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> ToggleAdmin(int groupId, int userId)
        {
            var userGroup = await _context.UserGroups
                .Include(ug => ug.User)
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId && ug.IsActive);

            if (userGroup == null)
            {
                TempData["ErrorMessage"] = "عضویت یافت نشد.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            // Owner قابل تغییر نیست
            if (userGroup.Role == GroupRole.Owner)
            {
                TempData["ErrorMessage"] = "نقش مالک گروه قابل تغییر نیست.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            userGroup.IsAdmin = !userGroup.IsAdmin;
            userGroup.Role = userGroup.IsAdmin ? GroupRole.Admin : GroupRole.Member;
            await _context.SaveChangesAsync();

            var message = userGroup.IsAdmin
                ? $"کاربر «{userGroup.User.FullName}» به ادمین ارتقا یافت."
                : $"دسترسی ادمین کاربر «{userGroup.User.FullName}» لغو شد.";

            TempData["SuccessMessage"] = message;
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // POST: Admin/Groups/TransferOwnership - انتقال مالکیت
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> TransferOwnership(int groupId, int newOwnerId)
        {
            var currentOwner = await _context.UserGroups
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.Role == GroupRole.Owner);

            var newOwnerMembership = await _context.UserGroups
                .Include(ug => ug.User)
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == newOwnerId && ug.IsActive);

            if (currentOwner == null || newOwnerMembership == null)
            {
                TempData["ErrorMessage"] = "خطا در انتقال مالکیت.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            // تنزل مالک قبلی به ادمین
            currentOwner.Role = GroupRole.Admin;
            currentOwner.IsAdmin = true;

            // ارتقای مالک جدید
            newOwnerMembership.Role = GroupRole.Owner;
            newOwnerMembership.IsAdmin = true;

            // به‌روزرسانی CreatorId در گروه
            var group = await _context.Groups.FindAsync(groupId);
            if (group != null)
            {
                group.CreatorId = newOwnerId;
                group.UpdatedAt = DateTime.Now;
            }

            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = $"مالکیت گروه به «{newOwnerMembership.User.FullName}» منتقل شد.";
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // POST: Admin/Groups/MuteMember - بی‌صدا کردن عضو
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> MuteMember(int groupId, int userId, int? hours = null)
        {
            var userGroup = await _context.UserGroups
                .Include(ug => ug.User)
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId && ug.IsActive);

            if (userGroup == null)
            {
                TempData["ErrorMessage"] = "عضویت یافت نشد.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            userGroup.IsMuted = true;
            userGroup.MutedUntil = hours.HasValue ? DateTime.Now.AddHours(hours.Value) : null;
            await _context.SaveChangesAsync();

            var duration = hours.HasValue ? $"به مدت {hours} ساعت" : "بدون محدودیت زمانی";
            TempData["SuccessMessage"] = $"کاربر «{userGroup.User.FullName}» {duration} بی‌صدا شد.";
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // POST: Admin/Groups/UnmuteMember - رفع بی‌صدایی
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> UnmuteMember(int groupId, int userId)
        {
            var userGroup = await _context.UserGroups
                .Include(ug => ug.User)
                .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId && ug.IsActive);

            if (userGroup == null)
            {
                TempData["ErrorMessage"] = "عضویت یافت نشد.";
                return RedirectToAction(nameof(Members), new { id = groupId });
            }

            userGroup.IsMuted = false;
            userGroup.MutedUntil = null;
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = $"بی‌صدایی کاربر «{userGroup.User.FullName}» رفع شد.";
            return RedirectToAction(nameof(Members), new { id = groupId });
        }

        // GET: Admin/Groups/Messages/5 - مشاهده پیام‌های گروه
        public async Task<IActionResult> Messages(int id, int page = 1, int pageSize = 50)
        {
            var group = await _context.Groups.FindAsync(id);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            var query = _context.Messages
                .Include(m => m.Sender)
                .Where(m => m.GroupId == id && !m.IsDeleted)
                .OrderByDescending(m => m.SentAt);

            var totalMessages = await query.CountAsync();
            var totalPages = (int)Math.Ceiling(totalMessages / (double)pageSize);

            var messages = await query
                .Skip((page - 1) * pageSize)
                .Take(pageSize)
                .Select(m => new MessageListViewModel
                {
                    Id = m.Id,
                    SenderName = m.Sender.FirstName + " " + m.Sender.LastName,
                    MessageText = m.MessageText ?? m.Content ?? "[بدون متن]",
                    SentAt = m.SentAt,
                    IsEdited = m.IsEdited,
                    Type = m.Type.ToString()
                })
                .ToListAsync();

            ViewBag.GroupId = id;
            ViewBag.GroupName = group.Name;
            ViewBag.CurrentPage = page;
            ViewBag.TotalPages = totalPages;
            ViewBag.TotalMessages = totalMessages;

            return View(messages);
        }

        // POST: Admin/Groups/DeleteMessage - حذف پیام
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteMessage(int groupId, int messageId)
        {
            var message = await _context.Messages
                .FirstOrDefaultAsync(m => m.Id == messageId && m.GroupId == groupId);

            if (message == null)
            {
                TempData["ErrorMessage"] = "پیام یافت نشد.";
                return RedirectToAction(nameof(Messages), new { id = groupId });
            }

            // حذف نرم
            message.IsDeleted = true;
            message.DeletedAt = DateTime.Now;
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "پیام با موفقیت حذف شد.";
            return RedirectToAction(nameof(Messages), new { id = groupId });
        }

        // POST: Admin/Groups/Restore/5 - بازگردانی گروه حذف شده
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Restore(int id)
        {
            var group = await _context.Groups.FindAsync(id);

            if (group == null)
            {
                TempData["ErrorMessage"] = "گروه یافت نشد.";
                return RedirectToAction(nameof(Index));
            }

            group.IsDeleted = false;
            group.IsActive = true;
            group.DeletedAt = null;
            group.UpdatedAt = DateTime.Now;

            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "گروه با موفقیت بازگردانی شد.";
            return RedirectToAction(nameof(Index));
        }

        // GET: Admin/Groups/Deleted - لیست گروه‌های حذف شده
        public async Task<IActionResult> Deleted()
        {
            var deletedGroups = await _context.Groups
                .Include(g => g.Creator)
                .Where(g => g.IsDeleted)
                .OrderByDescending(g => g.DeletedAt)
                .Select(g => new GroupListViewModel
                {
                    Id = g.Id,
                    Name = g.Name,
                    Description = g.Description,
                    CreatorName = g.Creator.FirstName + " " + g.Creator.LastName,
                    MemberCount = g.UserGroups.Count,
                    IsActive = g.IsActive,
                    IsPublic = g.IsPublic,
                    CreatedAt = g.CreatedAt,
                    DeletedAt = g.DeletedAt
                })
                .ToListAsync();

            return View(deletedGroups);
        }

        // GET: Admin/Groups/Export - خروجی Excel از لیست گروه‌ها
        public async Task<IActionResult> Export()
        {
            var groups = await _context.Groups
                .Include(g => g.Creator)
                .Include(g => g.UserGroups)
                .Where(g => !g.IsDeleted)
                .OrderBy(g => g.Name)
                .ToListAsync();

            // ساده‌ترین روش: خروجی CSV
            var csv = new System.Text.StringBuilder();
            csv.AppendLine("Id,Name,Description,Creator,MemberCount,IsPublic,IsActive,CreatedAt");

            foreach (var g in groups)
            {
                var description = g.Description?.Replace(",", " ").Replace("\n", " ") ?? "";
                csv.AppendLine($"{g.Id},{g.Name},{description},{g.Creator.FullName},{g.UserGroups.Count(ug => ug.IsActive)},{g.IsPublic},{g.IsActive},{g.CreatedAt:yyyy-MM-dd HH:mm}");
            }

            var bytes = System.Text.Encoding.UTF8.GetBytes(csv.ToString());
            return File(bytes, "text/csv", $"Groups_{DateTime.Now:yyyyMMdd_HHmm}.csv");
        }

        // متد کمکی برای بررسی وجود گروه
        private async Task<bool> GroupExistsAsync(int id)
        {
            return await _context.Groups.AnyAsync(e => e.Id == id);
        }
    }
}
 
 
==================== SettingsController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿// Areas/Admin/Controllers/SettingsController.cs - نسخه FINAL بدون ViewModel
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Areas.Admin.Models;
using System.Text.Json;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    public class SettingsController : Controller
    {
        private readonly ApplicationDbContext _context;

        public SettingsController(ApplicationDbContext context)
        {
            _context = context;
        }

        private async Task<string?> GetSettingValueAsync(string key)
        {
            var setting = await _context.SystemSettings.FirstOrDefaultAsync(s => s.Key == key);
            return setting?.Value;
        }

        private async Task SaveSettingAsync(string key, string? value)
        {
            var setting = await _context.SystemSettings.FirstOrDefaultAsync(s => s.Key == key);
            if (setting == null)
            {
                _context.SystemSettings.Add(new SystemSetting { Key = key, Value = value ?? "", UpdatedAt = DateTime.Now });
            }
            else
            {
                setting.Value = value ?? "";
                setting.UpdatedAt = DateTime.Now;
            }
            await _context.SaveChangesAsync();
        }

        public async Task<IActionResult> Index()
        {
            var settings = await _context.SystemSettings.ToListAsync();

            ViewBag.TotalSettings = settings.Count;

            // ✅ Safe DateTime
            var lastUpdated = await _context.SystemSettings
                .MaxAsync(s => (DateTime?)s.UpdatedAt) ?? DateTime.Now;
            ViewBag.LastUpdated = lastUpdated; // ✅ non-null

            return View(settings);
        }


        #region General


        [HttpGet]
        public async Task<IActionResult> General()
        {
            ViewBag.OrganizationName = await GetSettingValueAsync("CompanyName") ?? "سازمان";
            ViewBag.LogoUrl = await GetSettingValueAsync("CompanyLogoUrl");

            // ✅ دقیقاً "true" چک کنید (نه فقط true)
            var groupSetting = await GetSettingValueAsync("AllowUserGroupCreation");
            ViewBag.AllowUserGroupCreation = groupSetting == "true";

            var channelSetting = await GetSettingValueAsync("AllowUserChannelCreation");
            ViewBag.AllowUserChannelCreation = channelSetting == "true";

            ViewBag.MaxGroupMembers = await GetSettingValueAsync("MaxGroupMembers") ?? "200";

            return View();
        }




        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> General(string organizationName, IFormFile? logoFile,
     bool allowUserGroupCreation, bool allowUserChannelCreation, int maxGroupMembers)
        {
            try
            {
                // ذخیره نام سازمان
                await SaveSettingAsync("CompanyName", organizationName);
                await SaveSettingAsync("AllowUserGroupCreation", allowUserGroupCreation.ToString().ToLower());
                await SaveSettingAsync("AllowUserChannelCreation", allowUserChannelCreation.ToString().ToLower());
                await SaveSettingAsync("MaxGroupMembers", maxGroupMembers.ToString());

                // آپلود لوگو
                if (logoFile != null && logoFile.Length > 0)
                {
                    var uploadsPath = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "uploads", "logos");
                    Directory.CreateDirectory(uploadsPath);

                    var fileName = $"{Guid.NewGuid()}{Path.GetExtension(logoFile.FileName)}";
                    var filePath = Path.Combine(uploadsPath, fileName);

                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await logoFile.CopyToAsync(stream);
                    }

                    await SaveSettingAsync("CompanyLogoUrl", $"/uploads/logos/{fileName}");
                }

                TempData["Success"] = "تنظیمات با موفقیت ذخیره شد";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "خطا در ذخیره: " + ex.Message;
            }
            return RedirectToAction(nameof(General));
        }



        #endregion

        #region Authentication
        [HttpGet]
        public async Task<IActionResult> Authentication()
        {
            ViewBag.AuthenticationType = await GetSettingValueAsync("AuthenticationType") ?? "Database";
            ViewBag.AdServer = await GetSettingValueAsync("AdServer") ?? "";
            ViewBag.AdDomain = await GetSettingValueAsync("AdDomain") ?? "";
            ViewBag.ErpApiUrl = await GetSettingValueAsync("ErpApiUrl") ?? "";
            ViewBag.OtpExpiryMinutes = await GetSettingValueAsync("OtpExpiryMinutes") ?? "5";
            ViewBag.OtpEnabled = await GetSettingValueAsync("OtpEnabled") == "true";

            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> Authentication(
            string authenticationType, string adServer, string adDomain, string erpApiUrl,
            bool otpEnabled, int otpExpiryMinutes)
        {
            // 🔥 DEBUG - در Output Window ببینید
            System.Diagnostics.Debug.WriteLine($"DEBUG: Type={authenticationType}, OTP={otpEnabled}");

            await SaveSettingAsync("AuthenticationType", authenticationType);
            await SaveSettingAsync("AdServer", adServer);
            await SaveSettingAsync("AdDomain", adDomain);
            await SaveSettingAsync("ErpApiUrl", erpApiUrl);
            await SaveSettingAsync("OtpEnabled", otpEnabled.ToString().ToLower());
            await SaveSettingAsync("OtpExpiryMinutes", otpExpiryMinutes.ToString());

            TempData["Success"] = $"ذخیره شد: {authenticationType}, OTP={otpEnabled}";
            return RedirectToAction(nameof(Authentication));
        }


        #endregion

        #region FileUpload
        public async Task<IActionResult> FileUpload()
        {
            var settings = await _context.FileUploadSettings.ToListAsync();
            return View(settings);
        }

        // ✅ UPDATE (اصلاح موجود)
        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> UpdateFileType(int id, long maxSize, bool isAllowed)
        {
            var setting = await _context.FileUploadSettings.FindAsync(id);
            if (setting != null)
            {
                setting.MaxSize = maxSize;
                setting.IsAllowed = isAllowed;
                await _context.SaveChangesAsync();
                TempData["Success"] = "فایل بروزرسانی شد";
            }
            return RedirectToAction(nameof(FileUpload));
        }

        // ✅ CREATE (اضافه جدید)
        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> AddFileType(string fileType, string category, long maxSize, bool isAllowed)
        {
            if (!string.IsNullOrEmpty(fileType))
            {
                // چک تکراری
                var exists = await _context.FileUploadSettings.AnyAsync(x => x.FileType == fileType);
                if (!exists)
                {
                    _context.FileUploadSettings.Add(new FileUploadSetting
                    {
                        FileType = fileType.ToLower(),
                        Category = category,
                        MaxSize = maxSize,
                        IsAllowed = isAllowed
                    });
                    await _context.SaveChangesAsync();
                    TempData["Success"] = "فایل اضافه شد";
                }
                else
                {
                    TempData["Error"] = "این نوع فایل قبلاً وجود دارد";
                }
            }
            return RedirectToAction(nameof(FileUpload));
        }

        // ✅ DELETE
        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteFileType(int id)
        {
            var setting = await _context.FileUploadSettings.FindAsync(id);
            if (setting != null)
            {
                _context.FileUploadSettings.Remove(setting);
                await _context.SaveChangesAsync();
                TempData["Success"] = "فایل حذف شد";
            }
            return RedirectToAction(nameof(FileUpload));
        }
        #endregion


        #region VoIP

        [HttpGet]
        public async Task<IActionResult> VoIP()
        {
            ViewBag.VoipEnabled = await GetSettingValueAsync("VoipEnabled") == "true";
            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> VoIP(bool voipEnabled)
        {
            // 🔥 DEBUG
            System.Diagnostics.Debug.WriteLine($"🔥 VoIP Debug: {voipEnabled}");

            await SaveSettingAsync("VoipEnabled", voipEnabled.ToString().ToLower());

            // ✅ TempData["Success"] (نه SuccessMessage)
            TempData["Success"] = $"VoIP {(voipEnabled ? "فعال" : "غیرفعال")} شد";
            return RedirectToAction(nameof(VoIP));
        }


        #endregion

        #region Telegram
        [HttpGet]
        public async Task<IActionResult> Telegram()
        {
            ViewBag.TelegramEnabled = await GetSettingValueAsync("TelegramIntegrationEnabled") == "true";
            ViewBag.BotToken = await GetSettingValueAsync("TelegramBotToken") ?? "";
            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> Telegram(bool telegramEnabled, string? botToken)
        {
            // 🔥 DEBUG
            System.Diagnostics.Debug.WriteLine($"🔥 Telegram Debug: Enabled={telegramEnabled}, Token={botToken?.Substring(0, 10)}...");

            await SaveSettingAsync("TelegramIntegrationEnabled", telegramEnabled.ToString().ToLower());
            await SaveSettingAsync("TelegramBotToken", botToken);

            TempData["Success"] = $"تلگرام {(telegramEnabled ? "فعال" : "غیرفعال")} شد";
            return RedirectToAction(nameof(Telegram));
        }
        #endregion



        #region message
        [HttpGet]
        public async Task<IActionResult> MessageSettings()
        {
            ViewBag.MessageEditTimeLimit = await GetSettingValueAsync("MessageEditTimeLimit") ?? "3600";
            ViewBag.MessageDeleteTimeLimit = await GetSettingValueAsync("MessageDeleteTimeLimit") ?? "7200";
            ViewBag.AllowMessageEdit = await GetSettingValueAsync("AllowMessageEdit") == "true";
            ViewBag.AllowMessageDelete = await GetSettingValueAsync("AllowMessageDelete") == "true";

            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> MessageSettings(
            int messageEditTimeLimit, int messageDeleteTimeLimit,
            bool allowMessageEdit, bool allowMessageDelete)
        {
            // 🔥 DEBUG
            System.Diagnostics.Debug.WriteLine($"EditTime={messageEditTimeLimit}, Edit={allowMessageEdit}");

            await SaveSettingAsync("MessageEditTimeLimit", messageEditTimeLimit.ToString());
            await SaveSettingAsync("MessageDeleteTimeLimit", messageDeleteTimeLimit.ToString());
            await SaveSettingAsync("AllowMessageEdit", allowMessageEdit.ToString().ToLower());
            await SaveSettingAsync("AllowMessageDelete", allowMessageDelete.ToString().ToLower());

            TempData["Success"] = $"ذخیره شد: ویرایش={allowMessageEdit}, حذف={allowMessageDelete}";
            return RedirectToAction(nameof(MessageSettings));
        }



        #endregion

        #region ForbiddenWords
        public async Task<IActionResult> ForbiddenWords()
        {
            var words = await _context.ForbiddenWords.ToListAsync();
            return View(words);
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> AddForbiddenWord(string newWord)
        {
            try
            {
                if (!string.IsNullOrWhiteSpace(newWord))
                {
                    // ✅ چک تکراری قبل از Add
                    var trimmedWord = newWord.Trim().ToLower();
                    var exists = await _context.ForbiddenWords.AnyAsync(w => w.Word.ToLower() == trimmedWord);

                    if (exists)
                    {
                        TempData["Error"] = $"کلمه '{newWord.Trim()}' قبلاً وجود دارد";
                        return RedirectToAction(nameof(ForbiddenWords));
                    }

                    // ✅ اضافه کردن
                    _context.ForbiddenWords.Add(new ForbiddenWord
                    {
                        Word = trimmedWord,
                        CreatedAt = DateTime.Now
                    });
                    await _context.SaveChangesAsync();

                    TempData["Success"] = $"کلمه '{newWord.Trim()}' اضافه شد";
                }
                else
                {
                    TempData["Error"] = "کلمه نمی‌تواند خالی باشد";
                }
            }
            catch (DbUpdateException ex) when (ex.InnerException?.Message.Contains("duplicate key") == true)
            {
                // ✅ Catch خطای Unique Constraint
                TempData["Error"] = "این کلمه قبلاً وجود دارد";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "خطا در ذخیره: " + ex.Message;
            }

            return RedirectToAction(nameof(ForbiddenWords));
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteForbiddenWord(int id)
        {
            try
            {
                var word = await _context.ForbiddenWords.FindAsync(id);
                if (word != null)
                {
                    _context.ForbiddenWords.Remove(word);
                    await _context.SaveChangesAsync();
                    TempData["Success"] = $"کلمه '{word.Word}' حذف شد";
                }
                else
                {
                    TempData["Error"] = "کلمه پیدا نشد";
                }
            }
            catch (Exception ex)
            {
                TempData["Error"] = "خطا در حذف: " + ex.Message;
            }
            return RedirectToAction(nameof(ForbiddenWords));
        }
        #endregion


        #region ServiceLinks
        public async Task<IActionResult> ServiceLinks()
        {
            var links = await _context.ServiceLinks.ToListAsync();
            return View(links);
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> AddServiceLink(string title, string url, string? iconUrl = null)
        {
            try
            {
                // ✅ حل Foreign Key - AdminUser فعلی را پیدا کن
                var currentAdminId = GetCurrentAdminId(); // یا از User.Identity استفاده کنید

                var link = new ServiceLink
                {
                    Title = title,
                    Url = url,
                    IconUrl = iconUrl,
                    DisplayOrder = await GetNextDisplayOrderAsync(),
                    CreatedByAdminId = currentAdminId,  // ✅ Foreign Key
                    CreatedAt = DateTime.Now
                };

                _context.ServiceLinks.Add(link);
                await _context.SaveChangesAsync();

                TempData["Success"] = "لینک با موفقیت اضافه شد";
            }
            catch (DbUpdateException ex) when (ex.InnerException?.Message.Contains("FOREIGN KEY") == true)
            {
                TempData["Error"] = "خطا در ذخیره: AdminUser پیدا نشد";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "خطا: " + ex.Message;
            }

            return RedirectToAction(nameof(ServiceLinks));
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteServiceLink(int id)
        {
            try
            {
                var link = await _context.ServiceLinks.FindAsync(id);
                if (link != null)
                {
                    _context.ServiceLinks.Remove(link);
                    await _context.SaveChangesAsync();
                    TempData["Success"] = "لینک حذف شد";
                }
            }
            catch (Exception ex)
            {
                TempData["Error"] = "خطا در حذف: " + ex.Message;
            }
            return RedirectToAction(nameof(ServiceLinks));
        }

        // ✅ Helper Methods
        private int GetCurrentAdminId()
        {
            // روش 1: از ClaimsPrincipal
            var userId = User.FindFirst("AdminId")?.Value;
            if (int.TryParse(userId, out int adminId))
                return adminId;

            // روش 2: اولین AdminUser
            return 1; // یا از Session/Cookie
        }

        private async Task<int> GetNextDisplayOrderAsync()
        {
            var maxOrder = await _context.ServiceLinks.MaxAsync(l => (int?)l.DisplayOrder) ?? 0;
            return maxOrder + 1;
        }


        #endregion







        [HttpGet]
        public async Task<IActionResult> Sms()
        {
            ViewBag.SmsEnabled = await GetSettingValueAsync("SmsEnabled") == "true";
            ViewBag.SmsApiKey = await GetSettingValueAsync("SmsApiKey") ?? "";
            ViewBag.SmsSenderNumber = await GetSettingValueAsync("SmsSenderNumber") ?? "";
            ViewBag.SmsUsername = await GetSettingValueAsync("SmsUsername") ?? "";        // ✅ TopTip Username
            ViewBag.SmsPassword = await GetSettingValueAsync("SmsPassword") ?? "";        // ✅ TopTip Password
            ViewBag.SmsApiUrl = await GetSettingValueAsync("SmsApiUrl") ?? "";
            ViewBag.SmsProvider = await GetSettingValueAsync("SmsProvider") ?? "TopTip";
            ViewBag.OtpLength = await GetSettingValueAsync("OtpLength") ?? "6";
            ViewBag.OtpExpiryMinutes = await GetSettingValueAsync("OtpExpiryMinutes") ?? "5";

            // ✅ تست Balance
            ViewBag.BalanceResult = await CheckTopTipBalanceAsync();

            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> Sms(bool smsEnabled, string smsApiKey, string smsSenderNumber,
            string smsUsername, string smsPassword, string smsApiUrl, string smsProvider,
            int otpLength = 6, int otpExpiryMinutes = 5)
        {
            try
            {
                await SaveSettingAsync("SmsEnabled", smsEnabled.ToString().ToLower());
                await SaveSettingAsync("SmsApiKey", smsApiKey);
                await SaveSettingAsync("SmsSenderNumber", smsSenderNumber);
                await SaveSettingAsync("SmsUsername", smsUsername);        // ✅
                await SaveSettingAsync("SmsPassword", smsPassword);        // ✅
                await SaveSettingAsync("SmsApiUrl", smsApiUrl);
                await SaveSettingAsync("SmsProvider", smsProvider);
                await SaveSettingAsync("OtpLength", otpLength.ToString());
                await SaveSettingAsync("OtpExpiryMinutes", otpExpiryMinutes.ToString());

                TempData["Success"] = "تنظیمات TopTip کامل ذخیره شد";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "خطا: " + ex.Message;
            }
            return RedirectToAction(nameof(Sms));
        }

        // ✅ Balance Checker
        // ✅ Balance Checker - اصلاح کامل
        private async Task<object> CheckTopTipBalanceAsync()
        {
            try
            {
                var username = await GetSettingValueAsync("SmsUsername");
                var password = await GetSettingValueAsync("SmsPassword");

                // 🔥 DEBUG - لاگ برای تست
                System.Diagnostics.Debug.WriteLine($"🔥 TopTip Balance: Username={username?.Substring(0, 3)}..., Password={password?.Length} chars");

                if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
                    return new { Success = false, Balance = 0M, Message = "نام کاربری/رمز خالی است" };

                using var httpClient = new HttpClient { Timeout = TimeSpan.FromSeconds(15) };
                string apiUrl = $"http://toptip.ir/webservice/rest/user_info" +
                               $"?login_username={Uri.EscapeDataString(username)}" +
                               $"&login_password={Uri.EscapeDataString(password)}";

                var response = await httpClient.GetAsync(apiUrl);
                var content = await response.Content.ReadAsStringAsync();

                // 🔥 DEBUG Response
                System.Diagnostics.Debug.WriteLine($"🔥 TopTip Response: {content.Substring(0, Math.Min(200, content.Length))}...");

                if (response.IsSuccessStatusCode)
                {
                    // ✅ چک result:false (خطا)
                    if (content.Contains("\"result\":false") || content.Contains("\"result\": false"))
                    {
                        return new { Success = false, Balance = 0M, Message = "نام کاربری/رمز اشتباه" };
                    }

                    var balance = ParseTopTipBalance(content);
                    return new
                    {
                        Success = true,
                        Balance = balance,
                        Message = balance > 0 ? "موفق" : "پاسخ نامعتبر"
                    };
                }
                else
                {
                    return new { Success = false, Balance = 0M, Message = $"HTTP {response.StatusCode}" };
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"🔥 Balance Error: {ex.Message}");
                return new { Success = false, Balance = 0M, Message = "خطای اتصال" };
            }
        }

        // ✅ Parse اصلاح‌شده
        private decimal ParseTopTipBalance(string response)
        {
            try
            {
                // 🔥 DEBUG Raw Response
                System.Diagnostics.Debug.WriteLine($"🔥 Parsing: {response.Substring(0, 300)}");

                // ✅ دقیق‌تر: "cash":"90582307"
                var cashIndex = response.IndexOf("\"cash\":");
                if (cashIndex == -1)
                {
                    System.Diagnostics.Debug.WriteLine("🔥 'cash' not found");
                    return 0;
                }

                var startIndex = response.IndexOf("\"", cashIndex + 7) + 1; // بعد از "cash":
                var endIndex = response.IndexOf("\"", startIndex);

                if (startIndex <= 0 || endIndex == -1 || endIndex <= startIndex)
                {
                    System.Diagnostics.Debug.WriteLine("🔥 Invalid cash format");
                    return 0;
                }

                var cashStr = response.Substring(startIndex, endIndex - startIndex).Trim();
                System.Diagnostics.Debug.WriteLine($"🔥 Extracted cash: '{cashStr}'");

                return decimal.TryParse(cashStr, out decimal balance) ? balance : 0;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"🔥 Parse Error: {ex.Message}");
                return 0;
            }
        }
















    }
}
 
 
==================== UsersController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
﻿using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Areas.Admin.Models;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    public class UsersController : BaseAdminController
    {
        private readonly ApplicationDbContext _context;

        public UsersController(ApplicationDbContext context)
        {
            _context = context;
        }

        // لیست کاربران با قابلیت جستجو و صفحه‌بندی
        public async Task<IActionResult> Index(string search, int page = 1, int pageSize = 20)
        {
            var query = _context.Users.AsQueryable();

            // جستجو
            if (!string.IsNullOrEmpty(search))
            {
                query = query.Where(u =>
                    u.FirstName.Contains(search) ||
                    u.LastName.Contains(search) ||
                    u.Username.Contains(search) ||
                    u.PhoneNumber.Contains(search));
            }

            var totalCount = await query.CountAsync();
            var totalPages = (int)Math.Ceiling(totalCount / (double)pageSize);

            var users = await query
                .OrderByDescending(u => u.CreatedAt)
                .Skip((page - 1) * pageSize)
                .Take(pageSize)
                .ToListAsync();

            var model = new UserListViewModel
            {
                Users = users,
                CurrentPage = page,
                TotalPages = totalPages,
                PageSize = pageSize,
                TotalCount = totalCount,
                SearchTerm = search
            };

            return View(model);
        }

       



        // ایجاد کاربر جدید - GET
        public IActionResult Create()
        {
            return View(new UserCreateViewModel());
        }

        // ایجاد کاربر جدید - POST
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Create(UserCreateViewModel model)
        {
            if (!ModelState.IsValid)
            {
                return View(model);
            }

            // بررسی تکراری نبودن نام کاربری
            if (await _context.Users.AnyAsync(u => u.Username == model.Username))
            {
                ModelState.AddModelError("Username", "این نام کاربری قبلاً استفاده شده است");
                return View(model);
            }

            // بررسی تکراری نبودن شماره موبایل
            if (await _context.Users.AnyAsync(u => u.PhoneNumber == model.PhoneNumber))
            {
                ModelState.AddModelError("PhoneNumber", "این شماره موبایل قبلاً ثبت شده است");
                return View(model);
            }

            var user = new User
            {
                Username = model.Username,
                FirstName = model.FirstName,
                LastName = model.LastName,
                PhoneNumber = model.PhoneNumber,
                Email = model.Email,
                ActiveDirectoryId = model.ActiveDirectoryId,
                ErpUserId = model.ErpUserId,
                IsActive = model.IsActive,
                CanCreateGroup = model.CanCreateGroup,
                CanCreateChannel = model.CanCreateChannel,
                CanMakeVoiceCall = model.CanMakeVoiceCall,
                CanMakeVideoCall = model.CanMakeVideoCall,
                SmsCredit = model.SmsCredit,
                CreatedAt = DateTime.Now,
                LastSeenAt = DateTime.Now
            };

            _context.Users.Add(user);
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "کاربر با موفقیت ایجاد شد";
            return RedirectToAction(nameof(Index));
        }

        // ویرایش کاربر - GET
        public async Task<IActionResult> Edit(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound();
            }

            var model = new UserEditViewModel
            {
                Id = user.Id,
                Username = user.Username,
                FirstName = user.FirstName,
                LastName = user.LastName,
                PhoneNumber = user.PhoneNumber,
                Email = user.Email,
                ActiveDirectoryId = user.ActiveDirectoryId,
                ErpUserId = user.ErpUserId,
                IsActive = user.IsActive,
                CanCreateGroup = user.CanCreateGroup,
                CanCreateChannel = user.CanCreateChannel,
                CanMakeVoiceCall = user.CanMakeVoiceCall,
                CanMakeVideoCall = user.CanMakeVideoCall,
                SmsCredit = user.SmsCredit
            };

            return View(model);
        }

        // ویرایش کاربر - POST
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Edit(UserEditViewModel model)
        {
            if (!ModelState.IsValid)
            {
                return View(model);
            }

            var user = await _context.Users.FindAsync(model.Id);
            if (user == null)
            {
                return NotFound();
            }

            // بررسی تکراری نبودن نام کاربری
            if (await _context.Users.AnyAsync(u => u.Username == model.Username && u.Id != model.Id))
            {
                ModelState.AddModelError("Username", "این نام کاربری قبلاً استفاده شده است");
                return View(model);
            }

            // بررسی تکراری نبودن شماره موبایل
            if (await _context.Users.AnyAsync(u => u.PhoneNumber == model.PhoneNumber && u.Id != model.Id))
            {
                ModelState.AddModelError("PhoneNumber", "این شماره موبایل قبلاً ثبت شده است");
                return View(model);
            }

            user.Username = model.Username;
            user.FirstName = model.FirstName;
            user.LastName = model.LastName;
            user.PhoneNumber = model.PhoneNumber;
            user.Email = model.Email;
            user.ActiveDirectoryId = model.ActiveDirectoryId;
            user.ErpUserId = model.ErpUserId;
            user.IsActive = model.IsActive;
            user.CanCreateGroup = model.CanCreateGroup;
            user.CanCreateChannel = model.CanCreateChannel;
            user.CanMakeVoiceCall = model.CanMakeVoiceCall;
            user.CanMakeVideoCall = model.CanMakeVideoCall;
            user.SmsCredit = model.SmsCredit;

            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "اطلاعات کاربر با موفقیت ویرایش شد";
            return RedirectToAction(nameof(Index));
        }

        // حذف کاربر
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Delete(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound();
            }

            try
            {
                _context.Users.Remove(user);
                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "کاربر با موفقیت حذف شد";
            }
            catch (DbUpdateException)
            {
                TempData["ErrorMessage"] = "به دلیل وجود داده‌های مرتبط، امکان حذف این کاربر وجود ندارد";
            }

            return RedirectToAction(nameof(Index));
        }

        // فعال/غیرفعال کردن کاربر
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> ToggleStatus(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound();
            }

            user.IsActive = !user.IsActive;
            await _context.SaveChangesAsync();

            return Json(new { success = true, isActive = user.IsActive });
        }
    }
}
 
 
==================== DashboardViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
﻿namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    public class DashboardViewModel
    {
        public int TotalUsers { get; set; }
        public int ActiveUsers { get; set; }
        public int TotalGroups { get; set; }
        public int TotalChannels { get; set; }
        public int TotalMessages { get; set; }
        public int TodayMessages { get; set; }
        public int TotalCalls { get; set; }
        public int TodayCalls { get; set; }
    }
}
 
 
==================== LoginViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
﻿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    public class LoginViewModel
    {
        [Required(ErrorMessage = "نام کاربری الزامی است")]
        [Display(Name = "نام کاربری")]
        public string Username { get; set; }

        [Required(ErrorMessage = "رمز عبور الزامی است")]
        [DataType(DataType.Password)]
        [Display(Name = "رمز عبور")]
        public string Password { get; set; }

        [Display(Name = "مرا به خاطر بسپار")]
        public bool RememberMe { get; set; }
    }
}
 
 
==================== SettingsViewModels.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
﻿// Path: OrganizationalMessenger.Web/Areas/Admin/Models/SettingsViewModels.cs

using System.ComponentModel.DataAnnotations;
using OrganizationalMessenger.Domain.Entities;

namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    #region ========== Index ViewModel ==========

    public class SettingsIndexViewModel
    {
        public List<SystemSetting> AllSettings { get; set; } = new();
        public Dictionary<string, int> SettingCounts { get; set; } = new();
        public DateTime? LastUpdated { get; set; }
        public string? LastUpdatedBy { get; set; }

        // آمار سریع
        public int TotalUsers { get; set; }
        public int TotalMessages { get; set; }
        public int TodayActiveUsers { get; set; }
        public string SystemVersion { get; set; } = "1.0.0";
    }

    #endregion

    #region ========== General Settings ==========

    public class GeneralSettingsViewModel
    {
        [Display(Name = "نام سازمان")]
        [Required(ErrorMessage = "نام سازمان الزامی است")]
        [StringLength(200)]
        public string CompanyName { get; set; } = string.Empty;

        [Display(Name = "آدرس لوگوی سازمان")]
        public string? CompanyLogoUrl { get; set; }

        [Display(Name = "امکان ایجاد گروه توسط همه کاربران")]
        public bool AllUsersCanCreateGroup { get; set; }

        [Display(Name = "امکان ایجاد کانال توسط همه کاربران")]
        public bool AllUsersCanCreateChannel { get; set; }

        [Display(Name = "حداکثر اعضای گروه")]
        [Range(2, 10000)]
        public int MaxGroupMembers { get; set; } = 200;

        [Display(Name = "حداکثر اعضای کانال")]
        [Range(1, 100000)]
        public int MaxChannelMembers { get; set; } = 5000;

        [Display(Name = "اعتبار پیامک پیش‌فرض برای کاربران جدید")]
        [Range(0, 1000)]
        public int DefaultSmsCredit { get; set; } = 10;
    }

    #endregion

    #region ========== Authentication Settings ==========

    public class AuthenticationSettingsViewModel
    {
        [Display(Name = "روش احراز هویت")]
        public string AuthType { get; set; } = "Database";

        // Active Directory Settings
        [Display(Name = "آدرس سرور AD")]
        public string? AdServer { get; set; }

        [Display(Name = "دامنه AD")]
        public string? AdDomain { get; set; }

        // ERP Settings
        [Display(Name = "آدرس API سیستم ERP")]
        [Url(ErrorMessage = "آدرس URL معتبر وارد کنید")]
        public string? ErpApiUrl { get; set; }

        [Display(Name = "کلید API سیستم ERP")]
        public string? ErpApiKey { get; set; }

        // SMS/OTP Settings
        [Display(Name = "آدرس سرویس‌دهنده پیامک")]
        public string? SmsProviderUrl { get; set; }

        [Display(Name = "کلید API پیامک")]
        public string? SmsApiKey { get; set; }

        [Display(Name = "شماره ارسال‌کننده پیامک")]
        public string? SmsSenderNumber { get; set; }

        [Display(Name = "مدت اعتبار کد OTP (دقیقه)")]
        [Range(1, 10)]
        public int OtpExpirationMinutes { get; set; } = 2;
    }

    #endregion

    #region ========== File Upload Settings ==========

    public class FileUploadSettingsViewModel
    {
        public List<FileUploadSettingItemViewModel> FileTypes { get; set; } = new();

        // تنظیمات کلی از SystemSettings
        [Display(Name = "حداکثر حجم تصویر (MB)")]
        public int MaxImageSizeMB { get; set; } = 10;

        [Display(Name = "حداکثر حجم ویدیو (MB)")]
        public int MaxVideoSizeMB { get; set; } = 100;

        [Display(Name = "حداکثر حجم فایل (MB)")]
        public int MaxFileSizeMB { get; set; } = 50;
    }

    public class FileUploadSettingItemViewModel
    {
        public int Id { get; set; }

        [Display(Name = "نوع فایل")]
        public string FileType { get; set; } = string.Empty;

        [Display(Name = "دسته‌بندی")]
        public string Category { get; set; } = string.Empty;

        [Display(Name = "حداکثر حجم (بایت)")]
        public long MaxSize { get; set; }

        [Display(Name = "مجاز")]
        public bool IsAllowed { get; set; }

        // محاسبه‌شده
        public double MaxSizeMB => Math.Round(MaxSize / (1024.0 * 1024.0), 2);

        public string CategoryIcon => Category?.ToLower() switch
        {
            "image" => "fa-image text-success",
            "video" => "fa-video text-primary",
            "audio" => "fa-music text-warning",
            "document" => "fa-file-alt text-info",
            _ => "fa-file text-secondary"
        };
    }

    #endregion

    #region ========== Message Settings ==========

    public class MessageSettingsViewModel
    {
        [Display(Name = "امکان ویرایش پیام")]
        public bool MessageEditEnabled { get; set; } = true;

        [Display(Name = "امکان حذف پیام")]
        public bool MessageDeleteEnabled { get; set; } = true;

        [Display(Name = "مهلت ویرایش پیام (دقیقه)")]
        [Range(0, 1440)]
        public int MessageEditTimeLimit { get; set; } = 15;

        [Display(Name = "مهلت حذف پیام (دقیقه)")]
        [Range(0, 1440)]
        public int MessageDeleteTimeLimit { get; set; } = 60;

        [Display(Name = "حذف پیام بعد از خواندن توسط گیرنده")]
        public bool MessageDeleteAfterRead { get; set; } = false;

        [Display(Name = "ادمین می‌تواند پیام‌ها را حذف کند")]
        public bool AdminCanDeleteMessages { get; set; } = true;

        [Display(Name = "رمزنگاری پیام‌ها")]
        public bool EncryptionEnabled { get; set; } = false;
    }

    #endregion

    #region ========== VoIP Settings ==========

    public class VoIPSettingsViewModel
    {
        [Display(Name = "فعال بودن تماس صوتی/تصویری")]
        public bool VoipEnabled { get; set; }

        [Display(Name = "آدرس سرور VoIP")]
        [Url(ErrorMessage = "آدرس URL معتبر وارد کنید")]
        public string? VoipServerUrl { get; set; }

        [Display(Name = "نام کاربری")]
        public string? VoipUsername { get; set; }

        [Display(Name = "رمز عبور")]
        public string? VoipPassword { get; set; }

        [Display(Name = "پروتکل")]
        public string VoipProtocol { get; set; } = "WebRTC";
    }

    #endregion

    #region ========== Telegram Settings ==========

    public class TelegramSettingsViewModel
    {
        [Display(Name = "فعال بودن ربات تلگرام")]
        public bool TelegramEnabled { get; set; }

        [Display(Name = "توکن ربات تلگرام")]
        public string? TelegramBotToken { get; set; }

        // اطلاعات نمایشی (فقط خواندنی)
        public string? BotUsername { get; set; }
        public bool IsConnected { get; set; }
    }

    #endregion

    #region ========== SMS Settings ==========

    public class SmsSettingsViewModel
    {
        [Display(Name = "آدرس سرویس‌دهنده")]
        [Url(ErrorMessage = "آدرس URL معتبر وارد کنید")]
        public string? SmsProviderUrl { get; set; }

        [Display(Name = "کلید API")]
        public string? SmsApiKey { get; set; }

        [Display(Name = "شماره ارسال‌کننده")]
        public string? SmsSenderNumber { get; set; }

        [Display(Name = "مدت اعتبار OTP (دقیقه)")]
        [Range(1, 10)]
        public int OtpExpirationMinutes { get; set; } = 2;

        // آمار
        public int TodaySentCount { get; set; }
        public decimal? CurrentBalance { get; set; }
    }

    #endregion

    #region ========== Service Links Settings ==========

    public class ServiceLinksViewModel
    {
        public List<ServiceLink> Links { get; set; } = new();
    }

    public class ServiceLinkFormViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "عنوان الزامی است")]
        [StringLength(100)]
        [Display(Name = "عنوان")]
        public string Title { get; set; } = string.Empty;

        [Required(ErrorMessage = "آدرس الزامی است")]
        [Url(ErrorMessage = "آدرس URL معتبر وارد کنید")]
        [Display(Name = "آدرس لینک")]
        public string Url { get; set; } = string.Empty;

        [Display(Name = "آیکون")]
        public string? IconUrl { get; set; }

        [Display(Name = "ترتیب نمایش")]
        public int DisplayOrder { get; set; }

        [Display(Name = "فعال")]
        public bool IsActive { get; set; } = true;
    }

    #endregion

    #region ========== Forbidden Words Settings ==========

    public class ForbiddenWordsViewModel
    {
        public List<ForbiddenWord> Words { get; set; } = new();
        public int TotalCount { get; set; }
        public int ActiveCount { get; set; }

        // فرم افزودن
        [Required(ErrorMessage = "کلمه الزامی است")]
        [StringLength(100)]
        public string NewWord { get; set; } = string.Empty;
    }

    #endregion

    #region ========== System Info ==========

    public class SystemInfoViewModel
    {
        public string DotNetVersion { get; set; } = string.Empty;
        public string OSDescription { get; set; } = string.Empty;
        public long MemoryUsageMB { get; set; }
        public long TotalMemoryMB { get; set; }
        public int ProcessorCount { get; set; }
        public TimeSpan Uptime { get; set; }
        public string MachineName { get; set; } = string.Empty;

        // آمار اپلیکیشن
        public int TotalUsers { get; set; }
        public int OnlineUsers { get; set; }
        public int TotalMessages { get; set; }
        public int TodayMessages { get; set; }
        public long DatabaseSizeMB { get; set; }
        public long FileStorageSizeMB { get; set; }
    }

    #endregion
}
 
 
==================== UserViewModels.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
﻿using OrganizationalMessenger.Domain.Entities;
using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    // لیست کاربران
    public class UserListViewModel
    {
        public List<User> Users { get; set; }
        public int CurrentPage { get; set; }
        public int TotalPages { get; set; }
        public int PageSize { get; set; }
        public int TotalCount { get; set; }
        public string SearchTerm { get; set; }
    }

    // ایجاد کاربر
    public class UserCreateViewModel
    {
        [Required(ErrorMessage = "نام کاربری الزامی است")]
        [Display(Name = "نام کاربری")]
        public string Username { get; set; }

        [Required(ErrorMessage = "نام الزامی است")]
        [Display(Name = "نام")]
        public string FirstName { get; set; }

        [Required(ErrorMessage = "نام خانوادگی الزامی است")]
        [Display(Name = "نام خانوادگی")]
        public string LastName { get; set; }

        [Required(ErrorMessage = "شماره موبایل الزامی است")]
        [Phone(ErrorMessage = "فرمت شماره موبایل صحیح نیست")]
        [Display(Name = "شماره موبایل")]
        public string PhoneNumber { get; set; }

        [EmailAddress(ErrorMessage = "فرمت ایمیل صحیح نیست")]
        [Display(Name = "ایمیل")]
        public string Email { get; set; }

        [Display(Name = "شناسه Active Directory")]
        public string ActiveDirectoryId { get; set; }

        [Display(Name = "شناسه ERP")]
        public string ErpUserId { get; set; }

        [Display(Name = "وضعیت فعال")]
        public bool IsActive { get; set; } = true;

        [Display(Name = "مجوز ایجاد گروه")]
        public bool CanCreateGroup { get; set; } = true;

        [Display(Name = "مجوز ایجاد کانال")]
        public bool CanCreateChannel { get; set; } = true;

        [Display(Name = "مجوز تماس صوتی")]
        public bool CanMakeVoiceCall { get; set; } = true;

        [Display(Name = "مجوز تماس تصویری")]
        public bool CanMakeVideoCall { get; set; } = true;

        [Range(0, int.MaxValue, ErrorMessage = "اعتبار پیامک باید عدد مثبت باشد")]
        [Display(Name = "اعتبار پیامک")]
        public int SmsCredit { get; set; } = 10;
    }

    // ویرایش کاربر
    public class UserEditViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "نام کاربری الزامی است")]
        [Display(Name = "نام کاربری")]
        public string Username { get; set; }

        [Required(ErrorMessage = "نام الزامی است")]
        [Display(Name = "نام")]
        public string FirstName { get; set; }

        [Required(ErrorMessage = "نام خانوادگی الزامی است")]
        [Display(Name = "نام خانوادگی")]
        public string LastName { get; set; }

        [Required(ErrorMessage = "شماره موبایل الزامی است")]
        [Phone(ErrorMessage = "فرمت شماره موبایل صحیح نیست")]
        [Display(Name = "شماره موبایل")]
        public string PhoneNumber { get; set; }

        [EmailAddress(ErrorMessage = "فرمت ایمیل صحیح نیست")]
        [Display(Name = "ایمیل")]
        public string Email { get; set; }

        [Display(Name = "شناسه Active Directory")]
        public string ActiveDirectoryId { get; set; }

        [Display(Name = "شناسه ERP")]
        public string ErpUserId { get; set; }

        [Display(Name = "وضعیت فعال")]
        public bool IsActive { get; set; }

        [Display(Name = "مجوز ایجاد گروه")]
        public bool CanCreateGroup { get; set; }

        [Display(Name = "مجوز ایجاد کانال")]
        public bool CanCreateChannel { get; set; }

        [Display(Name = "مجوز تماس صوتی")]
        public bool CanMakeVoiceCall { get; set; }

        [Display(Name = "مجوز تماس تصویری")]
        public bool CanMakeVideoCall { get; set; }

        [Range(0, int.MaxValue, ErrorMessage = "اعتبار پیامک باید عدد مثبت باشد")]
        [Display(Name = "اعتبار پیامک")]
        public int SmsCredit { get; set; }
    }
}
 
 
==================== AccountController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
﻿using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Infrastructure.Data;
using System.Security.Claims;

[AllowAnonymous]
public class AccountController : Controller
{
    private readonly ApplicationDbContext _context;
    private readonly IAuthenticationManager _authManager;

    public AccountController(ApplicationDbContext context, IAuthenticationManager authManager)
    {
        _context = context;
        _authManager = authManager;
    }

    public IActionResult Login()
    {
        return View();
    }

    [HttpPost]
    public async Task<IActionResult> Login(string username, string password)
    {
        // تست کاربران ساده
        var user = _context.Users.FirstOrDefault(u => u.Username == username &&
            u.PasswordHash == "AQAAAAEAACcQAAAAEG3LzixU/DMivW0V8ALZr0eH5x4oJvVDIfQiGaPYTB141YiQCDY5ale+wjF3R0C8Q==");

        if (user != null && user.IsActive)
        {
            // ✅ Cookie Login
            var claims = new List<Claim>
            {
                new Claim(ClaimTypes.Name, user.Username),
                new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
                new Claim("FullName", user.FirstName + " " + user.LastName),
                new Claim("PhoneNumber", user.PhoneNumber ?? "")
            };

            var claimsIdentity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
            var authProperties = new AuthenticationProperties
            {
                IsPersistent = true,
                ExpiresUtc = DateTimeOffset.UtcNow.AddDays(14)
            };

            await HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme,
                new ClaimsPrincipal(claimsIdentity), authProperties);

            return RedirectToAction("Index", "Chat");
        }

        ViewBag.Error = "نام کاربری یا رمز اشتباه";
        return View();
    }

    public async Task<IActionResult> Logout()
    {
        await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
        return RedirectToAction("Login");
    }
}
 
 
==================== ChatController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
﻿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Infrastructure.Data;
using System.Security.Claims;

[Authorize]
public class ChatController : Controller
{
    private readonly ApplicationDbContext _context;

    public ChatController(ApplicationDbContext context)
    {
        _context = context;
    }

    private int GetCurrentUserId()
    {
        var userIdClaim = User.FindFirst("UserId")?.Value ??
                         User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        return int.TryParse(userIdClaim, out int userId) ? userId : 0;
    }

    public async Task<IActionResult> Index()
    {
        var currentUserId = GetCurrentUserId();
        ViewBag.CurrentUserId = currentUserId;
        return View();
    }

    [HttpGet]
    public async Task<IActionResult> GetCurrentUser()
    {
        var userId = GetCurrentUserId();
        var user = await _context.Users
            .Where(u => u.Id == userId)
            .Select(u => new {
                userId = u.Id,
                fullName = u.FirstName + " " + u.LastName,
                username = u.Username,
                profileImage = u.AvatarUrl
            })
            .FirstOrDefaultAsync();
        return Json(user);
    }

    [HttpGet]
    [Route("api/[controller]/users")] // ✅ Route دقیق
    public async Task<IActionResult> GetUsers()
    {
        try
        {
            var currentUserId = GetCurrentUserId();
            Console.WriteLine($"🔍 GetUsers called for user: {currentUserId}");

            var users = await _context.Users
                .AsNoTracking() // ✅ Performance
                .Where(u => u.Id != currentUserId && u.IsActive == true)
                .OrderByDescending(u => u.IsOnline)
                .ThenBy(u => u.FirstName)
                .Take(50) // ✅ Limit
                .Select(u => new
                {
                    userId = u.Id,
                    fullName = $"{u.FirstName} {u.LastName}".Trim(),
                    username = u.Username ?? "",
                    isOnline = u.IsOnline,
                    profileImage = u.AvatarUrl ?? ""
                })
                .ToListAsync();

            Console.WriteLine($"✅ GetUsers SUCCESS: {users.Count} users");
            return Json(users);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"❌ GetUsers ERROR: {ex.Message}");
            return Json(new List<object>()); // ✅ Empty list instead of error
        }
    }


    [HttpGet]
    public async Task<IActionResult> GetMessages(int receiverId, int? lastMessageId = null)
    {
        var currentUserId = GetCurrentUserId();

        var query = _context.Messages
            .Where(m => !m.IsDeleted &&
                       ((m.SenderId == currentUserId && m.ReceiverId == receiverId) ||
                        (m.SenderId == receiverId && m.ReceiverId == currentUserId)));

        if (lastMessageId.HasValue)
            query = query.Where(m => m.Id < lastMessageId.Value);

        var messages = await query
            .OrderBy(m => m.SentAt)
            .Take(50)
            .Select(m => new
            {
                messageId = m.Id,
                senderId = m.SenderId,
                senderName = m.Sender.FirstName + " " + m.Sender.LastName,
                content = m.MessageText ?? m.Content,
                sentAt = m.SentAt,
                isDelivered = m.IsDelivered,
                isRead = m.IsRead
            })
            .ToListAsync();

        return Json(messages);
    }

    [HttpPost]
    public async Task<IActionResult> MarkAllAsRead(int receiverId)
    {
        var currentUserId = GetCurrentUserId();
        var messages = await _context.Messages
            .Where(m => !m.IsDeleted && m.SenderId == receiverId &&
                       m.ReceiverId == currentUserId && !m.IsRead)
            .ToListAsync();

        foreach (var msg in messages)
            msg.IsRead = true;

        await _context.SaveChangesAsync();
        return Json(new { count = messages.Count });
    }
}
 
 
==================== ChatHub.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Hubs\ 
 
﻿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.SignalR;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Domain.Entities;
using System.Collections.Concurrent;
using System.IdentityModel.Tokens.Jwt;
using System.Security.Claims;

[Authorize]
public class ChatHub : Hub
{
    private readonly ApplicationDbContext _context;
    private static readonly ConcurrentDictionary<int, List<string>> _userConnections = new();

    public ChatHub(ApplicationDbContext context)
    {
        _context = context;
    }

    private int GetUserId()
    {
        var userIdClaim = Context.User?.FindFirst("UserId")?.Value ??
                         Context.User?.FindFirst(ClaimTypes.NameIdentifier)?.Value ??
                         Context.User?.FindFirst(JwtRegisteredClaimNames.Sub)?.Value;
        return int.TryParse(userIdClaim, out int userId) ? userId : 0;
    }

    // 🔥 SendMessage - Private Chat (SenderId + ReceiverId)
    public async Task SendMessage(int receiverId, string content)
    {
        try
        {
            var senderId = GetUserId();
            if (senderId == 0 || senderId == receiverId)
            {
                await Clients.Caller.SendAsync("Error", "خطا در ارسال");
                return;
            }

            Console.WriteLine($"📨 [{senderId}→{receiverId}] {content.Substring(0, Math.Min(30, content.Length))}");

            // ✅ Message جدید (سازگار با Entity شما)
            var message = new Message
            {
                SenderId = senderId,
                ReceiverId = receiverId,
                MessageText = content.Trim(),
                Content = content.Trim(), // هر دو فیلد
                SentAt = DateTime.Now,
                IsDelivered = false,
                IsRead = false,
                IsDeleted = false
            };

            _context.Messages.Add(message);
            await _context.SaveChangesAsync();

            var sender = await _context.Users.FindAsync(senderId);
            var receiverOnline = _userConnections.ContainsKey(receiverId);

            // ✅ Auto-Delivered اگر گیرنده آنلاین
            if (receiverOnline)
            {
                message.IsDelivered = true;
                message.DeliveredAt = DateTime.Now;
                await _context.SaveChangesAsync();
            }

            var messageDto = new
            {
                messageId = message.Id,
                chatId = receiverId, // chatId = receiverId برای Private
                senderId = message.SenderId,
                senderName = sender?.FirstName + " " + sender?.LastName,
                content = message.MessageText,
                sentAt = message.SentAt.ToString("yyyy-MM-ddTHH:mm:ss"),
                status = receiverOnline ? 2 : 1, // 1=Sent, 2=Delivered
                isOwn = true,
                isDelivered = receiverOnline
            };

            // 📤 ارسال به فرستنده
            await Clients.Caller.SendAsync("ReceiveMessage", messageDto);

            // 📤 ارسال به گیرنده (اگر آنلاین)
            if (receiverOnline)
            {
                await Clients.User(receiverId.ToString()).SendAsync("ReceiveMessage", messageDto);
            }

            Console.WriteLine($"✅ Message {message.Id} sent (status: {messageDto.status})");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"❌ SendMessage: {ex.Message}");
            await Clients.Caller.SendAsync("Error", "خطا در ارسال");
        }
    }

    // ✅ Typing
    public async Task Typing(int receiverId, bool isTyping)
    {
        await Clients.User(receiverId.ToString()).SendAsync("UserTyping", receiverId, GetUserId(), isTyping);
    }

    // ✅ Join Chat (Private = receiverId)
    public async Task JoinChat(int receiverId)
    {
        var groupName = $"chat_{receiverId}";
        await Groups.AddToGroupAsync(Context.ConnectionId, groupName);

        // Mark previous messages as delivered
        await MarkPendingMessagesAsDelivered(GetUserId(), receiverId);

        Console.WriteLine($"👥 Joined private chat with {receiverId}");
    }

    // ✅ Online/Offline - کامل
    public override async Task OnConnectedAsync()
    {
        var userId = GetUserId();
        if (userId == 0) return;

        // Connection tracking
        if (!_userConnections.TryGetValue(userId, out var connections))
        {
            connections = new();
            _userConnections[userId] = connections;
        }
        connections.Add(Context.ConnectionId);

        // Update DB
        var user = await _context.Users.FindAsync(userId);
        if (user != null)
        {
            user.IsOnline = true;
            user.LastSeen = DateTime.Now;
            await _context.SaveChangesAsync();
            await Clients.Others.SendAsync("UserOnline", userId);
        }

        Console.WriteLine($"✅ User {userId} ONLINE");
        await base.OnConnectedAsync();
    }

    public override async Task OnDisconnectedAsync(Exception? exception)
    {
        var userId = GetUserId();
        if (userId == 0 || !_userConnections.TryGetValue(userId, out var connections))
            return;

        connections.Remove(Context.ConnectionId);
        if (connections.Count == 0)
        {
            _userConnections.TryRemove(userId, out _);

            var user = await _context.Users.FindAsync(userId);
            if (user != null)
            {
                user.IsOnline = false;
                user.LastSeen = DateTime.Now;
                await _context.SaveChangesAsync();
                await Clients.Others.SendAsync("UserOffline", userId);
            }
            Console.WriteLine($"❌ User {userId} OFFLINE");
        }

        await base.OnDisconnectedAsync(exception);
    }

    // ✅ Mark Pending Messages as Delivered
    private async Task MarkPendingMessagesAsDelivered(int receiverId, int senderId)
    {
        var pending = await _context.Messages
            .Where(m => m.SenderId == senderId && m.ReceiverId == receiverId &&
                       !m.IsDelivered && !m.IsDeleted)
            .ToListAsync();

        foreach (var msg in pending)
        {
            msg.IsDelivered = true;
            msg.DeliveredAt = DateTime.Now;
        }

        if (pending.Any()) await _context.SaveChangesAsync();
    }
}
 
 
==================== ErrorViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ 
 
namespace OrganizationalMessenger.Web.Models;

public class ErrorViewModel
{
    public string? RequestId { get; set; }

    public bool ShowRequestId => !string.IsNullOrEmpty(RequestId);
}
 
 
==================== ChannelViewModels.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
﻿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Models.ViewModels
{
    // ==================== لیست کانال‌ها ====================
    public class ChannelListViewModel
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string CreatorName { get; set; } = string.Empty;
        public int SubscriberCount { get; set; }
        public bool IsActive { get; set; }
        public bool IsPublic { get; set; }
        public DateTime CreatedAt { get; set; }
    }

    // ==================== ایجاد کانال ====================
    public class ChannelCreateViewModel
    {
        [Required(ErrorMessage = "نام کانال الزامی است")]
        [StringLength(100, ErrorMessage = "نام کانال نمی‌تواند بیشتر از 100 کاراکتر باشد")]
        [Display(Name = "نام کانال")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "توضیحات نمی‌تواند بیشتر از 500 کاراکتر باشد")]
        [Display(Name = "توضیحات")]
        public string? Description { get; set; }

        [Required(ErrorMessage = "انتخاب سازنده الزامی است")]
        [Display(Name = "سازنده")]
        public int CreatorId { get; set; }

        [Display(Name = "کانال عمومی")]
        public bool IsPublic { get; set; }

        [Display(Name = "فعال")]
        public bool IsActive { get; set; } = true;
    }

    // ==================== ویرایش کانال ====================
    public class ChannelEditViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "نام کانال الزامی است")]
        [StringLength(100, ErrorMessage = "نام کانال نمی‌تواند بیشتر از 100 کاراکتر باشد")]
        [Display(Name = "نام کانال")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "توضیحات نمی‌تواند بیشتر از 500 کاراکتر باشد")]
        [Display(Name = "توضیحات")]
        public string? Description { get; set; }

        [Display(Name = "کانال عمومی")]
        public bool IsPublic { get; set; }

        [Display(Name = "فعال")]
        public bool IsActive { get; set; }

        // فقط برای نمایش (ReadOnly)
        public int CreatorId { get; set; }
        public DateTime CreatedAt { get; set; }
    }

    // ==================== جزئیات کانال ====================
    public class ChannelDetailsViewModel
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string CreatorName { get; set; } = string.Empty;
        public int CreatorId { get; set; }
        public int SubscriberCount { get; set; }
        public int AdminCount { get; set; }
        public int PublisherCount { get; set; }
        public int MessageCount { get; set; }
        public bool IsActive { get; set; }
        public bool IsPublic { get; set; }
        public DateTime CreatedAt { get; set; }

        // لیست اعضای کانال
        public List<ChannelSubscriberViewModel> Subscribers { get; set; } = new();
    }

    // ==================== اعضای کانال ====================
    public class ChannelSubscriberViewModel
    {
        public int UserId { get; set; }
        public string FullName { get; set; } = string.Empty;
        public string Username { get; set; } = string.Empty;
        public string? PhoneNumber { get; set; }
        public string? AvatarUrl { get; set; }
        public bool IsAdmin { get; set; }
        public bool CanPost { get; set; }
        public string RoleName { get; set; } = string.Empty;
        public DateTime JoinedAt { get; set; }
        public bool IsOwner { get; set; }
    }

    // ==================== افزودن عضو به کانال ====================
    public class AddChannelSubscriberViewModel
    {
        [Required(ErrorMessage = "انتخاب کانال الزامی است")]
        public int ChannelId { get; set; }

        [Required(ErrorMessage = "انتخاب کاربر الزامی است")]
        [Display(Name = "کاربر")]
        public int UserId { get; set; }

        [Display(Name = "دسترسی ارسال پست")]
        public bool CanPost { get; set; }

        [Display(Name = "دسترسی مدیریت")]
        public bool IsAdmin { get; set; }
    }

    // ==================== مدیریت اعضای کانال ====================
    public class ChannelSubscribersPageViewModel
    {
        public int ChannelId { get; set; }
        public string ChannelName { get; set; } = string.Empty;
        public bool IsPublic { get; set; }
        public List<ChannelSubscriberViewModel> Subscribers { get; set; } = new();
        public List<AvailableUserViewModel> AvailableUsers { get; set; } = new();
    }

    // ==================== کاربران قابل افزودن ====================
    public class AvailableUserViewModel
    {
        public int Id { get; set; }
        public string FullName { get; set; } = string.Empty;
        public string Username { get; set; } = string.Empty;
        public string? PhoneNumber { get; set; }
    }

    // ==================== پیام‌های کانال ====================
    public class ChannelMessageListViewModel
    {
        public int ChannelId { get; set; }
        public string ChannelName { get; set; } = string.Empty;
        public List<ChannelMessageViewModel> Messages { get; set; } = new();
        public int TotalMessages { get; set; }
        public int CurrentPage { get; set; }
        public int TotalPages { get; set; }
    }

    public class ChannelMessageViewModel
    {
        public long Id { get; set; }
        public string Content { get; set; } = string.Empty;
        public string SenderName { get; set; } = string.Empty;
        public DateTime SentAt { get; set; }
        public bool HasAttachment { get; set; }
        public int ViewCount { get; set; }
        public bool IsEdited { get; set; }
        public bool IsPinned { get; set; }
    }

    // ==================== آمار کانال ====================
    public class ChannelStatisticsViewModel
    {
        public int ChannelId { get; set; }
        public string ChannelName { get; set; } = string.Empty;
        public int TotalSubscribers { get; set; }
        public int ActiveSubscribers { get; set; }
        public int TotalMessages { get; set; }
        public int TodayMessages { get; set; }
        public int WeekMessages { get; set; }
        public int MonthMessages { get; set; }
        public int TotalViews { get; set; }
        public double AverageViewsPerMessage { get; set; }
        public DateTime? LastMessageAt { get; set; }
        public List<DailyStatViewModel> DailyStats { get; set; } = new();
    }

    public class DailyStatViewModel
    {
        public DateTime Date { get; set; }
        public int MessageCount { get; set; }
        public int NewSubscribers { get; set; }
    }
}
 
 
==================== GroupCreateViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
﻿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel برای ایجاد گروه جدید
    /// </summary>
    public class GroupCreateViewModel
    {
        [Required(ErrorMessage = "نام گروه الزامی است.")]
        [StringLength(100, MinimumLength = 2, ErrorMessage = "نام گروه باید بین 2 تا 100 کاراکتر باشد.")]
        [Display(Name = "نام گروه")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "توضیحات نمی‌تواند بیش از 500 کاراکتر باشد.")]
        [Display(Name = "توضیحات")]
        public string? Description { get; set; }

        [Required(ErrorMessage = "سازنده گروه باید مشخص شود.")]
        [Display(Name = "سازنده")]
        public int CreatorId { get; set; }

        [Range(2, 10000, ErrorMessage = "حداکثر تعداد اعضا باید بین 2 تا 10000 باشد.")]
        [Display(Name = "حداکثر تعداد اعضا")]
        public int MaxMembers { get; set; } = 100;

        [Display(Name = "عمومی")]
        public bool IsPublic { get; set; } = false;

        [Display(Name = "فعال")]
        public bool IsActive { get; set; } = true;
    }
}
 
 
==================== GroupEditViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
﻿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel برای ویرایش گروه
    /// </summary>
    public class GroupEditViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "نام گروه الزامی است.")]
        [StringLength(100, MinimumLength = 2, ErrorMessage = "نام گروه باید بین 2 تا 100 کاراکتر باشد.")]
        [Display(Name = "نام گروه")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "توضیحات نمی‌تواند بیش از 500 کاراکتر باشد.")]
        [Display(Name = "توضیحات")]
        public string? Description { get; set; }

        [Range(2, 10000, ErrorMessage = "حداکثر تعداد اعضا باید بین 2 تا 10000 باشد.")]
        [Display(Name = "حداکثر تعداد اعضا")]
        public int MaxMembers { get; set; }

        [Display(Name = "عمومی")]
        public bool IsPublic { get; set; }

        [Display(Name = "فعال")]
        public bool IsActive { get; set; }

        public int CreatorId { get; set; }

        public string? CreatorName { get; set; }

        public DateTime CreatedAt { get; set; }

        public int CurrentMemberCount { get; set; }
    }
}
 
 
==================== GroupListViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
﻿namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel برای نمایش لیست گروه‌ها در پنل ادمین
    /// </summary>
    public class GroupListViewModel
    {
        public int Id { get; set; }

        public string Name { get; set; } = string.Empty;

        public string? Description { get; set; }

        public string? ProfilePicture { get; set; }

        public int CreatorId { get; set; }

        public string CreatorName { get; set; } = string.Empty;

        public string? CreatorUsername { get; set; }

        public int MemberCount { get; set; }

        public int AdminCount { get; set; }

        public int MessageCount { get; set; }

        public int MaxMembers { get; set; }

        public bool IsActive { get; set; }

        public bool IsPublic { get; set; }

        public bool IsDeleted { get; set; }

        public DateTime CreatedAt { get; set; }

        public DateTime? DeletedAt { get; set; }

        public DateTime? LastActivityAt { get; set; }
    }
}
 
 
==================== MessageListViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
﻿namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel برای نمایش لیست پیام‌ها در پنل ادمین
    /// </summary>
    public class MessageListViewModel
    {
        public int Id { get; set; }

        public int SenderId { get; set; }

        public string SenderName { get; set; } = string.Empty;

        public string? SenderUsername { get; set; }

        public string? SenderAvatar { get; set; }

        public string MessageText { get; set; } = string.Empty;

        public DateTime SentAt { get; set; }

        public bool IsEdited { get; set; }

        public DateTime? EditedAt { get; set; }

        public bool IsDeleted { get; set; }

        public string Type { get; set; } = "Text";

        public string? AttachmentUrl { get; set; }

        public string? AttachmentName { get; set; }

        public long? AttachmentSize { get; set; }

        public int ReplyCount { get; set; }

        public int ReactionCount { get; set; }

        public bool IsRead { get; set; }

        public bool IsDelivered { get; set; }
    }
}
 
 
==================== .NETCoreApp,Version=v8.0.AssemblyAttributes.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
 
 
==================== OrganizationalMessenger.Web.AssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("OrganizationalMessenger.Web")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0")]
[assembly: System.Reflection.AssemblyProductAttribute("OrganizationalMessenger.Web")]
[assembly: System.Reflection.AssemblyTitleAttribute("OrganizationalMessenger.Web")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== OrganizationalMessenger.Web.GlobalUsings.g.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
// <auto-generated/>
global using global::Microsoft.AspNetCore.Builder;
global using global::Microsoft.AspNetCore.Hosting;
global using global::Microsoft.AspNetCore.Http;
global using global::Microsoft.AspNetCore.Routing;
global using global::Microsoft.Extensions.Configuration;
global using global::Microsoft.Extensions.DependencyInjection;
global using global::Microsoft.Extensions.Hosting;
global using global::Microsoft.Extensions.Logging;
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Net.Http.Json;
global using global::System.Threading;
global using global::System.Threading.Tasks;
 
 
==================== OrganizationalMessenger.Web.RazorAssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: Microsoft.AspNetCore.Mvc.ApplicationParts.ProvideApplicationPartFactoryAttribute("Microsoft.AspNetCore.Mvc.ApplicationParts.ConsolidatedAssemblyApplicationPartFact" +
    "ory, Microsoft.AspNetCore.Mvc.Razor")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== _ViewImports.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\ 
 
﻿@using OrganizationalMessenger.Web
@using OrganizationalMessenger.Web.Areas.Admin.Models
@using OrganizationalMessenger.Domain.Entities
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
 
 
==================== _ViewStart.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\ 
 
﻿@{
    Layout = "_Layout";
}
 
 
==================== Login.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Account\ 
 
﻿@model OrganizationalMessenger.Web.Areas.Admin.Models.LoginViewModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ورود - پنل مدیریت</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.rtl.min.css" />
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
            max-width: 400px;
            width: 100%;
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h2 {
            color: #667eea;
            font-weight: bold;
        }
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h2>پنل مدیریت</h2>
            <p class="text-muted">پیام‌رسان سازمانی</p>
        </div>

        <form method="post" asp-action="Login">
            @Html.AntiForgeryToken()

            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

            <div class="mb-3">
                <label asp-for="Username" class="form-label">نام کاربری</label>
                <input asp-for="Username" class="form-control" autocomplete="username" />
                <span asp-validation-for="Username" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Password" class="form-label">رمز عبور</label>
                <input asp-for="Password" class="form-control" autocomplete="current-password" />
                <span asp-validation-for="Password" class="text-danger"></span>
            </div>

            <div class="mb-3 form-check">
                <input asp-for="RememberMe" class="form-check-input" />
                <label asp-for="RememberMe" class="form-check-label">مرا به خاطر بسپار</label>
            </div>

            <button type="submit" class="btn btn-login w-100">ورود</button>
        </form>

        <div class="text-center mt-3">
            <small class="text-muted">نام کاربری پیش‌فرض: admin | رمز عبور: Admin@123</small>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
</body>
</html>
 
 
==================== Create.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
﻿@model OrganizationalMessenger.Web.Models.ViewModels.ChannelCreateViewModel

@{
    ViewData["Title"] = "ایجاد کانال";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>ایجاد کانال جدید</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">بازگشت به لیست</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()

    <div class="form-group">
        <label asp-for="Name">نام کانال *</label>
        <input asp-for="Name" class="form-control" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Description">توضیحات</label>
        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="CreatorId">سازنده *</label>
        <select asp-for="CreatorId" class="form-control" required>
            <option value="">-- انتخاب کنید --</option>
            @if (ViewBag.Users != null)
            {
                @foreach (var user in ViewBag.Users)
                {
                    <option value="@user.Id">@user.FullName (@user.Username)</option>
                }
            }
        </select>
        <span asp-validation-for="CreatorId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label class="checkbox-label">
            <input asp-for="IsPublic" type="checkbox" />
            کانال عمومی
        </label>
    </div>

    <div class="form-group">
        <label class="checkbox-label">
            <input asp-for="IsActive" type="checkbox" />
            فعال
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">ایجاد کانال</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">انصراف</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
 
 
==================== Details.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
﻿@model OrganizationalMessenger.Domain.Entities.Channel

@{
    ViewData["Title"] = "جزئیات کانال";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    string ToPersianDate(DateTime? date)
    {
        if (date == null) return "---";
        var persianCalendar = new System.Globalization.PersianCalendar();
        return $"{persianCalendar.GetYear(date.Value)}/{persianCalendar.GetMonth(date.Value):00}/{persianCalendar.GetDayOfMonth(date.Value):00}";
    }
}

<div class="page-header">
    <h2>جزئیات کانال</h2>
    <div class="actions">
        <a href="@Url.Action("Edit", new { id = Model.Id })" class="btn btn-primary">ویرایش</a>
        <a href="@Url.Action("Index")" class="btn btn-secondary">بازگشت به لیست</a>
    </div>
</div>

<div class="details-container">
    <div class="detail-card">
        <h3>اطلاعات پایه</h3>
        <div class="detail-row">
            <span class="label">نام کانال:</span>
            <span class="value">@Model.Name</span>
        </div>
        <div class="detail-row">
            <span class="label">توضیحات:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.Description) ? "---" : Model.Description)</span>
        </div>
        <div class="detail-row">
            <span class="label">سازنده:</span>
            <span class="value">@Model.Creator.FirstName @Model.Creator.LastName (@Model.Creator.Username)</span>
        </div>
        <div class="detail-row">
            <span class="label">وضعیت:</span>
            <span class="badge @(Model.IsActive ? "badge-active" : "badge-inactive")">
                @(Model.IsActive ? "فعال" : "غیرفعال")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">نوع:</span>
            <span class="badge @(Model.IsPublic ? "badge-active" : "badge-inactive")">
                @(Model.IsPublic ? "عمومی" : "خصوصی")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">تاریخ ایجاد:</span>
            <span class="value">@ToPersianDate(Model.CreatedAt)</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>آمار</h3>
        <div class="detail-row">
            <span class="label">تعداد اعضا:</span>
            <span class="value">@ViewBag.MemberCount</span>
        </div>
        <div class="detail-row">
            <span class="label">تعداد پیام‌ها:</span>
            <span class="value">@ViewBag.MessageCount</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>اعضای کانال (@Model.UserChannels.Count)</h3>
        @if (Model.UserChannels.Any())
        {
            <ul class="list-items">
                @foreach (var uc in Model.UserChannels.OrderByDescending(x => x.IsAdmin))
                {
                    <li>
                        @uc.User.FirstName @uc.User.LastName (@uc.User.Username)
                        @if (uc.IsAdmin)
                        {
                            <span class="badge badge-admin">مدیر</span>
                        }
                        <span class="date">عضویت: @ToPersianDate(uc.JoinedAt)</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="no-data">عضوی وجود ندارد</p>
        }
    </div>
</div>
 
 
==================== Edit.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
﻿@model OrganizationalMessenger.Web.Models.ViewModels.ChannelEditViewModel

@{
    ViewData["Title"] = "ویرایش کانال";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>ویرایش کانال</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">بازگشت به لیست</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="CreatorId" />
    <input type="hidden" asp-for="CreatedAt" />

    <div class="form-group">
        <label asp-for="Name">نام کانال *</label>
        <input asp-for="Name" class="form-control" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Description">توضیحات</label>
        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" asp-for="IsPublic" />
            کانال عمومی
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" asp-for="IsActive" />
            فعال
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">ذخیره تغییرات</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">انصراف</a>
    </div>
</form>
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
﻿@model IEnumerable<OrganizationalMessenger.Web.Models.ViewModels.ChannelListViewModel>

@{
    ViewData["Title"] = "مدیریت کانال‌ها";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>مدیریت کانال‌ها</h2>
    <a href="@Url.Action("Create")" class="btn btn-primary">+ کانال جدید</a>
</div>

<div class="search-filter">
    <form method="get" class="search-form">
        <input type="text" name="searchTerm" placeholder="جستجو بر اساس نام یا توضیحات..."
               value="@ViewBag.SearchTerm" />

        <select name="isActive">
            <option value="">همه کانال‌ها</option>
            <option value="true" selected="@(ViewBag.IsActive == true)">فعال</option>
            <option value="false" selected="@(ViewBag.IsActive == false)">غیرفعال</option>
        </select>

        <button type="submit" class="btn btn-secondary">جستجو</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">پاک کردن فیلترها</a>
    </form>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error">@TempData["ErrorMessage"]</div>
}

<table>
    <thead>
        <tr>
            <th>نام کانال</th>
            <th>سازنده</th>
            <th>تعداد اعضا</th>
            <th>وضعیت</th>
            <th>نوع</th>
            <th>تاریخ ایجاد</th>
            <th>عملیات</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var channel in Model)
        {
            <tr>
                <td>@channel.Name</td>
                <td>@channel.CreatorName</td>
                <td>@channel.SubscriberCount</td>
                <td>
                    <span class="badge @(channel.IsActive ? "badge-active" : "badge-inactive")">
                        @(channel.IsActive ? "فعال" : "غیرفعال")
                    </span>
                </td>
                <td>
                    <span class="badge @(channel.IsPublic ? "badge-active" : "badge-inactive")">
                        @(channel.IsPublic ? "عمومی" : "خصوصی")
                    </span>
                </td>
                <td>@channel.CreatedAt.ToString("yyyy/MM/dd")</td>
                <td class="actions">
                    <a href="@Url.Action("Details", new { id = channel.Id })" class="btn-icon" title="جزئیات">👁️</a>
                    <a href="@Url.Action("Edit", new { id = channel.Id })" class="btn-icon" title="ویرایش">✏️</a>
                    <form method="post" action="@Url.Action("Delete", new { id = channel.Id })"
                          style="display:inline;" onsubmit="return confirm('آیا مطمئن هستید؟');">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn-icon btn-danger" title="حذف">🗑️</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <p class="no-data">هیچ کانالی یافت نشد.</p>
}
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Dashboard\ 
 
﻿@{
    ViewData["Title"] = "داشبورد";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
<style>
    /* ==================== متغیرهای CSS ==================== */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --danger-gradient: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        --dark-gradient: linear-gradient(135deg, #434343 0%, #000000 100%);
        --card-shadow: 0 10px 40px rgba(0,0,0,0.1);
        --card-hover-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }

    /* ==================== هدر صفحه ==================== */
    .page-header {
        background: var(--primary-gradient);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        color: #fff;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @@keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .page-header h1 {
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
        position: relative;
        z-index: 1;
    }

    .page-header .date-display {
        font-size: 1rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }

    /* ==================== کارت‌های آمار ==================== */
    .stats-card {
        background: #fff;
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        height: 100%;
    }

    .stats-card:hover {
        transform: translateY(-10px);
        box-shadow: var(--card-hover-shadow);
    }

    .stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        opacity: 0.1;
        transform: translate(30%, -30%);
    }

    .stats-card.primary::before { background: #667eea; }
    .stats-card.success::before { background: #38ef7d; }
    .stats-card.warning::before { background: #f5576c; }
    .stats-card.info::before { background: #00f2fe; }
    .stats-card.danger::before { background: #f45c43; }
    .stats-card.purple::before { background: #9f7aea; }
    .stats-card.teal::before { background: #38b2ac; }
    .stats-card.orange::before { background: #ed8936; }

    .stats-card .icon-wrapper {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #fff;
        margin-bottom: 15px;
    }

    .stats-card.primary .icon-wrapper { background: var(--primary-gradient); }
    .stats-card.success .icon-wrapper { background: var(--success-gradient); }
    .stats-card.warning .icon-wrapper { background: var(--warning-gradient); }
    .stats-card.info .icon-wrapper { background: var(--info-gradient); }
    .stats-card.danger .icon-wrapper { background: var(--danger-gradient); }
    .stats-card.purple .icon-wrapper { background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%); }
    .stats-card.teal .icon-wrapper { background: linear-gradient(135deg, #38b2ac 0%, #319795 100%); }
    .stats-card.orange .icon-wrapper { background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); }

    .stats-card .stats-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2d3748;
        line-height: 1;
        margin-bottom: 5px;
    }

    .stats-card .stats-label {
        font-size: 0.9rem;
        color: #718096;
        margin-bottom: 10px;
    }

    .stats-card .stats-change {
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .stats-card .stats-change.positive { color: #38a169; }
    .stats-card .stats-change.negative { color: #e53e3e; }

    /* ==================== کارت‌های نمودار ==================== */
    .chart-card {
        background: #fff;
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
        height: 100%;
    }

    .chart-card .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e2e8f0;
    }

    .chart-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3748;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chart-card .card-title i {
        color: #667eea;
    }

    .chart-period-btns {
        display: flex;
        gap: 5px;
    }

    .chart-period-btn {
        padding: 6px 12px;
        border: 1px solid #e2e8f0;
        background: #fff;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        font-family: inherit;
    }

    .chart-period-btn:hover,
    .chart-period-btn.active {
        background: #667eea;
        color: #fff;
        border-color: #667eea;
    }

    .chart-container {
        position: relative;
        height: 300px;
    }

    /* ==================== کارت‌های جدول ==================== */
    .table-card {
        background: #fff;
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
        height: 100%;
    }

    .table-card .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e2e8f0;
    }

    .table-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3748;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .table-card .card-title i {
        color: #667eea;
    }

    .table-card .view-all-btn {
        font-size: 0.85rem;
        color: #667eea;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s ease;
    }

    .table-card .view-all-btn:hover {
        color: #764ba2;
    }

    .dashboard-table {
        width: 100%;
        border-collapse: collapse;
    }

    .dashboard-table th {
        text-align: right;
        padding: 12px 15px;
        font-weight: 600;
        color: #4a5568;
        background: #f7fafc;
        font-size: 0.85rem;
    }

    .dashboard-table th:first-child {
        border-radius: 0 10px 10px 0;
    }

    .dashboard-table th:last-child {
        border-radius: 10px 0 0 10px;
    }

    .dashboard-table td {
        padding: 15px;
        border-bottom: 1px solid #edf2f7;
        font-size: 0.9rem;
        color: #4a5568;
    }

    .dashboard-table tr:last-child td {
        border-bottom: none;
    }

    .dashboard-table tr:hover td {
        background: #f7fafc;
    }

    /* ==================== آواتار کاربر ==================== */
    .user-avatar {
        position: relative;
        width: 40px;
        height: 40px;
        background: var(--primary-gradient);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 600;
        font-size: 1rem;
    }

    .user-avatar .online-indicator {
        position: absolute;
        bottom: -2px;
        right: -2px;
        width: 12px;
        height: 12px;
        background: #48bb78;
        border-radius: 50%;
        border: 2px solid #fff;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-info .user-name {
        font-weight: 600;
        color: #2d3748;
    }

    .user-info .user-username {
        font-size: 0.8rem;
        color: #a0aec0;
    }

    /* ==================== بج‌ها ==================== */
    .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .badge.bg-success {
        background: rgba(72, 187, 120, 0.15) !important;
        color: #38a169;
    }

    .badge.bg-danger {
        background: rgba(245, 101, 101, 0.15) !important;
        color: #e53e3e;
    }

    .badge.bg-warning {
        background: rgba(237, 137, 54, 0.15) !important;
        color: #dd6b20;
    }

    .badge.bg-info {
        background: rgba(66, 153, 225, 0.15) !important;
        color: #3182ce;
    }

    .badge.bg-secondary {
        background: rgba(113, 128, 150, 0.15) !important;
        color: #718096;
    }

    .badge.bg-primary {
        background: rgba(102, 126, 234, 0.15) !important;
        color: #667eea;
    }

    /* ==================== انیمیشن آپدیت ==================== */
    .value-updated {
        animation: pulse-update 0.5s ease;
    }

    @@keyframes pulse-update {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); color: #48bb78; }
        100% { transform: scale(1); }
    }

    /* ==================== آخرین به‌روزرسانی ==================== */
    .last-updated {
        font-size: 0.8rem;
        color: #a0aec0;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .last-updated i {
        animation: spin 2s linear infinite;
    }

    @@keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* ==================== ریسپانسیو ==================== */
    @@media (max-width: 768px) {
        .page-header {
            padding: 20px;
        }

        .page-header h1 {
            font-size: 1.5rem;
        }

        .stats-card .stats-value {
            font-size: 1.8rem;
        }

        .chart-period-btns {
            flex-wrap: wrap;
        }
    }
</style>
}

<!-- ==================== هدر صفحه ==================== -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
            <h1><i class="fas fa-chart-line me-2"></i>داشبورد</h1>
            <p class="date-display mb-0 mt-2">
                <i class="fas fa-calendar-alt me-1"></i>
                @ViewBag.TodayPersianDate
            </p>
        </div>
        <div class="last-updated" id="lastUpdatedContainer">
            <i class="fas fa-sync-alt"></i>
            <span>آخرین به‌روزرسانی: </span>
            <span id="lastUpdated">@ViewBag.TodayPersianDateTime</span>
        </div>
    </div>
</div>

<!-- ==================== کارت‌های آمار ==================== -->
<div class="row g-4 mb-4">
    <!-- کل کاربران -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card primary">
            <div class="icon-wrapper">
                <i class="fas fa-users"></i>
            </div>
            <div class="stats-value" id="totalUsers">@ViewBag.TotalUsers</div>
            <div class="stats-label">کل کاربران</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.NewUsersToday نفر امروز</span>
            </div>
        </div>
    </div>

    <!-- کاربران آنلاین -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card success">
            <div class="icon-wrapper">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="stats-value" id="onlineUsers">@ViewBag.OnlineUsers</div>
            <div class="stats-label">کاربران آنلاین</div>
            <div class="stats-change positive">
                <i class="fas fa-circle text-success"></i>
                <span>فعال</span>
            </div>
        </div>
    </div>

    <!-- کل پیام‌ها -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card info">
            <div class="icon-wrapper">
                <i class="fas fa-comments"></i>
            </div>
            <div class="stats-value" id="totalMessages">@ViewBag.TotalMessages</div>
            <div class="stats-label">کل پیام‌ها</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.MessagesToday پیام امروز</span>
            </div>
        </div>
    </div>

    <!-- گروه‌ها -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card warning">
            <div class="icon-wrapper">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="stats-value" id="totalGroups">@ViewBag.TotalGroups</div>
            <div class="stats-label">گروه‌ها</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.NewGroupsThisWeek این هفته</span>
            </div>
        </div>
    </div>

    <!-- کانال‌ها -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card purple">
            <div class="icon-wrapper">
                <i class="fas fa-broadcast-tower"></i>
            </div>
            <div class="stats-value" id="totalChannels">@ViewBag.TotalChannels</div>
            <div class="stats-label">کانال‌ها</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.NewChannelsThisWeek این هفته</span>
            </div>
        </div>
    </div>

    <!-- تماس‌ها -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card teal">
            <div class="icon-wrapper">
                <i class="fas fa-phone-alt"></i>
            </div>
            <div class="stats-value" id="totalCalls">@ViewBag.TotalCalls</div>
            <div class="stats-label">تماس‌ها</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.CallsToday امروز</span>
            </div>
        </div>
    </div>

    <!-- فایل‌های آپلود شده -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card orange">
            <div class="icon-wrapper">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="stats-value" id="totalFiles">@ViewBag.TotalFiles</div>
            <div class="stats-label">فایل‌های آپلود شده</div>
            <div class="stats-change">
                <i class="fas fa-database"></i>
                <span>@ViewBag.TotalStorageUsed استفاده شده</span>
            </div>
        </div>
    </div>

    <!-- گزارشات در انتظار -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card danger">
            <div class="icon-wrapper">
                <i class="fas fa-flag"></i>
            </div>
            <div class="stats-value" id="pendingReports">@ViewBag.PendingReports</div>
            <div class="stats-label">گزارشات در انتظار</div>
            <div class="stats-change negative">
                <i class="fas fa-exclamation-triangle"></i>
                <span>نیاز به بررسی</span>
            </div>
        </div>
    </div>
</div>

<!-- ==================== نمودارها ==================== -->
<div class="row g-4 mb-4">
    <!-- نمودار پیام‌ها -->
    <div class="col-xl-8 col-lg-7">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-area"></i>
                    آمار پیام‌ها
                </h5>
                <div class="chart-period-btns">
                    <button class="chart-period-btn active" data-period="week">هفته</button>
                    <button class="chart-period-btn" data-period="month">ماه</button>
                    <button class="chart-period-btn" data-period="year">سال</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="messagesChart"></canvas>
            </div>
        </div>
    </div>

    <!-- نمودار نوع پیام‌ها -->
    <div class="col-xl-4 col-lg-5">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-pie"></i>
                    نوع پیام‌ها
                </h5>
            </div>
            <div class="chart-container">
                <canvas id="messageTypesChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- ==================== نمودارهای ردیف دوم ==================== -->
<div class="row g-4 mb-4">
    <!-- نمودار فعالیت کاربران -->
    <div class="col-xl-6">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    فعالیت کاربران (ساعتی)
                </h5>
            </div>
            <div class="chart-container">
                <canvas id="userActivityChart"></canvas>
            </div>
        </div>
    </div>

    <!-- نمودار تماس‌ها -->
    <div class="col-xl-6">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-line"></i>
                    آمار تماس‌ها
                </h5>
                <div class="chart-period-btns">
                    <button class="chart-period-btn active" data-period="week" data-chart="calls">هفته</button>
                    <button class="chart-period-btn" data-period="month" data-chart="calls">ماه</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="callsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- ==================== جداول ==================== -->
<div class="row g-4 mb-4">
    <!-- کاربران جدید -->
    <div class="col-xl-6">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-user-plus"></i>
                    کاربران جدید
                </h5>
                <a href="/Admin/Users" class="view-all-btn">
                    مشاهده همه
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>کاربر</th>
                            <th>تاریخ عضویت</th>
                            <th>وضعیت</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="newUsersTableBody">
                        @if (ViewBag.NewUsers != null)
                        {
                            foreach (var user in ViewBag.NewUsers)
                            {
                                <tr>
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar">
                                                @(user.FullName?.Length > 0 ? user.FullName[0].ToString().ToUpper() : "U")
                                                @if (user.IsOnline)
                                                {
                                                    <span class="online-indicator"></span>
                                                }
                                            </div>
                                            <div>
                                                <div class="user-name">@user.FullName</div>
                                                <div class="user-username">@@@user.Username</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>@user.CreatedAtPersian</td>
                                    <td>
                                        @if (user.IsActive)
                                        {
                                            <span class="badge bg-success">فعال</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger">غیرفعال</span>
                                        }
                                    </td>
                                    <td>
                                        <a href="/Admin/Users/Edit/@user.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                                    کاربر جدیدی یافت نشد
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- گزارشات اخیر -->
    <div class="col-xl-6">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-flag"></i>
                    گزارشات اخیر
                </h5>
                <a href="/Admin/Reports" class="view-all-btn">
                    مشاهده همه
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>گزارش‌دهنده</th>
                            <th>نوع</th>
                            <th>دلیل</th>
                            <th>وضعیت</th>
                            <th>عملیات</th>
                        </tr>
                    </thead>
                    <tbody id="recentReportsTableBody">
                        @if (ViewBag.RecentReports != null && ((IEnumerable<dynamic>)ViewBag.RecentReports).Any())
                        {
                            foreach (var report in ViewBag.RecentReports)
                            {
                                <tr>
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 0.9rem;">
                                                @(report.ReporterName?.Length > 0 ? report.ReporterName[0].ToString().ToUpper() : "U")
                                            </div>
                                            <div>
                                                <div class="user-name">@report.ReporterName</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        @switch (report.ItemType)
                                        {
                                            case "Message":
                                                <span class="badge bg-info">پیام</span>
                                                break;
                                            case "User":
                                                <span class="badge bg-primary">کاربر</span>
                                                break;
                                            case "Group":
                                                <span class="badge bg-warning">گروه</span>
                                                break;
                                            case "Channel":
                                                <span class="badge bg-secondary">کانال</span>
                                                break;
                                            default:
                                                <span class="badge bg-light text-dark">@report.ItemType</span>
                                                break;
                                        }
                                    </td>
                                    <td>
                                        <span class="text-truncate d-inline-block" style="max-width: 150px;" title="@report.Reason">
                                            @report.Reason
                                        </span>
                                    </td>
                                    <td>
                                        @switch (report.Status)
                                        {
                                            case "Pending":
                                                <span class="badge bg-warning">در انتظار</span>
                                                break;
                                            case "Reviewed":
                                                <span class="badge bg-info">بررسی شده</span>
                                                break;
                                            case "Resolved":
                                                <span class="badge bg-success">حل شده</span>
                                                break;
                                            case "Dismissed":
                                                <span class="badge bg-secondary">رد شده</span>
                                                break;
                                            default:
                                                <span class="badge bg-light text-dark">@report.Status</span>
                                                break;
                                        }
                                    </td>
                                    <td>
                                        <a href="/Admin/Reports/Details/@report.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">
                                    <i class="fas fa-check-circle fa-2x mb-2 d-block text-success"></i>
                                    گزارشی یافت نشد
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ==================== ردیف سوم جداول ==================== -->
<div class="row g-4 mb-4">
    <!-- گروه‌های فعال -->
    <div class="col-xl-4">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-fire"></i>
                    گروه‌های فعال
                </h5>
                <a href="/Admin/Groups" class="view-all-btn">
                    مشاهده همه
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>نام گروه</th>
                            <th>اعضا</th>
                            <th>پیام‌ها</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.ActiveGroups != null)
                        {
                            foreach (var group in ViewBag.ActiveGroups)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 0.9rem; background: var(--warning-gradient);">
                                                <i class="fas fa-users" style="font-size: 0.8rem;"></i>
                                            </div>
                                            <span>@group.Name</span>
                                        </div>
                                    </td>
                                    <td>@group.MemberCount</td>
                                    <td>@group.MessageCount</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">
                                    گروهی یافت نشد
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- کانال‌های فعال -->
    <div class="col-xl-4">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-broadcast-tower"></i>
                    کانال‌های فعال
                </h5>
                <a href="/Admin/Channels" class="view-all-btn">
                    مشاهده همه
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>نام کانال</th>
                            <th>اعضا</th>
                            <th>پست‌ها</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.ActiveChannels != null)
                        {
                            foreach (var channel in ViewBag.ActiveChannels)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 0.9rem; background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);">
                                                <i class="fas fa-broadcast-tower" style="font-size: 0.8rem;"></i>
                                            </div>
                                            <span>@channel.Name</span>
                                        </div>
                                    </td>
                                    <td>@channel.SubscriberCount</td>
                                    <td>@channel.PostCount</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">
                                    کانالی یافت نشد
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- آخرین تماس‌ها -->
    <div class="col-xl-4">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-phone-alt"></i>
                    آخرین تماس‌ها
                </h5>
                <a href="/Admin/Calls" class="view-all-btn">
                    مشاهده همه
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>تماس‌گیرنده</th>
                            <th>نوع</th>
                            <th>مدت</th>
                            <th>وضعیت</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.RecentCalls != null)
                        {
                            foreach (var call in ViewBag.RecentCalls)
                            {
                                <tr>
                                    <td>@call.InitiatorName</td>
                                    <td>
                                        @if (call.Type == "Voice")
                                        {
                                            <i class="fas fa-phone text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="fas fa-video text-primary"></i>
                                        }
                                    </td>
                                    <td>@call.Duration</td>
                                    <td>
                                        @switch (call.Status)
                                        {
                                            case "Answered":
                                                <span class="badge bg-success">برقرار</span>
                                                break;
                                            case "Missed":
                                                <span class="badge bg-warning">از دست رفته</span>
                                                break;
                                            case "Rejected":
                                                <span class="badge bg-danger">رد شده</span>
                                                break;
                                            default:
                                                <span class="badge bg-secondary">@call.Status</span>
                                                break;
                                        }
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">
                                    تماسی یافت نشد
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ==================== کارت‌های سریع ==================== -->
<div class="row g-4">
    <div class="col-12">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-bolt"></i>
                    دسترسی سریع
                </h5>
            </div>
            <div class="row g-3 p-3">
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Users/Create" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--primary-gradient);">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>کاربر جدید</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Groups/Create" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--success-gradient);">
                            <i class="fas fa-users"></i>
                        </div>
                        <span>گروه جدید</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Channels/Create" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);">
                            <i class="fas fa-broadcast-tower"></i>
                        </div>
                        <span>کانال جدید</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Messages/Broadcast" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--info-gradient);">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span>پیام همگانی</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Settings" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--warning-gradient);">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span>تنظیمات</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Reports" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--danger-gradient);">
                            <i class="fas fa-flag"></i>
                        </div>
                        <span>گزارشات</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        // ==================== تنظیمات Chart.js ====================
        Chart.defaults.font.family = 'Vazirmatn, Tahoma, sans-serif';
        Chart.defaults.color = '#718096';

        // ==================== نمودار پیام‌ها ====================
        const messagesCtx = document.getElementById('messagesChart').getContext('2d');
        const messagesChart = new Chart(messagesCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(ViewBag.MessageChartLabels ?? "['شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه', 'جمعه']"),
                datasets: [{
                    label: 'پیام‌ها',
                    data: @Html.Raw(ViewBag.MessageChartData ?? "[120, 190, 150, 220, 180, 250, 200]"),
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#667eea',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10,
                        displayColors: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // ==================== نمودار نوع پیام‌ها ====================
        const messageTypesCtx = document.getElementById('messageTypesChart').getContext('2d');
        const messageTypesChart = new Chart(messageTypesCtx, {
            type: 'doughnut',
            data: {
                labels: ['متنی', 'تصویر', 'ویدیو', 'صوتی', 'فایل', 'سایر'],
                datasets: [{
                    data: @Html.Raw(ViewBag.MessageTypesData ?? "[65, 15, 8, 5, 5, 2]"),
                    backgroundColor: [
                        '#667eea',
                        '#38ef7d',
                        '#f5576c',
                        '#4facfe',
                        '#ed8936',
                        '#9f7aea'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10
                    }
                },
                cutout: '65%'
            }
        });

        // ==================== نمودار فعالیت کاربران ====================
        const userActivityCtx = document.getElementById('userActivityChart').getContext('2d');
        const userActivityChart = new Chart(userActivityCtx, {
            type: 'bar',
            data: {
                labels: ['00', '02', '04', '06', '08', '10', '12', '14', '16', '18', '20', '22'],
                datasets: [{
                    label: 'فعالیت',
                    data: @Html.Raw(ViewBag.UserActivityData ?? "[10, 5, 3, 8, 45, 80, 95, 88, 92, 85, 60, 30]"),
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10,
                        displayColors: false,
                        callbacks: {
                            title: function(context) {
                                return 'ساعت ' + context[0].label + ':00';
                            },
                            label: function(context) {
                                return context.raw + ' کاربر فعال';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // ==================== نمودار تماس‌ها ====================
        const callsCtx = document.getElementById('callsChart').getContext('2d');
        const callsChart = new Chart(callsCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(ViewBag.CallsChartLabels ?? "['شنبه', 'یکشنبه', 'دوشنبه', 'سه‌شنبه', 'چهارشنبه', 'پنجشنبه', 'جمعه']"),
                datasets: [
                    {
                        label: 'تماس صوتی',
                        data: @Html.Raw(ViewBag.VoiceCallsData ?? "[25, 35, 28, 42, 38, 45, 30]"),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'تماس تصویری',
                        data: @Html.Raw(ViewBag.VideoCallsData ?? "[10, 15, 12, 18, 14, 20, 15]"),
                        borderColor: '#4299e1',
                        backgroundColor: 'rgba(66, 153, 225, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // ==================== تغییر بازه زمانی نمودارها ====================
        document.querySelectorAll('.chart-period-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const period = this.dataset.period;
                const chartType = this.dataset.chart || 'messages';

                // تغییر وضعیت active
                this.parentElement.querySelectorAll('.chart-period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // درخواست داده جدید از سرور
                loadChartData(chartType, period);
            });
        });

        function loadChartData(chartType, period) {
            fetch(`/Admin/Dashboard/GetChartData?type=${chartType}&period=${period}`)
                .then(response => response.json())
                .then(data => {
                    if (chartType === 'messages') {
                        messagesChart.data.labels = data.labels;
                        messagesChart.data.datasets[0].data = data.values;
                        messagesChart.update();
                    } else if (chartType === 'calls') {
                        callsChart.data.labels = data.labels;
                        callsChart.data.datasets[0].data = data.voiceCalls;
                        callsChart.data.datasets[1].data = data.videoCalls;
                        callsChart.update();
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // ==================== به‌روزرسانی خودکار آمار ====================
        function updateStats() {
            fetch('/Admin/Dashboard/GetLiveStats')
                .then(response => response.json())
                .then(data => {
                    // به‌روزرسانی کارت‌های آمار با انیمیشن
                    updateStatValue('totalUsers', data.totalUsers);
                    updateStatValue('onlineUsers', data.onlineUsers);
                    updateStatValue('totalMessages', data.totalMessages);
                    updateStatValue('totalGroups', data.totalGroups);
                    updateStatValue('totalChannels', data.totalChannels);
                    updateStatValue('totalCalls', data.totalCalls);
                    updateStatValue('totalFiles', data.totalFiles);
                    updateStatValue('pendingReports', data.pendingReports);

                    // به‌روزرسانی زمان
                    document.getElementById('lastUpdated').textContent = data.lastUpdated;
                })
                .catch(error => console.error('Error updating stats:', error));
        }

        function updateStatValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== newValue.toString()) {
                element.textContent = newValue.toLocaleString('fa-IR');
                element.classList.add('value-updated');
                setTimeout(() => element.classList.remove('value-updated'), 500);
            }
        }

        // به‌روزرسانی هر 30 ثانیه
        setInterval(updateStats, 30000);

        // ==================== انیمیشن ورود کارت‌ها ====================
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.stats-card, .chart-card, .table-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>

    <style>
        /* استایل دکمه‌های دسترسی سریع */
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px 15px;
            background: #f7fafc;
            border-radius: 15px;
            text-decoration: none;
            color: #4a5568;
            transition: all 0.3s ease;
        }

            .quick-action-btn:hover {
                background: #edf2f7;
                transform: translateY(-5px);
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                color: #2d3748;
            }

        .quick-action-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.2rem;
        }

        .quick-action-btn span {
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
        }
    </style>
}
 
 
==================== Create.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Groups\ 
 
﻿@model OrganizationalMessenger.Web.Models.ViewModels.GroupCreateViewModel

@{
    ViewData["Title"] = "ایجاد گروه";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>ایجاد گروه جدید</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">بازگشت به لیست</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()

    <div class="form-group">
        <label for="Name">نام گروه *</label>
        <input type="text" id="Name" name="Name" asp-for="Name" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="Description">توضیحات</label>
        <textarea id="Description" name="Description" asp-for="Description" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="CreatorId">سازنده *</label>
        <select id="CreatorId" name="CreatorId" asp-for="CreatorId" required>
            <option value="">-- انتخاب کنید --</option>
            @foreach (var user in ViewBag.Users)
            {
                <option value="@user.Id">@user.FirstName @user.LastName (@user.Username)</option>
            }
        </select>
        <span asp-validation-for="CreatorId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="MaxMembers">حداکثر تعداد اعضا</label>
        <input type="number" id="MaxMembers" name="MaxMembers" asp-for="MaxMembers" min="2" max="5000" value="200" />
        <span asp-validation-for="MaxMembers" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsPublic" asp-for="IsPublic" />
            گروه عمومی
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsActive" asp-for="IsActive" checked />
            فعال
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">ایجاد گروه</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">انصراف</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
 
 
==================== Edit.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Groups\ 
 
﻿@model OrganizationalMessenger.Web.Models.ViewModels.GroupEditViewModel

@{
    ViewData["Title"] = "ویرایش گروه";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>ویرایش گروه</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">بازگشت به لیست</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="CreatorId" />
    <input type="hidden" asp-for="CreatedAt" />

    <div class="form-group">
        <label for="Name">نام گروه *</label>
        <input type="text" id="Name" name="Name" asp-for="Name" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="Description">توضیحات</label>
        <textarea id="Description" name="Description" asp-for="Description" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="MaxMembers">حداکثر تعداد اعضا</label>
        <input type="number" id="MaxMembers" name="MaxMembers" asp-for="MaxMembers" min="2" max="5000" />
        <span asp-validation-for="MaxMembers" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsPublic" asp-for="IsPublic" />
            گروه عمومی
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsActive" asp-for="IsActive" />
            فعال
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">ذخیره تغییرات</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">انصراف</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Groups\ 
 
﻿@model IEnumerable<OrganizationalMessenger.Web.Models.ViewModels.GroupListViewModel>

@{
    ViewData["Title"] = "مدیریت گروه‌ها";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>مدیریت گروه‌ها</h2>
    <a href="@Url.Action("Create")" class="btn btn-primary">+ گروه جدید</a>
</div>

<div class="search-filter">
    <form method="get" class="search-form">
        <input type="text" name="searchTerm" placeholder="جستجو بر اساس نام یا توضیحات..."
               value="@ViewBag.SearchTerm" />

        <select name="isActive">
            <option value="">همه گروه‌ها</option>
            <option value="true" selected="@(ViewBag.IsActive == true)">فعال</option>
            <option value="false" selected="@(ViewBag.IsActive == false)">غیرفعال</option>
        </select>

        <button type="submit" class="btn btn-secondary">جستجو</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">پاک کردن فیلترها</a>
    </form>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error">@TempData["ErrorMessage"]</div>
}

<table>
    <thead>
        <tr>
            <th>نام گروه</th>
            <th>سازنده</th>
            <th>تعداد اعضا</th>
            <th>وضعیت</th>
            <th>نوع</th>
            <th>تاریخ ایجاد</th>
            <th>عملیات</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var group in Model)
        {
            <tr>
                <td>@group.Name</td>
                <td>@group.CreatorName</td>
                <td>@group.MemberCount</td>
                <td>
                    <span class="badge @(group.IsActive ? "badge-active" : "badge-inactive")">
                        @(group.IsActive ? "فعال" : "غیرفعال")
                    </span>
                </td>
                <td>
                    <span class="badge @(group.IsPublic ? "badge-active" : "badge-inactive")">
                        @(group.IsPublic ? "عمومی" : "خصوصی")
                    </span>
                </td>
                <td>@group.CreatedAt.ToString("yyyy/MM/dd")</td>
                <td class="actions">
                    <a href="@Url.Action("Details", new { id = group.Id })" class="btn-icon" title="جزئیات">👁️</a>
                    <a href="@Url.Action("Members", new { id = group.Id })" class="btn-icon" title="اعضا">👥</a>
                    <a href="@Url.Action("Edit", new { id = group.Id })" class="btn-icon" title="ویرایش">✏️</a>
                    <form method="post" action="@Url.Action("Delete", new { id = group.Id })"
                          style="display:inline;" onsubmit="return confirm('آیا مطمئن هستید؟');">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn-icon btn-danger" title="حذف">🗑️</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <p class="no-data">هیچ گروهی یافت نشد.</p>
}
 
 
==================== Authentication.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@{
    ViewData["Title"] = "تنظیمات احراز هویت";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4>تنظیمات احراز هویت</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }

            <form asp-action="Authentication" method="post">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>نوع احراز هویت</label>
                            @{
                                string authType = ViewBag.AuthenticationType?.ToString() ?? "Database";
                            }
                            <select name="authenticationType" class="form-control">
                                <option value="Database" selected="@(authType == "Database")">دیتابیس</option>
                                <option value="ActiveDirectory" selected="@(authType == "ActiveDirectory")">Active Directory</option>
                                <option value="ERP" selected="@(authType == "ERP")">ERP</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label>سرور AD</label>
                            <input type="text" name="adServer" value="@ViewBag.AdServer" class="form-control" />
                        </div>
                        <div class="form-group mb-3">
                            <label>دامنه AD</label>
                            <input type="text" name="adDomain" value="@ViewBag.AdDomain" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>API ERP</label>
                            <input type="url" name="erpApiUrl" value="@ViewBag.ErpApiUrl"
                                   class="form-control" placeholder="https://erp.company.com/api" />
                        </div>

                        <!-- ✅ Checkbox -->
                        <div class="form-check mb-3">
                            <input type="checkbox" name="otpEnabled" value="true"
                                   class="form-check-input" id="otpEnabled"
                                   @(ViewBag.OtpEnabled == true ? "checked" : "") />
                            <label class="form-check-label" for="otpEnabled">فعال‌سازی OTP</label>
                        </div>
                        <input type="hidden" name="otpEnabled" value="false" />

                        <div class="form-group mb-3">
                            <label>انقضای OTP (دقیقه)</label>
                            <input type="number" name="otpExpiryMinutes"
                                   value="@ViewBag.OtpExpiryMinutes"
                                   class="form-control" min="1" max="60" />
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">ذخیره</button>
                <a asp-action="Index" class="btn btn-secondary ml-2">بازگشت</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== FileUpload.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@model IEnumerable<OrganizationalMessenger.Domain.Entities.FileUploadSetting>
@{
    ViewData["Title"] = "تنظیمات آپلود فایل";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>
    }

    <!-- Add New File Type -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5><i class="fas fa-plus-circle"></i> اضافه کردن نوع فایل جدید</h5>
        </div>
        <div class="card-body">
            <form asp-action="AddFileType" method="post" class="row align-items-end">
                <div class="col-md-2">
                    <label class="form-label"> jpg, pdf, zipنوع فایل</label>
                    <input type="text" name="fileType" placeholder="jpg"
                           class="form-control" maxlength="10" required />
                </div>

                <div class="col-md-2">
                    <label class="form-label">دسته‌بندی</label>
                    <select name="category" class="form-control">
                        <option value="تصویر">تصویر</option>
                        <option value="ویدیو">ویدیو</option>
                        <option value="صوت">صوت</option>
                        <option value="سند">سند</option>
                        <option value="آرشیو">آرشیو</option>
                        <option value="سایر">سایر</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">حداکثر حجم (5MB پیش‌فرض)</label>
                    <input type="number" name="maxSize" value="5242880"
                           class="form-control" min="1024" step="1024" />
                </div>

                <div class="col-md-2">
                    <label class="form-label">وضعیت</label>
                    <select name="isAllowed" class="form-control">
                        <option value="true">فعال</option>
                        <option value="false">غیرفعال</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-plus"></i> اضافه کن
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- File Types Table -->
    <div class="card">
        <div class="card-header bg-info text-white">
            <h5><i class="fas fa-list"></i> فایل‌های تعریف‌شده (@Model.Count())</h5>
        </div>
        <div class="card-body p-0">
            @if (!Model.Any())
            {
                <div class="alert alert-warning text-center py-5">
                    <i class="fas fa-file-upload fa-3x mb-3 text-muted"></i>
                    <h4>هیچ نوع فایلی تعریف نشده</h4>
                    <p class="mb-0">از فرم بالا اولین نوع فایل را اضافه کنید</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="thead-light">
                            <tr>
                                <th style="width: 120px;">نوع فایل</th>
                                <th style="width: 120px;">دسته‌بندی</th>
                                <th style="width: 100px;">حداکثر حجم</th>
                                <th style="width: 100px;">وضعیت</th>
                                <th style="width: 200px;">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        <code class="text-dark font-weight-bold">.@item.FileType</code>
                                    </td>
                                    <td>
                                        <span class="badge badge-primary text-black px-2 py-1">
                                            @item.Category
                                        </span>
                                    </td>
                                    <td class="align-middle">
                                        <small>@(item.MaxSize / 1024 / 1024) MB</small>
                                    </td>
                                    <td class="align-middle">
                                        <span class="badge @(item.IsAllowed ? "badge-success" : "badge-danger") px-2 py-1" style="color:black">
                                            @(item.IsAllowed ? "فعال" : "غیرفعال")
                                        </span>
                                    </td>
                                    <td class="align-middle">
                                        <!-- Update Form - Compact -->
                                        <div class="btn-group btn-group-sm" role="group">
                                            <form asp-action="UpdateFileType" method="post" class="d-inline">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <div class="input-group input-group-sm" style="width: 300px;">
                                                    <input type="number" name="maxSize" value="@item.MaxSize"
                                                           class="form-control form-control-sm px-1" style="height: 32px; margin-left:10px" />
                                                    @{
                                                        bool isAllowed = item.IsAllowed;
                                                    }
                                                    <select name="isAllowed" class="form-control form-control-sm px-1" style="height: 32px; border-left: 0; margin-left:10px">
                                                        <option value="true" selected="@isAllowed">فعال</option>
                                                        <option value="false" selected="@(!isAllowed)">غیرفعال</option>
                                                    </select>
                                                    <div class="input-group-append">
                                                        <button type="submit" class="btn btn-primary px-2" title="بروزرسانی" style="width:74px">
                                                            <i class="fas fa-save"> ذخیره</i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>

                                            <!-- Delete Button -->
                                            <form asp-action="DeleteFileType" method="post" class="d-inline ml-1">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <button type="submit" class="btn btn-danger"
                                                        onclick="return confirm('آیا مطمئنید؟ .@item.FileType حذف شود')"
                                                        title="حذف">
                                                    <i class="fas fa-trash">حذف</i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

    <div class="mt-4">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> بازگشت به تنظیمات
        </a>
    </div>
</div>

@section Scripts {
    <script>
        // Auto dismiss alerts after 5 seconds
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);
    </script>
}
 
 
==================== ForbiddenWords.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@model IEnumerable<OrganizationalMessenger.Domain.Entities.ForbiddenWord>
@{
    ViewData["Title"] = "کلمات ممنوعه";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-9">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>کلمات ممنوعه</h4>
                    <form asp-action="AddForbiddenWord" method="post" class="d-inline">
                        <div class="input-group input-group-sm" style="width: 300px;">
                            <input type="text" name="newWord" class="form-control" placeholder="کلمه جدید..." required />
                            <div class="input-group-append">
                                <button class="btn btn-success" type="submit">افزودن</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-body">
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
                    }

                    @if (Model.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>کلمه</th>
                                        <th>ایجاد شده</th>
                                        <th>عملیات</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        int index = 1;
                                    }
                                    @foreach (var word in Model)
                                    {
                                        <tr>
                                            <th>@index</th>
                                            <td><code>@word.Word</code></td>
                                            <td>@word.CreatedAt.ToString("yyyy/MM/dd HH:mm")</td>
                                            <td>
                                                <form asp-action="DeleteForbiddenWord" method="post" style="display:inline;"
                                                      onsubmit="return confirm('آیا مطمئنید؟');">
                                                    <input type="hidden" name="id" value="@word.Id" />
                                                    <button type="submit" class="btn btn-sm btn-danger">حذف</button>
                                                </form>
                                            </td>
                                        </tr>
                                        index++;
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">هیچ کلمه ممنوعه‌ای ثبت نشده</h5>
                            <p class="text-muted">کلمات را از طریق فرم بالا اضافه کنید</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <a asp-action="Index" class="btn btn-secondary mt-3">بازگشت</a>
</div>
 
 
==================== General.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@{
    ViewData["Title"] = "تنظیمات عمومی";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <form asp-action="General" method="post" enctype="multipart/form-data">
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-cog"></i> تنظیمات عمومی</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>نام سازمان <span class="text-danger">*</span></label>
                            <input type="text" name="organizationName" value="@ViewBag.OrganizationName"
                                   class="form-control" required />
                        </div>

                        <div class="form-group mb-3">
                            <label>لوگوی سازمان</label>
                            <input type="file" name="logoFile" class="form-control" accept="image/*" />
                            @if (!string.IsNullOrEmpty(ViewBag.LogoUrl?.ToString()))
                            {
                                <img src="@ViewBag.LogoUrl" style="max-height:80px; border:1px solid #ddd;" />
                            }
                        </div>
                    </div>

                    <div class="col-md-6">
                        <!-- ✅ CHECKBOX 1 - درست -->
                        <div class="form-check mb-3">
                            <input type="checkbox" id="allowGroupCreation"
                                   name="allowUserGroupCreation" value="true"
                                   class="form-check-input"
                                   @(ViewBag.AllowUserGroupCreation ? "checked" : "") />
                            <label class="form-check-label" for="allowGroupCreation">
                                اجازه ایجاد گروه به کاربران
                            </label>
                        </div>

                        <!-- ✅ CHECKBOX 2 - درست -->
                        <div class="form-check mb-3">
                            <input type="checkbox" id="allowChannelCreation"
                                   name="allowUserChannelCreation" value="true"
                                   class="form-check-input"
                                   @(ViewBag.AllowUserChannelCreation ? "checked" : "") />
                            <label class="form-check-label" for="allowChannelCreation">
                                اجازه ایجاد کانال به کاربران
                            </label>
                        </div>

                        <div class="form-group mb-3">
                            <label>حداکثر اعضای گروه</label>
                            <input type="number" name="maxGroupMembers"
                                   value="@ViewBag.MaxGroupMembers"
                                   class="form-control" min="10" max="10000" />
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> ذخیره تنظیمات
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg ml-2">بازگشت</a>
            </div>
        </div>
    </form>
</div>
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@model IEnumerable<OrganizationalMessenger.Domain.Entities.SystemSetting>
@{
    ViewData["Title"] = "تنظیمات سیستم";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar Menu - مدرن -->
        <div class="col-xl-3 col-lg-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-gradient-primary text-white border-0">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>منوی تنظیمات
                    </h5>
                </div>
                <div class="list-group list-group-flush">
                    <a asp-action="General" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("General") == true ? "active" : "")">
                        <i class="fas fa-sliders-h me-3 text-primary"></i>عمومی
                    </a>
                    <a asp-action="Authentication" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("Authentication") == true ? "active" : "")">
                        <i class="fas fa-shield-alt me-3 text-success"></i>احراز هویت
                    </a>
                    <a asp-action="MessageSettings" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("MessageSettings") == true ? "active" : "")">
                        <i class="fas fa-comment-dots me-3 text-info"></i>پیام‌ها
                    </a>
                    <a asp-action="Sms" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("Sms") == true ? "active" : "")">
                        <i class="fas fa-sms me-3 text-warning"></i>پیامک
                    </a>
                    <a asp-action="VoIP" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("VoIP") == true ? "active" : "")">
                        <i class="fas fa-phone me-3 text-danger"></i>VoIP
                    </a>
                    <a asp-action="Telegram" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("Telegram") == true ? "active" : "")">
                        <i class="fab fa-telegram-plane me-3 text-primary"></i>تلگرام
                    </a>
                    <a asp-action="FileUpload" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("FileUpload") == true ? "active" : "")">
                        <i class="fas fa-file-upload me-3 text-success"></i>آپلود فایل
                    </a>
                    <a asp-action="ForbiddenWords" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("ForbiddenWords") == true ? "active" : "")">
                        <i class="fas fa-ban me-3 text-danger"></i>کلمات ممنوعه
                    </a>
                    <a asp-action="ServiceLinks" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("ServiceLinks") == true ? "active" : "")">
                        <i class="fas fa-link me-3 text-info"></i>خدمات
                    </a>
                    <a asp-action="Export" class="list-group-item list-group-item-action list-group-item-success">
                        <i class="fas fa-download me-3"></i>خروجی JSON
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content - مدرن -->
        <div class="col-xl-9 col-lg-8">
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-cog fa-2x text-primary mb-2"></i>
                            <h3 class="text-primary">@ViewBag.TotalSettings</h3>
                            <p class="mb-0 text-muted">کل تنظیمات</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                            <h3 class="text-warning">@(((DateTime)ViewBag.LastUpdated).ToString("HH:mm"))</h3>
                            <p class="mb-0 text-muted">آخرین بروزرسانی</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                            <h3 class="text-success">@Model.Count(s => s.Value?.ToLower() == "true")</h3>
                            <p class="mb-0 text-muted">فعال</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Table - شیک -->
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-secondary text-white py-3">
                    <h4 class="mb-0">
                        <i class="fas fa-list me-2"></i>وضعیت تنظیمات سیستم
                    </h4>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0 align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th class="border-0 py-3">
                                        <i class="fas fa-key me-1"></i>کلید
                                    </th>
                                    <th class="border-0 py-3">
                                        <i class="fas fa-cube me-1"></i>مقدار
                                    </th>
                                    <th class="border-0 py-3">
                                        <i class="fas fa-info-circle me-1"></i>توضیح
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="table-group-divider">
                                @foreach (var item in Model.OrderBy(x => x.Key))
                                {
                                    <tr class="hover-row">
                                        <td class="py-3">
                                            <code class="bg-light px-2 py-1 rounded font-monospace text-dark fw-semibold">
                                                @item.Key
                                            </code>
                                        </td>
                                        <td class="py-3">
                                            @{
                                                bool isBool = item.Value?.ToLower() == "true" || item.Value?.ToLower() == "false";
                                            }
                                            @if (isBool)
                                            {
                                                <span class="badge fs-6 px-3 py-2 @(item.Value == "true" ? "bg-success" : "bg-danger")">
                                                    @if (item.Value == "true")
                                                    {
                                                        <i class="fas fa-check-circle me-1"></i>
                                                        <span>فعال</span>
                                                    }
                                                    else
                                                    {
                                                        <i class="fas fa-times-circle me-1"></i>
                                                        <span>غیرفعال</span>
                                                    }
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-light text-dark px-3 py-2">
                                                    @item.Value
                                                </span>
                                            }
                                        </td>
                                        <td class="py-3">
                                            @if (!string.IsNullOrEmpty(item.Description))
                                            {
                                                <span class="text-muted small d-inline-block" style="max-width: 300px;" title="@item.Description">
                                                    @item.Description
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="text-muted small">—</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .bg-gradient-primary {
        background: var(--primary-gradient) !important;
    }

    .bg-gradient-secondary {
        background: var(--secondary-gradient) !important;
    }

    .list-group-item.active {
        background-color: var(--primary-gradient);
        border-color: transparent;
    }

    .hover-row:hover {
        background-color: rgba(0,123,255,.05);
        transform: scale(1.01);
        transition: all 0.2s ease;
    }

    .table-hover tbody tr:hover {
        --bs-table-accent-bg: rgba(0,0,0,.025);
    }

    .font-monospace {
        font-family: 'Fira Code', 'SF Mono', monospace;
        font-size: 0.875rem;
    }

    .badge {
        font-weight: 500 !important;
        border-radius: 25px;
        min-width: 80px;
        text-align: center;
    }
</style>

@section Scripts {
    <script>
        // Smooth hover animations
        document.querySelectorAll('.hover-row').forEach(row => {
            row.addEventListener('mouseenter', () => {
                row.style.transform = 'translateY(-2px)';
            });
            row.addEventListener('mouseleave', () => {
                row.style.transform = 'translateY(0)';
            });
        });
    </script>
}
 
 
==================== MessageSettings.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@{
    ViewData["Title"] = "تنظیمات پیام‌ها";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4>تنظیمات پیام‌ها</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }

            <form asp-action="MessageSettings" method="post">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>زمان ویرایش پیام (ثانیه)</label>
                            <input type="number" name="messageEditTimeLimit"
                                   value="@ViewBag.MessageEditTimeLimit"
                                   class="form-control" min="0" />
                            <small class="form-text text-muted">0 = بدون محدودیت</small>
                        </div>
                        <div class="form-group mb-3">
                            <label>زمان حذف پیام (ثانیه)</label>
                            <input type="number" name="messageDeleteTimeLimit"
                                   value="@ViewBag.MessageDeleteTimeLimit"
                                   class="form-control" min="0" />
                            <small class="form-text text-muted">0 = بدون محدودیت</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <!-- ✅ Checkbox 1 + Hidden -->
                        <div class="form-check mb-3">
                            <input type="checkbox" name="allowMessageEdit" value="true"
                                   class="form-check-input" id="allowEdit"
                                   @(ViewBag.AllowMessageEdit == true ? "checked" : "") />
                            <label class="form-check-label" for="allowEdit">اجازه ویرایش پیام</label>
                        </div>
                        <input type="hidden" name="allowMessageEdit" value="false" />

                        <!-- ✅ Checkbox 2 + Hidden -->
                        <div class="form-check mb-3">
                            <input type="checkbox" name="allowMessageDelete" value="true"
                                   class="form-check-input" id="allowDelete"
                                   @(ViewBag.AllowMessageDelete == true ? "checked" : "") />
                            <label class="form-check-label" for="allowDelete">اجازه حذف پیام</label>
                        </div>
                        <input type="hidden" name="allowMessageDelete" value="false" />
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">ذخیره</button>
                <a asp-action="Index" class="btn btn-secondary ml-2">بازگشت</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== ServiceLinks.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@model IEnumerable<OrganizationalMessenger.Domain.Entities.ServiceLink>
@{
    ViewData["Title"] = "لینک‌های خدمات";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4><i class="fas fa-link"></i> لینک‌های خدمات (@Model.Count())</h4>

            <!-- ✅ FORM کامل - کار می‌کند! -->
            <form asp-action="AddServiceLink" method="post" class="input-group input-group-sm" style="max-width: 500px;">
                <input type="text" name="title" class="form-control" placeholder="عنوان خدمت" required />
                <input type="url" name="url" class="form-control" placeholder="https://erp.company.com" required />
                <input type="text" name="iconUrl" class="form-control" placeholder="fas fa-external-link" />
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> افزودن
                </button>
            </form>
        </div>

        <div class="card-body">
            @if (!Model.Any())
            {
                <div class="text-center py-5">
                    <i class="fas fa-link fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">هیچ لینکی ثبت نشده</h5>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>عنوان</th>
                                <th style="width: 200px;">آدرس</th>
                                <th style="width: 120px;">آیکون</th>
                                <th style="width: 100px;">عملیات</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int index = 1;
                            }
                            @foreach (var link in Model.OrderBy(l => l.DisplayOrder))
                            {
                                <tr>
                                    <td>@index</td>
                                    <td><strong>@link.Title</strong></td>
                                    <td>
                                        <a href="@link.Url" target="_blank" class="text-truncate d-inline-block"
                                           style="max-width: 200px;" title="@link.Url">
                                            @link.Url
                                        </a>
                                    </td>
                                    <td><code>@link.IconUrl</code></td>
                                    <td>
                                        <form asp-action="DeleteServiceLink" method="post" class="d-inline">
                                            <input type="hidden" name="id" value="@link.Id" />
                                            <button type="submit" class="btn btn-sm btn-danger"
                                                    onclick="return confirm('حذف شود؟ @link.Title')">
                                                <i class="fas fa-trash">حذف</i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                index++;
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

    <a asp-action="Index" class="btn btn-secondary mt-3">بازگشت</a>
</div>
 
 
==================== Sms.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@{
    ViewData["Title"] = "تنظیمات SMS (TopTip)";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    var balanceResult = ViewBag.BalanceResult;
    bool balanceSuccess = balanceResult != null && (balanceResult as dynamic).Success == true;
    decimal balance = balanceSuccess ? (decimal)(balanceResult as dynamic).Balance : 0;
    string balanceMessage = balanceSuccess ? "موفق" : ((balanceResult as dynamic)?.Message ?? "نامشخص");
}

<div class="container-fluid">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="row">
        <!-- Main Settings -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fas fa-sms"></i> تنظیمات TopTip SMS</h4>
                </div>
                <div class="card-body">
                    <form asp-action="Sms" method="post">
                        <!-- SMS Toggle -->
                        <div class="form-check mb-4">
                            <input type="checkbox" name="smsEnabled" value="true"
                                   class="form-check-input" id="smsEnabled"
                                   @(ViewBag.SmsEnabled == true ? "checked" : "") />
                            <input type="hidden" name="smsEnabled" value="false" />
                            <label class="form-check-label" for="smsEnabled">
                                <h5>فعال‌سازی SMS</h5>
                            </label>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <!-- API Key -->
                                <div class="form-group mb-3">
                                    <label>API Key <span class="text-danger">*</span></label>
                                    <input type="text" name="smsApiKey" value="@ViewBag.SmsApiKey"
                                           class="form-control" required />
                                    <small>از پنل TopTip کپی کنید</small>
                                </div>

                                <!-- Sender Number -->
                                <div class="form-group mb-3">
                                    <label>شماره ارسال <span class="text-danger">*</span></label>
                                    <input type="text" name="smsSenderNumber" value="@ViewBag.SmsSenderNumber"
                                           class="form-control" placeholder="3000505" required />
                                </div>
                            </div>

                            <div class="col-md-6">
                                <!-- Username -->
                                <div class="form-group mb-3">
                                    <label>نام کاربری پنل <span class="text-danger">*</span></label>
                                    <input type="text" name="smsUsername" value="@ViewBag.SmsUsername"
                                           class="form-control" required />
                                </div>

                                <!-- Password -->
                                <div class="form-group mb-3">
                                    <label>رمز عبور پنل <span class="text-danger">*</span></label>
                                    <input type="password" name="smsPassword" value="@ViewBag.SmsPassword"
                                           class="form-control" required />
                                </div>
                            </div>
                        </div>

                        <!-- OTP Settings -->
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>طول OTP</label>
                                    <input type="number" name="otpLength" value="@ViewBag.OtpLength"
                                           class="form-control" min="4" max="8" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>انقضای OTP (دقیقه)</label>
                                    <input type="number" name="otpExpiryMinutes" value="@ViewBag.OtpExpiryMinutes"
                                           class="form-control" min="1" max="30" />
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg mt-3">
                            <i class="fas fa-save"></i> ذخیره تنظیمات TopTip
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Balance Display -->
        <div class="col-md-4">
            <div class="card sticky-top" style="top: 20px; z-index:1!important">
                <div class="card-header bg-success text-white">
                    <h6><i class="fas fa-wallet"></i> موجودی TopTip</h6>
                </div>
                <div class="card-body text-center">
                    @if (balanceSuccess)
                    {
                        <div class="mb-3">
                            <i class="fas fa-check-circle fa-3x text-success mb-2"></i>
                            <h3 class="text-success">@balance.ToString("N0") ریال</h3>
                            <small class="text-success">اتصال موفق</small>
                        </div>
                    }
                    else
                    {
                        <div class="mb-3">
                            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-2"></i>
                            <h5 class="text-warning">@balanceMessage</h5>
                            <small class="text-muted">نام کاربری/رمز را تنظیم کنید</small>
                        </div>
                    }

                    <hr />
                    <small class="text-muted">
                        <strong>آخرین بروزرسانی:</strong> @DateTime.Now.ToString("HH:mm:ss")
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Documentation -->
    <div class="card mt-4">
        <div class="card-header bg-info text-white">
            <h6>راهنمای TopTip</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>دریافت اطلاعات:</h6>
                    <ul class="small">
                        <li><a href="https://toptip.ir" target="_blank">toptip.ir</a> → ثبت‌نام</li>
                        <li>پنل → شارژ حساب</li>
                        <li>تنظیمات → API Key / Username / Password</li>
                        <li>خدمات → شماره ارسال (3000505 و...)</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>API ارسال:</h6>
                    <pre class="small bg-light p-2 rounded">
http://toptip.ir/webservice/rest/sms_send
?note_arr[]=سلام
&api_key=YOUR_API_KEY
&receiver_number=09123456789
&sender_number=3000505
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>
 
 
==================== Telegram.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@{
    ViewData["Title"] = "تنظیمات تلگرام";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4><i class="fab fa-telegram-plane"></i> تنظیمات تلگرام</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }

            <form asp-action="Telegram" method="post">
                <!-- ✅ Checkbox + Hidden -->
                <div class="form-check mb-3">
                    <input type="checkbox" name="telegramEnabled" value="true"
                           class="form-check-input" id="telegramEnabled"
                           @(ViewBag.TelegramEnabled == true ? "checked" : "") />
                    <label class="form-check-label" for="telegramEnabled">
                        فعال‌سازی تلگرام
                    </label>
                </div>
                <input type="hidden" name="telegramEnabled" value="false" />
                
                <!-- ✅ Bot Token با مقدار قبلی -->
                <div class="form-group mb-3">
                    <label>Bot Token <span class="text-muted">(از BotFather تلگرام)</span></label>
                    <input type="text" name="botToken" 
                           value="@ViewBag.BotToken"
                           class="form-control" 
                           placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" />
                    <small class="form-text text-muted">
                        1. در تلگرام BotFather را پیدا کنید<br/>
                        2. /newbot → نام ربات → username_bot<br/>
                        3. توکن را کپی کنید (مثال: 123456:ABC-DEF...)
                    </small>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> ذخیره تنظیمات
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg ml-2">بازگشت</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== VoIP.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
﻿@{
    ViewData["Title"] = "تنظیمات VoIP";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4><i class="fas fa-phone"></i> تنظیمات VoIP</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }

            <form asp-action="VoIP" method="post">
                <!-- ✅ Checkbox + Hidden Field -->
                <div class="form-check mb-4">
                    <input type="checkbox" name="voipEnabled" value="true"
                           class="form-check-input" id="voipEnabled"
                           @(ViewBag.VoipEnabled == true ? "checked" : "") />
                    <label class="form-check-label" for="voipEnabled">
                        <h5>فعال‌سازی تماس‌های VoIP</h5>
                    </label>
                </div>
                <!-- ✅ Hidden Field -->
                <input type="hidden" name="voipEnabled" value="false" />

                <div class="alert alert-info">
                    <strong>توجه:</strong> با فعال‌سازی VoIP، کاربران می‌توانند تماس صوتی و تصویری برقرار کنند.
                </div>

                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> ذخیره تنظیمات
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg ml-2">بازگشت</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== Create.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
﻿@model OrganizationalMessenger.Web.Areas.Admin.Models.UserCreateViewModel
@{
    ViewData["Title"] = "افزودن کاربر جدید";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mb-3">
    <div class="col-md-12">
        <h2>
            <i class="bi bi-person-plus"></i> افزودن کاربر جدید
        </h2>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form asp-action="Create" method="post">
                    @Html.AntiForgeryToken()

                    <div class="row">
                        <!-- اطلاعات پایه -->
                        <div class="col-md-12 mb-3">
                            <h5 class="border-bottom pb-2">اطلاعات پایه</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Username" class="form-label"></label>
                            <input asp-for="Username" class="form-control" />
                            <span asp-validation-for="Username" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="PhoneNumber" class="form-label"></label>
                            <input asp-for="PhoneNumber" class="form-control" placeholder="09123456789" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="FirstName" class="form-label"></label>
                            <input asp-for="FirstName" class="form-control" />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="LastName" class="form-label"></label>
                            <input asp-for="LastName" class="form-control" />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <!-- اطلاعات احراز هویت -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">اطلاعات احراز هویت</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ActiveDirectoryId" class="form-label"></label>
                            <input asp-for="ActiveDirectoryId" class="form-control" />
                            <span asp-validation-for="ActiveDirectoryId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ErpUserId" class="form-label"></label>
                            <input asp-for="ErpUserId" class="form-control" />
                            <span asp-validation-for="ErpUserId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="SmsCredit" class="form-label"></label>
                            <input asp-for="SmsCredit" type="number" class="form-control" />
                            <span asp-validation-for="SmsCredit" class="text-danger"></span>
                        </div>

                        <!-- دسترسی‌ها -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">دسترسی‌ها و مجوزها</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                <label asp-for="IsActive" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateGroup" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateGroup" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateChannel" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateChannel" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVoiceCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVoiceCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVideoCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVideoCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <!-- دکمه‌ها -->
                        <div class="col-md-12 mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> ذخیره
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> انصراف
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- راهنما -->
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> راهنما</h5>
            </div>
            <div class="card-body">
                <h6>نکات مهم:</h6>
                <ul class="small">
                    <li>نام کاربری باید یکتا باشد</li>
                    <li>شماره موبایل برای احراز هویت پیامکی استفاده می‌شود</li>
                    <li>شناسه AD برای احراز هویت Active Directory</li>
                    <li>شناسه ERP برای احراز هویت سیستم ERP</li>
                    <li>اعتبار پیامک برای ارسال کد تایید به کاربر</li>
                </ul>

                <h6 class="mt-3">دسترسی‌ها:</h6>
                <ul class="small">
                    <li><strong>ایجاد گروه:</strong> کاربر می‌تواند گروه جدید ایجاد کند</li>
                    <li><strong>ایجاد کانال:</strong> کاربر می‌تواند کانال جدید ایجاد کند</li>
                    <li><strong>تماس صوتی:</strong> کاربر می‌تواند تماس صوتی برقرار کند</li>
                    <li><strong>تماس تصویری:</strong> کاربر می‌تواند تماس تصویری برقرار کند</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
 
 
==================== Details.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
﻿@{
    ViewData["Title"] = "جزئیات کاربر";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    // Helper برای تبدیل تاریخ میلادی به شمسی
    string ToPersianDate(DateTime? date)
    {
        if (date == null) return "---";
        var persianCalendar = new System.Globalization.PersianCalendar();
        return $"{persianCalendar.GetYear(date.Value)}/{persianCalendar.GetMonth(date.Value):00}/{persianCalendar.GetDayOfMonth(date.Value):00}";
    }

    string ToPersianDateTime(DateTime? date)
    {
        if (date == null) return "---";
        var persianCalendar = new System.Globalization.PersianCalendar();
        return $"{persianCalendar.GetYear(date.Value)}/{persianCalendar.GetMonth(date.Value):00}/{persianCalendar.GetDayOfMonth(date.Value):00} {date.Value:HH:mm}";
    }
}

<div class="page-header">
    <h2>جزئیات کاربر</h2>
    <div class="actions">
        <a href="@Url.Action("Edit", new { id = Model.Id })" class="btn btn-primary">ویرایش</a>
        <a href="@Url.Action("Index")" class="btn btn-secondary">بازگشت به لیست</a>
    </div>
</div>

<div class="details-container">
    <div class="detail-card">
        <h3>اطلاعات پایه</h3>
        <div class="detail-row">
            <span class="label">نام کاربری:</span>
            <span class="value">@Model.Username</span>
        </div>
        <div class="detail-row">
            <span class="label">نام و نام خانوادگی:</span>
            <span class="value">@Model.FirstName @Model.LastName</span>
        </div>
        <div class="detail-row">
            <span class="label">ایمیل:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.Email) ? "---" : Model.Email)</span>
        </div>
        <div class="detail-row">
            <span class="label">شماره تلفن:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.PhoneNumber) ? "---" : Model.PhoneNumber)</span>
        </div>
        <div class="detail-row">
            <span class="label">وضعیت:</span>
            <span class="badge @(Model.IsActive ? "badge-active" : "badge-inactive")">
                @(Model.IsActive ? "فعال" : "غیرفعال")
            </span>
        </div>
    </div>

    <div class="detail-card">
        <h3>احراز هویت</h3>
        <div class="detail-row">
            <span class="label">Active Directory ID:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.ActiveDirectoryId) ? "---" : Model.ActiveDirectoryId)</span>
        </div>
        <div class="detail-row">
            <span class="label">ERP User ID:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.ErpUserId) ? "---" : Model.ErpUserId)</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>اعتبارات و مجوزها</h3>
        <div class="detail-row">
            <span class="label">اعتبار پیامک:</span>
            <span class="value">@Model.SmsCredit</span>
        </div>
        <div class="detail-row">
            <span class="label">مجوز ایجاد گروه:</span>
            <span class="badge @(Model.CanCreateGroup ? "badge-active" : "badge-inactive")">
                @(Model.CanCreateGroup ? "دارد" : "ندارد")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">مجوز ایجاد کانال:</span>
            <span class="badge @(Model.CanCreateChannel ? "badge-active" : "badge-inactive")">
                @(Model.CanCreateChannel ? "دارد" : "ندارد")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">مجوز تماس صوتی:</span>
            <span class="badge @(Model.CanMakeVoiceCall ? "badge-active" : "badge-inactive")">
                @(Model.CanMakeVoiceCall ? "دارد" : "ندارد")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">مجوز تماس تصویری:</span>
            <span class="badge @(Model.CanMakeVideoCall ? "badge-active" : "badge-inactive")">
                @(Model.CanMakeVideoCall ? "دارد" : "ندارد")
            </span>
        </div>
    </div>

    <div class="detail-card">
        <h3>فعالیت‌ها</h3>
        <div class="detail-row">
            <span class="label">تاریخ ثبت‌نام:</span>
            <span class="value">@ToPersianDateTime(Model.CreatedAt)</span>
        </div>
        <div class="detail-row">
            <span class="label">آخرین بازدید:</span>
            <span class="value">@ToPersianDateTime(Model.LastSeenAt)</span>
        </div>
        <div class="detail-row">
            <span class="label">تعداد پیام‌های ارسالی:</span>
            <span class="value">@ViewBag.MessageCount</span>
        </div>
        <div class="detail-row">
            <span class="label">تعداد تماس‌ها:</span>
            <span class="value">@ViewBag.CallCount</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>گروه‌های عضو (@Model.UserGroups.Count)</h3>
        @if (Model.UserGroups.Any())
        {
            <ul class="list-items">
                @foreach (var ug in Model.UserGroups)
                {
                    <li>
                        @ug.Group.Name
                        @if (ug.IsAdmin)
                        {
                            <span class="badge badge-admin">مدیر</span>
                        }
                        <span class="date">عضویت: @ToPersianDate(ug.JoinedAt)</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="no-data">عضو هیچ گروهی نیست</p>
        }
    </div>

    <div class="detail-card">
        <h3>کانال‌های عضو (@Model.UserChannels.Count)</h3>
        @if (Model.UserChannels.Any())
        {
            <ul class="list-items">
                @foreach (var uc in Model.UserChannels)
                {
                    <li>
                        @uc.Channel.Name
                        @if (uc.IsAdmin)
                        {
                            <span class="badge badge-admin">مدیر</span>
                        }
                        <span class="date">عضویت: @ToPersianDate(uc.JoinedAt)</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="no-data">عضو هیچ کانالی نیست</p>
        }
    </div>
</div>
 
 
==================== Edit.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
﻿@model OrganizationalMessenger.Web.Areas.Admin.Models.UserEditViewModel
@{
    ViewData["Title"] = "ویرایش کاربر";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mb-3">
    <div class="col-md-12">
        <h2>
            <i class="bi bi-pencil-square"></i> ویرایش کاربر
        </h2>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form asp-action="Edit" method="post">
                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Id" />

                    <div class="row">
                        <!-- اطلاعات پایه -->
                        <div class="col-md-12 mb-3">
                            <h5 class="border-bottom pb-2">اطلاعات پایه</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Username" class="form-label"></label>
                            <input asp-for="Username" class="form-control" />
                            <span asp-validation-for="Username" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="PhoneNumber" class="form-label"></label>
                            <input asp-for="PhoneNumber" class="form-control" placeholder="09123456789" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="FirstName" class="form-label"></label>
                            <input asp-for="FirstName" class="form-control" />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="LastName" class="form-label"></label>
                            <input asp-for="LastName" class="form-control" />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>

                        <!-- اطلاعات احراز هویت -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">اطلاعات احراز هویت</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ActiveDirectoryId" class="form-label"></label>
                            <input asp-for="ActiveDirectoryId" class="form-control" />
                            <span asp-validation-for="ActiveDirectoryId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ErpUserId" class="form-label"></label>
                            <input asp-for="ErpUserId" class="form-control" />
                            <span asp-validation-for="ErpUserId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="SmsCredit" class="form-label"></label>
                            <input asp-for="SmsCredit" type="number" class="form-control" />
                            <span asp-validation-for="SmsCredit" class="text-danger"></span>
                        </div>

                        <!-- دسترسی‌ها -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">دسترسی‌ها و مجوزها</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                <label asp-for="IsActive" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateGroup" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateGroup" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateChannel" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateChannel" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVoiceCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVoiceCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVideoCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVideoCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <!-- دکمه‌ها -->
                        <div class="col-md-12 mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> ذخیره تغییرات
                            </button>
                            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-info">
                                <i class="bi bi-eye"></i> مشاهده جزئیات
                            </a>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> انصراف
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- راهنما -->
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> راهنما</h5>
            </div>
            <div class="card-body">
                <h6>نکات ویرایش:</h6>
                <ul class="small">
                    <li>تغییر نام کاربری ممکن است بر روی سایر بخش‌های سیستم تأثیر بگذارد</li>
                    <li>در صورت تغییر شماره موبایل، کاربر باید مجدداً احراز هویت شود</li>
                    <li>غیرفعال کردن کاربر دسترسی او را به سیستم قطع می‌کند</li>
                </ul>

                <h6 class="mt-3">هشدارها:</h6>
                <div class="alert alert-warning small p-2">
                    <i class="bi bi-exclamation-triangle"></i>
                    حذف دسترسی‌های کاربر ممکن است باعث محدودیت در استفاده از سیستم شود.
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
﻿@model OrganizationalMessenger.Web.Areas.Admin.Models.UserListViewModel
@{
    ViewData["Title"] = "مدیریت کاربران";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mb-3">
    <div class="col-md-6">
        <h2>
            <i class="bi bi-people"></i> مدیریت کاربران
        </h2>
    </div>
    <div class="col-md-6 text-end">
        <a asp-action="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> افزودن کاربر جدید
        </a>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- فرم جستجو -->
<div class="card mb-3">
    <div class="card-body">
        <form method="get" asp-action="Index">
            <div class="row g-2">
                <div class="col-md-10">
                    <input type="text" name="search" value="@Model.SearchTerm"
                           class="form-control" placeholder="جستجو بر اساس نام، نام خانوادگی، نام کاربری یا شماره موبایل...">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> جستجو
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- جدول کاربران -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ردیف</th>
                        <th>نام کاربری</th>
                        <th>نام و نام خانوادگی</th>
                        <th>شماره موبایل</th>
                        <th>وضعیت</th>
                        <th>تاریخ ثبت</th>
                        <th>عملیات</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Users.Any())
                    {
                        int rowNum = (Model.CurrentPage - 1) * Model.PageSize + 1;
                        foreach (var user in Model.Users)
                        {
                            <tr>
                                <td>@rowNum</td>
                                <td>@user.Username</td>
                                <td>@user.FirstName @user.LastName</td>
                                <td>@(string.IsNullOrEmpty(user.PhoneNumber) ? "---" : user.PhoneNumber)</td>
                                <td>
                                    @if (user.IsActive)
                                    {
                                        <span class="badge bg-success">فعال</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">غیرفعال</span>
                                    }
                                </td>
                                <td>@user.CreatedAt.ToString("yyyy/MM/dd")</td>
                                <td>
                                   
                                    <a asp-action="Edit" asp-route-id="@user.Id"
                                       class="btn btn-sm btn-warning btn-action" title="ویرایش">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <button type="button" class="btn btn-sm btn-danger btn-action"
                                            onclick="confirmDelete(@user.Id, '@user.FirstName @user.LastName')" title="حذف">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-secondary btn-action"
                                            onclick="toggleStatus(@user.Id)" title="تغییر وضعیت">
                                        <i class="bi bi-toggle-on"></i>
                                    </button>
                                </td>
                            </tr>
                            rowNum++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7" class="text-center">کاربری یافت نشد</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- صفحه‌بندی -->
        @if (Model.TotalPages > 1)
        {
            <nav>
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link" asp-action="Index"
                           asp-route-page="@(Model.CurrentPage - 1)"
                           asp-route-search="@Model.SearchTerm">قبلی</a>
                    </li>

                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a class="page-link" asp-action="Index"
                               asp-route-page="@i"
                               asp-route-search="@Model.SearchTerm">@i</a>
                        </li>
                    }

                    <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                        <a class="page-link" asp-action="Index"
                           asp-route-page="@(Model.CurrentPage + 1)"
                           asp-route-search="@Model.SearchTerm">بعدی</a>
                    </li>
                </ul>
            </nav>

            <p class="text-center text-muted">
                نمایش @((Model.CurrentPage - 1) * Model.PageSize + 1) تا
                @(Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount)) از
                @Model.TotalCount کاربر
            </p>
        }
    </div>
</div>

<!-- فرم حذف (مخفی) -->
<form id="deleteForm" method="post" asp-action="Delete">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" id="deleteId" />
</form>

@section Scripts {
    <script>
        function confirmDelete(id, name) {
            if (confirm('آیا از حذف کاربر "' + name + '" اطمینان دارید؟')) {
                document.getElementById('deleteId').value = id;
                document.getElementById('deleteForm').submit();
            }
        }

        function toggleStatus(id) {
            if (confirm('آیا از تغییر وضعیت این کاربر اطمینان دارید؟')) {
                $.ajax({
                    url: '@Url.Action("ToggleStatus")',
                    type: 'POST',
                    data: {
                        id: id,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            location.reload();
                        }
                    }
                });
            }
        }
    </script>
}
 
 
==================== _ViewImports.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\ 
 
﻿@using OrganizationalMessenger.Web
@using OrganizationalMessenger.Web.Models
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
 
 
==================== _ViewStart.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\ 
 
﻿@{
    Layout = "_Layout";
}
 
 
==================== Login.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Account\ 
 
﻿<h2>ورود</h2>

@if (ViewBag.Error != null)
{
    <div class="alert alert-danger">@ViewBag.Error</div>
}

<form asp-action="Login" method="post">
    <div class="form-group mb-3">
        <label>نام کاربری</label>
        <input name="username" class="form-control" />
    </div>
    <div class="form-group mb-3">
        <label>رمز عبور</label>
        <input name="password" type="password" class="form-control" />
    </div>
    <button type="submit" class="btn btn-primary">ورود</button>
</form>

<div class="mt-4">
    <h6>👥 کاربران تست:</h6>
    <p>testuser1 → Test1234! (ادمین)</p>
    <p>testuser25 → Test1234!</p>
    <p>testuser100 → Test1234!</p>
</div>
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Chat\ 
 
﻿@{
    ViewData["Title"] = "چت سازمانی";
    Layout = null; // Fullscreen chat
}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"] - OrgChat</title>

    <!-- Bootstrap 5.3 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Custom Chat CSS -->
    <link href="~/css/chat.css" rel="stylesheet" />
    <style>
        html, body {
            height: 100%;
            margin: 0;
        }

        .h-100vh {
            height: 100vh !important;
        }

        .sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .chat-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }

        .status-sent {
            color: #999;
        }

        .status-delivered {
            color: #34c759;
        }

        .status-read {
            color: #007AFF;
        }

        .online-indicator {
            position: absolute;
            bottom: 4px;
            right: 4px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #f8f9fa;
        }

            .online-indicator.online {
                background: #34c759;
                animation: pulse 2s infinite;
            }

            .online-indicator.offline {
                background: #adb5bd;
            }
        @@keyframes pulse {
            0%

        {
            box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.8);
        }

        70% {
            box-shadow: 0 0 0 12px rgba(52, 199, 89, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(52, 199, 89, 0);
        }

        }
    </style>
</head>
<body class="bg-light">
    @Html.AntiForgeryToken()

    <div class="container-fluid h-100vh">
        <div class="row h-100">
            <!-- 🔥 Sidebar - کاربران + چت‌ها -->
            <div class="col-md-4 col-lg-3 border-end bg-white h-100 d-flex flex-column">
                <!-- Header -->
                <div class="sidebar-header p-4 border-bottom bg-white shadow-sm">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="user-info d-flex align-items-center flex-grow-1">
                            <div class="position-relative me-3">
                                <div class="avatar rounded-circle bg-gradient-primary text-white d-flex align-items-center justify-content-center fs-6 fw-bold"
                                     style="width: 50px; height: 50px;" id="currentUserAvatar">
                                    👤
                                </div>
                            </div>
                            <div>
                                <h6 class="mb-1 fw-bold" id="currentUserName">در حال بارگذاری...</h6>
                                <small class="text-muted" id="currentUserMobile">---</small>
                            </div>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                <i class="bi bi-three-dots-vertical"></i>
                            </button>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#"><i class="bi bi-person"></i> پروفایل</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-people"></i> مخاطبین</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="logout()"><i class="bi bi-box-arrow-right"></i> خروج</a></li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Search -->
                <div class="search-box p-3 border-bottom bg-light">
                    <div class="input-group input-group-sm">
                        <span class="input-group-text bg-white border-end-0">
                            <i class="bi bi-search text-muted"></i>
                        </span>
                        <input type="text" class="form-control border-start-0 ps-0" id="searchInput"
                               placeholder="جستجو در مخاطبین...">
                    </div>
                </div>

                <!-- 🔥 Tabs: Users | Chats -->
                <div class="d-flex border-bottom bg-light">
                    <button class="flex-fill py-2 border-0 bg-transparent tab-btn active" data-tab="users">
                        <i class="bi bi-people fs-5"></i><span class="ms-1 d-none d-md-inline">مخاطبین</span>
                    </button>
                    <button class="flex-fill py-2 border-0 bg-transparent tab-btn" data-tab="chats">
                        <i class="bi bi-chat-dots fs-5"></i><span class="ms-1 d-none d-md-inline">چت‌ها</span>
                    </button>
                </div>

                <!-- Users/Chats List -->
                <div class="flex-grow-1 overflow-hidden p-2">
                    <!-- Users Tab -->
                    <div id="usersTab" class="tab-content h-100 overflow-auto">
                        <div class="users-list" id="usersList">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-people fs-1 opacity-50 mb-3"></i>
                                <p>در حال بارگذاری مخاطبین...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Chats Tab -->
                    <div id="chatsTab" class="tab-content h-100 overflow-auto d-none">
                        <div class="chats-list" id="chatsList">
                            <div class="text-center text-muted py-5">
                                <i class="bi bi-chat-dots fs-1 opacity-50 mb-3"></i>
                                <p>چتی وجود ندارد</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 🔥 Chat Area - کامل -->
            <div class="col-md-8 col-lg-9 d-flex flex-column bg-white h-100">
                <!-- Empty State -->
                <div id="emptyChat" class="d-flex flex-column justify-content-center align-items-center flex-grow-1 text-muted bg-light">
                    <div class="empty-icon mb-4">
                        <i class="bi bi-chat-dots display-1 opacity-25"></i>
                    </div>
                    <h3 class="mb-2">به چت سازمانی خوش آمدید</h3>
                    <p class="mb-0 opacity-75">از لیست سمت راست یک کاربر یا چت را انتخاب کنید</p>
                </div>

                <!-- Chat Content -->
                <div id="chatContent" class="d-none flex-grow-1 flex-column bg-white">
                    <!-- Chat Header -->
                    <div class="chat-header border-bottom bg-white shadow-sm p-3">
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center flex-grow-1">
                                <div class="position-relative me-3">
                                    <div class="chat-user-avatar rounded-circle bg-gradient-success text-white d-flex align-items-center justify-content-center fs-6 fw-bold"
                                         style="width: 50px; height: 50px;" id="chatUserAvatar">
                                        👤
                                    </div>
                                    <div class="online-indicator online"></div>
                                </div>
                                <div class="user-info flex-grow-1 pe-3">
                                    <h6 class="mb-1 fw-bold me-2" id="chatUserName">نام کاربر</h6>
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="badge bg-success py-1 px-2 fs-2" id="chatUserStatus">آنلاین</span>
                                        <small class="text-muted" id="chatTypingStatus"></small>
                                    </div>
                                </div>
                            </div>
                            <div class="chat-actions gap-1">
                                <button class="btn btn-sm btn-outline-primary" title="تماس صوتی">
                                    <i class="bi bi-telephone"></i>
                                </button>
                                <button class="btn btn-sm btn-outline-primary" title="تماس تصویری">
                                    <i class="bi bi-camera-video"></i>
                                </button>
                                <div class="btn-group">
                                    <button class="btn btn-sm btn-outline-secondary dropdown-toggle" data-bs-toggle="dropdown">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end">
                                        <li><a class="dropdown-item" href="#"><i class="bi bi-search"></i> جستجو در چت</a></li>
                                        <li><a class="dropdown-item" href="#"><i class="bi bi-funnel"></i> پیام‌های خوانده نشده</a></li>
                                        <li><hr></li>
                                        <li><a class="dropdown-item" href="#"><i class="bi bi-bell"></i> اطلاع‌رسانی‌ها</a></li>
                                        <li><a class="dropdown-item" href="#"><i class="bi bi-shield-check"></i> حریم خصوصی</a></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Messages Container -->
                    <div class="messages-container flex-grow-1 p-4 position-relative" id="messagesContainer" style="overflow-y: auto; background: #f8f9fa;">
                        <!-- Messages loaded here -->
                    </div>

                    <!-- Typing Indicator -->
                    <div id="typingIndicator" class="p-3 border-top bg-white d-none">
                        <div class="d-flex align-items-center">
                            <div class="typing-dots me-2">
                                <span></span><span></span><span></span>
                            </div>
                            <small class="text-muted">کاربر در حال تایپ...</small>
                        </div>
                    </div>

                    <!-- 🔥 Input Area - کامل -->
                    <div class="input-area p-3 border-top bg-white shadow-sm">
                        <!-- Emoji Picker -->
                        <div class="emoji-picker position-absolute bottom-100 start-50 translate-middle-x mb-2 p-2 bg-white rounded-3 shadow-lg border d-none"
                             id="emojiPicker" style="z-index: 1060; min-width: 320px; max-height: 300px; overflow-y: auto;">
                            <div class="emoji-tabs mb-2 d-flex gap-1 flex-wrap">
                                <button class="emoji-tab btn btn-sm btn-outline-secondary active" data-category="recent">📝 اخیر</button>
                                <button class="emoji-tab btn btn-sm btn-outline-secondary" data-category="smileys">😊</button>
                                <button class="emoji-tab btn btn-sm btn-outline-secondary" data-category="people">🙌</button>
                                <button class="emoji-tab btn btn-sm btn-outline-secondary" data-category="nature">🌟</button>
                                <button class="emoji-tab btn btn-sm btn-outline-secondary" data-category="food">🍕</button>
                                <button class="emoji-tab btn btn-sm btn-outline-secondary" data-category="activities">⚽</button>
                            </div>
                            <div id="emojiPickerBody" class="emoji-grid">
                                <!-- Emojis loaded dynamically -->
                            </div>
                        </div>

                        <div class="input-container position-relative">
                            <button class="btn btn-outline-secondary position-absolute start-0 top-50 translate-middle-y me-2" id="attachBtn" title="پیوست">
                                <i class="bi bi-paperclip fs-5"></i>
                            </button>

                            <input type="text" class="form-control ps-5 pe-5" id="messageInput"
                                   placeholder="پیام خود را بنویسید..." disabled>

                            <button class="btn btn-outline-secondary position-absolute end-0 top-50 translate-middle-y ms-2" id="emojiBtn" title="ایموجی">
                                <i class="bi bi-emoji-smile fs-5"></i>
                            </button>

                            <button class="btn btn-primary position-absolute end-0 top-50 translate-middle-y ms-5 rounded-pill px-3" id="sendBtn" disabled>
                                <i class="bi bi-send-fill"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.0/signalr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    @section Scripts {
        <script src="~/js/chat.js"></script>
        <script src="~/js/emoji.js"></script>

        <script>
            // Global token
            window.__antiforgery = '@Html.AntiForgeryToken()'.replace(/input[^>]*>/, '').match(/value="([^"]+)"/)?.[1];
        </script>



    }
</body>
</html>
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Home\ 
 
﻿@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>
 
 
==================== Privacy.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Home\ 
 
﻿@{
    ViewData["Title"] = "Privacy Policy";
}
<h1>@ViewData["Title"]</h1>

<p>Use this page to detail your site's privacy policy.</p>
 
 
==================== Error.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
﻿@model ErrorViewModel
@{
    ViewData["Title"] = "Error";
}

<h1 class="text-danger">Error.</h1>
<h2 class="text-danger">An error occurred while processing your request.</h2>

@if (Model.ShowRequestId)
{
    <p>
        <strong>Request ID:</strong> <code>@Model.RequestId</code>
    </p>
}

<h3>Development Mode</h3>
<p>
    Swapping to <strong>Development</strong> environment will display more detailed information about the error that occurred.
</p>
<p>
    <strong>The Development environment shouldn't be enabled for deployed applications.</strong>
    It can result in displaying sensitive information from exceptions to end users.
    For local debugging, enable the <strong>Development</strong> environment by setting the <strong>ASPNETCORE_ENVIRONMENT</strong> environment variable to <strong>Development</strong>
    and restarting the app.
</p>
 
 
==================== _AdminLayout.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
﻿<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - پنل مدیریت پیام‌رسان سازمانی</title>

    <!-- Bootstrap RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />

    <!-- Vazirmatn Font -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />

    <!-- DataTables -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" rel="stylesheet" />

    <!-- Toastr -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #858796;
            --success-color: #1cc88a;
            --info-color: #36b9cc;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
            --sidebar-active: #1abc9c;
        }

        * {
            font-family: 'Vazirmatn', sans-serif !important;
        }

        body {
            background-color: #f8f9fc;
            overflow-x: hidden;
        }

        /* ==================== Sidebar ==================== */
        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #1e3a5f 0%, #152238 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

            .sidebar.collapsed {
                width: 70px;
            }

        /* Sidebar Brand (Logo) - Fixed at Top */
        .sidebar-brand {
            padding: 20px 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

            .sidebar-brand img {
                width: 50px;
                height: 50px;
                border-radius: 10px;
                margin-bottom: 10px;
            }

            .sidebar-brand h5 {
                color: #fff;
                margin: 0;
                font-size: 1rem;
                font-weight: 600;
            }

        /* Sidebar Menu - Scrollable */
        .sidebar-menu {
            list-style: none;
            padding: 15px 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

            .sidebar-menu::-webkit-scrollbar {
                width: 6px;
            }

            .sidebar-menu::-webkit-scrollbar-track {
                background: transparent;
            }

            .sidebar-menu::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 3px;
            }

                .sidebar-menu::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.5);
                }

        /* Menu Header */
        .menu-header {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            padding: 15px 20px 8px;
            letter-spacing: 0.5px;
        }

        .sidebar.collapsed .menu-header {
            display: none;
        }

        /* Menu Item */
        .menu-item {
            margin: 2px 10px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }

            .menu-link:hover {
                background: rgba(255, 255, 255, 0.1);
                color: #fff;
            }

            .menu-link.active {
                background: linear-gradient(90deg, #4e73df 0%, #224abe 100%);
                color: #fff;
                box-shadow: 0 2px 10px rgba(78, 115, 223, 0.4);
            }

            .menu-link i:first-child {
                width: 24px;
                text-align: center;
                margin-left: 12px;
                font-size: 1rem;
            }

        .menu-text {
            flex: 1;
            font-size: 0.9rem;
        }

        /* Menu Arrow */
        .menu-arrow {
            font-size: 0.7rem;
            transition: transform 0.2s ease;
        }

        .menu-item.open .menu-arrow {
            transform: rotate(-90deg);
        }

        /* Menu Badge */
        .menu-badge {
            background: #e74a3b;
            color: #fff;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }

        /* Submenu */
        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .menu-item.open .submenu {
            max-height: 500px;
        }

        .submenu-link {
            display: block;
            padding: 10px 15px 10px 50px;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            font-size: 0.85rem;
            border-radius: 6px;
            margin: 2px 0;
            transition: all 0.2s ease;
        }

            .submenu-link:hover {
                color: #fff;
                background: rgba(255, 255, 255, 0.05);
            }

            .submenu-link.active {
                color: #4e73df;
                background: rgba(78, 115, 223, 0.1);
            }

            .submenu-link::before {
                content: "●";
                font-size: 0.5rem;
                margin-left: 8px;
                opacity: 0.5;
            }

        /* Collapsed State */
        .sidebar.collapsed .sidebar-brand h5,
        .sidebar.collapsed .menu-text,
        .sidebar.collapsed .menu-arrow,
        .sidebar.collapsed .menu-badge {
            display: none;
        }

        .sidebar.collapsed .menu-link {
            justify-content: center;
            padding: 15px;
        }

            .sidebar.collapsed .menu-link i:first-child {
                margin: 0;
                font-size: 1.2rem;
            }

        .sidebar.collapsed .submenu {
            position: absolute;
            right: 70px;
            top: 0;
            background: #1e3a5f;
            min-width: 200px;
            border-radius: 8px;
            box-shadow: -5px 5px 15px rgba(0, 0, 0, 0.2);
            max-height: none;
            padding: 10px 0;
        }

        .sidebar.collapsed .submenu-link {
            padding: 10px 20px;
        }

            .sidebar.collapsed .submenu-link::before {
                display: none;
            }

        /* ==================== Main Content ==================== */
        .main-content {
            margin-right: 280px;
            min-height: 100vh;
            background: #f4f6f9;
            transition: margin-right 0.3s ease;
        }

        .sidebar.collapsed ~ .main-content {
            margin-right: 70px;
        }

        /* Top Navbar */
        .top-navbar {
            background: #fff;
            padding: 15px 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .navbar-search {
            position: relative;
            max-width: 400px;
        }

            .navbar-search input {
                padding-right: 2.5rem;
                border-radius: 20px;
                border: 1px solid #e3e6f0;
            }

            .navbar-search i {
                position: absolute;
                right: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: var(--secondary-color);
            }

        .navbar-icons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f8f9fc;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            color: var(--secondary-color);
            transition: all 0.2s ease;
        }

            .nav-icon-btn:hover {
                background: #eaecf4;
                color: var(--primary-color);
            }

            .nav-icon-btn .badge {
                position: absolute;
                top: -2px;
                left: -2px;
                font-size: 0.6rem;
                padding: 0.25rem 0.4rem;
            }

        .user-dropdown {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

            .user-dropdown:hover {
                background: #f8f9fc;
            }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: #3a3b45;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--secondary-color);
        }

        /* Page Content */
        .page-content {
            padding: 25px;
        }

        /* Sidebar Toggle */
        .toggle-sidebar-btn {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--secondary-color);
            cursor: pointer;
            padding: 0.5rem;
        }

        /* Responsive */
        @@media (max-width: 992px) {
            .sidebar

        {
            right: -280px;
        }

        .sidebar.show {
            right: 0;
        }

        .main-content {
            margin-right: 0;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

            .sidebar-overlay.show {
                display: block;
            }

        }

        /* Animation */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @@keyframes fadeIn {
            from

        {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }

        }
    </style>


    @RenderSection("Styles", required: false)
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        @await Html.PartialAsync("_SidebarMenu")
    </aside>

    <!-- Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        @await Html.PartialAsync("_TopNavbar")

        <!-- Page Content -->
        <main class="page-content fade-in">
            @RenderBody()
        </main>

        <!-- Footer -->
        <footer class="text-center py-3 text-muted" style="font-size: 0.85rem;">
            <span>© @DateTime.Now.Year پیام‌رسان سازمانی | نسخه 1.0.0</span>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Toastr Settings
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-left",
            "timeOut": "3000",
            "rtl": true
        };

        // Toggle Sidebar
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });

        // Mobile Sidebar Toggle
        document.getElementById('mobileSidebarToggle')?.addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('show');
        });

        document.getElementById('sidebarOverlay').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('show');
        });

        // Submenu Toggle
        document.querySelectorAll('.has-submenu > .menu-link').forEach(function(link) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                this.closest('.menu-item').classList.toggle('open');
            });
        });

        // DataTables Default Settings
        $.extend(true, $.fn.dataTable.defaults, {
            language: {
                "emptyTable": "داده‌ای برای نمایش وجود ندارد",
                "info": "نمایش _START_ تا _END_ از _TOTAL_ ردیف",
                "infoEmpty": "نمایش 0 تا 0 از 0 ردیف",
                "infoFiltered": "(فیلتر شده از _MAX_ ردیف)",
                "lengthMenu": "نمایش _MENU_ ردیف",
                "loadingRecords": "در حال بارگذاری...",
                "processing": "در حال پردازش...",
                "search": "جستجو:",
                "zeroRecords": "نتیجه‌ای یافت نشد",
                "paginate": {
                    "first": "اول",
                    "last": "آخر",
                    "next": "بعدی",
                    "previous": "قبلی"
                }
            },
            pageLength: 10,
            responsive: true
        });

        // Select2 Default
        $.fn.select2.defaults.set("theme", "bootstrap-5");
        $.fn.select2.defaults.set("dir", "rtl");
        $.fn.select2.defaults.set("language", "fa");

        // SweetAlert2 Default
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
        });

        // Delete Confirmation
        function confirmDelete(url, itemName) {
            Swal.fire({
                title: 'آیا مطمئن هستید؟',
                text: `${itemName} حذف خواهد شد!`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#e74a3b',
                cancelButtonColor: '#858796',
                confirmButtonText: 'بله، حذف شود',
                cancelButtonText: 'انصراف'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url;
                }
            });
        }

        // Show Success Message from TempData
        @if (TempData["Success"] != null)
        {
                <text>toastr.success('@TempData["Success"]');</text>
        }

        @if (TempData["Error"] != null)
        {
                <text>toastr.error('@TempData["Error"]');</text>
        }
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
 
 
==================== _Layout.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
﻿<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - OrganizationalMessenger.Web</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/OrganizationalMessenger.Web.styles.css" asp-append-version="true" />
    <!-- SignalR Client -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.0/signalr.min.js"></script>

</head>
<body>
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">
            <div class="container-fluid">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">OrganizationalMessenger.Web</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">
                    <ul class="navbar-nav flex-grow-1">
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <footer class="border-top footer text-muted">
        <div class="container">
            &copy; 1404 - OrganizationalMessenger.Web - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
 
 
==================== _SidebarMenu.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
﻿@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString()?.ToLower();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString()?.ToLower();
}

<!-- Brand -->
<div class="sidebar-brand">
    @* <img src="~/images/logo.png" alt="Logo" onerror="this.src='https://via.placeholder.com/50/4e73df/ffffff?text=OM'" /> *@
    <h5>پیام‌رسان سازمانی</h5>
</div>

<!-- Menu -->
<ul class="sidebar-menu">

    <!-- Dashboard -->
    <li class="menu-item">
        <a href="@Url.Action("Index", "Dashboard")" class="menu-link @(currentController == "dashboard" ? "active" : "")">
            <i class="fas fa-tachometer-alt"></i>
            <span class="menu-text">داشبورد</span>
        </a>
    </li>

    <!-- User Management -->
    <li class="menu-header">مدیریت کاربران</li>

    <li class="menu-item has-submenu @(currentController == "users" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "users" ? "active" : "")">
            <i class="fas fa-users"></i>
            <span class="menu-text">کاربران</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Users")" class="submenu-link @(currentController == "users" && currentAction == "index" ? "active" : "")">
                    لیست کاربران
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Users")" class="submenu-link @(currentController == "users" && currentAction == "create" ? "active" : "")">
                    افزودن کاربر
                </a>
            </li>
            <li>
                <a href="@Url.Action("Permissions", "Users")" class="submenu-link @(currentController == "users" && currentAction == "permissions" ? "active" : "")">
                    مجوزها
                </a>
            </li>
            <li>
                <a href="@Url.Action("SmsCredits", "Users")" class="submenu-link @(currentController == "users" && currentAction == "smscredits" ? "active" : "")">
                    اعتبار پیامک
                </a>
            </li>
        </ul>
    </li>

    <!-- Groups -->
    <li class="menu-item has-submenu @(currentController == "groups" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "groups" ? "active" : "")">
            <i class="fas fa-user-friends"></i>
            <span class="menu-text">گروه‌ها</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Groups")" class="submenu-link @(currentController == "groups" && currentAction == "index" ? "active" : "")">
                    لیست گروه‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Groups")" class="submenu-link @(currentController == "groups" && currentAction == "create" ? "active" : "")">
                    ایجاد گروه
                </a>
            </li>
        </ul>
    </li>

    <!-- Channels -->
    <li class="menu-item has-submenu @(currentController == "channels" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "channels" ? "active" : "")">
            <i class="fas fa-broadcast-tower"></i>
            <span class="menu-text">کانال‌ها</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Channels")" class="submenu-link @(currentController == "channels" && currentAction == "index" ? "active" : "")">
                    لیست کانال‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Channels")" class="submenu-link @(currentController == "channels" && currentAction == "create" ? "active" : "")">
                    ایجاد کانال
                </a>
            </li>
        </ul>
    </li>

    <!-- Messages -->
    <li class="menu-header">پیام‌ها و محتوا</li>

    <li class="menu-item has-submenu @(currentController == "messages" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "messages" ? "active" : "")">
            <i class="fas fa-comments"></i>
            <span class="menu-text">پیام‌ها</span>
            <span class="menu-badge" id="reportsBadge">0</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Messages")" class="submenu-link @(currentController == "messages" && currentAction == "index" ? "active" : "")">
                    تمام پیام‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("Reports", "Messages")" class="submenu-link @(currentController == "messages" && currentAction == "reports" ? "active" : "")">
                    گزارشات پیام
                </a>
            </li>
            <li>
                <a href="@Url.Action("ForbiddenWords", "Messages")" class="submenu-link @(currentController == "messages" && currentAction == "forbiddenwords" ? "active" : "")">
                    کلمات ممنوعه
                </a>
            </li>
        </ul>
    </li>

    <!-- Polls -->
    <li class="menu-item">
        <a href="@Url.Action("Index", "Polls")" class="menu-link @(currentController == "polls" ? "active" : "")">
            <i class="fas fa-poll"></i>
            <span class="menu-text">نظرسنجی‌ها</span>
        </a>
    </li>

    <!-- Calls -->
    <li class="menu-item">
        <a href="@Url.Action("Index", "Calls")" class="menu-link @(currentController == "calls" ? "active" : "")">
            <i class="fas fa-phone-alt"></i>
            <span class="menu-text">تماس‌ها</span>
        </a>
    </li>

    <!-- Notifications -->
    <li class="menu-header">اعلان‌ها</li>

    <li class="menu-item has-submenu @(currentController == "notifications" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "notifications" ? "active" : "")">
            <i class="fas fa-bell"></i>
            <span class="menu-text">اعلان‌ها</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Notifications")" class="submenu-link @(currentController == "notifications" && currentAction == "index" ? "active" : "")">
                    لیست اعلان‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Notifications")" class="submenu-link @(currentController == "notifications" && currentAction == "create" ? "active" : "")">
                    ارسال اعلان
                </a>
            </li>
            <li>
                <a href="@Url.Action("SystemAlerts", "Notifications")" class="submenu-link @(currentController == "notifications" && currentAction == "systemalerts" ? "active" : "")">
                    هشدارهای سیستم
                </a>
            </li>
        </ul>
    </li>

    <!-- Reports & Analytics -->
    <li class="menu-header">گزارشات</li>

    <li class="menu-item has-submenu @(currentController == "reports" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "reports" ? "active" : "")">
            <i class="fas fa-chart-bar"></i>
            <span class="menu-text">گزارشات</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "index" ? "active" : "")">
                    داشبورد گزارشات
                </a>
            </li>
            <li>
                <a href="@Url.Action("UserActivity", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "useractivity" ? "active" : "")">
                    فعالیت کاربران
                </a>
            </li>
            <li>
                <a href="@Url.Action("MessageStats", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "messagestats" ? "active" : "")">
                    آمار پیام‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("CallLogs", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "calllogs" ? "active" : "")">
                    لاگ تماس‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("LoginHistory", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "loginhistory" ? "active" : "")">
                    تاریخچه ورود
                </a>
            </li>
        </ul>
    </li>

    <!-- Settings -->
    <li class="menu-header">تنظیمات</li>

    <li class="menu-item has-submenu @(currentController == "settings" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "settings" ? "active" : "")">
            <i class="fas fa-cogs"></i>
            <span class="menu-text">تنظیمات</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "index" ? "active" : "")">
                    تنظیمات عمومی
                </a>
            </li>
            <li>
                <a href="@Url.Action("Authentication", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "authentication" ? "active" : "")">
                    احراز هویت
                </a>
            </li>
            <li>
                <a href="@Url.Action("VoIP", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "voip" ? "active" : "")">
                    تنظیمات VoIP
                </a>
            </li>
            <li>
                <a href="@Url.Action("FileUpload", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "fileupload" ? "active" : "")">
                    آپلود فایل
                </a>
            </li>
            <li>
                <a href="@Url.Action("MessageSettings", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "messagesettings" ? "active" : "")">
                    تنظیمات پیام
                </a>
            </li>
            <li>
                <a href="@Url.Action("ServiceLinks", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "servicelinks" ? "active" : "")">
                    لینک سرویس‌ها
                </a>
            </li>
            <li>
                <a href="@Url.Action("Telegram", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "telegram" ? "active" : "")">
                    تنظیمات تلگرام
                </a>
            </li>
            <li>
                <a href="@Url.Action("Sms", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "sms" ? "active" : "")">
                    تنظیمات پیامک
                </a>
            </li>
        </ul>
    </li>

    <!-- Admin Users -->
    <li class="menu-item has-submenu @(currentController == "adminusers" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "adminusers" ? "active" : "")">
            <i class="fas fa-user-shield"></i>
            <span class="menu-text">مدیران سیستم</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "AdminUsers")" class="submenu-link @(currentController == "adminusers" && currentAction == "index" ? "active" : "")">
                    لیست مدیران
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "AdminUsers")" class="submenu-link @(currentController == "adminusers" && currentAction == "create" ? "active" : "")">
                    افزودن مدیر
                </a>
            </li>
        </ul>
    </li>

</ul>
 
 
==================== _TopNavbar.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
﻿@{
    var adminName = Context.Session.GetString("AdminName") ?? "مدیر سیستم";
    var adminRole = Context.Session.GetString("IsSuperAdmin") == "True" ? "مدیر ارشد" : "مدیر";
}

<nav class="top-navbar">
    <div class="d-flex align-items-center gap-3">
        <!-- Sidebar Toggle -->
        <button class="toggle-sidebar-btn d-none d-lg-block" id="toggleSidebar">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Mobile Toggle -->
        <button class="toggle-sidebar-btn d-lg-none" id="mobileSidebarToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Search -->
        <div class="navbar-search d-none d-md-block">
            <i class="fas fa-search"></i>
            <input type="text" class="form-control" placeholder="جستجو..." id="globalSearch" />
        </div>
    </div>

    <div class="navbar-icons">
        <!-- Refresh -->
        <button class="nav-icon-btn" title="بروزرسانی" onclick="location.reload()">
            <i class="fas fa-sync-alt"></i>
        </button>

        <!-- Notifications -->
        <div class="dropdown">
            <button class="nav-icon-btn" data-bs-toggle="dropdown" title="اعلان‌ها">
                <i class="fas fa-bell"></i>
                <span class="badge bg-danger" id="notificationCount">3</span>
            </button>
            <div class="dropdown-menu dropdown-menu-start p-0" style="min-width: 320px;">
                <div class="p-3 border-bottom bg-light">
                    <strong>اعلان‌ها</strong>
                </div>
                <div class="notification-list" style="max-height: 300px; overflow-y: auto;">
                    <a href="#" class="dropdown-item d-flex align-items-start py-2">
                        <div class="me-3">
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-user-plus"></i>
                            </div>
                        </div>
                        <div>
                            <div class="small text-gray-500">12:00</div>
                            <span>کاربر جدید ثبت‌نام کرد</span>
                        </div>
                    </a>
                    <a href="#" class="dropdown-item d-flex align-items-start py-2">
                        <div class="me-3">
                            <div class="rounded-circle bg-warning text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div>
                            <div class="small text-gray-500">11:30</div>
                            <span>گزارش پیام جدید</span>
                        </div>
                    </a>
                    <a href="#" class="dropdown-item d-flex align-items-start py-2">
                        <div class="me-3">
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                        <div>
                            <div class="small text-gray-500">10:00</div>
                            <span>پشتیبان‌گیری کامل شد</span>
                        </div>
                    </a>
                </div>
                <a href="@Url.Action("Index", "Notifications")" class="dropdown-item text-center py-2 border-top">
                    مشاهده همه
                </a>
            </div>
        </div>

        <!-- Messages -->
        <div class="dropdown">
            <button class="nav-icon-btn" data-bs-toggle="dropdown" title="پیام‌ها">
                <i class="fas fa-envelope"></i>
                <span class="badge bg-warning" id="messageCount">5</span>
            </button>
            <div class="dropdown-menu dropdown-menu-start p-0" style="min-width: 320px;">
                <div class="p-3 border-bottom bg-light">
                    <strong>پیام‌های گزارش شده</strong>
                </div>
                <div class="message-list" style="max-height: 300px; overflow-y: auto;">
                    <a href="#" class="dropdown-item py-2">
                        <div class="d-flex justify-content-between">
                            <span class="fw-bold">علی محمدی</span>
                            <small class="text-muted">10 دقیقه پیش</small>
                        </div>
                        <div class="small text-truncate">محتوای نامناسب گزارش شده...</div>
                    </a>
                </div>
                <a href="@Url.Action("Reports", "Messages")" class="dropdown-item text-center py-2 border-top">
                    مشاهده همه
                </a>
            </div>
        </div>

        <!-- User Menu -->
        <div class="dropdown">
            <div class="user-dropdown" data-bs-toggle="dropdown">
                <img src="https://via.placeholder.com/42/4e73df/ffffff?text=A" alt="Avatar" class="user-avatar" />
                <div class="user-info d-none d-md-block">
                    <div class="user-name">@adminName</div>
                    <div class="user-role">@adminRole</div>
                </div>
                <i class="fas fa-chevron-down text-muted d-none d-md-block"></i>
            </div>
            <ul class="dropdown-menu dropdown-menu-start">
                <li>
                    <a class="dropdown-item" href="@Url.Action("Profile", "Account")">
                        <i class="fas fa-user fa-fw me-2"></i> پروفایل
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="@Url.Action("Index", "Settings")">
                        <i class="fas fa-cog fa-fw me-2"></i> تنظیمات
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="@Url.Action("LoginHistory", "Reports")">
                        <i class="fas fa-history fa-fw me-2"></i> تاریخچه ورود
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item text-danger" href="@Url.Action("Logout", "Account")">
                        <i class="fas fa-sign-out-alt fa-fw me-2"></i> خروج
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
 
 
==================== _ValidationScriptsPartial.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
﻿<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
 
 
Total Files: 128 
