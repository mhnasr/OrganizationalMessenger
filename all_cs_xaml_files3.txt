
==================== SettingsController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
ï»¿// Areas/Admin/Controllers/SettingsController.cs - Ù†Ø³Ø®Ù‡ FINAL Ø¨Ø¯ÙˆÙ† ViewModel
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Areas.Admin.Models;
using System.Text.Json;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    [Area("Admin")]
    public class SettingsController : Controller
    {
        private readonly ApplicationDbContext _context;

        public SettingsController(ApplicationDbContext context)
        {
            _context = context;
        }

        private async Task<string?> GetSettingValueAsync(string key)
        {
            var setting = await _context.SystemSettings.FirstOrDefaultAsync(s => s.Key == key);
            return setting?.Value;
        }

        private async Task SaveSettingAsync(string key, string? value)
        {
            var setting = await _context.SystemSettings.FirstOrDefaultAsync(s => s.Key == key);
            if (setting == null)
            {
                _context.SystemSettings.Add(new SystemSetting { Key = key, Value = value ?? "", UpdatedAt = DateTime.Now });
            }
            else
            {
                setting.Value = value ?? "";
                setting.UpdatedAt = DateTime.Now;
            }
            await _context.SaveChangesAsync();
        }

        public async Task<IActionResult> Index()
        {
            var settings = await _context.SystemSettings.ToListAsync();

            ViewBag.TotalSettings = settings.Count;

            // âœ… Safe DateTime
            var lastUpdated = await _context.SystemSettings
                .MaxAsync(s => (DateTime?)s.UpdatedAt) ?? DateTime.Now;
            ViewBag.LastUpdated = lastUpdated; // âœ… non-null

            return View(settings);
        }


        #region General


        [HttpGet]
        public async Task<IActionResult> General()
        {
            ViewBag.OrganizationName = await GetSettingValueAsync("CompanyName") ?? "Ø³Ø§Ø²Ù…Ø§Ù†";
            ViewBag.LogoUrl = await GetSettingValueAsync("CompanyLogoUrl");

            // âœ… Ø¯Ù‚ÛŒÙ‚Ø§Ù‹ "true" Ú†Ú© Ú©Ù†ÛŒØ¯ (Ù†Ù‡ ÙÙ‚Ø· true)
            var groupSetting = await GetSettingValueAsync("AllowUserGroupCreation");
            ViewBag.AllowUserGroupCreation = groupSetting == "true";

            var channelSetting = await GetSettingValueAsync("AllowUserChannelCreation");
            ViewBag.AllowUserChannelCreation = channelSetting == "true";

            ViewBag.MaxGroupMembers = await GetSettingValueAsync("MaxGroupMembers") ?? "200";

            return View();
        }




        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> General(string organizationName, IFormFile? logoFile,
     bool allowUserGroupCreation, bool allowUserChannelCreation, int maxGroupMembers)
        {
            try
            {
                // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù†
                await SaveSettingAsync("CompanyName", organizationName);
                await SaveSettingAsync("AllowUserGroupCreation", allowUserGroupCreation.ToString().ToLower());
                await SaveSettingAsync("AllowUserChannelCreation", allowUserChannelCreation.ToString().ToLower());
                await SaveSettingAsync("MaxGroupMembers", maxGroupMembers.ToString());

                // Ø¢Ù¾Ù„ÙˆØ¯ Ù„ÙˆÚ¯Ùˆ
                if (logoFile != null && logoFile.Length > 0)
                {
                    var uploadsPath = Path.Combine(Directory.GetCurrentDirectory(), "wwwroot", "uploads", "logos");
                    Directory.CreateDirectory(uploadsPath);

                    var fileName = $"{Guid.NewGuid()}{Path.GetExtension(logoFile.FileName)}";
                    var filePath = Path.Combine(uploadsPath, fileName);

                    using (var stream = new FileStream(filePath, FileMode.Create))
                    {
                        await logoFile.CopyToAsync(stream);
                    }

                    await SaveSettingAsync("CompanyLogoUrl", $"/uploads/logos/{fileName}");
                }

                TempData["Success"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: " + ex.Message;
            }
            return RedirectToAction(nameof(General));
        }



        #endregion

        #region Authentication
        [HttpGet]
        public async Task<IActionResult> Authentication()
        {
            ViewBag.AuthenticationType = await GetSettingValueAsync("AuthenticationType") ?? "Database";
            ViewBag.AdServer = await GetSettingValueAsync("AdServer") ?? "";
            ViewBag.AdDomain = await GetSettingValueAsync("AdDomain") ?? "";
            ViewBag.ErpApiUrl = await GetSettingValueAsync("ErpApiUrl") ?? "";
            ViewBag.OtpExpiryMinutes = await GetSettingValueAsync("OtpExpiryMinutes") ?? "5";
            ViewBag.OtpEnabled = await GetSettingValueAsync("OtpEnabled") == "true";

            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> Authentication(
            string authenticationType, string adServer, string adDomain, string erpApiUrl,
            bool otpEnabled, int otpExpiryMinutes)
        {
            // ğŸ”¥ DEBUG - Ø¯Ø± Output Window Ø¨Ø¨ÛŒÙ†ÛŒØ¯
            System.Diagnostics.Debug.WriteLine($"DEBUG: Type={authenticationType}, OTP={otpEnabled}");

            await SaveSettingAsync("AuthenticationType", authenticationType);
            await SaveSettingAsync("AdServer", adServer);
            await SaveSettingAsync("AdDomain", adDomain);
            await SaveSettingAsync("ErpApiUrl", erpApiUrl);
            await SaveSettingAsync("OtpEnabled", otpEnabled.ToString().ToLower());
            await SaveSettingAsync("OtpExpiryMinutes", otpExpiryMinutes.ToString());

            TempData["Success"] = $"Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯: {authenticationType}, OTP={otpEnabled}";
            return RedirectToAction(nameof(Authentication));
        }


        #endregion

        #region FileUpload
        public async Task<IActionResult> FileUpload()
        {
            var settings = await _context.FileUploadSettings.ToListAsync();
            return View(settings);
        }

        // âœ… UPDATE (Ø§ØµÙ„Ø§Ø­ Ù…ÙˆØ¬ÙˆØ¯)
        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> UpdateFileType(int id, long maxSize, bool isAllowed)
        {
            var setting = await _context.FileUploadSettings.FindAsync(id);
            if (setting != null)
            {
                setting.MaxSize = maxSize;
                setting.IsAllowed = isAllowed;
                await _context.SaveChangesAsync();
                TempData["Success"] = "ÙØ§ÛŒÙ„ Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯";
            }
            return RedirectToAction(nameof(FileUpload));
        }

        // âœ… CREATE (Ø§Ø¶Ø§ÙÙ‡ Ø¬Ø¯ÛŒØ¯)
        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> AddFileType(string fileType, string category, long maxSize, bool isAllowed)
        {
            if (!string.IsNullOrEmpty(fileType))
            {
                // Ú†Ú© ØªÚ©Ø±Ø§Ø±ÛŒ
                var exists = await _context.FileUploadSettings.AnyAsync(x => x.FileType == fileType);
                if (!exists)
                {
                    _context.FileUploadSettings.Add(new FileUploadSetting
                    {
                        FileType = fileType.ToLower(),
                        Category = category,
                        MaxSize = maxSize,
                        IsAllowed = isAllowed
                    });
                    await _context.SaveChangesAsync();
                    TempData["Success"] = "ÙØ§ÛŒÙ„ Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯";
                }
                else
                {
                    TempData["Error"] = "Ø§ÛŒÙ† Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯";
                }
            }
            return RedirectToAction(nameof(FileUpload));
        }

        // âœ… DELETE
        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteFileType(int id)
        {
            var setting = await _context.FileUploadSettings.FindAsync(id);
            if (setting != null)
            {
                _context.FileUploadSettings.Remove(setting);
                await _context.SaveChangesAsync();
                TempData["Success"] = "ÙØ§ÛŒÙ„ Ø­Ø°Ù Ø´Ø¯";
            }
            return RedirectToAction(nameof(FileUpload));
        }
        #endregion


        #region VoIP

        [HttpGet]
        public async Task<IActionResult> VoIP()
        {
            ViewBag.VoipEnabled = await GetSettingValueAsync("VoipEnabled") == "true";
            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> VoIP(bool voipEnabled)
        {
            // ğŸ”¥ DEBUG
            System.Diagnostics.Debug.WriteLine($"ğŸ”¥ VoIP Debug: {voipEnabled}");

            await SaveSettingAsync("VoipEnabled", voipEnabled.ToString().ToLower());

            // âœ… TempData["Success"] (Ù†Ù‡ SuccessMessage)
            TempData["Success"] = $"VoIP {(voipEnabled ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")} Ø´Ø¯";
            return RedirectToAction(nameof(VoIP));
        }


        #endregion

        #region Telegram
        [HttpGet]
        public async Task<IActionResult> Telegram()
        {
            ViewBag.TelegramEnabled = await GetSettingValueAsync("TelegramIntegrationEnabled") == "true";
            ViewBag.BotToken = await GetSettingValueAsync("TelegramBotToken") ?? "";
            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> Telegram(bool telegramEnabled, string? botToken)
        {
            // ğŸ”¥ DEBUG
            System.Diagnostics.Debug.WriteLine($"ğŸ”¥ Telegram Debug: Enabled={telegramEnabled}, Token={botToken?.Substring(0, 10)}...");

            await SaveSettingAsync("TelegramIntegrationEnabled", telegramEnabled.ToString().ToLower());
            await SaveSettingAsync("TelegramBotToken", botToken);

            TempData["Success"] = $"ØªÙ„Ú¯Ø±Ø§Ù… {(telegramEnabled ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")} Ø´Ø¯";
            return RedirectToAction(nameof(Telegram));
        }
        #endregion



        #region message
        [HttpGet]
        public async Task<IActionResult> MessageSettings()
        {
            ViewBag.MessageEditTimeLimit = await GetSettingValueAsync("MessageEditTimeLimit") ?? "3600";
            ViewBag.MessageDeleteTimeLimit = await GetSettingValueAsync("MessageDeleteTimeLimit") ?? "7200";
            ViewBag.AllowMessageEdit = await GetSettingValueAsync("AllowMessageEdit") == "true";
            ViewBag.AllowMessageDelete = await GetSettingValueAsync("AllowMessageDelete") == "true";

            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> MessageSettings(
            int messageEditTimeLimit, int messageDeleteTimeLimit,
            bool allowMessageEdit, bool allowMessageDelete)
        {
            // ğŸ”¥ DEBUG
            System.Diagnostics.Debug.WriteLine($"EditTime={messageEditTimeLimit}, Edit={allowMessageEdit}");

            await SaveSettingAsync("MessageEditTimeLimit", messageEditTimeLimit.ToString());
            await SaveSettingAsync("MessageDeleteTimeLimit", messageDeleteTimeLimit.ToString());
            await SaveSettingAsync("AllowMessageEdit", allowMessageEdit.ToString().ToLower());
            await SaveSettingAsync("AllowMessageDelete", allowMessageDelete.ToString().ToLower());

            TempData["Success"] = $"Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯: ÙˆÛŒØ±Ø§ÛŒØ´={allowMessageEdit}, Ø­Ø°Ù={allowMessageDelete}";
            return RedirectToAction(nameof(MessageSettings));
        }



        #endregion

        #region ForbiddenWords
        public async Task<IActionResult> ForbiddenWords()
        {
            var words = await _context.ForbiddenWords.ToListAsync();
            return View(words);
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> AddForbiddenWord(string newWord)
        {
            try
            {
                if (!string.IsNullOrWhiteSpace(newWord))
                {
                    // âœ… Ú†Ú© ØªÚ©Ø±Ø§Ø±ÛŒ Ù‚Ø¨Ù„ Ø§Ø² Add
                    var trimmedWord = newWord.Trim().ToLower();
                    var exists = await _context.ForbiddenWords.AnyAsync(w => w.Word.ToLower() == trimmedWord);

                    if (exists)
                    {
                        TempData["Error"] = $"Ú©Ù„Ù…Ù‡ '{newWord.Trim()}' Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯";
                        return RedirectToAction(nameof(ForbiddenWords));
                    }

                    // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù†
                    _context.ForbiddenWords.Add(new ForbiddenWord
                    {
                        Word = trimmedWord,
                        CreatedAt = DateTime.Now
                    });
                    await _context.SaveChangesAsync();

                    TempData["Success"] = $"Ú©Ù„Ù…Ù‡ '{newWord.Trim()}' Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯";
                }
                else
                {
                    TempData["Error"] = "Ú©Ù„Ù…Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯";
                }
            }
            catch (DbUpdateException ex) when (ex.InnerException?.Message.Contains("duplicate key") == true)
            {
                // âœ… Catch Ø®Ø·Ø§ÛŒ Unique Constraint
                TempData["Error"] = "Ø§ÛŒÙ† Ú©Ù„Ù…Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: " + ex.Message;
            }

            return RedirectToAction(nameof(ForbiddenWords));
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteForbiddenWord(int id)
        {
            try
            {
                var word = await _context.ForbiddenWords.FindAsync(id);
                if (word != null)
                {
                    _context.ForbiddenWords.Remove(word);
                    await _context.SaveChangesAsync();
                    TempData["Success"] = $"Ú©Ù„Ù…Ù‡ '{word.Word}' Ø­Ø°Ù Ø´Ø¯";
                }
                else
                {
                    TempData["Error"] = "Ú©Ù„Ù…Ù‡ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯";
                }
            }
            catch (Exception ex)
            {
                TempData["Error"] = "Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù: " + ex.Message;
            }
            return RedirectToAction(nameof(ForbiddenWords));
        }
        #endregion


        #region ServiceLinks
        public async Task<IActionResult> ServiceLinks()
        {
            var links = await _context.ServiceLinks.ToListAsync();
            return View(links);
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> AddServiceLink(string title, string url, string? iconUrl = null)
        {
            try
            {
                // âœ… Ø­Ù„ Foreign Key - AdminUser ÙØ¹Ù„ÛŒ Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†
                var currentAdminId = GetCurrentAdminId(); // ÛŒØ§ Ø§Ø² User.Identity Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯

                var link = new ServiceLink
                {
                    Title = title,
                    Url = url,
                    IconUrl = iconUrl,
                    DisplayOrder = await GetNextDisplayOrderAsync(),
                    CreatedByAdminId = currentAdminId,  // âœ… Foreign Key
                    CreatedAt = DateTime.Now
                };

                _context.ServiceLinks.Add(link);
                await _context.SaveChangesAsync();

                TempData["Success"] = "Ù„ÛŒÙ†Ú© Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯";
            }
            catch (DbUpdateException ex) when (ex.InnerException?.Message.Contains("FOREIGN KEY") == true)
            {
                TempData["Error"] = "Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡: AdminUser Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "Ø®Ø·Ø§: " + ex.Message;
            }

            return RedirectToAction(nameof(ServiceLinks));
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteServiceLink(int id)
        {
            try
            {
                var link = await _context.ServiceLinks.FindAsync(id);
                if (link != null)
                {
                    _context.ServiceLinks.Remove(link);
                    await _context.SaveChangesAsync();
                    TempData["Success"] = "Ù„ÛŒÙ†Ú© Ø­Ø°Ù Ø´Ø¯";
                }
            }
            catch (Exception ex)
            {
                TempData["Error"] = "Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù: " + ex.Message;
            }
            return RedirectToAction(nameof(ServiceLinks));
        }

        // âœ… Helper Methods
        private int GetCurrentAdminId()
        {
            // Ø±ÙˆØ´ 1: Ø§Ø² ClaimsPrincipal
            var userId = User.FindFirst("AdminId")?.Value;
            if (int.TryParse(userId, out int adminId))
                return adminId;

            // Ø±ÙˆØ´ 2: Ø§ÙˆÙ„ÛŒÙ† AdminUser
            return 1; // ÛŒØ§ Ø§Ø² Session/Cookie
        }

        private async Task<int> GetNextDisplayOrderAsync()
        {
            var maxOrder = await _context.ServiceLinks.MaxAsync(l => (int?)l.DisplayOrder) ?? 0;
            return maxOrder + 1;
        }


        #endregion







        [HttpGet]
        public async Task<IActionResult> Sms()
        {
            ViewBag.SmsEnabled = await GetSettingValueAsync("SmsEnabled") == "true";
            ViewBag.SmsApiKey = await GetSettingValueAsync("SmsApiKey") ?? "";
            ViewBag.SmsSenderNumber = await GetSettingValueAsync("SmsSenderNumber") ?? "";
            ViewBag.SmsUsername = await GetSettingValueAsync("SmsUsername") ?? "";        // âœ… TopTip Username
            ViewBag.SmsPassword = await GetSettingValueAsync("SmsPassword") ?? "";        // âœ… TopTip Password
            ViewBag.SmsApiUrl = await GetSettingValueAsync("SmsApiUrl") ?? "";
            ViewBag.SmsProvider = await GetSettingValueAsync("SmsProvider") ?? "TopTip";
            ViewBag.OtpLength = await GetSettingValueAsync("OtpLength") ?? "6";
            ViewBag.OtpExpiryMinutes = await GetSettingValueAsync("OtpExpiryMinutes") ?? "5";

            // âœ… ØªØ³Øª Balance
            ViewBag.BalanceResult = await CheckTopTipBalanceAsync();

            return View();
        }

        [HttpPost, ValidateAntiForgeryToken]
        public async Task<IActionResult> Sms(bool smsEnabled, string smsApiKey, string smsSenderNumber,
            string smsUsername, string smsPassword, string smsApiUrl, string smsProvider,
            int otpLength = 6, int otpExpiryMinutes = 5)
        {
            try
            {
                await SaveSettingAsync("SmsEnabled", smsEnabled.ToString().ToLower());
                await SaveSettingAsync("SmsApiKey", smsApiKey);
                await SaveSettingAsync("SmsSenderNumber", smsSenderNumber);
                await SaveSettingAsync("SmsUsername", smsUsername);        // âœ…
                await SaveSettingAsync("SmsPassword", smsPassword);        // âœ…
                await SaveSettingAsync("SmsApiUrl", smsApiUrl);
                await SaveSettingAsync("SmsProvider", smsProvider);
                await SaveSettingAsync("OtpLength", otpLength.ToString());
                await SaveSettingAsync("OtpExpiryMinutes", otpExpiryMinutes.ToString());

                TempData["Success"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª TopTip Ú©Ø§Ù…Ù„ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯";
            }
            catch (Exception ex)
            {
                TempData["Error"] = "Ø®Ø·Ø§: " + ex.Message;
            }
            return RedirectToAction(nameof(Sms));
        }

        // âœ… Balance Checker
        // âœ… Balance Checker - Ø§ØµÙ„Ø§Ø­ Ú©Ø§Ù…Ù„
        private async Task<object> CheckTopTipBalanceAsync()
        {
            try
            {
                var username = await GetSettingValueAsync("SmsUsername");
                var password = await GetSettingValueAsync("SmsPassword");

                // ğŸ”¥ DEBUG - Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ ØªØ³Øª
                System.Diagnostics.Debug.WriteLine($"ğŸ”¥ TopTip Balance: Username={username?.Substring(0, 3)}..., Password={password?.Length} chars");

                if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
                    return new { Success = false, Balance = 0M, Message = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ/Ø±Ù…Ø² Ø®Ø§Ù„ÛŒ Ø§Ø³Øª" };

                using var httpClient = new HttpClient { Timeout = TimeSpan.FromSeconds(15) };
                string apiUrl = $"http://toptip.ir/webservice/rest/user_info" +
                               $"?login_username={Uri.EscapeDataString(username)}" +
                               $"&login_password={Uri.EscapeDataString(password)}";

                var response = await httpClient.GetAsync(apiUrl);
                var content = await response.Content.ReadAsStringAsync();

                // ğŸ”¥ DEBUG Response
                System.Diagnostics.Debug.WriteLine($"ğŸ”¥ TopTip Response: {content.Substring(0, Math.Min(200, content.Length))}...");

                if (response.IsSuccessStatusCode)
                {
                    // âœ… Ú†Ú© result:false (Ø®Ø·Ø§)
                    if (content.Contains("\"result\":false") || content.Contains("\"result\": false"))
                    {
                        return new { Success = false, Balance = 0M, Message = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ/Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡" };
                    }

                    var balance = ParseTopTipBalance(content);
                    return new
                    {
                        Success = true,
                        Balance = balance,
                        Message = balance > 0 ? "Ù…ÙˆÙÙ‚" : "Ù¾Ø§Ø³Ø® Ù†Ø§Ù…Ø¹ØªØ¨Ø±"
                    };
                }
                else
                {
                    return new { Success = false, Balance = 0M, Message = $"HTTP {response.StatusCode}" };
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"ğŸ”¥ Balance Error: {ex.Message}");
                return new { Success = false, Balance = 0M, Message = "Ø®Ø·Ø§ÛŒ Ø§ØªØµØ§Ù„" };
            }
        }

        // âœ… Parse Ø§ØµÙ„Ø§Ø­â€ŒØ´Ø¯Ù‡
        private decimal ParseTopTipBalance(string response)
        {
            try
            {
                // ğŸ”¥ DEBUG Raw Response
                System.Diagnostics.Debug.WriteLine($"ğŸ”¥ Parsing: {response.Substring(0, 300)}");

                // âœ… Ø¯Ù‚ÛŒÙ‚â€ŒØªØ±: "cash":"90582307"
                var cashIndex = response.IndexOf("\"cash\":");
                if (cashIndex == -1)
                {
                    System.Diagnostics.Debug.WriteLine("ğŸ”¥ 'cash' not found");
                    return 0;
                }

                var startIndex = response.IndexOf("\"", cashIndex + 7) + 1; // Ø¨Ø¹Ø¯ Ø§Ø² "cash":
                var endIndex = response.IndexOf("\"", startIndex);

                if (startIndex <= 0 || endIndex == -1 || endIndex <= startIndex)
                {
                    System.Diagnostics.Debug.WriteLine("ğŸ”¥ Invalid cash format");
                    return 0;
                }

                var cashStr = response.Substring(startIndex, endIndex - startIndex).Trim();
                System.Diagnostics.Debug.WriteLine($"ğŸ”¥ Extracted cash: '{cashStr}'");

                return decimal.TryParse(cashStr, out decimal balance) ? balance : 0;
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine($"ğŸ”¥ Parse Error: {ex.Message}");
                return 0;
            }
        }
















    }
}
 
 
==================== UsersController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Areas.Admin.Models;

namespace OrganizationalMessenger.Web.Areas.Admin.Controllers
{
    public class UsersController : BaseAdminController
    {
        private readonly ApplicationDbContext _context;
        private readonly IWebHostEnvironment _env;

        public UsersController(ApplicationDbContext context, IWebHostEnvironment env)
        {
            _context = context;
            _env = env;
        }

       

        // Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¬Ø³ØªØ¬Ùˆ Ùˆ ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ
        public async Task<IActionResult> Index(string search, int page = 1, int pageSize = 20)
        {
            var query = _context.Users.AsQueryable();

            // Ø¬Ø³ØªØ¬Ùˆ
            if (!string.IsNullOrEmpty(search))
            {
                query = query.Where(u =>
                    u.FirstName.Contains(search) ||
                    u.LastName.Contains(search) ||
                    u.Username.Contains(search) ||
                    u.PhoneNumber.Contains(search));
            }

            var totalCount = await query.CountAsync();
            var totalPages = (int)Math.Ceiling(totalCount / (double)pageSize);

            var users = await query
                .OrderByDescending(u => u.CreatedAt)
                .Skip((page - 1) * pageSize)
                .Take(pageSize)
                .ToListAsync();

            var model = new UserListViewModel
            {
                Users = users,
                CurrentPage = page,
                TotalPages = totalPages,
                PageSize = pageSize,
                TotalCount = totalCount,
                SearchTerm = search
            };

            return View(model);
        }

       



        // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ - GET
        public IActionResult Create()
        {
            return View(new UserCreateViewModel());
        }

        // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ - POST
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Create(UserCreateViewModel model)
        {
            if (!ModelState.IsValid)
            {
                return View(model);
            }

            // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
            if (await _context.Users.AnyAsync(u => u.Username == model.Username))
            {
                ModelState.AddModelError("Username", "Ø§ÛŒÙ† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª");
                return View(model);
            }

            // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
            if (await _context.Users.AnyAsync(u => u.PhoneNumber == model.PhoneNumber))
            {
                ModelState.AddModelError("PhoneNumber", "Ø§ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª");
                return View(model);
            }

            var user = new User
            {
                Username = model.Username,
                FirstName = model.FirstName,
                LastName = model.LastName,
                PhoneNumber = model.PhoneNumber,
                Email = model.Email,
                ActiveDirectoryId = model.ActiveDirectoryId,
                ErpUserId = model.ErpUserId,
                IsActive = model.IsActive,
                CanCreateGroup = model.CanCreateGroup,
                CanCreateChannel = model.CanCreateChannel,
                CanMakeVoiceCall = model.CanMakeVoiceCall,
                CanMakeVideoCall = model.CanMakeVideoCall,
                SmsCredit = model.SmsCredit,
                CreatedAt = DateTime.Now,
                LastSeenAt = DateTime.Now
            };

            // âœ… Ø°Ø®ÛŒØ±Ù‡ Ø¢ÙˆØ§ØªØ§Ø±
            var avatarUrl = await SaveAvatarAsync(model.AvatarFile);
            if (!string.IsNullOrEmpty(avatarUrl))
            {
                user.AvatarUrl = avatarUrl;
                user.ProfilePicture = avatarUrl; // Ø§Ú¯Ø± Ø§ÛŒÙ† ÙÛŒÙ„Ø¯ Ø±Ø§ Ù‡Ù… Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ù‡Ù…â€ŒØ³Ùˆ Ù†Ú¯Ù‡ Ø¯Ø§Ø±ÛŒ
            }

            _context.Users.Add(user);
            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯";
            return RedirectToAction(nameof(Index));
        }

        // ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± - GET
        public async Task<IActionResult> Edit(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null) return NotFound();

            var model = new UserEditViewModel
            {
                Id = user.Id,
                Username = user.Username,
                FirstName = user.FirstName,
                LastName = user.LastName,
                PhoneNumber = user.PhoneNumber,
                Email = user.Email,
                ActiveDirectoryId = user.ActiveDirectoryId,
                ErpUserId = user.ErpUserId,
                IsActive = user.IsActive,
                CanCreateGroup = user.CanCreateGroup,
                CanCreateChannel = user.CanCreateChannel,
                CanMakeVoiceCall = user.CanMakeVoiceCall,
                CanMakeVideoCall = user.CanMakeVideoCall,
                SmsCredit = user.SmsCredit,
                AvatarUrl = user.AvatarUrl // âœ… Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± ÙØ±Ù…
            };

            return View(model);
        }


        // ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø± - POST
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Edit(UserEditViewModel model)
        {
            if (!ModelState.IsValid)
                return View(model);

            var user = await _context.Users.FindAsync(model.Id);
            if (user == null) return NotFound();

            // Ú†Ú©â€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù‚Ø¨Ù„ÛŒ...

            user.Username = model.Username;
            user.FirstName = model.FirstName;
            user.LastName = model.LastName;
            user.PhoneNumber = model.PhoneNumber;
            user.Email = model.Email;
            user.ActiveDirectoryId = model.ActiveDirectoryId;
            user.ErpUserId = model.ErpUserId;
            user.IsActive = model.IsActive;
            user.CanCreateGroup = model.CanCreateGroup;
            user.CanCreateChannel = model.CanCreateChannel;
            user.CanMakeVoiceCall = model.CanMakeVoiceCall;
            user.CanMakeVideoCall = model.CanMakeVideoCall;
            user.SmsCredit = model.SmsCredit;

            // âœ… Ø§Ú¯Ø± ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø¢Ù…Ø¯Ù‡ØŒ Ø°Ø®ÛŒØ±Ù‡ Ùˆ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†
            var newAvatarUrl = await SaveAvatarAsync(model.AvatarFile);
            if (!string.IsNullOrEmpty(newAvatarUrl))
            {
                user.AvatarUrl = newAvatarUrl;
                user.ProfilePicture = newAvatarUrl;
            }

            await _context.SaveChangesAsync();

            TempData["SuccessMessage"] = "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯";
            return RedirectToAction(nameof(Index));
        }


        // Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø±
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Delete(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound();
            }

            try
            {
                _context.Users.Remove(user);
                await _context.SaveChangesAsync();
                TempData["SuccessMessage"] = "Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯";
            }
            catch (DbUpdateException)
            {
                TempData["ErrorMessage"] = "Ø¨Ù‡ Ø¯Ù„ÛŒÙ„ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø±ØªØ¨Ø·ØŒ Ø§Ù…Ú©Ø§Ù† Ø­Ø°Ù Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯";
            }

            return RedirectToAction(nameof(Index));
        }

        // ÙØ¹Ø§Ù„/ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> ToggleStatus(int id)
        {
            var user = await _context.Users.FindAsync(id);
            if (user == null)
            {
                return NotFound();
            }

            user.IsActive = !user.IsActive;
            await _context.SaveChangesAsync();

            return Json(new { success = true, isActive = user.IsActive });
        }




        private async Task<string?> SaveAvatarAsync(IFormFile? file)
        {
            if (file == null || file.Length == 0) return null;

            var uploadsRoot = Path.Combine(_env.WebRootPath, "uploads", "avatars");
            Directory.CreateDirectory(uploadsRoot);

            var ext = Path.GetExtension(file.FileName);
            var fileName = $"{Guid.NewGuid():N}{ext}";
            var fullPath = Path.Combine(uploadsRoot, fileName);

            using (var stream = new FileStream(fullPath, FileMode.Create))
            {
                await file.CopyToAsync(stream);
            }

            // Ù…Ø³ÛŒØ± Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± HTML
            return $"/uploads/avatars/{fileName}";
        }


    }
}
 
 
==================== DashboardViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
ï»¿namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    public class DashboardViewModel
    {
        public int TotalUsers { get; set; }
        public int ActiveUsers { get; set; }
        public int TotalGroups { get; set; }
        public int TotalChannels { get; set; }
        public int TotalMessages { get; set; }
        public int TodayMessages { get; set; }
        public int TotalCalls { get; set; }
        public int TodayCalls { get; set; }
    }
}
 
 
==================== LoginViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
ï»¿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    public class LoginViewModel
    {
        [Required(ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ")]
        public string Username { get; set; }

        [Required(ErrorMessage = "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [DataType(DataType.Password)]
        [Display(Name = "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±")]
        public string Password { get; set; }

        [Display(Name = "Ù…Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø¨Ø³Ù¾Ø§Ø±")]
        public bool RememberMe { get; set; }
    }
}
 
 
==================== SettingsViewModels.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
ï»¿// Path: OrganizationalMessenger.Web/Areas/Admin/Models/SettingsViewModels.cs

using System.ComponentModel.DataAnnotations;
using OrganizationalMessenger.Domain.Entities;

namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    #region ========== Index ViewModel ==========

    public class SettingsIndexViewModel
    {
        public List<SystemSetting> AllSettings { get; set; } = new();
        public Dictionary<string, int> SettingCounts { get; set; } = new();
        public DateTime? LastUpdated { get; set; }
        public string? LastUpdatedBy { get; set; }

        // Ø¢Ù…Ø§Ø± Ø³Ø±ÛŒØ¹
        public int TotalUsers { get; set; }
        public int TotalMessages { get; set; }
        public int TodayActiveUsers { get; set; }
        public string SystemVersion { get; set; } = "1.0.0";
    }

    #endregion

    #region ========== General Settings ==========

    public class GeneralSettingsViewModel
    {
        [Display(Name = "Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù†")]
        [Required(ErrorMessage = "Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [StringLength(200)]
        public string CompanyName { get; set; } = string.Empty;

        [Display(Name = "Ø¢Ø¯Ø±Ø³ Ù„ÙˆÚ¯ÙˆÛŒ Ø³Ø§Ø²Ù…Ø§Ù†")]
        public string? CompanyLogoUrl { get; set; }

        [Display(Name = "Ø§Ù…Ú©Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ ØªÙˆØ³Ø· Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†")]
        public bool AllUsersCanCreateGroup { get; set; }

        [Display(Name = "Ø§Ù…Ú©Ø§Ù† Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„ ØªÙˆØ³Ø· Ù‡Ù…Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†")]
        public bool AllUsersCanCreateChannel { get; set; }

        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø¹Ø¶Ø§ÛŒ Ú¯Ø±ÙˆÙ‡")]
        [Range(2, 10000)]
        public int MaxGroupMembers { get; set; } = 200;

        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø¹Ø¶Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„")]
        [Range(1, 100000)]
        public int MaxChannelMembers { get; set; } = 5000;

        [Display(Name = "Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú© Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯")]
        [Range(0, 1000)]
        public int DefaultSmsCredit { get; set; } = 10;
    }

    #endregion

    #region ========== Authentication Settings ==========

    public class AuthenticationSettingsViewModel
    {
        [Display(Name = "Ø±ÙˆØ´ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª")]
        public string AuthType { get; set; } = "Database";

        // Active Directory Settings
        [Display(Name = "Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± AD")]
        public string? AdServer { get; set; }

        [Display(Name = "Ø¯Ø§Ù…Ù†Ù‡ AD")]
        public string? AdDomain { get; set; }

        // ERP Settings
        [Display(Name = "Ø¢Ø¯Ø±Ø³ API Ø³ÛŒØ³ØªÙ… ERP")]
        [Url(ErrorMessage = "Ø¢Ø¯Ø±Ø³ URL Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯")]
        public string? ErpApiUrl { get; set; }

        [Display(Name = "Ú©Ù„ÛŒØ¯ API Ø³ÛŒØ³ØªÙ… ERP")]
        public string? ErpApiKey { get; set; }

        // SMS/OTP Settings
        [Display(Name = "Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆÛŒØ³â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù…Ú©")]
        public string? SmsProviderUrl { get; set; }

        [Display(Name = "Ú©Ù„ÛŒØ¯ API Ù¾ÛŒØ§Ù…Ú©")]
        public string? SmsApiKey { get; set; }

        [Display(Name = "Ø´Ù…Ø§Ø±Ù‡ Ø§Ø±Ø³Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ù¾ÛŒØ§Ù…Ú©")]
        public string? SmsSenderNumber { get; set; }

        [Display(Name = "Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø± Ú©Ø¯ OTP (Ø¯Ù‚ÛŒÙ‚Ù‡)")]
        [Range(1, 10)]
        public int OtpExpirationMinutes { get; set; } = 2;
    }

    #endregion

    #region ========== File Upload Settings ==========

    public class FileUploadSettingsViewModel
    {
        public List<FileUploadSettingItemViewModel> FileTypes { get; set; } = new();

        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ø§Ø² SystemSettings
        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… ØªØµÙˆÛŒØ± (MB)")]
        public int MaxImageSizeMB { get; set; } = 10;

        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… ÙˆÛŒØ¯ÛŒÙˆ (MB)")]
        public int MaxVideoSizeMB { get; set; } = 100;

        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… ÙØ§ÛŒÙ„ (MB)")]
        public int MaxFileSizeMB { get; set; } = 50;
    }

    public class FileUploadSettingItemViewModel
    {
        public int Id { get; set; }

        [Display(Name = "Ù†ÙˆØ¹ ÙØ§ÛŒÙ„")]
        public string FileType { get; set; } = string.Empty;

        [Display(Name = "Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ")]
        public string Category { get; set; } = string.Empty;

        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… (Ø¨Ø§ÛŒØª)")]
        public long MaxSize { get; set; }

        [Display(Name = "Ù…Ø¬Ø§Ø²")]
        public bool IsAllowed { get; set; }

        // Ù…Ø­Ø§Ø³Ø¨Ù‡â€ŒØ´Ø¯Ù‡
        public double MaxSizeMB => Math.Round(MaxSize / (1024.0 * 1024.0), 2);

        public string CategoryIcon => Category?.ToLower() switch
        {
            "image" => "fa-image text-success",
            "video" => "fa-video text-primary",
            "audio" => "fa-music text-warning",
            "document" => "fa-file-alt text-info",
            _ => "fa-file text-secondary"
        };
    }

    #endregion

    #region ========== Message Settings ==========

    public class MessageSettingsViewModel
    {
        [Display(Name = "Ø§Ù…Ú©Ø§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…")]
        public bool MessageEditEnabled { get; set; } = true;

        [Display(Name = "Ø§Ù…Ú©Ø§Ù† Ø­Ø°Ù Ù¾ÛŒØ§Ù…")]
        public bool MessageDeleteEnabled { get; set; } = true;


        [Display(Name = "Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡ Ø§Ø«Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù…")]
        public bool ShowDeletedMessageNotice { get; set; } = true;



        [Display(Name = "Ù…Ù‡Ù„Øª ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… (Ø¯Ù‚ÛŒÙ‚Ù‡)")]
        [Range(0, 1440)]
        public int MessageEditTimeLimit { get; set; } = 15;

        [Display(Name = "Ù…Ù‡Ù„Øª Ø­Ø°Ù Ù¾ÛŒØ§Ù… (Ø¯Ù‚ÛŒÙ‚Ù‡)")]
        [Range(0, 1440)]
        public int MessageDeleteTimeLimit { get; set; } = 60;

        [Display(Name = "Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ø¨Ø¹Ø¯ Ø§Ø² Ø®ÙˆØ§Ù†Ø¯Ù† ØªÙˆØ³Ø· Ú¯ÛŒØ±Ù†Ø¯Ù‡")]
        public bool MessageDeleteAfterRead { get; set; } = false;

        [Display(Name = "Ø§Ø¯Ù…ÛŒÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø±Ø§ Ø­Ø°Ù Ú©Ù†Ø¯")]
        public bool AdminCanDeleteMessages { get; set; } = true;

        [Display(Name = "Ø±Ù…Ø²Ù†Ú¯Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§")]
        public bool EncryptionEnabled { get; set; } = false;
    }

    #endregion

    #region ========== VoIP Settings ==========

    public class VoIPSettingsViewModel
    {
        [Display(Name = "ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ/ØªØµÙˆÛŒØ±ÛŒ")]
        public bool VoipEnabled { get; set; }

        [Display(Name = "Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆØ± VoIP")]
        [Url(ErrorMessage = "Ø¢Ø¯Ø±Ø³ URL Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯")]
        public string? VoipServerUrl { get; set; }

        [Display(Name = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ")]
        public string? VoipUsername { get; set; }

        [Display(Name = "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±")]
        public string? VoipPassword { get; set; }

        [Display(Name = "Ù¾Ø±ÙˆØªÚ©Ù„")]
        public string VoipProtocol { get; set; } = "WebRTC";
    }

    #endregion

    #region ========== Telegram Settings ==========

    public class TelegramSettingsViewModel
    {
        [Display(Name = "ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù† Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…")]
        public bool TelegramEnabled { get; set; }

        [Display(Name = "ØªÙˆÚ©Ù† Ø±Ø¨Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…")]
        public string? TelegramBotToken { get; set; }

        // Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ù…Ø§ÛŒØ´ÛŒ (ÙÙ‚Ø· Ø®ÙˆØ§Ù†Ø¯Ù†ÛŒ)
        public string? BotUsername { get; set; }
        public bool IsConnected { get; set; }
    }

    #endregion

    #region ========== SMS Settings ==========

    public class SmsSettingsViewModel
    {
        [Display(Name = "Ø¢Ø¯Ø±Ø³ Ø³Ø±ÙˆÛŒØ³â€ŒØ¯Ù‡Ù†Ø¯Ù‡")]
        [Url(ErrorMessage = "Ø¢Ø¯Ø±Ø³ URL Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯")]
        public string? SmsProviderUrl { get; set; }

        [Display(Name = "Ú©Ù„ÛŒØ¯ API")]
        public string? SmsApiKey { get; set; }

        [Display(Name = "Ø´Ù…Ø§Ø±Ù‡ Ø§Ø±Ø³Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡")]
        public string? SmsSenderNumber { get; set; }

        [Display(Name = "Ù…Ø¯Øª Ø§Ø¹ØªØ¨Ø§Ø± OTP (Ø¯Ù‚ÛŒÙ‚Ù‡)")]
        [Range(1, 10)]
        public int OtpExpirationMinutes { get; set; } = 2;

        // Ø¢Ù…Ø§Ø±
        public int TodaySentCount { get; set; }
        public decimal? CurrentBalance { get; set; }
    }

    #endregion

    #region ========== Service Links Settings ==========

    public class ServiceLinksViewModel
    {
        public List<ServiceLink> Links { get; set; } = new();
    }

    public class ServiceLinkFormViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [StringLength(100)]
        [Display(Name = "Ø¹Ù†ÙˆØ§Ù†")]
        public string Title { get; set; } = string.Empty;

        [Required(ErrorMessage = "Ø¢Ø¯Ø±Ø³ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Url(ErrorMessage = "Ø¢Ø¯Ø±Ø³ URL Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯")]
        [Display(Name = "Ø¢Ø¯Ø±Ø³ Ù„ÛŒÙ†Ú©")]
        public string Url { get; set; } = string.Empty;

        [Display(Name = "Ø¢ÛŒÚ©ÙˆÙ†")]
        public string? IconUrl { get; set; }

        [Display(Name = "ØªØ±ØªÛŒØ¨ Ù†Ù…Ø§ÛŒØ´")]
        public int DisplayOrder { get; set; }

        [Display(Name = "ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; } = true;
    }

    #endregion

    #region ========== Forbidden Words Settings ==========

    public class ForbiddenWordsViewModel
    {
        public List<ForbiddenWord> Words { get; set; } = new();
        public int TotalCount { get; set; }
        public int ActiveCount { get; set; }

        // ÙØ±Ù… Ø§ÙØ²ÙˆØ¯Ù†
        [Required(ErrorMessage = "Ú©Ù„Ù…Ù‡ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [StringLength(100)]
        public string NewWord { get; set; } = string.Empty;
    }

    #endregion

    #region ========== System Info ==========

    public class SystemInfoViewModel
    {
        public string DotNetVersion { get; set; } = string.Empty;
        public string OSDescription { get; set; } = string.Empty;
        public long MemoryUsageMB { get; set; }
        public long TotalMemoryMB { get; set; }
        public int ProcessorCount { get; set; }
        public TimeSpan Uptime { get; set; }
        public string MachineName { get; set; } = string.Empty;

        // Ø¢Ù…Ø§Ø± Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†
        public int TotalUsers { get; set; }
        public int OnlineUsers { get; set; }
        public int TotalMessages { get; set; }
        public int TodayMessages { get; set; }
        public long DatabaseSizeMB { get; set; }
        public long FileStorageSizeMB { get; set; }
    }

    #endregion
}
 
 
==================== UserViewModels.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Models\ 
 
ï»¿using OrganizationalMessenger.Domain.Entities;
using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Areas.Admin.Models
{
    // Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
    public class UserListViewModel
    {
        public List<User> Users { get; set; }
        public int CurrentPage { get; set; }
        public int TotalPages { get; set; }
        public int PageSize { get; set; }
        public int TotalCount { get; set; }
        public string SearchTerm { get; set; }
    }

    // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±
    public class UserCreateViewModel
    {
        [Required(ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ")]
        public string Username { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù…")]
        public string FirstName { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ")]
        public string LastName { get; set; }


        public string? AvatarUrl { get; set; }       // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙØ¹Ù„ÛŒ
        public IFormFile? AvatarFile { get; set; }   // ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ 

        [Required(ErrorMessage = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Phone(ErrorMessage = "ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª")]
        [Display(Name = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„")]
        public string PhoneNumber { get; set; }

        [EmailAddress(ErrorMessage = "ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª")]
        [Display(Name = "Ø§ÛŒÙ…ÛŒÙ„")]
        public string Email { get; set; }

        [Display(Name = "Ø´Ù†Ø§Ø³Ù‡ Active Directory")]
        public string ActiveDirectoryId { get; set; }

        [Display(Name = "Ø´Ù†Ø§Ø³Ù‡ ERP")]
        public string ErpUserId { get; set; }

        [Display(Name = "ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; } = true;

        [Display(Name = "Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡")]
        public bool CanCreateGroup { get; set; } = true;

        [Display(Name = "Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„")]
        public bool CanCreateChannel { get; set; } = true;

        [Display(Name = "Ù…Ø¬ÙˆØ² ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ")]
        public bool CanMakeVoiceCall { get; set; } = true;

        [Display(Name = "Ù…Ø¬ÙˆØ² ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ")]
        public bool CanMakeVideoCall { get; set; } = true;

        [Range(0, int.MaxValue, ErrorMessage = "Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú© Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯")]
        [Display(Name = "Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú©")]
        public int SmsCredit { get; set; } = 10;
    }

    // ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±
    public class UserEditViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ")]
        public string Username { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù…")]
        public string FirstName { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ")]
        public string LastName { get; set; }

        [Required(ErrorMessage = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Phone(ErrorMessage = "ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª")]
        [Display(Name = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„")]
        public string PhoneNumber { get; set; }

        public string? AvatarUrl { get; set; }       // Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙØ¹Ù„ÛŒ
        public IFormFile? AvatarFile { get; set; }   // ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯


        [EmailAddress(ErrorMessage = "ÙØ±Ù…Øª Ø§ÛŒÙ…ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª")]
        [Display(Name = "Ø§ÛŒÙ…ÛŒÙ„")]
        public string Email { get; set; }

        [Display(Name = "Ø´Ù†Ø§Ø³Ù‡ Active Directory")]
        public string ActiveDirectoryId { get; set; }

        [Display(Name = "Ø´Ù†Ø§Ø³Ù‡ ERP")]
        public string ErpUserId { get; set; }

        [Display(Name = "ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; }

        [Display(Name = "Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡")]
        public bool CanCreateGroup { get; set; }

        [Display(Name = "Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„")]
        public bool CanCreateChannel { get; set; }

        [Display(Name = "Ù…Ø¬ÙˆØ² ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ")]
        public bool CanMakeVoiceCall { get; set; }

        [Display(Name = "Ù…Ø¬ÙˆØ² ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ")]
        public bool CanMakeVideoCall { get; set; }

        [Range(0, int.MaxValue, ErrorMessage = "Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú© Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ù…Ø«Ø¨Øª Ø¨Ø§Ø´Ø¯")]
        [Display(Name = "Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú©")]
        public int SmsCredit { get; set; }
    }
}
 
 
==================== AccountController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Authentication;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Infrastructure.Services;
using System.Security.Claims;

namespace OrganizationalMessenger.Web.Controllers
{
    [AllowAnonymous]
    public class AccountController : Controller
    {
        private readonly ApplicationDbContext _context;
        private readonly IAuthenticationManager _authManager;
        private readonly ISmsSender _smsSender;

        public AccountController(
            ApplicationDbContext context,
            IAuthenticationManager authManager,
            ISmsSender smsSender)
        {
            _context = context;
            _authManager = authManager;
            _smsSender = smsSender;
        }

        // ==================== ØµÙØ­Ù‡ Ù„Ø§Ú¯ÛŒÙ† ====================
        [HttpGet]
        public IActionResult Login()
        {
            // Ø§Ú¯Ø± Ú©Ø§Ø±Ø¨Ø± Ù„Ø§Ú¯ÛŒÙ† Ø§Ø³ØªØŒ Ø¨Ù‡ ØµÙØ­Ù‡ Chat Ø¨Ø±ÙˆØ¯
            if (User.Identity?.IsAuthenticated == true)
            {
                return RedirectToAction("Index", "Chat");
            }

            return View();
        }

        // ==================== Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ OTP ====================
        [HttpPost]
        public async Task<IActionResult> SendOtp(string phoneNumber)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(phoneNumber))
                {
                    return Json(new { success = false, message = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª" });
                }

                // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ù…Ø§Ø±Ù‡
                phoneNumber = CleanPhoneNumber(phoneNumber);

                // Ø¨Ø±Ø±Ø³ÛŒ ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡
                if (!phoneNumber.StartsWith("09") || phoneNumber.Length != 11)
                {
                    return Json(new { success = false, message = "ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ø±Ø³Øª Ù†ÛŒØ³Øª" });
                }

                // Ø¨Ø±Ø±Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
                var user = await _context.Users
                    .FirstOrDefaultAsync(u => u.PhoneNumber == phoneNumber && u.IsActive && !u.IsDeleted);

                if (user == null)
                {
                    return Json(new { success = false, message = "Ø§ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ø± Ø³ÛŒØ³ØªÙ… Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª" });
                }


                var success = await _smsSender.SendSmsAsync(
                    $"Ú©Ø¯ ØªØ§ÛŒÛŒØ¯: {GenerateOtp()}",
                    phoneNumber
                );

                //if (!success)
                //{
                //    return Json(new { success = false, message = "Ø®Ø·Ø§ Ø¯Ø± Ø§  Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…Ú©" });
                //}

                // Ø°Ø®ÛŒØ±Ù‡ OTP Ø¯Ø± Session (ØªÙ†Ù‡Ø§ Ø¨Ø±Ø§ÛŒ ØªÙˆØ³Ø¹Ù‡)
                HttpContext.Session.SetString("OTP_Phone", phoneNumber);

                return Json(new { success = true, message = "Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯" });
            }
            catch (Exception ex)
            {
                return Json(new { success = false, message = $"Ø®Ø·Ø§: {ex.Message}" });
            }
        }

        // ==================== ØªØ§ÛŒÛŒØ¯ OTP ====================
        [HttpPost]
        public async Task<IActionResult> VerifyOtp(string phoneNumber, string otpCode)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(phoneNumber) || string.IsNullOrWhiteSpace(otpCode))
                {
                    TempData["Error"] = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
                    return RedirectToAction(nameof(Login));
                }

                // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ù…Ø§Ø±Ù‡
                phoneNumber = CleanPhoneNumber(phoneNumber);

                // Ø¨Ø±Ø±Ø³ÛŒ OTP (Ø¯Ø± Ù…Ø­ÛŒØ· ÙˆØ§Ù‚Ø¹ÛŒ Ø§Ø² Ø³Ø±ÙˆÛŒØ³ Ù¾ÛŒØ§Ù…Ú© Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯)
                var sessionOtp = HttpContext.Session.GetString("OTP_Phone");
                if (sessionOtp != phoneNumber)
                {
                    TempData["Error"] = "Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª";
                    return RedirectToAction(nameof(Login));
                }

                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±
                var user = await _context.Users
                    .FirstOrDefaultAsync(u => u.PhoneNumber == phoneNumber && u.IsActive && !u.IsDeleted);

                if (user == null)
                {
                    TempData["Error"] = "Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯";
                    return RedirectToAction(nameof(Login));
                }

                // ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
                await SignInUserAsync(user);

                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø²Ù…Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ†
                user.LastSeenAt = DateTime.Now;
                user.IsOnline = true;
                await _context.SaveChangesAsync();

                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† OTP Ø§Ø² Session
                HttpContext.Session.Remove("OTP_Phone");

                return RedirectToAction("Index", "Chat");
            }
            catch (Exception ex)
            {
                TempData["Error"] = $"Ø®Ø·Ø§: {ex.Message}";
                return RedirectToAction(nameof(Login));
            }
        }

        // ==================== ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ====================
        [HttpPost]
        public async Task<IActionResult> LoginWithPassword(string username, string password)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
                {
                    TempData["Error"] = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
                    return RedirectToAction(nameof(Login));
                }

                // Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ (Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„)
                username = CleanPhoneNumber(username);

                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø±
                var user = await _context.Users
                    .FirstOrDefaultAsync(u => u.PhoneNumber == username && u.IsActive && !u.IsDeleted);

                if (user == null)
                {
                    TempData["Error"] = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª";
                    return RedirectToAction(nameof(Login));
                }

                // Ø¨Ø±Ø±Ø³ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² BCrypt ÛŒØ§ Ø¯ÛŒÚ¯Ø± Ø±ÙˆØ´)
                // Ø¯Ø± Ø§ÛŒÙ†Ø¬Ø§ ÙØ±Ø¶ Ú©Ø±Ø¯ÛŒÙ… Ú©Ù‡ BCrypt Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                if (user.PasswordHash == null || !VerifyPassword(password, user.PasswordHash))
                {
                    TempData["Error"] = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª";
                    return RedirectToAction(nameof(Login));
                }

                // ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
                await SignInUserAsync(user);

                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø²Ù…Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ†
                user.LastSeenAt = DateTime.Now;
                user.IsOnline = true;
                await _context.SaveChangesAsync();

                return RedirectToAction("Index", "Chat");
            }
            catch (Exception ex)
            {
                TempData["Error"] = $"Ø®Ø·Ø§: {ex.Message}";
                return RedirectToAction(nameof(Login));
            }
        }

        // ==================== ÙˆØ±ÙˆØ¯ Ø¨Ø§ Active Directory ====================
        [HttpPost]
        public async Task<IActionResult> LoginWithAD(string username, string password)
        {
            try
            {
                if (string.IsNullOrWhiteSpace(username) || string.IsNullOrWhiteSpace(password))
                {
                    TempData["Error"] = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª";
                    return RedirectToAction(nameof(Login));
                }

                // Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ø² Ø·Ø±ÛŒÙ‚ AD
                var authResult = await _authManager.AuthenticateAsync(
                    username,
                    password,
                    AuthenticationType.ActiveDirectory
                );

                if (!authResult.IsSuccess)
                {
                    TempData["Error"] = authResult.ErrorMessage ?? "Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒ   Ù†Ø§Ù…ÙˆÙÙ‚";
                    return RedirectToAction(nameof(Login));
                }

                // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ÛŒØ§ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø±
                var user = await _context.Users
                    .FirstOrDefaultAsync(u => u.ActiveDirectoryId == authResult.UserId && u.IsActive);

                if (user == null)
                {
                    // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
                    user = new User
                    {
                        Username = authResult.UserId,
                        FirstName = authResult.FirstName ?? "",
                        LastName = authResult.LastName ?? "",
                        Email = authResult.Email,
                        PhoneNumber = authResult.PhoneNumber,
                        ActiveDirectoryId = authResult.UserId,
                        IsADAuthenticated = true,
                        IsActive = true,
                        CreatedAt = DateTime.Now,
                        SmsCredit = 10
                    };

                    _context.Users.Add(user);
                    await _context.SaveChangesAsync();
                }

                // ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±
                await SignInUserAsync(user);

                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø¢Ø®Ø±ÛŒÙ† Ø²Ù…Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ†
                user.LastSeenAt = DateTime.Now;
                user.IsOnline = true;
                await _context.SaveChangesAsync();

                return RedirectToAction("Index", "Chat");
            }
            catch (Exception ex)
            {
                TempData["Error"] = $"Ø®Ø·Ø§: {ex.Message}";
                return RedirectToAction(nameof(Login));
            }
        }

        // ==================== Ø®Ø±ÙˆØ¬ ====================
        [HttpPost]
        [Authorize]
        public async Task<IActionResult> Logout()
        {
            try
            {
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø¢Ù†Ù„Ø§ÛŒÙ†
                var userId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
                if (!string.IsNullOrWhiteSpace(userId) && int.TryParse(userId, out int id))
                {
                    var user = await _context.Users.FindAsync(id);
                    if (user != null)
                    {
                        user.IsOnline = false;
                        user.LastSeenAt = DateTime.Now;
                        await _context.SaveChangesAsync();
                    }
                }

                await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
            }
            catch { }

            return RedirectToAction(nameof(Login));
        }

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================

        /// <summary>
        /// Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
        /// </summary>
        private string CleanPhoneNumber(string phone)
        {
            return phone?.Trim()
                .Replace(" ", "").Replace("-", "")
                .Replace("Û°", "0").Replace("Û±", "1")
                .Replace("Û²", "2").Replace("Û³", "3")
                .Replace("Û´", "4").Replace("Ûµ", "5")
                .Replace("Û¶", "6").Replace("Û·", "7")
                .Replace("Û¸", "8").Replace("Û¹", "9") ?? "";
        }

        /// <summary>
        /// ØªÙˆÙ„ÛŒØ¯ Ú©Ø¯ OTP 6 Ø±Ù‚Ù…ÛŒ
        /// </summary>
        private string GenerateOtp()
        {
            var random = new Random();
            return random.Next(100000, 999999).ToString();
        }

        /// <summary>
        /// Ø¨Ø±Ø±Ø³ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (BCrypt)
        /// </summary>
        private bool VerifyPassword(string password, string hash)
        {
            try
            {
                return BCrypt.Net.BCrypt.Verify(password, hash);
            }
            catch
            {
                return false;
            }
        }

        /// <summary>
        /// ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ Ø³ÛŒØ³ØªÙ…
        /// </summary>
        private async Task SignInUserAsync(User user)
        {
            var claims = new List<Claim>
            {
                new Claim(ClaimTypes.Name, user.Username),
                new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
                new Claim("FullName", $"{user.FirstName} {user.LastName}"),
                new Claim("PhoneNumber", user.PhoneNumber ?? ""),
                new Claim("Avatar", user.AvatarUrl ?? "")
            };

            var claimsIdentity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
            var authProperties = new AuthenticationProperties
            {
                IsPersistent = true,
                ExpiresUtc = DateTimeOffset.UtcNow.AddDays(30)
            };

            await HttpContext.SignInAsync(
                CookieAuthenticationDefaults.AuthenticationScheme,
                new ClaimsPrincipal(claimsIdentity),
                authProperties
            );
        }



        

    }
} 
 
==================== ChannelController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;

namespace OrganizationalMessenger.Controllers
{
    [Authorize]
    [Route("api/[controller]")]
    [ApiController]
    public class ChannelController : ControllerBase
    {
        private readonly ApplicationDbContext _context;

        public ChannelController(ApplicationDbContext context)
        {
            _context = context;
        }

        private int? GetCurrentUserId()
        {
            var userIdClaim = User.FindFirst("UserId")?.Value;
            return int.TryParse(userIdClaim, out var userId) ? userId : null;
        }

        // âœ… Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯
        [HttpPost("Create")]
        public async Task<IActionResult> CreateChannel([FromBody] CreateChannelRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ²
                var user = await _context.Users.FindAsync(userId.Value);
                if (user == null || !user.CanCreateChannel)
                {
                    return StatusCode(403, new { success = false, message = "Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„ Ù†Ø¯Ø§Ø±ÛŒØ¯" });
                }

                // âœ… Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„
                var channel = new Channel
                {
                    Name = request.Name,
                    Description = request.Description,
                    CreatorId = userId.Value,
                    IsPublic = request.IsPublic,
                    OnlyAdminsCanPost = request.OnlyAdminsCanPost,
                    AllowComments = request.AllowComments,
                    IsActive = true,
                    CreatedAt = DateTime.Now
                };

                // âœ… ØªÙˆÙ„ÛŒØ¯ Ù„ÛŒÙ†Ú© Ø¯Ø¹ÙˆØª
                if (!channel.IsPublic)
                {
                    channel.GenerateInviteLink();
                }

                _context.Channels.Add(channel);
                await _context.SaveChangesAsync();

                // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Owner
                var userChannel = new UserChannel
                {
                    UserId = userId.Value,
                    ChannelId = channel.Id,
                    Role = ChannelRole.Owner,
                    IsOwner = true,
                    IsAdmin = true,
                    CanPost = true,
                    CanDeleteMessages = true,
                    CanManageMembers = true,
                    JoinedAt = DateTime.Now,
                    IsActive = true
                };

                _context.UserChannels.Add(userChannel);

                // âœ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§
                channel.MemberCount = 1;
                await _context.SaveChangesAsync();

                return Ok(new
                {
                    success = true,
                    message = "Ú©Ø§Ù†Ø§Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯",
                    channelId = channel.Id,
                    channel = new
                    {
                        channel.Id,
                        channel.Name,
                        channel.Description,
                        channel.AvatarUrl,
                        channel.IsPublic,
                        channel.OnlyAdminsCanPost,
                        channel.AllowComments,
                        channel.InviteLink,
                        channel.CreatedAt
                    }
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
        [HttpGet("MyChannels")]
        public async Task<IActionResult> GetMyChannels()
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var channels = await _context.UserChannels
                    .Where(uc => uc.UserId == userId.Value && uc.IsActive)
                    .Include(uc => uc.Channel)
                        .ThenInclude(c => c.Creator)
                    .Select(uc => new
                    {
                        uc.Channel.Id,
                        uc.Channel.Name,
                        uc.Channel.Description,
                        Avatar = uc.Channel.AvatarUrl ?? "/images/default-channel.png",
                        uc.Channel.IsPublic,
                        uc.Channel.MemberCount,
                        Role = uc.Role.ToString(),
                        uc.IsAdmin,
                        uc.CanPost,
                        uc.IsMuted,
                        uc.IsPinned,
                        UnreadCount = uc.UnreadCount,
                        LastMessage = _context.Messages
                            .Where(m => m.ChannelId == uc.ChannelId && !m.IsDeleted)
                            .OrderByDescending(m => m.SentAt)
                            .Select(m => m.Content ?? m.MessageText)
                            .FirstOrDefault(),
                        LastMessageTime = _context.Messages
                            .Where(m => m.ChannelId == uc.ChannelId && !m.IsDeleted)
                            .OrderByDescending(m => m.SentAt)
                            .Select(m => m.SentAt)
                            .FirstOrDefault()
                    })
                    .OrderByDescending(c => c.IsPinned)
                    .ThenByDescending(c => c.LastMessageTime)
                    .ToListAsync();

                return Ok(new { success = true, channels });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ© Ú©Ø§Ù†Ø§Ù„
        [HttpGet("{channelId}")]
        public async Task<IActionResult> GetChannel(int channelId)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var userChannel = await _context.UserChannels
                    .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == userId.Value && uc.IsActive);

                if (userChannel == null)
                    return NotFound(new { success = false, message = "Ø´Ù…Ø§ Ø¹Ø¶Ùˆ Ø§ÛŒÙ† Ú©Ø§Ù†Ø§Ù„ Ù†ÛŒØ³ØªÛŒØ¯" });

                var channel = await _context.Channels
                    .Include(c => c.Creator)
                    .FirstOrDefaultAsync(c => c.Id == channelId && !c.IsDeleted);

                if (channel == null)
                    return NotFound(new { success = false, message = "Ú©Ø§Ù†Ø§Ù„ ÛŒØ§ÙØª Ù†Ø´Ø¯" });

                var admins = await _context.UserChannels
                    .Where(uc => uc.ChannelId == channelId && uc.IsActive && uc.IsAdmin)
                    .Include(uc => uc.User)
                    .Select(uc => new
                    {
                        uc.User.Id,
                        Name = $"{uc.User.FirstName} {uc.User.LastName}",
                        Avatar = uc.User.AvatarUrl ?? "/images/default-avatar.png",
                        Role = uc.Role.ToString(),
                        uc.CanPost,
                        uc.JoinedAt
                    })
                    .ToListAsync();

                return Ok(new
                {
                    success = true,
                    channel = new
                    {
                        channel.Id,
                        channel.Name,
                        channel.Description,
                        Avatar = channel.AvatarUrl ?? "/images/default-channel.png",
                        channel.IsPublic,
                        channel.OnlyAdminsCanPost,
                        channel.AllowComments,
                        channel.MemberCount,
                        Creator = $"{channel.Creator.FirstName} {channel.Creator.LastName}",
                        channel.CreatedAt,
                        MyRole = userChannel.Role.ToString(),
                        IsAdmin = userChannel.IsAdmin,
                        CanPost = userChannel.CanPost,
                        IsMuted = userChannel.IsMuted,
                        channel.InviteLink
                    },
                    admins
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„
        [HttpPost("{channelId}/AddMember")]
        public async Task<IActionResult> AddMember(int channelId, [FromBody] AddMemberRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ² (Ø¨Ø§ÛŒØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´Ø¯)
                var adminChannel = await _context.UserChannels
                    .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == userId.Value && uc.IsAdmin);

                if (adminChannel == null)
                    return StatusCode(403, new { success = false, message = "Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ù†Ø¯Ø§Ø±ÛŒØ¯" });

                // âœ… Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ
                var existing = await _context.UserChannels
                    .FirstOrDefaultAsync(uc => uc.ChannelId == channelId && uc.UserId == request.UserId);

                if (existing != null)
                {
                    if (existing.IsActive)
                        return BadRequest(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¹Ø¶Ùˆ Ø§Ø³Øª" });

                    // âœ… ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
                    existing.Rejoin();
                    await _context.SaveChangesAsync();
                }
                else
                {
                    // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯
                    var userChannel = new UserChannel
                    {
                        UserId = request.UserId,
                        ChannelId = channelId,
                        Role = ChannelRole.Subscriber,
                        IsActive = true,
                        JoinedAt = DateTime.Now
                    };

                    _context.UserChannels.Add(userChannel);
                }

                // âœ… Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§
                var channel = await _context.Channels.FindAsync(channelId);
                if (channel != null)
                {
                    channel.MemberCount = await _context.UserChannels
                        .CountAsync(uc => uc.ChannelId == channelId && uc.IsActive);
                    channel.UpdatedAt = DateTime.Now;
                }

                await _context.SaveChangesAsync();

                return Ok(new { success = true, message = "Ø¹Ø¶Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯" });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø¬Ø³ØªØ¬ÙˆÛŒ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¹Ù…ÙˆÙ…ÛŒ
        [HttpGet("Search")]
        public async Task<IActionResult> SearchPublicChannels([FromQuery] string query)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var channels = await _context.Channels
                    .Where(c => c.IsPublic && !c.IsDeleted && c.IsActive &&
                                c.Name.Contains(query))
                    .Select(c => new
                    {
                        c.Id,
                        c.Name,
                        c.Description,
                        Avatar = c.AvatarUrl ?? "/images/default-channel.png",
                        c.MemberCount,
                        IsJoined = _context.UserChannels
                            .Any(uc => uc.ChannelId == c.Id && uc.UserId == userId.Value && uc.IsActive)
                    })
                    .Take(20)
                    .ToListAsync();

                return Ok(new { success = true, channels });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }
    }

    // âœ… DTOs
    public class CreateChannelRequest
    {
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public bool IsPublic { get; set; } = true;
        public bool OnlyAdminsCanPost { get; set; } = true;
        public bool AllowComments { get; set; } = false;
    }

    public class AddMemberRequest
    {
        public int UserId { get; set; }
    }
} 
 
==================== ChatController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.SignalR;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;
using OrganizationalMessenger.Web.Hubs;
using System.Security.Claims;

namespace OrganizationalMessenger.Web.Controllers
{
    [Authorize]
    public class ChatController : Controller
    {
        private readonly ApplicationDbContext _context;
        private readonly IHubContext<ChatHub> _hubContext; // âœ… 
        public ChatController(ApplicationDbContext context, IHubContext<ChatHub> hubContext)
        {
            _context = context;
            _hubContext = hubContext;
        }

        // ØµÙØ­Ù‡ Ø§ØµÙ„ÛŒ Ú†Øª
        [HttpGet]
        public async Task<IActionResult> Index()
        {
            var userId = GetCurrentUserId();
            if (userId == null)
                return RedirectToAction("Login", "Account");

            var user = await _context.Users
                .Include(u => u.UserGroups)
                    .ThenInclude(ug => ug.Group)
                .Include(u => u.UserChannels)
                    .ThenInclude(uc => uc.Channel)
                .FirstOrDefaultAsync(u => u.Id == userId.Value);

            if (user == null)
                return RedirectToAction("Login", "Account");

            ViewBag.CurrentUser = user;
            ViewBag.Chats = await GetUserChats(userId.Value);
            return View();
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ú†ØªÙ‡Ø§
        [HttpGet]
        [Route("Chat/GetChats")]
        public async Task<IActionResult> GetChats(string tab = "all")
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            var chats = await GetUserChats(userId.Value, tab);
            return Json(chats);
        }

        // Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…Ù‡Ø§ÛŒ ÛŒÚ© Ú†Øª
        // Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ§Ù…Ù‡Ø§ÛŒ ÛŒÚ© Ú†Øª - Ø¨Ø§ Pagination



        [HttpGet]
        public async Task<IActionResult> GetMessages(
                int? userId,
                int? groupId,
                int? channelId,  // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
                int pageSize = 20,
                int? beforeMessageId = null)
        {
            var currentUserId = GetCurrentUserId();
            if (currentUserId == null) return Unauthorized();

            IQueryable<Message> query = _context.Messages
                .Include(m => m.Sender)
                .Include(m => m.ReadReceipts)
                .Include(m => m.Attachments)
                .Include(m => m.ReplyToMessage)
                    .ThenInclude(r => r.Sender)
                .Include(m => m.Reactions)
                    .ThenInclude(r => r.User)
                .Where(m => !m.IsSystemMessage);

            // âœ… Ø´Ø±Ø· Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„
            if (userId.HasValue)
            {
                query = query.Where(m =>
                    (m.SenderId == currentUserId && m.ReceiverId == userId) ||
                    (m.SenderId == userId && m.ReceiverId == currentUserId));
            }
            else if (groupId.HasValue)
            {
                query = query.Where(m => m.GroupId == groupId);
            }
            else if (channelId.HasValue)  // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
            {
                query = query.Where(m => m.ChannelId == channelId);
            }
            else
            {
                return BadRequest("userId, groupId or channelId is required");
            }

            if (beforeMessageId.HasValue)
            {
                var beforeMessage = await _context.Messages.FindAsync(beforeMessageId.Value);
                if (beforeMessage != null)
                {
                    query = query.Where(m => m.SentAt < beforeMessage.SentAt);
                }
            }

            var messages = await query
                .OrderByDescending(m => m.SentAt)
                .Take(pageSize)
                .ToListAsync();

            messages.Reverse();

            var showDeletedNoticeStr = await _context.SystemSettings
                .Where(s => s.Key == "ShowDeletedMessageNotice")
                .Select(s => s.Value)
                .FirstOrDefaultAsync();

            bool showDeletedNotice = true;
            if (!string.IsNullOrEmpty(showDeletedNoticeStr))
            {
                showDeletedNotice = showDeletedNoticeStr.ToLower() == "true";
            }

            var result = messages
                .Where(m => showDeletedNotice || !m.IsDeleted)
                .Select(m => new
                {
                    m.Id,
                    MessageText = m.IsDeleted ? null : m.MessageText,
                    Content = m.IsDeleted ? null : m.Content,
                    m.Type,
                    m.SentAt,
                    m.DeliveredAt,
                    m.IsEdited,
                    m.EditedAt,
                    m.IsDeleted,
                    m.DeletedAt,
                    SenderId = m.SenderId,
                    SenderName = $"{m.Sender.FirstName} {m.Sender.LastName}",
                    SenderAvatar = m.Sender.AvatarUrl ?? "/images/default-avatar.png",
                    IsDelivered = m.IsDelivered,
                    IsRead = m.SenderId == currentUserId.Value
                        ? m.ReadReceipts.Any(r => r.UserId == m.ReceiverId)
                        : m.ReadReceipts.Any(r => r.UserId == currentUserId.Value),
                    ReadAt = m.SenderId == currentUserId.Value
                        ? m.ReadReceipts
                            .Where(r => r.UserId == m.ReceiverId)
                            .Select(r => (DateTime?)r.ReadAt)
                            .FirstOrDefault()
                        : m.ReadReceipts
                            .Where(r => r.UserId == currentUserId.Value)
                            .Select(r => (DateTime?)r.ReadAt)
                            .FirstOrDefault(),
                    ReplyToMessageId = m.ReplyToMessageId,
                    ReplyToText = m.ReplyToMessage != null ? m.ReplyToMessage.Content : null,
                    ReplyToSenderName = m.ReplyToMessage != null
                        ? $"{m.ReplyToMessage.Sender.FirstName} {m.ReplyToMessage.Sender.LastName}"
                        : null,
                    Attachments = m.IsDeleted
                        ? new List<object>()
                        : m.Attachments
                            .Where(a => !a.IsDeleted)
                            .Select(a => (object)new
                            {
                                a.Id,
                                a.OriginalFileName,
                                a.FileUrl,
                                a.ThumbnailUrl,
                                FileType = a.FileType.ToString(),
                                a.FileSize,
                                a.Extension,
                                ReadableSize = a.ReadableFileSize,
                                a.Width,
                                a.Height,
                                a.Duration,
                                ReadableDuration = a.ReadableDuration
                            })
                            .ToList(),
                    // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Reactions Ø¨Ø§ hasReacted
                    Reactions = m.Reactions
                        .GroupBy(r => r.Emoji)
                        .Select(g => new
                        {
                            emoji = g.Key,
                            count = g.Count(),
                            users = g.Select(r => new
                            {
                                id = r.UserId,
                                name = $"{r.User.FirstName} {r.User.LastName}"
                            }).ToList(),
                            hasReacted = g.Any(r => r.UserId == currentUserId.Value)
                        })
                        .ToList()
                })
                .ToList();

            return Json(new
            {
                messages = result,
                hasMore = messages.Count == pageSize
            });
        }



        // âœ… Ø§ØµÙ„Ø§Ø­ SendMessage - Ø¨Ø§ Ú©Ù¾Ø´Ù†
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> SendMessage([FromBody] SendMessageRequest request)
        {
            var senderId = GetCurrentUserId();
            if (senderId == null) return Unauthorized();

            if (!ModelState.IsValid)
                return BadRequest(ModelState);

            if (request.ReceiverId == null && request.GroupId == null && request.ChannelId == null)
                return BadRequest("ReceiverId or GroupId or ChannelId must be specified.");

            var sender = await _context.Users.FindAsync(senderId.Value);
            if (sender == null || !sender.IsActive)
                return Unauthorized();

            if (request.GroupId.HasValue)
            {
                var isGroupMember = await _context.UserGroups
                    .AnyAsync(ug => ug.UserId == senderId && ug.GroupId == request.GroupId && ug.IsActive);
                if (!isGroupMember) return Forbid();
            }

            // âœ… Log Ø¨Ø±Ø§ÛŒ debug
            Console.WriteLine($"ğŸ“ MessageText received: {request.MessageText}");
            var now = DateTime.UtcNow;
            var message = new Message
            {
                SenderId = senderId.Value,
                ReceiverId = request.ReceiverId,
                GroupId = request.GroupId,
                ChannelId = request.ChannelId,
                MessageText = request.MessageText,      // âœ… Ú©Ù¾Ø´Ù†
                Content = request.MessageText,          // âœ… Ú©Ù¾Ø´Ù† (Ù‡Ø± Ø¯Ùˆ ÙÛŒÙ„Ø¯)
                Type = request.Type,
                SentAt = now,
                IsDelivered = false
            };

            _context.Messages.Add(message);
            await _context.SaveChangesAsync();

            Console.WriteLine($"âœ… Message saved: Id={message.Id}, Content={message.Content}");

            // Ø§ØªØµØ§Ù„ ÙØ§ÛŒÙ„ Ø¨Ù‡ Ù¾ÛŒØ§Ù…
            if (request.FileAttachmentId.HasValue)
            {
                var file = await _context.FileAttachments
                    .FirstOrDefaultAsync(f => f.Id == request.FileAttachmentId.Value &&
                                             f.UploaderId == senderId.Value);
                if (file != null)
                {
                    file.MessageId = message.Id;
                    await _context.SaveChangesAsync();
                    Console.WriteLine($"âœ… File attached: FileId={file.Id}, MessageId={message.Id}");
                }
            }

            return Json(new
            {
                success = true,
                messageId = message.Id,
                sentAt = message.SentAt
            });
        }


        // Ù…ØªØ¯ Ú©Ù…Ú©ÛŒ Ø¨Ø±Ø§ÛŒ Ú¯Ø±ÙØªÙ† Ø¢ÛŒâ€ŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ù„ÛŒ
        private int? GetCurrentUserId()
        {
            var claim = User.FindFirst(ClaimTypes.NameIdentifier);
            if (claim == null)
                return null;

            if (int.TryParse(claim.Value, out var id))
                return id;

            return null;
        }


        // âœ… Ù…ÙˆÙ‚ØªØ§Ù‹ Ø¨Ø±Ø§ÛŒ ØªØ³Øª - 2 Ú©Ø§Ø±Ø¨Ø± Ø¯ÛŒÚ¯Ù‡ Ø¨Ø³Ø§Ø²



        // Ù…ØªØ¯ Ú©Ù…Ú©ÛŒ

        // âœ… Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ø§ÛŒÙ† Ù…ØªØ¯ Ú©Ù…Ú©ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ú©Ù†ÛŒØ¯:

        private async Task<dynamic> GetUserChats(int userId, string tab = "all")
        {
            var chats = new List<dynamic>();

            // âœ… Ú†Øªâ€ŒÙ‡Ø§ÛŒ Ø®ØµÙˆØµÛŒ
            if (tab == "all" || tab == "private")
            {
                var users = await _context.Users
                    .Where(u => u.Id != userId && u.IsActive)
                    .OrderBy(u => u.FirstName)
                    .ThenBy(u => u.LastName)
                    .Take(50)
                    .ToListAsync();

                foreach (var user in users)
                {
                    var fullName = $"{user.FirstName} {user.LastName}".Trim();

                    var lastMessage = await _context.Messages
                        .Where(m =>
                            ((m.SenderId == userId && m.ReceiverId == user.Id) ||
                             (m.SenderId == user.Id && m.ReceiverId == userId)))
                        .OrderByDescending(m => m.SentAt)
                        .FirstOrDefaultAsync();

                    var unreadCount = await _context.Messages
                        .Where(m => m.SenderId == user.Id &&
                                   m.ReceiverId == userId &&
                                   !_context.MessageReads.Any(mr => mr.MessageId == m.Id && mr.UserId == userId))
                        .CountAsync();

                    chats.Add(new
                    {
                        type = "private",
                        id = user.Id,
                        name = fullName,
                        avatar = user.AvatarUrl ?? "/images/default-avatar.png",
                        isOnline = user.IsOnline,
                        lastMessage = lastMessage != null ?
                            (lastMessage.MessageText ?? lastMessage.Content ?? "") : "",
                        lastMessageTime = lastMessage?.SentAt ?? user.LastSeen ?? user.CreatedAt,
                        unreadCount,
                        messageDirection = lastMessage?.SenderId == userId ? "sent" : "received"
                    });
                }
            }

            // âœ… Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
            if (tab == "all" || tab == "groups")
            {
                var groups = await _context.UserGroups
                    .Where(ug => ug.UserId == userId && ug.IsActive)
                    .Include(ug => ug.Group)
                    .ToListAsync();

                foreach (var ug in groups)
                {
                    var lastMessage = await _context.Messages
                        .Where(m => m.GroupId == ug.GroupId && !m.IsDeleted)
                        .OrderByDescending(m => m.SentAt)
                        .FirstOrDefaultAsync();

                    var memberCount = await _context.UserGroups
                        .CountAsync(x => x.GroupId == ug.GroupId && x.IsActive);

                    chats.Add(new
                    {
                        type = "group",
                        id = ug.Group.Id,
                        name = ug.Group.Name,
                        avatar = ug.Group.AvatarUrl ?? "/images/default-group.png",
                        isOnline = false,
                        lastMessage = lastMessage != null ?
                            (lastMessage.MessageText ?? lastMessage.Content ?? "") : "Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ§Ù…",
                        lastMessageTime = lastMessage?.SentAt ?? ug.Group.CreatedAt,
                        memberCount,
                        unreadCount = 0, // TODO: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¯Ù‚ÛŒÙ‚
                        role = ug.Role.ToString(),
                        isAdmin = ug.IsAdmin,
                        isMuted = ug.IsMuted
                    });
                }
            }

            // âœ… Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§
            if (tab == "all" || tab == "channels")
            {
                var channels = await _context.UserChannels
                    .Where(uc => uc.UserId == userId && uc.IsActive)
                    .Include(uc => uc.Channel)
                    .Where(uc => !uc.Channel.IsDeleted)
                    .ToListAsync();

                foreach (var uc in channels)
                {
                    var lastMessage = await _context.Messages
                        .Where(m => m.ChannelId == uc.ChannelId && !m.IsDeleted)
                        .OrderByDescending(m => m.SentAt)
                        .FirstOrDefaultAsync();

                    chats.Add(new
                    {
                        type = "channel",
                        id = uc.Channel.Id,
                        name = uc.Channel.Name,
                        avatar = uc.Channel.AvatarUrl ?? "/images/default-channel.png",
                        isOnline = false,
                        lastMessage = lastMessage != null ?
                            (lastMessage.MessageText ?? lastMessage.Content ?? "") : "Ø¨Ø¯ÙˆÙ† Ù¾ÛŒØ§Ù…",
                        lastMessageTime = lastMessage?.SentAt ?? uc.Channel.CreatedAt,
                        memberCount = uc.Channel.MemberCount,
                        unreadCount = uc.UnreadCount,
                        role = uc.Role.ToString(),
                        isAdmin = uc.IsAdmin,
                        canPost = uc.CanPost,
                        isMuted = uc.IsMuted,
                        isPinned = uc.IsPinned
                    });
                }
            }

            return chats.OrderByDescending(c => c.lastMessageTime ?? DateTime.MinValue).ToList();
        }






        // âœ… DTO Ù‡Ø§




        // âœ… ÙÙ‚Ø· Ø§ÛŒÙ† 2 Ù…ØªØ¯ Ø±Ùˆ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† (Ø¨Ù‚ÛŒÙ‡ Ø±Ùˆ Ø¯Ø³Øª Ù†Ø²Ù†):

        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> MarkMessagesAsRead([FromBody] MarkAsReadRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            var now = DateTime.Now;
            var messagesToMark = await _context.Messages
                .Where(m => request.MessageIds.Contains(m.Id) &&
                           m.ReceiverId == userId.Value &&  // ÙÙ‚Ø· Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÛŒ
                           m.SenderId != userId.Value)      // ğŸš¨ Ùˆ Ù†Ù‡ Ø§Ø±Ø³Ø§Ù„ÛŒ Ø®ÙˆØ¯Ù…!
                .ToListAsync();

            foreach (var message in messagesToMark)
            {
                if (!await _context.MessageReads.AnyAsync(mr =>
                    mr.MessageId == message.Id && mr.UserId == userId.Value))
                {
                    _context.MessageReads.Add(new MessageRead
                    {
                        MessageId = message.Id,
                        UserId = userId.Value,
                        ReadAt = now
                    });
                }
            }

            await _context.SaveChangesAsync();
            return Json(new { success = true, markedCount = messagesToMark.Count });
        }


        // âœ… Ú©Ù„Ø§Ø³ DTO (ÙÙ‚Ø· 1 Ø¨Ø§Ø± - Ø®Ø· Ø¢Ø®Ø± Ú©Ù„Ø§Ø³)
        public class MarkAsReadRequest
        {
            public List<int> MessageIds { get; set; } = new();
        }







        [AllowAnonymous]
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> SignOut()
        {
            await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);

            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªÙ…Ø§Ù… cookie Ù‡Ø§
            Response.Cookies.Delete(".AspNetCore.Cookies");

            return RedirectToAction("Login", "Account");
        }

        //*************************************************************
        // âœ… Ø¯Ø±ÛŒØ§ÙØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        [HttpGet]
        public async Task<IActionResult> GetMessageSettings()
        {
            try
            {
                var allowEdit = await _context.SystemSettings
                    .Where(s => s.Key == "AllowMessageEdit")
                    .Select(s => s.Value.ToLower() == "true")
                    .FirstOrDefaultAsync();

                var allowDelete = await _context.SystemSettings
                    .Where(s => s.Key == "AllowMessageDelete")
                    .Select(s => s.Value.ToLower() == "true")
                    .FirstOrDefaultAsync();

                var editTimeLimitStr = await _context.SystemSettings
                    .Where(s => s.Key == "MessageEditTimeLimit")
                    .Select(s => s.Value)
                    .FirstOrDefaultAsync();

                int editTimeLimit = 3600;
                if (!string.IsNullOrEmpty(editTimeLimitStr))
                {
                    int.TryParse(editTimeLimitStr, out editTimeLimit);
                }

                var deleteTimeLimitStr = await _context.SystemSettings
                    .Where(s => s.Key == "MessageDeleteTimeLimit")
                    .Select(s => s.Value)
                    .FirstOrDefaultAsync();

                int deleteTimeLimit = 7200;
                if (!string.IsNullOrEmpty(deleteTimeLimitStr))
                {
                    int.TryParse(deleteTimeLimitStr, out deleteTimeLimit);
                }

                return Ok(new
                {
                    success = true,
                    allowEdit,
                    allowDelete,
                    editTimeLimit,
                    deleteTimeLimit
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> EditMessage([FromBody] EditMessageRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var message = await _context.Messages
                    .FirstOrDefaultAsync(m => m.Id == request.MessageId && m.SenderId == userId.Value);

                if (message == null)
                    return NotFound(new { success = false, message = "Ù¾ÛŒØ§Ù… ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯" });

                var allowEdit = await _context.SystemSettings
                    .Where(s => s.Key == "AllowMessageEdit")
                    .Select(s => s.Value.ToLower() == "true")
                    .FirstOrDefaultAsync();

                if (!allowEdit)
                    return BadRequest(new { success = false, message = "ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª" });

                var editTimeLimitStr = await _context.SystemSettings
                    .Where(s => s.Key == "MessageEditTimeLimit")
                    .Select(s => s.Value)
                    .FirstOrDefaultAsync();

                int editTimeLimit = 3600;
                if (!string.IsNullOrEmpty(editTimeLimitStr))
                {
                    int.TryParse(editTimeLimitStr, out editTimeLimit);
                }

                var elapsedSeconds = (DateTime.Now - message.SentAt).TotalSeconds;
                if (elapsedSeconds > editTimeLimit)
                {
                    return BadRequest(new
                    {
                        success = false,
                        message = $"Ø²Ù…Ø§Ù† Ù…Ø¬Ø§Ø² ÙˆÛŒØ±Ø§ÛŒØ´ ({editTimeLimit} Ø«Ø§Ù†ÛŒÙ‡) Ú¯Ø°Ø´ØªÙ‡ Ø§Ø³Øª"
                    });
                }

                message.Content = request.NewContent;
                message.MessageText = request.NewContent;
                message.IsEdited = true;
                message.EditedAt = DateTime.Now;

                await _context.SaveChangesAsync();

                return Ok(new
                {
                    success = true,
                    message = "Ù¾ÛŒØ§Ù… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ Ø´Ø¯",
                    editedAt = message.EditedAt
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }






        // âœ… Ø­Ø°Ù Ù¾ÛŒØ§Ù…
        // âœ… Ø­Ø°Ù Ù¾ÛŒØ§Ù… - Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> DeleteMessage([FromBody] DeleteMessageRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var message = await _context.Messages
                    .Include(m => m.Attachments)
                    .FirstOrDefaultAsync(m => m.Id == request.MessageId && m.SenderId == userId.Value);

                if (message == null)
                    return NotFound(new { success = false, message = "Ù¾ÛŒØ§Ù… ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯" });

                var allowDelete = await _context.SystemSettings
                    .Where(s => s.Key == "AllowMessageDelete")
                    .Select(s => s.Value.ToLower() == "true")
                    .FirstOrDefaultAsync();

                if (!allowDelete)
                    return BadRequest(new { success = false, message = "Ø­Ø°Ù Ù¾ÛŒØ§Ù… ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª" });

                var deleteTimeLimitStr = await _context.SystemSettings
                    .Where(s => s.Key == "MessageDeleteTimeLimit")
                    .Select(s => s.Value)
                    .FirstOrDefaultAsync();

                int deleteTimeLimit = 7200;
                if (!string.IsNullOrEmpty(deleteTimeLimitStr))
                {
                    int.TryParse(deleteTimeLimitStr, out deleteTimeLimit);
                }

                var elapsedSeconds = (DateTime.Now - message.SentAt).TotalSeconds;
                if (elapsedSeconds > deleteTimeLimit)
                {
                    return BadRequest(new
                    {
                        success = false,
                        message = $"Ø²Ù…Ø§Ù† Ù…Ø¬Ø§Ø² Ø­Ø°Ù ({deleteTimeLimit} Ø«Ø§Ù†ÛŒÙ‡) Ú¯Ø°Ø´ØªÙ‡ Ø§Ø³Øª"
                    });
                }

                var showDeletedNoticeStr = await _context.SystemSettings
                    .Where(s => s.Key == "ShowDeletedMessageNotice")
                    .Select(s => s.Value)
                    .FirstOrDefaultAsync();

                bool showDeletedNotice = true;
                if (!string.IsNullOrEmpty(showDeletedNoticeStr))
                {
                    showDeletedNotice = showDeletedNoticeStr.ToLower() == "true";
                }

                // âœ… Ø°Ø®ÛŒØ±Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù‚Ø¨Ù„ Ø§Ø² Ø­Ø°Ù
                var messageIdForNotification = message.Id;
                var receiverIdForNotification = message.ReceiverId;

                if (showDeletedNotice)
                {
                    // ÙˆØ§ØªØ³Ø§Ù¾ mode: Ù†Ù…Ø§ÛŒØ´ "Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ø´Ø¯Ù‡"
                    message.Content = null;
                    message.MessageText = null;
                    message.IsDeleted = true;
                    message.DeletedAt = DateTime.Now;

                    foreach (var attachment in message.Attachments)
                    {
                        attachment.IsDeleted = true;
                    }

                    await _context.SaveChangesAsync();
                }
                else
                {
                    // âœ… ØªÙ„Ú¯Ø±Ø§Ù… mode: Ø­Ø°Ù Ú©Ø§Ù…Ù„ - Ø§ÙˆÙ„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ù†
                    _context.Messages.Remove(message);
                    await _context.SaveChangesAsync();
                }

                return Ok(new
                {
                    success = true,
                    message = "Ù¾ÛŒØ§Ù… Ø­Ø°Ù Ø´Ø¯",
                    showNotice = showDeletedNotice,
                    messageId = messageIdForNotification,  // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
                    receiverId = receiverIdForNotification  // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        public class DeleteMessageRequest
        {
            public int MessageId { get; set; }
        }





        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> ForwardMessages([FromBody] ForwardMessagesRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var messages = await _context.Messages
                    .Include(m => m.Attachments)
                    .Where(m => request.MessageIds.Contains(m.Id))
                    .ToListAsync();

                var forwardedMessageIds = new List<int>();

                foreach (var originalMessage in messages)
                {
                    var newMessage = new Message
                    {
                        SenderId = userId.Value,
                        ReceiverId = request.ReceiverId,
                        MessageText = originalMessage.MessageText,
                        Content = originalMessage.Content,
                        Type = originalMessage.Type,
                        SentAt = DateTime.Now,
                        IsDelivered = false,
                        IsEdited = false,
                        ForwardedFromMessageId = originalMessage.Id,
                        ForwardedFromUserId = originalMessage.SenderId,
                        Attachments = originalMessage.Attachments
                            .Where(a => !a.IsDeleted)
                            .Select(a => new FileAttachment
                            {
                                FileName = a.FileName,
                                OriginalFileName = a.OriginalFileName,
                                FilePath = a.FilePath,
                                FileUrl = a.FileUrl,
                                ContentType = a.ContentType,
                                Extension = a.Extension,
                                FileSize = a.FileSize,
                                FileType = a.FileType,
                                ThumbnailPath = a.ThumbnailPath,
                                ThumbnailUrl = a.ThumbnailUrl,
                                Width = a.Width,
                                Height = a.Height,
                                Duration = a.Duration,
                                UploaderId = userId.Value,
                                CreatedAt = DateTime.Now,
                                IsDeleted = false,
                                FileHash = a.FileHash,
                                IsScanned = a.IsScanned,
                                IsSafe = a.IsSafe,
                                ScannedAt = a.ScannedAt,
                                ScanResult = a.ScanResult,
                                DownloadCount = 0,
                                LastDownloadAt = null
                            })
                            .ToList()
                    };

                    _context.Messages.Add(newMessage);
                    await _context.SaveChangesAsync();

                    forwardedMessageIds.Add(newMessage.Id);

                    // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Real-time Ø¨Ù‡ Ú¯ÛŒØ±Ù†Ø¯Ù‡ Ø§Ø² Ø·Ø±ÛŒÙ‚ SignalR
                    try
                    {
                        var receiver = await _context.Users.FindAsync(request.ReceiverId);
                        if (receiver != null)
                        {
                            var messageDto = new
                            {
                                id = newMessage.Id,
                                senderId = newMessage.SenderId,
                                senderName = $"{User.Identity.Name}",
                                senderAvatar = "/images/default-avatar.png", // ÛŒØ§ Ø§Ø² Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø¨Ú¯ÛŒØ±ÛŒØ¯
                                content = newMessage.Content,
                                messageText = newMessage.MessageText,
                                type = newMessage.Type,
                                sentAt = newMessage.SentAt,
                                isDelivered = false,
                                isRead = false,
                                attachments = newMessage.Attachments.Select(a => new
                                {
                                    a.Id,
                                    a.OriginalFileName,
                                    a.FileUrl,
                                    a.ThumbnailUrl,
                                    fileType = a.FileType,
                                    a.FileSize,
                                    a.Extension,
                                    readableSize = a.ReadableFileSize,
                                    a.Width,
                                    a.Height
                                }).ToList()
                            };

                            await _hubContext.Clients.User(request.ReceiverId.ToString())
                                .SendAsync("ReceiveMessage", messageDto);
                        }
                    }
                    catch (Exception signalREx)
                    {
                        Console.WriteLine($"âš ï¸ SignalR notification error: {signalREx.Message}");
                    }
                }

                return Ok(new { success = true, message = "Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø§Ø±Ø¬Ø§Ø¹ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù†Ø¯", forwardedIds = forwardedMessageIds });
            }
            catch (Exception ex)
            {
                Console.WriteLine($"âŒ ForwardMessages error: {ex.Message}");
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }




        public class ForwardMessagesRequest
        {
            public List<int> MessageIds { get; set; } = new();
            public int ReceiverId { get; set; }
        }




        // ============================================
        // React to Message
        // ============================================

        [HttpPost]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> ReactToMessage([FromBody] ReactToMessageRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var message = await _context.Messages
                    .FirstOrDefaultAsync(m => m.Id == request.MessageId);

                if (message == null)
                    return NotFound(new { success = false, message = "Ù¾ÛŒØ§Ù… ÛŒØ§ÙØª Ù†Ø´Ø¯" });

                // âœ… Ú†Ú© Ú©Ø±Ø¯Ù† ÙˆØ¬ÙˆØ¯ react Ù‚Ø¨Ù„ÛŒ Ø¨Ø§ Ù‡Ù…ÛŒÙ† Ø§ÛŒÙ…ÙˆØ¬ÛŒ
                var existingReaction = await _context.MessageReactions
                    .FirstOrDefaultAsync(mr =>
                        mr.MessageId == request.MessageId &&
                        mr.UserId == userId.Value &&
                        mr.Emoji == request.Emoji);

                if (existingReaction != null)
                {
                    // âœ… Ø­Ø°Ù react (toggle)
                    _context.MessageReactions.Remove(existingReaction);
                    await _context.SaveChangesAsync();

                    var updatedReactions = await GetMessageReactions(request.MessageId, userId.Value);

                    return Ok(new
                    {
                        success = true,
                        action = "removed",
                        messageId = request.MessageId,
                        emoji = request.Emoji,
                        reactions = updatedReactions
                    });
                }
                else
                {
                    // âœ… Ø­Ø°Ù ØªÙ…Ø§Ù… reaction Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø§Ø² Ø§ÛŒÙ† Ù¾ÛŒØ§Ù…
                    var oldReactions = await _context.MessageReactions
                        .Where(mr => mr.MessageId == request.MessageId && mr.UserId == userId.Value)
                        .ToListAsync();

                    if (oldReactions.Any())
                    {
                        _context.MessageReactions.RemoveRange(oldReactions);
                        Console.WriteLine($"ğŸ—‘ï¸ Removed {oldReactions.Count} old reactions from user {userId.Value}");
                    }

                    // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† react Ø¬Ø¯ÛŒØ¯
                    var reaction = new MessageReaction
                    {
                        MessageId = request.MessageId,
                        UserId = userId.Value,
                        Emoji = request.Emoji,
                        CreatedAt = DateTime.Now
                    };

                    _context.MessageReactions.Add(reaction);
                    await _context.SaveChangesAsync();

                    var updatedReactions = await GetMessageReactions(request.MessageId, userId.Value);

                    return Ok(new
                    {
                        success = true,
                        action = "added",
                        messageId = request.MessageId,
                        emoji = request.Emoji,
                        reactions = updatedReactions
                    });
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"âŒ ReactToMessage error: {ex.Message}");
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª reactions ÛŒÚ© Ù¾ÛŒØ§Ù…
        private async Task<List<object>> GetMessageReactions(int messageId, int currentUserId)
        {
            var reactions = await _context.MessageReactions
                .Where(mr => mr.MessageId == messageId)
                .Include(mr => mr.User)
                .GroupBy(mr => mr.Emoji)
                .Select(g => new
                {
                    emoji = g.Key,
                    count = g.Count(),
                    users = g.Select(mr => new
                    {
                        id = mr.UserId,
                        name = $"{mr.User.FirstName} {mr.User.LastName}"
                    }).ToList(),
                    hasReacted = g.Any(mr => mr.UserId == currentUserId) // âœ… Ø¢ÛŒØ§ Ù…Ù† react Ø²Ø¯Ù‡â€ŒØ§Ù…ØŸ
                })
                .ToListAsync();

            return reactions.Cast<object>().ToList();
        }

        // âœ… DTO
        public class ReactToMessageRequest
        {
            public int MessageId { get; set; }
            public string Emoji { get; set; } = string.Empty;
        }




    }

    public class EditMessageRequest
    {
        public int MessageId { get; set; }
        public string NewContent { get; set; } = string.Empty;
    }

    public class SendMessageRequest
    {
        public int? ReceiverId { get; set; }
        public int? GroupId { get; set; }
        public int? ChannelId { get; set; }
        public string? MessageText { get; set; }
        public MessageType Type { get; set; } = MessageType.Text;
        public int? FileAttachmentId { get; set; }  // âœ… Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯

    }
}
 
 
==================== FileController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Infrastructure.Data;
using SixLabors.ImageSharp;
using SixLabors.ImageSharp.Formats.Jpeg;
using SixLabors.ImageSharp.Processing;
using System.Security.Claims;
using static System.Net.Mime.MediaTypeNames;

namespace OrganizationalMessenger.Web.Controllers
{
    [Authorize]
    [Route("api/[controller]")]
    [ApiController]
    public class FileController : ControllerBase
    {
        private readonly ApplicationDbContext _context;
        private readonly IWebHostEnvironment _env;

        public FileController(ApplicationDbContext context, IWebHostEnvironment env)
        {
            _context = context;
            _env = env;
        }

        // âœ… Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
        // âœ… Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ - Ø¨Ø§ Ú©Ù¾Ø´Ù†

        [HttpPost("upload")]
        public async Task<IActionResult> UploadFile(
    IFormFile file,
    [FromForm] int? messageId = null,
    [FromForm] string? caption = null,
    [FromForm] int? duration = null)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            if (file == null || file.Length == 0)
                return BadRequest(new { success = false, message = "ÙØ§ÛŒÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª" });

            var extension = Path.GetExtension(file.FileName).ToLower().TrimStart('.');
            var contentType = file.ContentType;

            // âœ… Ø§Ú¯Ø± duration Ø¯Ø§Ø±ÛŒÙ… â†’ Ø­ØªÙ…Ø§Ù‹ Audio Ø§Ø³Øª
            string category = null;
            if (duration.HasValue && duration.Value > 0)
            {
                category = "Audio";
                Console.WriteLine($"ğŸ¤ Detected voice message: duration={duration}s");
            }

            var uploadSetting = await _context.FileUploadSettings
                .FirstOrDefaultAsync(f => f.FileType.ToLower() == extension && f.IsAllowed);

            if (uploadSetting == null)
                return BadRequest(new { success = false, message = $"ÙØ±Ù…Øª .{extension} Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª" });

            // âœ… Ø§Ú¯Ø± duration Ø¯Ø§Ø±ÛŒÙ…ØŒ category Ø±Ø§ Override Ú©Ù†
            if (category == "Audio")
            {
                uploadSetting.Category = "Audio";
            }

            if (file.Length > uploadSetting.MaxSize)
            {
                var maxSizeMB = uploadSetting.MaxSize / (1024.0 * 1024.0);
                return BadRequest(new { success = false, message = $"Ø­Ø¬Ù… ÙØ§ÛŒÙ„ Ù†Ø¨Ø§ÛŒØ¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² {maxSizeMB:0.##} MB Ø¨Ø§Ø´Ø¯" });
            }

            try
            {
                var uploadsPath = Path.Combine(_env.WebRootPath, "uploads", uploadSetting.Category.ToLower());
                if (!Directory.Exists(uploadsPath))
                    Directory.CreateDirectory(uploadsPath);

                var fileName = $"{Guid.NewGuid()}{Path.GetExtension(file.FileName)}";
                var filePath = Path.Combine(uploadsPath, fileName);
                var fileUrl = $"/uploads/{uploadSetting.Category.ToLower()}/{fileName}";

                using (var stream = new FileStream(filePath, FileMode.Create))
                {
                    await file.CopyToAsync(stream);
                }

                string? thumbnailUrl = null;
                string? thumbnailPath = null;
                int? width = null, height = null;

                if (uploadSetting.Category.ToLower() == "image")
                {
                    try
                    {
                        using var image = await SixLabors.ImageSharp.Image.LoadAsync(filePath);
                        width = image.Width;
                        height = image.Height;

                        var thumbDir = Path.Combine(uploadsPath, "thumbs");
                        if (!Directory.Exists(thumbDir))
                            Directory.CreateDirectory(thumbDir);

                        var thumbFileName = $"thumb_{fileName}";
                        thumbnailPath = Path.Combine(thumbDir, thumbFileName);

                        var clone = image.Clone(x => x.Resize(new ResizeOptions
                        {
                            Size = new Size(300, 300),
                            Mode = ResizeMode.Max
                        }));

                        await clone.SaveAsJpegAsync(thumbnailPath, new JpegEncoder { Quality = 80 });
                        thumbnailUrl = $"/uploads/{uploadSetting.Category.ToLower()}/thumbs/{thumbFileName}";
                    }
                    catch (Exception ex)
                    {
                        Console.WriteLine($"âŒ Thumbnail error: {ex.Message}");
                    }
                }

                string? fileHash = null;
                try
                {
                    using var sha256 = System.Security.Cryptography.SHA256.Create();
                    using var fileStream = System.IO.File.OpenRead(filePath);
                    var hashBytes = await sha256.ComputeHashAsync(fileStream);
                    fileHash = BitConverter.ToString(hashBytes).Replace("-", "").ToLower();
                }
                catch { }

                var fileAttachment = new FileAttachment
                {
                    FileName = fileName,
                    OriginalFileName = file.FileName,
                    FilePath = filePath,
                    FileUrl = fileUrl,
                    ContentType = contentType,
                    Extension = extension,
                    FileSize = file.Length,
                    FileType = uploadSetting.Category, // âœ… Audio ÛŒØ§ Video
                    ThumbnailPath = thumbnailPath,
                    ThumbnailUrl = thumbnailUrl,
                    Width = width,
                    Height = height,
                    Duration = duration, // âœ…
                    UploaderId = userId.Value,
                    MessageId = messageId,
                    CreatedAt = DateTime.Now,
                    FileHash = fileHash,
                    IsSafe = true,
                    IsScanned = false
                };

                _context.FileAttachments.Add(fileAttachment);
                await _context.SaveChangesAsync();

                Console.WriteLine($"âœ… File uploaded: ID={fileAttachment.Id}, Type={fileAttachment.FileType}, Duration={duration}s");

                return Ok(new
                {
                    success = true,
                    file = new
                    {
                        id = fileAttachment.Id,
                        fileName = fileAttachment.FileName,
                        originalFileName = fileAttachment.OriginalFileName,
                        fileUrl = fileAttachment.FileUrl,
                        thumbnailUrl = fileAttachment.ThumbnailUrl,
                        fileType = fileAttachment.FileType, // âœ… Audio
                        fileSize = fileAttachment.FileSize,
                        width = fileAttachment.Width,
                        height = fileAttachment.Height,
                        extension = fileAttachment.Extension,
                        duration = fileAttachment.Duration,
                        readableSize = fileAttachment.ReadableFileSize,
                        readableDuration = fileAttachment.ReadableDuration
                    },
                    caption
                });
            }
            catch (Exception ex)
            {
                Console.WriteLine($"âŒ Upload error: {ex.Message}");
                return StatusCode(500, new { success = false, message = $"Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„: {ex.Message}" });
            }
        }










        // âœ… Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
        [HttpGet("download/{id}")]
        public async Task<IActionResult> DownloadFile(int id)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            var file = await _context.FileAttachments
                .FirstOrDefaultAsync(f => f.Id == id && !f.IsDeleted);

            if (file == null)
                return NotFound(new { success = false, message = "ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯" });

            if (!file.IsSafe)
                return BadRequest(new { success = false, message = "Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø§Ù…Ù† Ù†ÛŒØ³Øª Ùˆ Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù†Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯" });

            if (!System.IO.File.Exists(file.FilePath))
                return NotFound(new { success = false, message = "ÙØ§ÛŒÙ„ ÙÛŒØ²ÛŒÚ©ÛŒ Ø¯Ø± Ø³Ø±ÙˆØ± ÛŒØ§ÙØª Ù†Ø´Ø¯" });

            // âœ… Ø§ÙØ²Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¯Ø§Ù†Ù„ÙˆØ¯
            file.IncrementDownloadCount();
            await _context.SaveChangesAsync();

            var memory = new MemoryStream();
            using (var stream = new FileStream(file.FilePath, FileMode.Open))
            {
                await stream.CopyToAsync(memory);
            }
            memory.Position = 0;

            return File(memory, file.ContentType ?? "application/octet-stream", file.OriginalFileName);
        }

        // âœ… Ø­Ø°Ù ÙØ§ÛŒÙ„ (soft delete)
        [HttpDelete("delete/{id}")]
        public async Task<IActionResult> DeleteFile(int id)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            var file = await _context.FileAttachments
                .FirstOrDefaultAsync(f => f.Id == id && f.UploaderId == userId.Value && !f.IsDeleted);

            if (file == null)
                return NotFound(new { success = false, message = "ÙØ§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯ ÛŒØ§ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±ÛŒØ¯" });

            file.MarkAsDeleted();
            await _context.SaveChangesAsync();

            return Ok(new { success = true, message = "ÙØ§ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯" });
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ÛŒÚ© Ù¾ÛŒØ§Ù…
        [HttpGet("message/{messageId}")]
        public async Task<IActionResult> GetMessageFiles(int messageId)
        {
            var files = await _context.FileAttachments
                .Where(f => f.MessageId == messageId && !f.IsDeleted)
                .Select(f => new
                {
                    f.Id,
                    f.OriginalFileName,
                    f.FileUrl,
                    f.ThumbnailUrl,
                    f.FileType,
                    f.FileSize,
                    ReadableSize = f.ReadableFileSize,
                    f.Width,
                    f.Height,
                    f.Extension,
                    f.CreatedAt
                })
                .ToListAsync();

            return Ok(new { success = true, files });
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
        [HttpGet("settings")]
        public async Task<IActionResult> GetUploadSettings()
        {
            var settings = await _context.FileUploadSettings
                .Where(f => f.IsAllowed)
                .Select(f => new
                {
                    f.FileType,
                    f.Category,
                    f.MaxSize,
                    MaxSizeMB = f.MaxSize / (1024.0 * 1024.0)
                })
                .ToListAsync();

            return Ok(new { success = true, settings });
        }

        // ========== Ù…ØªØ¯Ù‡Ø§ÛŒ Ú©Ù…Ú©ÛŒ ==========

        private int? GetCurrentUserId()
        {
            var claim = User.FindFirst(ClaimTypes.NameIdentifier);
            if (claim == null) return null;
            if (int.TryParse(claim.Value, out var id)) return id;
            return null;
        }
    }
} 
 
==================== GroupController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;

namespace OrganizationalMessenger.Controllers
{
    [Authorize]
    [Route("api/[controller]")]
    [ApiController]
    public class GroupController : ControllerBase
    {
        private readonly ApplicationDbContext _context;

        public GroupController(ApplicationDbContext context)
        {
            _context = context;
        }

        private int? GetCurrentUserId()
        {
            var userIdClaim = User.FindFirst("UserId")?.Value;
            return int.TryParse(userIdClaim, out var userId) ? userId : null;
        }

        // âœ… Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯
        [HttpPost("Create")]
        public async Task<IActionResult> CreateGroup([FromBody] CreateGroupRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ²
                var user = await _context.Users.FindAsync(userId.Value);
                if (user == null || !user.CanCreateGroup)
                {
                    return Forbid("Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ù†Ø¯Ø§Ø±ÛŒØ¯");
                }

                // âœ… Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡
                var group = new Group
                {
                    Name = request.Name,
                    Description = request.Description,
                    CreatorId = userId.Value,
                    IsPublic = request.IsPublic,
                    MaxMembers = request.MaxMembers ?? 200,
                    IsActive = true,
                    CreatedAt = DateTime.Now
                };

                _context.Groups.Add(group);
                await _context.SaveChangesAsync();

                // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Owner
                var userGroup = new UserGroup
                {
                    UserId = userId.Value,
                    GroupId = group.Id,
                    Role = GroupRole.Owner,
                    IsAdmin = true,
                    JoinedAt = DateTime.Now,
                    IsActive = true
                };

                _context.UserGroups.Add(userGroup);
                await _context.SaveChangesAsync();

                return Ok(new
                {
                    success = true,
                    message = "Ú¯Ø±ÙˆÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯",
                    groupId = group.Id,
                    group = new
                    {
                        group.Id,
                        group.Name,
                        group.Description,
                        group.AvatarUrl,
                        group.IsPublic,
                        group.MaxMembers,
                        group.CreatedAt
                    }
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
        [HttpGet("MyGroups")]
        public async Task<IActionResult> GetMyGroups()
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var groups = await _context.UserGroups
                    .Where(ug => ug.UserId == userId.Value && ug.IsActive)
                    .Include(ug => ug.Group)
                        .ThenInclude(g => g.Creator)
                    .Select(ug => new
                    {
                        ug.Group.Id,
                        ug.Group.Name,
                        ug.Group.Description,
                        Avatar = ug.Group.AvatarUrl ?? "/images/default-group.png",
                        ug.Group.IsPublic,
                        MemberCount = _context.UserGroups.Count(x => x.GroupId == ug.GroupId && x.IsActive),
                        Role = ug.Role.ToString(),
                        ug.IsAdmin,
                        ug.IsMuted,
                        UnreadCount = 0, // TODO: Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
                        LastMessage = _context.Messages
                            .Where(m => m.GroupId == ug.GroupId && !m.IsDeleted)
                            .OrderByDescending(m => m.SentAt)
                            .Select(m => m.Content ?? m.MessageText)
                            .FirstOrDefault(),
                        LastMessageTime = _context.Messages
                            .Where(m => m.GroupId == ug.GroupId && !m.IsDeleted)
                            .OrderByDescending(m => m.SentAt)
                            .Select(m => m.SentAt)
                            .FirstOrDefault()
                    })
                    .OrderByDescending(g => g.LastMessageTime)
                    .ToListAsync();

                return Ok(new { success = true, groups });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÛŒÚ© Ú¯Ø±ÙˆÙ‡
        [HttpGet("{groupId}")]
        public async Task<IActionResult> GetGroup(int groupId)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var userGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId.Value && ug.IsActive);

                if (userGroup == null)
                    return NotFound(new { success = false, message = "Ø´Ù…Ø§ Ø¹Ø¶Ùˆ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù†ÛŒØ³ØªÛŒØ¯" });

                var group = await _context.Groups
                    .Include(g => g.Creator)
                    .FirstOrDefaultAsync(g => g.Id == groupId);

                if (group == null)
                    return NotFound(new { success = false, message = "Ú¯Ø±ÙˆÙ‡ ÛŒØ§ÙØª Ù†Ø´Ø¯" });

                var members = await _context.UserGroups
                    .Where(ug => ug.GroupId == groupId && ug.IsActive)
                    .Include(ug => ug.User)
                    .Select(ug => new
                    {
                        ug.User.Id,
                        Name = $"{ug.User.FirstName} {ug.User.LastName}",
                        Avatar = ug.User.AvatarUrl ?? "/images/default-avatar.png",
                        Role = ug.Role.ToString(),
                        ug.IsAdmin,
                        ug.JoinedAt
                    })
                    .ToListAsync();

                return Ok(new
                {
                    success = true,
                    group = new
                    {
                        group.Id,
                        group.Name,
                        group.Description,
                        Avatar = group.AvatarUrl ?? "/images/default-group.png",
                        group.IsPublic,
                        group.MaxMembers,
                        Creator = $"{group.Creator.FirstName} {group.Creator.LastName}",
                        group.CreatedAt,
                        MemberCount = members.Count,
                        MyRole = userGroup.Role.ToString(),
                        IsAdmin = userGroup.IsAdmin,
                        IsMuted = userGroup.IsMuted
                    },
                    members
                });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }



        // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡
        [HttpPost("{groupId}/AddMember")]
        public async Task<IActionResult> AddMember(int groupId, [FromBody] AddMemberRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ² (Ø¨Ø§ÛŒØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´Ø¯)
                var adminGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId.Value && ug.IsAdmin);

                if (adminGroup == null)
                    return StatusCode(403, new { success = false, message = "Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ù†Ø¯Ø§Ø±ÛŒØ¯" });

                // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø¹Ø¶Ø§
                var group = await _context.Groups.FindAsync(groupId);
                if (group == null)
                    return NotFound(new { success = false, message = "Ú¯Ø±ÙˆÙ‡ ÛŒØ§ÙØª Ù†Ø´Ø¯" });

                var currentMemberCount = await _context.UserGroups
                    .CountAsync(ug => ug.GroupId == groupId && ug.IsActive);

                if (currentMemberCount >= group.MaxMembers)
                    return BadRequest(new { success = false, message = $"Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§ ({group.MaxMembers}) Ù…Ø­Ø¯ÙˆØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª" });

                // âœ… Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ Ù‚Ø¨Ù„ÛŒ
                var existing = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == request.UserId);

                if (existing != null)
                {
                    if (existing.IsActive)
                        return BadRequest(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø¹Ø¶Ùˆ Ø§Ø³Øª" });

                    // ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯
                    existing.IsActive = true;
                    existing.JoinedAt = DateTime.Now;
                    await _context.SaveChangesAsync();
                }
                else
                {
                    // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ø¶Ùˆ Ø¬Ø¯ÛŒØ¯
                    var userGroup = new UserGroup
                    {
                        UserId = request.UserId,
                        GroupId = groupId,
                        Role = GroupRole.Member,
                        IsActive = true,
                        JoinedAt = DateTime.Now
                    };

                    _context.UserGroups.Add(userGroup);
                    await _context.SaveChangesAsync();
                }

                return Ok(new { success = true, message = "Ø¹Ø¶Ùˆ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯" });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… Ø­Ø°Ù Ø¹Ø¶Ùˆ Ø§Ø² Ú¯Ø±ÙˆÙ‡
        [HttpPost("{groupId}/RemoveMember")]
        public async Task<IActionResult> RemoveMember(int groupId, [FromBody] RemoveMemberRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                // âœ… Ø¨Ø±Ø±Ø³ÛŒ Ù…Ø¬ÙˆØ²
                var adminGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId.Value && ug.IsAdmin);

                if (adminGroup == null)
                    return StatusCode(403, new { success = false, message = "Ø´Ù…Ø§ Ù…Ø¬ÙˆØ² Ø­Ø°Ù Ø¹Ø¶Ùˆ Ù†Ø¯Ø§Ø±ÛŒØ¯" });

                var userGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == request.UserId);

                if (userGroup == null)
                    return NotFound(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø± Ø¹Ø¶Ùˆ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù†ÛŒØ³Øª" });

                // âœ… Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø±Ø§ Ø­Ø°Ù Ú©Ø±Ø¯
                if (userGroup.Role == GroupRole.Owner)
                    return BadRequest(new { success = false, message = "Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø³Ø§Ø²Ù†Ø¯Ù‡ Ú¯Ø±ÙˆÙ‡ Ø±Ø§ Ø­Ø°Ù Ú©Ø±Ø¯" });

                userGroup.IsActive = false;
                await _context.SaveChangesAsync();

                return Ok(new { success = true, message = "Ø¹Ø¶Ùˆ Ø­Ø°Ù Ø´Ø¯" });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… ØªØºÛŒÛŒØ± Ù†Ù‚Ø´ Ø¹Ø¶Ùˆ
        [HttpPost("{groupId}/ChangeRole")]
        public async Task<IActionResult> ChangeRole(int groupId, [FromBody] ChangeRoleRequest request)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var adminGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId.Value && ug.Role == GroupRole.Owner);

                if (adminGroup == null)
                    return StatusCode(403, new { success = false, message = "ÙÙ‚Ø· Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù†Ù‚Ø´â€ŒÙ‡Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡Ø¯" });

                var userGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == request.UserId);

                if (userGroup == null)
                    return NotFound(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø± ÛŒØ§ÙØª Ù†Ø´Ø¯" });

                userGroup.Role = request.NewRole;
                userGroup.IsAdmin = request.NewRole == GroupRole.Admin || request.NewRole == GroupRole.Owner;

                await _context.SaveChangesAsync();

                return Ok(new { success = true, message = "Ù†Ù‚Ø´ ØªØºÛŒÛŒØ± ÛŒØ§ÙØª" });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… ØªØ±Ú© Ú¯Ø±ÙˆÙ‡
        [HttpPost("{groupId}/Leave")]
        public async Task<IActionResult> LeaveGroup(int groupId)
        {
            var userId = GetCurrentUserId();
            if (userId == null) return Unauthorized();

            try
            {
                var userGroup = await _context.UserGroups
                    .FirstOrDefaultAsync(ug => ug.GroupId == groupId && ug.UserId == userId.Value);

                if (userGroup == null)
                    return NotFound(new { success = false, message = "Ø´Ù…Ø§ Ø¹Ø¶Ùˆ Ø§ÛŒÙ† Ú¯Ø±ÙˆÙ‡ Ù†ÛŒØ³ØªÛŒØ¯" });

                if (userGroup.Role == GroupRole.Owner)
                    return BadRequest(new { success = false, message = "Ø³Ø§Ø²Ù†Ø¯Ù‡ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú¯Ø±ÙˆÙ‡ Ø±Ø§ ØªØ±Ú© Ú©Ù†Ø¯" });

                userGroup.IsActive = false;
                await _context.SaveChangesAsync();

                return Ok(new { success = true, message = "Ú¯Ø±ÙˆÙ‡ Ø±Ø§ ØªØ±Ú© Ú©Ø±Ø¯ÛŒØ¯" });
            }
            catch (Exception ex)
            {
                return StatusCode(500, new { success = false, message = ex.Message });
            }
        }

        // âœ… DTOs
        public class AddMemberRequest
        {
            public int UserId { get; set; }
        }

        public class RemoveMemberRequest
        {
            public int UserId { get; set; }
        }

        public class ChangeRoleRequest
        {
            public int UserId { get; set; }
            public GroupRole NewRole { get; set; }
        }
    }

    // âœ… DTOs
    public class CreateGroupRequest
    {
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public bool IsPublic { get; set; } = false;
        public int? MaxMembers { get; set; }
    }
} 
 
==================== OtpAuthenticationController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\ 
 
ï»¿using Microsoft.AspNetCore.Authentication;
using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;
using System.ComponentModel.DataAnnotations;
using System.Security.Claims;

namespace OrganizationalMessenger.Web.Controllers
{
    [ApiController]
    [Route("api/[controller]")]
    [AllowAnonymous]
    public class OtpAuthenticationController : ControllerBase
    {
        private readonly IAuthenticationManager _authManager;
        private readonly ApplicationDbContext _context;

        public OtpAuthenticationController(IAuthenticationManager authManager, ApplicationDbContext context)
        {
            _authManager = authManager;
            _context = context;
        }

        /// <summary>
        /// Ù…Ø±Ø­Ù„Ù‡ 1: Ø¯Ø±Ø®ÙˆØ§Ø³Øª OTP
        /// POST: api/otpauthentication/send-otp
        /// </summary>
        [HttpPost("send-otp")]
        public async Task<IActionResult> SendOtp([FromBody] SendOtpRequest request)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(new { success = false, message = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª" });
            }

            // Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ù†Ù‡
            var user = await _context.Users.FirstOrDefaultAsync(u => u.PhoneNumber == request.PhoneNumber);

            if (user == null)
            {
                return NotFound(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ Ø§ÛŒÙ† Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ÛŒØ§ÙØª Ù†Ø´Ø¯" });
            }

            if (!user.IsActive)
            {
                return BadRequest(new { success = false, message = "Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª" });
            }

            // Ø§Ø±Ø³Ø§Ù„ OTP
            var (success, message) = await _authManager.SendOtpAsync(request.PhoneNumber);

            if (!success)
            {
                return BadRequest(new { success = false, message });
            }

            return Ok(new
            {
                success = true,
                message = "Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯",
                phoneNumber = request.PhoneNumber
            });
        }

        /// <summary>
        /// Ù…Ø±Ø­Ù„Ù‡ 2: ØªØ§ÛŒÛŒØ¯ OTP Ùˆ Ù„Ø§Ú¯ÛŒÙ†
        /// POST: api/otpauthentication/verify-otp
        /// </summary>
        [HttpPost("verify-otp")]
        public async Task<IActionResult> VerifyOtp([FromBody] VerifyOtpRequest request)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(new { success = false, message = "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª" });
            }

            var result = await _authManager.AuthenticateAsync(request.PhoneNumber, request.OtpCode, AuthenticationType.SMS);

            if (!result.IsSuccess)
            {
                return Unauthorized(new { success = false, message = result.ErrorMessage });
            }

            // Ø§ÛŒØ¬Ø§Ø¯ Claims Ùˆ Ù„Ø§Ú¯ÛŒÙ†
            var claims = new List<Claim>
            {
                new Claim(ClaimTypes.NameIdentifier, result.UserId),
                new Claim(ClaimTypes.Name, result.FirstName + " " + result.LastName),
                new Claim("PhoneNumber", result.PhoneNumber ?? ""),
                new Claim("Email", result.Email ?? "")
            };

            var claimsIdentity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
            var authProperties = new AuthenticationProperties
            {
                IsPersistent = true,
                ExpiresUtc = DateTimeOffset.UtcNow.AddDays(14)
            };

            await HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme,
                new ClaimsPrincipal(claimsIdentity), authProperties);

            return Ok(new
            {
                success = true,
                message = "ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚",
                user = new
                {
                    id = result.UserId,
                    fullName = result.FirstName + " " + result.LastName,
                    phoneNumber = result.PhoneNumber,
                    email = result.Email
                }
            });
        }

        /// <summary>
        /// Ù„Ø§Ú¯ÛŒÙ† Ø¨Ø§ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
        /// POST: api/otpauthentication/login-password
        /// </summary>
        [HttpPost("login-password")]
        public async Task<IActionResult> LoginWithPassword([FromBody] LoginPasswordRequest request)
        {
            if (!ModelState.IsValid)
            {
                return BadRequest(new { success = false, message = "Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª" });
            }

            // Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† username
            var user = await _context.Users.FirstOrDefaultAsync(u => u.PhoneNumber == request.Username);

            if (user == null || string.IsNullOrEmpty(user.PasswordHash))
            {
                return Unauthorized(new { success = false, message = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨  Ù‡ Ø§Ø³Øª" });
            }

            // Ø¨Ø±Ø±Ø³ÛŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
            bool isPasswordValid = BCrypt.Net.BCrypt.Verify(request.Password, user.PasswordHash);

            if (!isPasswordValid)
            {
                return Unauthorized(new { success = false, message = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª" });
            }

            if (!user.IsActive)
            {
                return BadRequest(new { success = false, message = "Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª" });
            }

            // Ù„Ø§Ú¯ÛŒÙ†
            var claims = new List<Claim>
            {
                new Claim(ClaimTypes.NameIdentifier, user.Id.ToString()),
                new Claim(ClaimTypes.Name, user.FirstName + " " + user.LastName),
                new Claim("PhoneNumber", user.PhoneNumber ?? ""),
                new Claim("Email", user.Email ?? "")
            };

            var claimsIdentity = new ClaimsIdentity(claims, CookieAuthenticationDefaults.AuthenticationScheme);
            var authProperties = new AuthenticationProperties
            {
                IsPersistent = true,
                ExpiresUtc = DateTimeOffset.UtcNow.AddDays(14)
            };

            await HttpContext.SignInAsync(CookieAuthenticationDefaults.AuthenticationScheme,
                new ClaimsPrincipal(claimsIdentity), authProperties);

            return Ok(new
            {
                success = true,
                message = "ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚",
                user = new
                {
                    id = user.Id,
                    fullName = user.FirstName + " " + user.LastName,
                    phoneNumber = user.PhoneNumber,
                    email = user.Email
                }
            });
        }

        /// <summary>
        /// Ú†Ú© Ú©Ø±Ø¯Ù† Ø§ÛŒÙ†Ú©Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ØªØ¹Ø±ÛŒÙ Ú©Ø±Ø¯Ù‡ ÛŒØ§ Ù†Ù‡
        /// GET: api/otpauthentication/has-password/{phoneNumber}
        /// </summary>
        [HttpGet("has-password/{phoneNumber}")]
        public async Task<IActionResult> HasPassword(string phoneNumber)
        {
            var user = await _context.Users.FirstOrDefaultAsync(u => u.PhoneNumber == phoneNumber);

            if (user == null)
            {
                return NotFound(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯" });
            }

            return Ok(new
            {
                success = true,
                hasPassword = !string.IsNullOrEmpty(user.PasswordHash)
            });
        }

        [HttpPost("logout")]
        [Authorize]
        public async Task<IActionResult> Logout()
        {
            await HttpContext.SignOutAsync(CookieAuthenticationDefaults.AuthenticationScheme);
            return Ok(new { success = true, message = "Ø®Ø±ÙˆØ¬ Ù…ÙˆÙÙ‚" });
        }
    }

    // ==================== Request Models ====================

    public class SendOtpRequest
    {
        [Required(ErrorMessage = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Phone(ErrorMessage = "ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ ØµØ­ÛŒØ­ Ù†ÛŒØ³Øª")]
        [Display(Name = "Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„")]
        public string PhoneNumber { get; set; }
    }

    public class VerifyOtpRequest
    {
        [Required]
        public string PhoneNumber { get; set; }

        [Required(ErrorMessage = "Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [StringLength(6, MinimumLength = 4)]
        public string OtpCode { get; set; }
    }

    public class LoginPasswordRequest
    {
        [Required(ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        public string Username { get; set; } // Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„

        [Required(ErrorMessage = "Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        public string Password { get; set; }
    }
} 
 
==================== ChannelController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\Api\ 
 
ï»¿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using OrganizationalMessenger.Application.DTOs.Channel;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Domain.Entities;
using System.Security.Claims;

namespace OrganizationalMessenger.Controllers.Api
{
    [Authorize]
    [Route("api/[controller]")]
    [ApiController]
    public class ChannelController : ControllerBase
    {
        private readonly IChannelService _channelService;
        private readonly ILogger<ChannelController> _logger;

        public ChannelController(
            IChannelService channelService,
            ILogger<ChannelController> logger)
        {
            _channelService = channelService;
            _logger = logger;
        }

        private int GetCurrentUserId()
        {
            var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
            return int.TryParse(userIdClaim, out var userId) ? userId : 0;
        }

        [HttpPost("Create")]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Create([FromBody] CreateChannelDto dto)
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    _logger.LogWarning("Unauthorized channel creation attempt");
                    return Unauthorized(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø± Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª" });
                }

                _logger.LogInformation($"User {userId} creating channel: {dto.Name}");

                var channel = new Channel
                {
                    Name = dto.Name,
                    Description = dto.Description,
                    IsPublic = dto.IsPublic,
                    OnlyAdminsCanPost = dto.OnlyAdminsCanPost,
                    AllowComments = dto.AllowComments,
                    CreatedAt = DateTime.UtcNow,
                    CreatorId = userId
                };

                var createdChannel = await _channelService.CreateChannelAsync(channel, userId);

                return Ok(new
                {
                    success = true,
                    message = "Ú©Ø§Ù†Ø§Ù„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯",
                    channelId = createdChannel.Id,
                    channelName = createdChannel.Name
                });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error creating channel");
                return BadRequest(new { success = false, message = "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„: " + ex.Message });
            }
        }

        [HttpGet("MyChannels")]
        public async Task<IActionResult> GetMyChannels()
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    return Unauthorized();
                }

                var channels = await _channelService.GetUserChannelsAsync(userId);

                return Ok(new { success = true, channels });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error getting user channels");
                return BadRequest(new { success = false, message = ex.Message });
            }
        }

        [HttpPost("Subscribe/{channelId}")]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Subscribe(int channelId)
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    return Unauthorized();
                }

                await _channelService.SubscribeAsync(channelId, userId);

                return Ok(new { success = true, message = "Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ø´Ø¯ÛŒØ¯" });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error subscribing to channel {channelId}");
                return BadRequest(new { success = false, message = ex.Message });
            }
        }

        [HttpPost("Unsubscribe/{channelId}")]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Unsubscribe(int channelId)
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    return Unauthorized();
                }

                await _channelService.UnsubscribeAsync(channelId, userId);

                return Ok(new { success = true, message = "Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø² Ú©Ø§Ù†Ø§Ù„ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯" });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error unsubscribing from channel {channelId}");
                return BadRequest(new { success = false, message = ex.Message });
            }
        }
    }
} 
 
==================== GroupController.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Controllers\Api\ 
 
ï»¿using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.Mvc;
using OrganizationalMessenger.Application.DTOs.Group;
using OrganizationalMessenger.Application.Interfaces;
using OrganizationalMessenger.Domain.Entities;
using System.Security.Claims;

namespace OrganizationalMessenger.Controllers.Api
{
    [Authorize]
    [Route("api/[controller]")]
    [ApiController]
    public class GroupController : ControllerBase
    {
        private readonly IGroupService _groupService;
        private readonly ILogger<GroupController> _logger;

        public GroupController(
            IGroupService groupService,
            ILogger<GroupController> logger)
        {
            _groupService = groupService;
            _logger = logger;
        }

        private int GetCurrentUserId()
        {
            var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
            return int.TryParse(userIdClaim, out var userId) ? userId : 0;
        }

        [HttpPost("Create")]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> Create([FromBody] CreateGroupDto dto)
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    _logger.LogWarning("Unauthorized group creation attempt");
                    return Unauthorized(new { success = false, message = "Ú©Ø§Ø±Ø¨Ø± Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª" });
                }

                _logger.LogInformation($"User {userId} creating group: {dto.Name}");

                var group = new Group
                {
                    Name = dto.Name,
                    Description = dto.Description,
                    IsPublic = dto.IsPublic,
                    MaxMembers = dto.MaxMembers,
                    CreatedAt = DateTime.UtcNow,
                    CreatorId = userId
                };

                var createdGroup = await _groupService.CreateGroupAsync(group, userId);

                return Ok(new
                {
                    success = true,
                    message = "Ú¯Ø±ÙˆÙ‡ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯",
                    groupId = createdGroup.Id,
                    groupName = createdGroup.Name
                });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error creating group");
                return BadRequest(new { success = false, message = "Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡3: " + ex.Message });
            }
        }

        [HttpGet("MyGroups")]
        public async Task<IActionResult> GetMyGroups()
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    return Unauthorized();
                }

                var groups = await _groupService.GetUserGroupsAsync(userId);

                return Ok(new { success = true, groups });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "Error getting user groups");
                return BadRequest(new { success = false, message = ex.Message });
            }
        }

        [HttpPost("Join/{groupId}")]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> JoinGroup(int groupId)
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    return Unauthorized();
                }

                await _groupService.AddMemberAsync(groupId, userId);

                return Ok(new { success = true, message = "Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ú¯Ø±ÙˆÙ‡ Ù¾ÛŒÙˆØ³ØªÛŒØ¯" });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error joining group {groupId}");
                return BadRequest(new { success = false, message = ex.Message });
            }
        }

        [HttpPost("Leave/{groupId}")]
        [ValidateAntiForgeryToken]
        public async Task<IActionResult> LeaveGroup(int groupId)
        {
            try
            {
                var userId = GetCurrentUserId();
                if (userId == 0)
                {
                    return Unauthorized();
                }

                await _groupService.RemoveMemberAsync(groupId, userId);

                return Ok(new { success = true, message = "Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø² Ú¯Ø±ÙˆÙ‡ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯" });
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"Error leaving group {groupId}");
                return BadRequest(new { success = false, message = ex.Message });
            }
        }
    }
} 
 
==================== ChatHub.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Hubs\ 
 
ï»¿// âœ… ChatHub.cs - SignalR Hub Ø¨Ø±Ø§ÛŒ Real-time Communication

using Microsoft.AspNetCore.Authorization;
using Microsoft.AspNetCore.SignalR;
using Microsoft.EntityFrameworkCore;
using OrganizationalMessenger.Domain.Entities;
using OrganizationalMessenger.Domain.Enums;
using OrganizationalMessenger.Infrastructure.Data;
using System.Collections.Concurrent;
using System.Security.Claims;

namespace OrganizationalMessenger.Web.Hubs
{
    [Authorize] // ÙÙ‚Ø· Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´Ø¯Ù‡
    public class ChatHub : Hub
    {
        private readonly ApplicationDbContext _context;
        private readonly ILogger<ChatHub> _logger;

        // ğŸš¨ Thread-safe dictionary Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ ConnectionId Ù‡Ø§ÛŒ Ù‡Ø± Ú©Ø§Ø±Ø¨Ø±
        private static readonly ConcurrentDictionary<int, List<string>> _userConnections = new();

        public ChatHub(ApplicationDbContext context, ILogger<ChatHub> logger)
        {
            _context = context;
            _logger = logger;
        }

        // âœ… ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…ØªØµÙ„ Ø´Ø¯
        public override async Task OnConnectedAsync()
        {
            var userId = GetUserId();
            if (userId == 0)
            {
                await base.OnConnectedAsync();
                return;
            }

            _logger.LogInformation($"âœ… User {userId} connected: {Context.ConnectionId}");

            // Ø°Ø®ÛŒØ±Ù‡ ConnectionId Ù‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±
            _userConnections.AddOrUpdate(userId,
                new List<string> { Context.ConnectionId },
                (key, list) => { list.Add(Context.ConnectionId); return list; });

            // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ IsOnline Ø¯Ø± Ø¯ÛŒØªØ§Ø¨ÛŒØ³
            var user = await _context.Users.FindAsync(userId);
            if (user != null)
            {
                user.IsOnline = true;
                user.LastSeen = DateTime.Now;
                await _context.SaveChangesAsync();

                // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø³Ø§ÛŒØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                await Clients.Others.SendAsync("UserOnline", userId);
            }

            // ğŸš¨ Mark Sent â†’ Delivered Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ 24 Ø³Ø§Ø¹Øª Ø§Ø®ÛŒØ±
            await MarkReceivedMessagesAsDelivered(userId);

            await base.OnConnectedAsync();
        }

        // âœ… ÙˆÙ‚ØªÛŒ Ú©Ø§Ø±Ø¨Ø± Ù‚Ø·Ø¹ Ø´Ø¯
        public override async Task OnDisconnectedAsync(Exception? exception)
        {
            var userId = GetUserId();
            if (userId > 0 && _userConnections.TryGetValue(userId, out var connections))
            {
                connections.Remove(Context.ConnectionId);
                if (connections.Count == 0)
                {
                    _userConnections.TryRemove(userId, out _);

                    var user = await _context.Users.FindAsync(userId);
                    if (user != null)
                    {
                        user.IsOnline = false;
                        user.LastSeen = DateTime.Now;
                        await _context.SaveChangesAsync();

                        // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ø³Ø§ÛŒØ± Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                        await Clients.Others.SendAsync("UserOffline", userId, DateTime.Now);
                    }
                }
            }
            await base.OnDisconnectedAsync(exception);
        }

        // âœ… Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®ØµÙˆØµÛŒ
        // âœ… Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ø§ Reply
        public async Task SendPrivateMessage(int receiverId, string messageText, int? replyToMessageId = null)
        {
            var senderId = GetUserId();
            if (senderId == 0) return;

            try
            {
                var now = DateTime.UtcNow;

                var message = new Message
                {
                    SenderId = senderId,
                    ReceiverId = receiverId,
                    Content = messageText,
                    MessageText = messageText,
                    Type = MessageType.Text,
                    SentAt = now,
                    IsDelivered = false,
                    ReplyToMessageId = replyToMessageId
                };

                _context.Messages.Add(message);
                await _context.SaveChangesAsync();

                var sender = await _context.Users.FindAsync(senderId);

                var messageDto = new
                {
                    id = message.Id,
                    messageId = message.Id,
                    chatId = receiverId,
                    senderId = message.SenderId,
                    senderName = $"{sender.FirstName} {sender.LastName}",
                    senderAvatar = sender.AvatarUrl ?? "/images/default-avatar.png",
                    content = message.Content,
                    messageText = message.MessageText,
                    type = message.Type,
                    sentAt = message.SentAt.ToString("o"),
                    isDelivered = false,
                    isRead = false,
                    isEdited = false,
                    replyToMessageId = message.ReplyToMessageId,
                    replyToText = message.ReplyToMessage?.Content,
                    replyToSenderName = message.ReplyToMessage != null
                        ? $"{message.ReplyToMessage.Sender.FirstName} {message.ReplyToMessage.Sender.LastName}"
                        : null,
                    attachments = new List<object>()
                };

                Console.WriteLine($"âœ… Text Message {message.Id} - SentAt: {messageDto.sentAt}");

                // âœ… Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú¯ÛŒØ±Ù†Ø¯Ù‡
                await Clients.User(receiverId.ToString()).SendAsync("ReceiveMessage", messageDto);

                // âœ… ØªØ£ÛŒÛŒØ¯ Ø¨Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡
                await Clients.Caller.SendAsync("MessageSent", messageDto);

                // âœ… Ú†Ú© Ú©Ø±Ø¯Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨ÙˆØ¯Ù† Ú¯ÛŒØ±Ù†Ø¯Ù‡
                if (_userConnections.TryGetValue(receiverId, out var receiverConnections) && receiverConnections.Count > 0)
                {
                    // âœ… Ú¯ÛŒØ±Ù†Ø¯Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ† Ø§Ø³Øª
                    message.IsDelivered = true;
                    message.DeliveredAt = DateTime.UtcNow;
                    await _context.SaveChangesAsync();

                    Console.WriteLine($"ğŸ“¦ Message {message.Id} delivered to online user {receiverId}");

                    // âœ… Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡
                    await Clients.All.SendAsync("MessageDelivered", new
                    {
                        messageId = message.Id,
                        deliveredAt = message.DeliveredAt?.ToString("yyyy-MM-ddTHH:mm:ss")
                    });
                }
                else
                {
                    Console.WriteLine($"â³ Message {message.Id} sent to offline user {receiverId}");
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine($"âŒ SendPrivateMessage error: {ex.Message}");
                await Clients.Caller.SendAsync("Error", "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù…");
            }
        }
        // âœ… ØªØ£ÛŒÛŒØ¯ Delivered Ø§Ø² Frontend
        public async Task ConfirmDelivery(long messageId)
        {
            var userId = GetUserId();
            var message = await _context.Messages.FindAsync(messageId);

            if (message?.ReceiverId == userId && !message.IsDelivered)
            {
                message.IsDelivered = true;
                message.DeliveredAt = DateTime.Now;
                await _context.SaveChangesAsync();

                await Clients.All.SendAsync("MessageDelivered", new
                {
                    messageId,
                    deliveredAt = message.DeliveredAt
                });
            }
        }

        // ğŸš¨ MarkAsRead - Ø¯Ø±Ø¬ Ø±Ú©ÙˆØ±Ø¯ Ø¯Ø± Ø¬Ø¯ÙˆÙ„ MessageReads
        public async Task MarkAsRead(int messageId)
        {
            var userId = GetUserId();
            if (userId == 0) return;

            // ğŸš¨ Ú†Ú© ØªÚ©Ø±Ø§Ø±ÛŒ - Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§Ù‹ Ø®ÙˆØ§Ù†Ø¯Ù‡ â†’ Ø®Ø§Ø±Ø¬ Ø´Ùˆ
            if (await _context.MessageReads.AnyAsync(mr => mr.MessageId == messageId && mr.UserId == userId))
                return;

            // ğŸš¨ Ø¯Ø±Ø¬ Ø±Ú©ÙˆØ±Ø¯ Ø¬Ø¯ÛŒØ¯ Ø¯Ø± MessageReads â† PROBLEM!
            var read = new MessageRead
            {
                MessageId = messageId,
                UserId = userId,
                ReadAt = DateTime.Now
            };

            _context.MessageReads.Add(read);
            await _context.SaveChangesAsync();

            // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡
            await Clients.All.SendAsync("MessageRead", new
            {
                messageId,
                userId,
                readAt = read.ReadAt.ToString("yyyy-MM-ddTHH:mm:ss")
            });
        }

        // Typing indicator
        public async Task SendTyping(int receiverId)
        {
            if (_userConnections.TryGetValue(receiverId, out var receiverConnections))
            {
                foreach (var conn in receiverConnections)
                    await Clients.Client(conn).SendAsync("UserTyping", "Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Ø­Ø§Ù„ ØªØ§ÛŒÙ¾...");
            }
        }

        public async Task SendStoppedTyping(int receiverId)
        {
            if (_userConnections.TryGetValue(receiverId, out var receiverConnections))
            {
                foreach (var conn in receiverConnections)
                    await Clients.Client(conn).SendAsync("UserStoppedTyping");
            }
        }

        // Ø¹Ù„Ø§Ù…Øªâ€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ 24 Ø³Ø§Ø¹Øª Ø§Ø®ÛŒØ± Ø¨Ù‡ Delivered
        private async Task MarkReceivedMessagesAsDelivered(int userId)
        {
            try
            {
                var messages = await _context.Messages
                    .Where(m => m.ReceiverId == userId &&
                               !m.IsDelivered &&
                               m.SentAt > DateTime.Now.AddHours(-24))
                    .ToListAsync();

                foreach (var msg in messages)
                {
                    msg.IsDelivered = true;
                    msg.DeliveredAt = DateTime.Now;
                }

                if (messages.Any())
                {
                    await _context.SaveChangesAsync();
                    _logger.LogInformation($"ğŸ“¦ {messages.Count} messages marked Delivered for user {userId}");
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "MarkReceivedMessagesAsDelivered error");
            }
        }

        private int GetUserId()
        {
            return int.TryParse(
                Context.User?.FindFirst(ClaimTypes.NameIdentifier)?.Value,
                out int id) ? id : 0;
        }

        // ğŸš¨ NotifyMessagesRead - Ø§Ø² Frontend ØµØ¯Ø§ Ø²Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (selectChat)
        public async Task NotifyMessagesRead(List<int> messageIds)
        {
            var userId = GetUserId();
            if (userId == 0) return;

            try
            {
                var messages = await _context.Messages
                    .Where(m => messageIds.Contains(m.Id))
                    .ToListAsync();

                foreach (var message in messages)
                {
                    var readReceipt = await _context.MessageReads
                        .FirstOrDefaultAsync(mr => mr.MessageId == message.Id && mr.UserId == userId);

                    if (readReceipt != null)
                    {
                        // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡
                        await Clients.User(message.SenderId.ToString()).SendAsync("MessageRead", new
                        {
                            messageId = message.Id,
                            readAt = readReceipt.ReadAt
                        });

                        Console.WriteLine($"âœ… Notified sender {message.SenderId} that message {message.Id} was read");
                    }
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "NotifyMessagesRead error");
            }
        }


        // âœ… Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®ØµÙˆØµÛŒ Ø¨Ø§ ÙØ§ÛŒÙ„
        // âœ… Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø®ØµÙˆØµÛŒ Ø¨Ø§ ÙØ§ÛŒÙ„ - Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡
        public async Task SendPrivateMessageWithFile(int receiverId, string messageText, int messageId, int fileAttachmentId)
        {
            var senderId = GetUserId();
            if (senderId == 0) return;

            try
            {
                var message = await _context.Messages
                    .Include(m => m.Sender)
                    .Include(m => m.Attachments.Where(a => !a.IsDeleted))
                    .FirstOrDefaultAsync(m => m.Id == messageId);

                if (message == null)
                {
                    _logger.LogError($"âŒ Message {messageId} not found");
                    return;
                }

                var file = message.Attachments.FirstOrDefault(a => a.Id == fileAttachmentId);
                if (file == null)
                {
                    _logger.LogError($"âŒ File {fileAttachmentId} not found");
                    return;
                }

                // âœ… ØªØ¨Ø¯ÛŒÙ„ Ø¨Ù‡ UTC Ø§Ú¯Ø± Local Ø§Ø³Øª
                var sentAtUtc = message.SentAt.Kind == DateTimeKind.Unspecified
                    ? DateTime.SpecifyKind(message.SentAt, DateTimeKind.Utc)
                    : message.SentAt.ToUniversalTime();

                var messageDto = new
                {
                    id = message.Id,
                    senderId = message.SenderId,
                    senderName = $"{message.Sender.FirstName} {message.Sender.LastName}",
                    senderAvatar = message.Sender.AvatarUrl ?? "/images/default-avatar.png",
                    content = message.Content,
                    messageText = message.MessageText,
                    type = message.Type,
                    sentAt = sentAtUtc.ToString("o"), // âœ… ISO 8601 Ø¨Ø§ "o"
                    isDelivered = false,
                    isRead = false,
                    isEdited = message.IsEdited,
                    editedAt = message.EditedAt,
                    chatId = receiverId,
                    attachments = new[]
                    {
                new
                {
                    id = file.Id,
                    originalFileName = file.OriginalFileName,
                    fileUrl = file.FileUrl,
                    thumbnailUrl = file.ThumbnailUrl,
                    fileType = file.FileType,
                    fileSize = file.FileSize,
                    extension = file.Extension,
                    readableSize = file.ReadableFileSize,
                    width = file.Width,
                    height = file.Height,
                    duration = file.Duration,
                    readableDuration = file.ReadableDuration
                }
            }
                };

                Console.WriteLine($"âœ… Message {message.Id} - SentAt (Local): {message.SentAt}");
                Console.WriteLine($"âœ… Message {message.Id} - SentAt (UTC): {messageDto.sentAt}");

                // ØªØ£ÛŒÛŒØ¯ Ø¨Ø±Ø§ÛŒ ÙØ±Ø³ØªÙ†Ø¯Ù‡
                await Clients.Caller.SendAsync("MessageSent", messageDto);

                // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú¯ÛŒØ±Ù†Ø¯Ù‡
                if (_userConnections.TryGetValue(receiverId, out var receiverConnections))
                {
                    foreach (var connectionId in receiverConnections)
                    {
                        await Clients.Client(connectionId).SendAsync("ReceiveMessage", messageDto);
                    }

                    message.IsDelivered = true;
                    message.DeliveredAt = DateTime.Now;
                    await _context.SaveChangesAsync();

                    await Clients.All.SendAsync("MessageDelivered", new
                    {
                        messageId = message.Id,
                        deliveredAt = message.DeliveredAt?.ToString("yyyy-MM-ddTHH:mm:ss")
                    });
                }
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"âŒ SendPrivateMessageWithFile error: {ex.Message}");
            }
        }
        // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…
        public async Task NotifyMessageEdited(int messageId, string newContent, DateTime editedAt)
        {
            var userId = GetUserId();
            if (userId == 0) return;

            var message = await _context.Messages
                .Include(m => m.Sender)
                .FirstOrDefaultAsync(m => m.Id == messageId && m.SenderId == userId);

            if (message == null) return;

            // Ø§Ø·Ù„Ø§Ø¹ Ø¨Ù‡ Ù‡Ù…Ù‡ (ÙØ±Ø³ØªÙ†Ø¯Ù‡ + Ú¯ÛŒØ±Ù†Ø¯Ù‡)
            await Clients.All.SendAsync("MessageEdited", new
            {
                messageId,
                newContent,
                editedAt = editedAt.ToString("yyyy-MM-ddTHH:mm:ss"),
                senderId = userId
            });

            _logger.LogInformation($"âœ… Message {messageId} edited by {userId}");
        }





        // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø­Ø°Ù Ù¾ÛŒØ§Ù… - Ø¨Ø§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø­Ø°Ù Ù¾ÛŒØ§Ù… - Ø¨Ø§ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú¯ÛŒØ±Ù†Ø¯Ù‡
        // âœ… Ø§Ø·Ù„Ø§Ø¹â€ŒØ±Ø³Ø§Ù†ÛŒ Ø­Ø°Ù Ù¾ÛŒØ§Ù… - Ø¨Ø¯ÙˆÙ† query
        public async Task NotifyMessageDeleted(int messageId, bool showNotice, int? receiverId)
        {
            var userId = GetUserId();
            if (userId == 0) return;

            try
            {
                // âœ… Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ debug
                _logger.LogInformation($"ğŸ—‘ï¸ NotifyMessageDeleted: messageId={messageId}, sender={userId}, receiver={receiverId}, showNotice={showNotice}");

                // âœ… Ú†Ú© Ú©Ø±Ø¯Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† Ø¨ÙˆØ¯Ù† Ú¯ÛŒØ±Ù†Ø¯Ù‡
                if (receiverId.HasValue && _userConnections.TryGetValue(receiverId.Value, out var receiverConnections))
                {
                    _logger.LogInformation($"ğŸ“¡ Receiver {receiverId} has {receiverConnections.Count} active connections");

                    // Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ú¯ÛŒØ±Ù†Ø¯Ù‡
                    foreach (var connectionId in receiverConnections)
                    {
                        await Clients.Client(connectionId).SendAsync("MessageDeleted", new
                        {
                            messageId,
                            showNotice,
                            deletedAt = DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss"),
                            senderId = userId,
                            receiverId
                        });

                        _logger.LogInformation($"ğŸ“¤ Sent MessageDeleted to connection: {connectionId}");
                    }
                }
                else
                {
                    _logger.LogWarning($"âš ï¸ Receiver {receiverId} is offline or not found in connections");
                }

                // âœ… Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ ÙØ±Ø³ØªÙ†Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯)
                await Clients.Caller.SendAsync("MessageDeleted", new
                {
                    messageId,
                    showNotice,
                    deletedAt = DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss"),
                    senderId = userId,
                    receiverId
                });

                _logger.LogInformation($"âœ… Message {messageId} deletion notified successfully");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, $"âŒ NotifyMessageDeleted error: {ex.Message}");
            }
        }




        // âœ… Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¨Ù‡ ChatHub
        public async Task NotifyMessageReaction(int messageId, string emoji, string action, List<object> reactions)
        {
            var userId = GetUserId();
            if (userId == 0) return;

            try
            {
                var message = await _context.Messages.FindAsync(messageId);
                if (message == null) return;

                // âœ… Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ù‡Ù…Ù‡ (ÙØ±Ø³ØªÙ†Ø¯Ù‡ + Ú¯ÛŒØ±Ù†Ø¯Ù‡)
                await Clients.All.SendAsync("MessageReaction", new
                {
                    messageId,
                    emoji,
                    action, // "added" ÛŒØ§ "removed"
                    userId,
                    reactions // Ù„ÛŒØ³Øª Ú©Ø§Ù…Ù„ reactions
                });

                _logger.LogInformation($"âœ… Reaction {action}: Message {messageId}, Emoji {emoji}, User {userId}");
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "NotifyMessageReaction error");
            }
        }


    }
}
 
 
==================== ChannelViewModels.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
ï»¿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Models.ViewModels
{
    // ==================== Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ ====================
    public class ChannelListViewModel
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string CreatorName { get; set; } = string.Empty;
        public int SubscriberCount { get; set; }
        public bool IsActive { get; set; }
        public bool IsPublic { get; set; }
        public DateTime CreatedAt { get; set; }
    }

    // ==================== Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelCreateViewModel
    {
        [Required(ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [StringLength(100, ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 100 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯")]
        [Display(Name = "Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 500 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯")]
        [Display(Name = "ØªÙˆØ¶ÛŒØ­Ø§Øª")]
        public string? Description { get; set; }

        [Required(ErrorMessage = "Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø§Ø²Ù†Ø¯Ù‡ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ø³Ø§Ø²Ù†Ø¯Ù‡")]
        public int CreatorId { get; set; }

        [Display(Name = "Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ")]
        public bool IsPublic { get; set; }

        [Display(Name = "ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; } = true;
    }

    // ==================== ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelEditViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [StringLength(100, ErrorMessage = "Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 100 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯")]
        [Display(Name = "Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ØªØ± Ø§Ø² 500 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯")]
        [Display(Name = "ØªÙˆØ¶ÛŒØ­Ø§Øª")]
        public string? Description { get; set; }

        [Display(Name = "Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ")]
        public bool IsPublic { get; set; }

        [Display(Name = "ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; }

        // ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ (ReadOnly)
        public int CreatorId { get; set; }
        public DateTime CreatedAt { get; set; }
    }

    // ==================== Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelDetailsViewModel
    {
        public int Id { get; set; }
        public string Name { get; set; } = string.Empty;
        public string? Description { get; set; }
        public string CreatorName { get; set; } = string.Empty;
        public int CreatorId { get; set; }
        public int SubscriberCount { get; set; }
        public int AdminCount { get; set; }
        public int PublisherCount { get; set; }
        public int MessageCount { get; set; }
        public bool IsActive { get; set; }
        public bool IsPublic { get; set; }
        public DateTime CreatedAt { get; set; }

        // Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„
        public List<ChannelSubscriberViewModel> Subscribers { get; set; } = new();
    }

    // ==================== Ø§Ø¹Ø¶Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelSubscriberViewModel
    {
        public int UserId { get; set; }
        public string FullName { get; set; } = string.Empty;
        public string Username { get; set; } = string.Empty;
        public string? PhoneNumber { get; set; }
        public string? AvatarUrl { get; set; }
        public bool IsAdmin { get; set; }
        public bool CanPost { get; set; }
        public string RoleName { get; set; } = string.Empty;
        public DateTime JoinedAt { get; set; }
        public bool IsOwner { get; set; }
    }

    // ==================== Ø§ÙØ²ÙˆØ¯Ù† Ø¹Ø¶Ùˆ Ø¨Ù‡ Ú©Ø§Ù†Ø§Ù„ ====================
    public class AddChannelSubscriberViewModel
    {
        [Required(ErrorMessage = "Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ù†Ø§Ù„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        public int ChannelId { get; set; }

        [Required(ErrorMessage = "Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø± Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª")]
        [Display(Name = "Ú©Ø§Ø±Ø¨Ø±")]
        public int UserId { get; set; }

        [Display(Name = "Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ø±Ø³Ø§Ù„ Ù¾Ø³Øª")]
        public bool CanPost { get; set; }

        [Display(Name = "Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª")]
        public bool IsAdmin { get; set; }
    }

    // ==================== Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø¹Ø¶Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelSubscribersPageViewModel
    {
        public int ChannelId { get; set; }
        public string ChannelName { get; set; } = string.Empty;
        public bool IsPublic { get; set; }
        public List<ChannelSubscriberViewModel> Subscribers { get; set; } = new();
        public List<AvailableUserViewModel> AvailableUsers { get; set; } = new();
    }

    // ==================== Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù‚Ø§Ø¨Ù„ Ø§ÙØ²ÙˆØ¯Ù† ====================
    public class AvailableUserViewModel
    {
        public int Id { get; set; }
        public string FullName { get; set; } = string.Empty;
        public string Username { get; set; } = string.Empty;
        public string? PhoneNumber { get; set; }
    }

    // ==================== Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelMessageListViewModel
    {
        public int ChannelId { get; set; }
        public string ChannelName { get; set; } = string.Empty;
        public List<ChannelMessageViewModel> Messages { get; set; } = new();
        public int TotalMessages { get; set; }
        public int CurrentPage { get; set; }
        public int TotalPages { get; set; }
    }

    public class ChannelMessageViewModel
    {
        public long Id { get; set; }
        public string Content { get; set; } = string.Empty;
        public string SenderName { get; set; } = string.Empty;
        public DateTime SentAt { get; set; }
        public bool HasAttachment { get; set; }
        public int ViewCount { get; set; }
        public bool IsEdited { get; set; }
        public bool IsPinned { get; set; }
    }

    // ==================== Ø¢Ù…Ø§Ø± Ú©Ø§Ù†Ø§Ù„ ====================
    public class ChannelStatisticsViewModel
    {
        public int ChannelId { get; set; }
        public string ChannelName { get; set; } = string.Empty;
        public int TotalSubscribers { get; set; }
        public int ActiveSubscribers { get; set; }
        public int TotalMessages { get; set; }
        public int TodayMessages { get; set; }
        public int WeekMessages { get; set; }
        public int MonthMessages { get; set; }
        public int TotalViews { get; set; }
        public double AverageViewsPerMessage { get; set; }
        public DateTime? LastMessageAt { get; set; }
        public List<DailyStatViewModel> DailyStats { get; set; } = new();
    }

    public class DailyStatViewModel
    {
        public DateTime Date { get; set; }
        public int MessageCount { get; set; }
        public int NewSubscribers { get; set; }
    }
}
 
 
==================== GroupCreateViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
ï»¿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel Ø¨Ø±Ø§ÛŒ Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯
    /// </summary>
    public class GroupCreateViewModel
    {
        [Required(ErrorMessage = "Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.")]
        [StringLength(100, MinimumLength = 2, ErrorMessage = "Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 2 ØªØ§ 100 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.")]
        [Display(Name = "Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ Ø§Ø² 500 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.")]
        [Display(Name = "ØªÙˆØ¶ÛŒØ­Ø§Øª")]
        public string? Description { get; set; }

        [Required(ErrorMessage = "Ø³Ø§Ø²Ù†Ø¯Ù‡ Ú¯Ø±ÙˆÙ‡ Ø¨Ø§ÛŒØ¯ Ù…Ø´Ø®Øµ Ø´ÙˆØ¯.")]
        [Display(Name = "Ø³Ø§Ø²Ù†Ø¯Ù‡")]
        public int CreatorId { get; set; }

        [Range(2, 10000, ErrorMessage = "Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 2 ØªØ§ 10000 Ø¨Ø§Ø´Ø¯.")]
        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§")]
        public int MaxMembers { get; set; } = 100;

        [Display(Name = "Ø¹Ù…ÙˆÙ…ÛŒ")]
        public bool IsPublic { get; set; } = false;

        [Display(Name = "ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; } = true;
    }
}
 
 
==================== GroupEditViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
ï»¿using System.ComponentModel.DataAnnotations;

namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ú¯Ø±ÙˆÙ‡
    /// </summary>
    public class GroupEditViewModel
    {
        public int Id { get; set; }

        [Required(ErrorMessage = "Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.")]
        [StringLength(100, MinimumLength = 2, ErrorMessage = "Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 2 ØªØ§ 100 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.")]
        [Display(Name = "Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡")]
        public string Name { get; set; } = string.Empty;

        [StringLength(500, ErrorMessage = "ØªÙˆØ¶ÛŒØ­Ø§Øª Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨ÛŒØ´ Ø§Ø² 500 Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯.")]
        [Display(Name = "ØªÙˆØ¶ÛŒØ­Ø§Øª")]
        public string? Description { get; set; }

        [Range(2, 10000, ErrorMessage = "Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§ Ø¨Ø§ÛŒØ¯ Ø¨ÛŒÙ† 2 ØªØ§ 10000 Ø¨Ø§Ø´Ø¯.")]
        [Display(Name = "Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§")]
        public int MaxMembers { get; set; }

        [Display(Name = "Ø¹Ù…ÙˆÙ…ÛŒ")]
        public bool IsPublic { get; set; }

        [Display(Name = "ÙØ¹Ø§Ù„")]
        public bool IsActive { get; set; }

        public int CreatorId { get; set; }

        public string? CreatorName { get; set; }

        public DateTime CreatedAt { get; set; }

        public int CurrentMemberCount { get; set; }
    }
}
 
 
==================== GroupListViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
ï»¿namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
    /// </summary>
    public class GroupListViewModel
    {
        public int Id { get; set; }

        public string Name { get; set; } = string.Empty;

        public string? Description { get; set; }

        public string? ProfilePicture { get; set; }

        public int CreatorId { get; set; }

        public string CreatorName { get; set; } = string.Empty;

        public string? CreatorUsername { get; set; }

        public int MemberCount { get; set; }

        public int AdminCount { get; set; }

        public int MessageCount { get; set; }

        public int MaxMembers { get; set; }

        public bool IsActive { get; set; }

        public bool IsPublic { get; set; }

        public bool IsDeleted { get; set; }

        public DateTime CreatedAt { get; set; }

        public DateTime? DeletedAt { get; set; }

        public DateTime? LastActivityAt { get; set; }
    }
}
 
 
==================== MessageListViewModel.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Models\ViewModels\ 
 
ï»¿namespace OrganizationalMessenger.Web.Models.ViewModels
{
    /// <summary>
    /// ViewModel Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù„ÛŒØ³Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ø¯Ø± Ù¾Ù†Ù„ Ø§Ø¯Ù…ÛŒÙ†
    /// </summary>
    public class MessageListViewModel
    {
        public int Id { get; set; }

        public int SenderId { get; set; }

        public string SenderName { get; set; } = string.Empty;

        public string? SenderUsername { get; set; }

        public string? SenderAvatar { get; set; }

        public string MessageText { get; set; } = string.Empty;

        public DateTime SentAt { get; set; }

        public bool IsEdited { get; set; }

        public DateTime? EditedAt { get; set; }

        public bool IsDeleted { get; set; }

        public string Type { get; set; } = "Text";

        public string? AttachmentUrl { get; set; }

        public string? AttachmentName { get; set; }

        public long? AttachmentSize { get; set; }

        public int ReplyCount { get; set; }

        public int ReactionCount { get; set; }

        public bool IsRead { get; set; }

        public bool IsDelivered { get; set; }
    }
}
 
 
==================== .NETCoreApp,Version=v8.0.AssemblyAttributes.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
// <autogenerated />
using System;
using System.Reflection;
[assembly: global::System.Runtime.Versioning.TargetFrameworkAttribute(".NETCoreApp,Version=v8.0", FrameworkDisplayName = ".NET 8.0")]
 
 
==================== OrganizationalMessenger.Web.AssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: System.Reflection.AssemblyCompanyAttribute("OrganizationalMessenger.Web")]
[assembly: System.Reflection.AssemblyConfigurationAttribute("Debug")]
[assembly: System.Reflection.AssemblyFileVersionAttribute("1.0.0.0")]
[assembly: System.Reflection.AssemblyInformationalVersionAttribute("1.0.0+0a6cf97d17a7529676d54880d5db7070f8dddde6")]
[assembly: System.Reflection.AssemblyProductAttribute("OrganizationalMessenger.Web")]
[assembly: System.Reflection.AssemblyTitleAttribute("OrganizationalMessenger.Web")]
[assembly: System.Reflection.AssemblyVersionAttribute("1.0.0.0")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== OrganizationalMessenger.Web.GlobalUsings.g.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
// <auto-generated/>
global using global::Microsoft.AspNetCore.Builder;
global using global::Microsoft.AspNetCore.Hosting;
global using global::Microsoft.AspNetCore.Http;
global using global::Microsoft.AspNetCore.Routing;
global using global::Microsoft.Extensions.Configuration;
global using global::Microsoft.Extensions.DependencyInjection;
global using global::Microsoft.Extensions.Hosting;
global using global::Microsoft.Extensions.Logging;
global using global::System;
global using global::System.Collections.Generic;
global using global::System.IO;
global using global::System.Linq;
global using global::System.Net.Http;
global using global::System.Net.Http.Json;
global using global::System.Threading;
global using global::System.Threading.Tasks;
 
 
==================== OrganizationalMessenger.Web.RazorAssemblyInfo.cs ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\obj\Debug\net8.0\ 
 
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//     Runtime Version:4.0.30319.42000
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Reflection;

[assembly: Microsoft.AspNetCore.Mvc.ApplicationParts.ProvideApplicationPartFactoryAttribute("Microsoft.AspNetCore.Mvc.ApplicationParts.ConsolidatedAssemblyApplicationPartFact" +
    "ory, Microsoft.AspNetCore.Mvc.Razor")]

// Generated by the MSBuild WriteCodeFragment class.

 
 
==================== _ViewImports.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\ 
 
ï»¿@using OrganizationalMessenger.Web
@using OrganizationalMessenger.Web.Areas.Admin.Models
@using OrganizationalMessenger.Domain.Entities
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
 
 
==================== _ViewStart.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\ 
 
ï»¿@{
    Layout = "_Layout";
}
 
 
==================== Login.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Account\ 
 
ï»¿@model OrganizationalMessenger.Web.Areas.Admin.Models.LoginViewModel
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÙˆØ±ÙˆØ¯ - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.rtl.min.css" />
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .login-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 40px;
            max-width: 400px;
            width: 100%;
        }
        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .login-header h2 {
            color: #667eea;
            font-weight: bold;
        }
        .btn-login {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            transition: transform 0.2s;
        }
        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="login-container">
        <div class="login-header">
            <h2>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</h2>
            <p class="text-muted">Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</p>
        </div>

        <form method="post" asp-action="Login">
            @Html.AntiForgeryToken()

            <div asp-validation-summary="ModelOnly" class="alert alert-danger" role="alert"></div>

            <div class="mb-3">
                <label asp-for="Username" class="form-label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</label>
                <input asp-for="Username" class="form-control" autocomplete="username" />
                <span asp-validation-for="Username" class="text-danger"></span>
            </div>

            <div class="mb-3">
                <label asp-for="Password" class="form-label">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label>
                <input asp-for="Password" class="form-control" autocomplete="current-password" />
                <span asp-validation-for="Password" class="text-danger"></span>
            </div>

            <div class="mb-3 form-check">
                <input asp-for="RememberMe" class="form-check-input" />
                <label asp-for="RememberMe" class="form-check-label">Ù…Ø±Ø§ Ø¨Ù‡ Ø®Ø§Ø·Ø± Ø¨Ø³Ù¾Ø§Ø±</label>
            </div>

            <button type="submit" class="btn btn-login w-100">ÙˆØ±ÙˆØ¯</button>
        </form>

        <div class="text-center mt-3">
            <small class="text-muted">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶: admin | Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±: Admin@123</small>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
</body>
</html>
 
 
==================== Create.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
ï»¿@model OrganizationalMessenger.Web.Models.ViewModels.ChannelCreateViewModel

@{
    ViewData["Title"] = "Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()

    <div class="form-group">
        <label asp-for="Name">Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ *</label>
        <input asp-for="Name" class="form-control" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="CreatorId">Ø³Ø§Ø²Ù†Ø¯Ù‡ *</label>
        <select asp-for="CreatorId" class="form-control" required>
            <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
            @if (ViewBag.Users != null)
            {
                @foreach (var user in ViewBag.Users)
                {
                    <option value="@user.Id">@user.FullName (@user.Username)</option>
                }
            }
        </select>
        <span asp-validation-for="CreatorId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label class="checkbox-label">
            <input asp-for="IsPublic" type="checkbox" />
            Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ
        </label>
    </div>

    <div class="form-group">
        <label class="checkbox-label">
            <input asp-for="IsActive" type="checkbox" />
            ÙØ¹Ø§Ù„
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
 
 
==================== Details.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
ï»¿@model OrganizationalMessenger.Domain.Entities.Channel

@{
    ViewData["Title"] = "Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù†Ø§Ù„";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    string ToPersianDate(DateTime? date)
    {
        if (date == null) return "---";
        var persianCalendar = new System.Globalization.PersianCalendar();
        return $"{persianCalendar.GetYear(date.Value)}/{persianCalendar.GetMonth(date.Value):00}/{persianCalendar.GetDayOfMonth(date.Value):00}";
    }
}

<div class="page-header">
    <h2>Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ù†Ø§Ù„</h2>
    <div class="actions">
        <a href="@Url.Action("Edit", new { id = Model.Id })" class="btn btn-primary">ÙˆÛŒØ±Ø§ÛŒØ´</a>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
    </div>
</div>

<div class="details-container">
    <div class="detail-card">
        <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡</h3>
        <div class="detail-row">
            <span class="label">Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„:</span>
            <span class="value">@Model.Name</span>
        </div>
        <div class="detail-row">
            <span class="label">ØªÙˆØ¶ÛŒØ­Ø§Øª:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.Description) ? "---" : Model.Description)</span>
        </div>
        <div class="detail-row">
            <span class="label">Ø³Ø§Ø²Ù†Ø¯Ù‡:</span>
            <span class="value">@Model.Creator.FirstName @Model.Creator.LastName (@Model.Creator.Username)</span>
        </div>
        <div class="detail-row">
            <span class="label">ÙˆØ¶Ø¹ÛŒØª:</span>
            <span class="badge @(Model.IsActive ? "badge-active" : "badge-inactive")">
                @(Model.IsActive ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">Ù†ÙˆØ¹:</span>
            <span class="badge @(Model.IsPublic ? "badge-active" : "badge-inactive")">
                @(Model.IsPublic ? "Ø¹Ù…ÙˆÙ…ÛŒ" : "Ø®ØµÙˆØµÛŒ")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯:</span>
            <span class="value">@ToPersianDate(Model.CreatedAt)</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>Ø¢Ù…Ø§Ø±</h3>
        <div class="detail-row">
            <span class="label">ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§:</span>
            <span class="value">@ViewBag.MemberCount</span>
        </div>
        <div class="detail-row">
            <span class="label">ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§:</span>
            <span class="value">@ViewBag.MessageCount</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>Ø§Ø¹Ø¶Ø§ÛŒ Ú©Ø§Ù†Ø§Ù„ (@Model.UserChannels.Count)</h3>
        @if (Model.UserChannels.Any())
        {
            <ul class="list-items">
                @foreach (var uc in Model.UserChannels.OrderByDescending(x => x.IsAdmin))
                {
                    <li>
                        @uc.User.FirstName @uc.User.LastName (@uc.User.Username)
                        @if (uc.IsAdmin)
                        {
                            <span class="badge badge-admin">Ù…Ø¯ÛŒØ±</span>
                        }
                        <span class="date">Ø¹Ø¶ÙˆÛŒØª: @ToPersianDate(uc.JoinedAt)</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="no-data">Ø¹Ø¶ÙˆÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯</p>
        }
    </div>
</div>
 
 
==================== Edit.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
ï»¿@model OrganizationalMessenger.Web.Models.ViewModels.ChannelEditViewModel

@{
    ViewData["Title"] = "ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù†Ø§Ù„";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ù†Ø§Ù„</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="CreatorId" />
    <input type="hidden" asp-for="CreatedAt" />

    <div class="form-group">
        <label asp-for="Name">Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„ *</label>
        <input asp-for="Name" class="form-control" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label asp-for="Description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <textarea asp-for="Description" class="form-control" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" asp-for="IsPublic" />
            Ú©Ø§Ù†Ø§Ù„ Ø¹Ù…ÙˆÙ…ÛŒ
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" asp-for="IsActive" />
            ÙØ¹Ø§Ù„
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</a>
    </div>
</form>
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Channels\ 
 
ï»¿@model IEnumerable<OrganizationalMessenger.Web.Models.ViewModels.ChannelListViewModel>

@{
    ViewData["Title"] = "Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</h2>
    <a href="@Url.Action("Create")" class="btn btn-primary">+ Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯</a>
</div>

<div class="search-filter">
    <form method="get" class="search-form">
        <input type="text" name="searchTerm" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… ÛŒØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª..."
               value="@ViewBag.SearchTerm" />

        <select name="isActive">
            <option value="">Ù‡Ù…Ù‡ Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</option>
            <option value="true" selected="@(ViewBag.IsActive == true)">ÙØ¹Ø§Ù„</option>
            <option value="false" selected="@(ViewBag.IsActive == false)">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
        </select>

        <button type="submit" class="btn btn-secondary">Ø¬Ø³ØªØ¬Ùˆ</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§</a>
    </form>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error">@TempData["ErrorMessage"]</div>
}

<table>
    <thead>
        <tr>
            <th>Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„</th>
            <th>Ø³Ø§Ø²Ù†Ø¯Ù‡</th>
            <th>ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
            <th>Ù†ÙˆØ¹</th>
            <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var channel in Model)
        {
            <tr>
                <td>@channel.Name</td>
                <td>@channel.CreatorName</td>
                <td>@channel.SubscriberCount</td>
                <td>
                    <span class="badge @(channel.IsActive ? "badge-active" : "badge-inactive")">
                        @(channel.IsActive ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")
                    </span>
                </td>
                <td>
                    <span class="badge @(channel.IsPublic ? "badge-active" : "badge-inactive")">
                        @(channel.IsPublic ? "Ø¹Ù…ÙˆÙ…ÛŒ" : "Ø®ØµÙˆØµÛŒ")
                    </span>
                </td>
                <td>@channel.CreatedAt.ToString("yyyy/MM/dd")</td>
                <td class="actions">
                    <a href="@Url.Action("Details", new { id = channel.Id })" class="btn-icon" title="Ø¬Ø²Ø¦ÛŒØ§Øª">ğŸ‘ï¸</a>
                    <a href="@Url.Action("Edit", new { id = channel.Id })" class="btn-icon" title="ÙˆÛŒØ±Ø§ÛŒØ´">âœï¸</a>
                    <form method="post" action="@Url.Action("Delete", new { id = channel.Id })"
                          style="display:inline;" onsubmit="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ');">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn-icon btn-danger" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <p class="no-data">Ù‡ÛŒÚ† Ú©Ø§Ù†Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
}
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Dashboard\ 
 
ï»¿@{
    ViewData["Title"] = "Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

@section Styles {
<style>
    /* ==================== Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ CSS ==================== */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        --info-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        --danger-gradient: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
        --dark-gradient: linear-gradient(135deg, #434343 0%, #000000 100%);
        --card-shadow: 0 10px 40px rgba(0,0,0,0.1);
        --card-hover-shadow: 0 20px 60px rgba(0,0,0,0.15);
    }

    /* ==================== Ù‡Ø¯Ø± ØµÙØ­Ù‡ ==================== */
    .page-header {
        background: var(--primary-gradient);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        color: #fff;
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @@keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    .page-header h1 {
        font-size: 2rem;
        font-weight: 700;
        margin: 0;
        position: relative;
        z-index: 1;
    }

    .page-header .date-display {
        font-size: 1rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
    }

    /* ==================== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± ==================== */
    .stats-card {
        background: #fff;
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        height: 100%;
    }

    .stats-card:hover {
        transform: translateY(-10px);
        box-shadow: var(--card-hover-shadow);
    }

    .stats-card::before {
        content: '';
        position: absolute;
        top: 0;
        right: 0;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        opacity: 0.1;
        transform: translate(30%, -30%);
    }

    .stats-card.primary::before { background: #667eea; }
    .stats-card.success::before { background: #38ef7d; }
    .stats-card.warning::before { background: #f5576c; }
    .stats-card.info::before { background: #00f2fe; }
    .stats-card.danger::before { background: #f45c43; }
    .stats-card.purple::before { background: #9f7aea; }
    .stats-card.teal::before { background: #38b2ac; }
    .stats-card.orange::before { background: #ed8936; }

    .stats-card .icon-wrapper {
        width: 60px;
        height: 60px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: #fff;
        margin-bottom: 15px;
    }

    .stats-card.primary .icon-wrapper { background: var(--primary-gradient); }
    .stats-card.success .icon-wrapper { background: var(--success-gradient); }
    .stats-card.warning .icon-wrapper { background: var(--warning-gradient); }
    .stats-card.info .icon-wrapper { background: var(--info-gradient); }
    .stats-card.danger .icon-wrapper { background: var(--danger-gradient); }
    .stats-card.purple .icon-wrapper { background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%); }
    .stats-card.teal .icon-wrapper { background: linear-gradient(135deg, #38b2ac 0%, #319795 100%); }
    .stats-card.orange .icon-wrapper { background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%); }

    .stats-card .stats-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: #2d3748;
        line-height: 1;
        margin-bottom: 5px;
    }

    .stats-card .stats-label {
        font-size: 0.9rem;
        color: #718096;
        margin-bottom: 10px;
    }

    .stats-card .stats-change {
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .stats-card .stats-change.positive { color: #38a169; }
    .stats-card .stats-change.negative { color: #e53e3e; }

    /* ==================== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø± ==================== */
    .chart-card {
        background: #fff;
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
        height: 100%;
    }

    .chart-card .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e2e8f0;
    }

    .chart-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3748;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .chart-card .card-title i {
        color: #667eea;
    }

    .chart-period-btns {
        display: flex;
        gap: 5px;
    }

    .chart-period-btn {
        padding: 6px 12px;
        border: 1px solid #e2e8f0;
        background: #fff;
        border-radius: 8px;
        cursor: pointer;
        font-size: 0.8rem;
        transition: all 0.3s ease;
        font-family: inherit;
    }

    .chart-period-btn:hover,
    .chart-period-btn.active {
        background: #667eea;
        color: #fff;
        border-color: #667eea;
    }

    .chart-container {
        position: relative;
        height: 300px;
    }

    /* ==================== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ ==================== */
    .table-card {
        background: #fff;
        border-radius: 20px;
        padding: 25px;
        box-shadow: var(--card-shadow);
        height: 100%;
    }

    .table-card .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 1px solid #e2e8f0;
    }

    .table-card .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #2d3748;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .table-card .card-title i {
        color: #667eea;
    }

    .table-card .view-all-btn {
        font-size: 0.85rem;
        color: #667eea;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s ease;
    }

    .table-card .view-all-btn:hover {
        color: #764ba2;
    }

    .dashboard-table {
        width: 100%;
        border-collapse: collapse;
    }

    .dashboard-table th {
        text-align: right;
        padding: 12px 15px;
        font-weight: 600;
        color: #4a5568;
        background: #f7fafc;
        font-size: 0.85rem;
    }

    .dashboard-table th:first-child {
        border-radius: 0 10px 10px 0;
    }

    .dashboard-table th:last-child {
        border-radius: 10px 0 0 10px;
    }

    .dashboard-table td {
        padding: 15px;
        border-bottom: 1px solid #edf2f7;
        font-size: 0.9rem;
        color: #4a5568;
    }

    .dashboard-table tr:last-child td {
        border-bottom: none;
    }

    .dashboard-table tr:hover td {
        background: #f7fafc;
    }

    /* ==================== Ø¢ÙˆØ§ØªØ§Ø± Ú©Ø§Ø±Ø¨Ø± ==================== */
    .user-avatar {
        position: relative;
        width: 40px;
        height: 40px;
        background: var(--primary-gradient);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff;
        font-weight: 600;
        font-size: 1rem;
    }

    .user-avatar .online-indicator {
        position: absolute;
        bottom: -2px;
        right: -2px;
        width: 12px;
        height: 12px;
        background: #48bb78;
        border-radius: 50%;
        border: 2px solid #fff;
    }

    .user-info {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .user-info .user-name {
        font-weight: 600;
        color: #2d3748;
    }

    .user-info .user-username {
        font-size: 0.8rem;
        color: #a0aec0;
    }

    /* ==================== Ø¨Ø¬â€ŒÙ‡Ø§ ==================== */
    .badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .badge.bg-success {
        background: rgba(72, 187, 120, 0.15) !important;
        color: #38a169;
    }

    .badge.bg-danger {
        background: rgba(245, 101, 101, 0.15) !important;
        color: #e53e3e;
    }

    .badge.bg-warning {
        background: rgba(237, 137, 54, 0.15) !important;
        color: #dd6b20;
    }

    .badge.bg-info {
        background: rgba(66, 153, 225, 0.15) !important;
        color: #3182ce;
    }

    .badge.bg-secondary {
        background: rgba(113, 128, 150, 0.15) !important;
        color: #718096;
    }

    .badge.bg-primary {
        background: rgba(102, 126, 234, 0.15) !important;
        color: #667eea;
    }

    /* ==================== Ø§Ù†ÛŒÙ…ÛŒØ´Ù† Ø¢Ù¾Ø¯ÛŒØª ==================== */
    .value-updated {
        animation: pulse-update 0.5s ease;
    }

    @@keyframes pulse-update {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); color: #48bb78; }
        100% { transform: scale(1); }
    }

    /* ==================== Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ==================== */
    .last-updated {
        font-size: 0.8rem;
        color: #a0aec0;
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .last-updated i {
        animation: spin 2s linear infinite;
    }

    @@keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* ==================== Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ ==================== */
    @@media (max-width: 768px) {
        .page-header {
            padding: 20px;
        }

        .page-header h1 {
            font-size: 1.5rem;
        }

        .stats-card .stats-value {
            font-size: 1.8rem;
        }

        .chart-period-btns {
            flex-wrap: wrap;
        }
    }
</style>
}

<!-- ==================== Ù‡Ø¯Ø± ØµÙØ­Ù‡ ==================== -->
<div class="page-header">
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div>
            <h1><i class="fas fa-chart-line me-2"></i>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</h1>
            <p class="date-display mb-0 mt-2">
                <i class="fas fa-calendar-alt me-1"></i>
                @ViewBag.TodayPersianDate
            </p>
        </div>
        <div class="last-updated" id="lastUpdatedContainer">
            <i class="fas fa-sync-alt"></i>
            <span>Ø¢Ø®Ø±ÛŒÙ† Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ: </span>
            <span id="lastUpdated">@ViewBag.TodayPersianDateTime</span>
        </div>
    </div>
</div>

<!-- ==================== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± ==================== -->
<div class="row g-4 mb-4">
    <!-- Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card primary">
            <div class="icon-wrapper">
                <i class="fas fa-users"></i>
            </div>
            <div class="stats-value" id="totalUsers">@ViewBag.TotalUsers</div>
            <div class="stats-label">Ú©Ù„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.NewUsersToday Ù†ÙØ± Ø§Ù…Ø±ÙˆØ²</span>
            </div>
        </div>
    </div>

    <!-- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ† -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card success">
            <div class="icon-wrapper">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="stats-value" id="onlineUsers">@ViewBag.OnlineUsers</div>
            <div class="stats-label">Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ†</div>
            <div class="stats-change positive">
                <i class="fas fa-circle text-success"></i>
                <span>ÙØ¹Ø§Ù„</span>
            </div>
        </div>
    </div>

    <!-- Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card info">
            <div class="icon-wrapper">
                <i class="fas fa-comments"></i>
            </div>
            <div class="stats-value" id="totalMessages">@ViewBag.TotalMessages</div>
            <div class="stats-label">Ú©Ù„ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.MessagesToday Ù¾ÛŒØ§Ù… Ø§Ù…Ø±ÙˆØ²</span>
            </div>
        </div>
    </div>

    <!-- Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card warning">
            <div class="icon-wrapper">
                <i class="fas fa-layer-group"></i>
            </div>
            <div class="stats-value" id="totalGroups">@ViewBag.TotalGroups</div>
            <div class="stats-label">Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.NewGroupsThisWeek Ø§ÛŒÙ† Ù‡ÙØªÙ‡</span>
            </div>
        </div>
    </div>

    <!-- Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card purple">
            <div class="icon-wrapper">
                <i class="fas fa-broadcast-tower"></i>
            </div>
            <div class="stats-value" id="totalChannels">@ViewBag.TotalChannels</div>
            <div class="stats-label">Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.NewChannelsThisWeek Ø§ÛŒÙ† Ù‡ÙØªÙ‡</span>
            </div>
        </div>
    </div>

    <!-- ØªÙ…Ø§Ø³â€ŒÙ‡Ø§ -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card teal">
            <div class="icon-wrapper">
                <i class="fas fa-phone-alt"></i>
            </div>
            <div class="stats-value" id="totalCalls">@ViewBag.TotalCalls</div>
            <div class="stats-label">ØªÙ…Ø§Ø³â€ŒÙ‡Ø§</div>
            <div class="stats-change positive">
                <i class="fas fa-arrow-up"></i>
                <span>+@ViewBag.CallsToday Ø§Ù…Ø±ÙˆØ²</span>
            </div>
        </div>
    </div>

    <!-- ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card orange">
            <div class="icon-wrapper">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="stats-value" id="totalFiles">@ViewBag.TotalFiles</div>
            <div class="stats-label">ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡</div>
            <div class="stats-change">
                <i class="fas fa-database"></i>
                <span>@ViewBag.TotalStorageUsed Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡</span>
            </div>
        </div>
    </div>

    <!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± -->
    <div class="col-xl-3 col-lg-4 col-md-6">
        <div class="stats-card danger">
            <div class="icon-wrapper">
                <i class="fas fa-flag"></i>
            </div>
            <div class="stats-value" id="pendingReports">@ViewBag.PendingReports</div>
            <div class="stats-label">Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</div>
            <div class="stats-change negative">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ø±Ø±Ø³ÛŒ</span>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ ==================== -->
<div class="row g-4 mb-4">
    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
    <div class="col-xl-8 col-lg-7">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-area"></i>
                    Ø¢Ù…Ø§Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
                </h5>
                <div class="chart-period-btns">
                    <button class="chart-period-btn active" data-period="week">Ù‡ÙØªÙ‡</button>
                    <button class="chart-period-btn" data-period="month">Ù…Ø§Ù‡</button>
                    <button class="chart-period-btn" data-period="year">Ø³Ø§Ù„</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="messagesChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ -->
    <div class="col-xl-4 col-lg-5">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-pie"></i>
                    Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
                </h5>
            </div>
            <div class="chart-container">
                <canvas id="messageTypesChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ÛŒ Ø±Ø¯ÛŒÙ Ø¯ÙˆÙ… ==================== -->
<div class="row g-4 mb-4">
    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ¹Ø§Ù„ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
    <div class="col-xl-6">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-bar"></i>
                    ÙØ¹Ø§Ù„ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† (Ø³Ø§Ø¹ØªÛŒ)
                </h5>
            </div>
            <div class="chart-container">
                <canvas id="userActivityChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Ù†Ù…ÙˆØ¯Ø§Ø± ØªÙ…Ø§Ø³â€ŒÙ‡Ø§ -->
    <div class="col-xl-6">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-chart-line"></i>
                    Ø¢Ù…Ø§Ø± ØªÙ…Ø§Ø³â€ŒÙ‡Ø§
                </h5>
                <div class="chart-period-btns">
                    <button class="chart-period-btn active" data-period="week" data-chart="calls">Ù‡ÙØªÙ‡</button>
                    <button class="chart-period-btn" data-period="month" data-chart="calls">Ù…Ø§Ù‡</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="callsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Ø¬Ø¯Ø§ÙˆÙ„ ==================== -->
<div class="row g-4 mb-4">
    <!-- Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯ -->
    <div class="col-xl-6">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-user-plus"></i>
                    Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¬Ø¯ÛŒØ¯
                </h5>
                <a href="/Admin/Users" class="view-all-btn">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Ú©Ø§Ø±Ø¨Ø±</th>
                            <th>ØªØ§Ø±ÛŒØ® Ø¹Ø¶ÙˆÛŒØª</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="newUsersTableBody">
                        @if (ViewBag.NewUsers != null)
                        {
                            foreach (var user in ViewBag.NewUsers)
                            {
                                <tr>
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar">
                                                @(user.FullName?.Length > 0 ? user.FullName[0].ToString().ToUpper() : "U")
                                                @if (user.IsOnline)
                                                {
                                                    <span class="online-indicator"></span>
                                                }
                                            </div>
                                            <div>
                                                <div class="user-name">@user.FullName</div>
                                                <div class="user-username">@@@user.Username</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>@user.CreatedAtPersian</td>
                                    <td>
                                        @if (user.IsActive)
                                        {
                                            <span class="badge bg-success">ÙØ¹Ø§Ù„</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-danger">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                                        }
                                    </td>
                                    <td>
                                        <a href="/Admin/Users/Edit/@user.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">
                                    <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                                    Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø§Ø®ÛŒØ± -->
    <div class="col-xl-6">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-flag"></i>
                    Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ø§Ø®ÛŒØ±
                </h5>
                <a href="/Admin/Reports" class="view-all-btn">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Ú¯Ø²Ø§Ø±Ø´â€ŒØ¯Ù‡Ù†Ø¯Ù‡</th>
                            <th>Ù†ÙˆØ¹</th>
                            <th>Ø¯Ù„ÛŒÙ„</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="recentReportsTableBody">
                        @if (ViewBag.RecentReports != null && ((IEnumerable<dynamic>)ViewBag.RecentReports).Any())
                        {
                            foreach (var report in ViewBag.RecentReports)
                            {
                                <tr>
                                    <td>
                                        <div class="user-info">
                                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 0.9rem;">
                                                @(report.ReporterName?.Length > 0 ? report.ReporterName[0].ToString().ToUpper() : "U")
                                            </div>
                                            <div>
                                                <div class="user-name">@report.ReporterName</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        @switch (report.ItemType)
                                        {
                                            case "Message":
                                                <span class="badge bg-info">Ù¾ÛŒØ§Ù…</span>
                                                break;
                                            case "User":
                                                <span class="badge bg-primary">Ú©Ø§Ø±Ø¨Ø±</span>
                                                break;
                                            case "Group":
                                                <span class="badge bg-warning">Ú¯Ø±ÙˆÙ‡</span>
                                                break;
                                            case "Channel":
                                                <span class="badge bg-secondary">Ú©Ø§Ù†Ø§Ù„</span>
                                                break;
                                            default:
                                                <span class="badge bg-light text-dark">@report.ItemType</span>
                                                break;
                                        }
                                    </td>
                                    <td>
                                        <span class="text-truncate d-inline-block" style="max-width: 150px;" title="@report.Reason">
                                            @report.Reason
                                        </span>
                                    </td>
                                    <td>
                                        @switch (report.Status)
                                        {
                                            case "Pending":
                                                <span class="badge bg-warning">Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±</span>
                                                break;
                                            case "Reviewed":
                                                <span class="badge bg-info">Ø¨Ø±Ø±Ø³ÛŒ Ø´Ø¯Ù‡</span>
                                                break;
                                            case "Resolved":
                                                <span class="badge bg-success">Ø­Ù„ Ø´Ø¯Ù‡</span>
                                                break;
                                            case "Dismissed":
                                                <span class="badge bg-secondary">Ø±Ø¯ Ø´Ø¯Ù‡</span>
                                                break;
                                            default:
                                                <span class="badge bg-light text-dark">@report.Status</span>
                                                break;
                                        }
                                    </td>
                                    <td>
                                        <a href="/Admin/Reports/Details/@report.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="5" class="text-center text-muted py-4">
                                    <i class="fas fa-check-circle fa-2x mb-2 d-block text-success"></i>
                                    Ú¯Ø²Ø§Ø±Ø´ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Ø±Ø¯ÛŒÙ Ø³ÙˆÙ… Ø¬Ø¯Ø§ÙˆÙ„ ==================== -->
<div class="row g-4 mb-4">
    <!-- Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ -->
    <div class="col-xl-4">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-fire"></i>
                    Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
                </h5>
                <a href="/Admin/Groups" class="view-all-btn">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡</th>
                            <th>Ø§Ø¹Ø¶Ø§</th>
                            <th>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.ActiveGroups != null)
                        {
                            foreach (var group in ViewBag.ActiveGroups)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 0.9rem; background: var(--warning-gradient);">
                                                <i class="fas fa-users" style="font-size: 0.8rem;"></i>
                                            </div>
                                            <span>@group.Name</span>
                                        </div>
                                    </td>
                                    <td>@group.MemberCount</td>
                                    <td>@group.MessageCount</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">
                                    Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„ -->
    <div class="col-xl-4">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-broadcast-tower"></i>
                    Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„
                </h5>
                <a href="/Admin/Channels" class="view-all-btn">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>Ù†Ø§Ù… Ú©Ø§Ù†Ø§Ù„</th>
                            <th>Ø§Ø¹Ø¶Ø§</th>
                            <th>Ù¾Ø³Øªâ€ŒÙ‡Ø§</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.ActiveChannels != null)
                        {
                            foreach (var channel in ViewBag.ActiveChannels)
                            {
                                <tr>
                                    <td>
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="user-avatar" style="width: 35px; height: 35px; font-size: 0.9rem; background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);">
                                                <i class="fas fa-broadcast-tower" style="font-size: 0.8rem;"></i>
                                            </div>
                                            <span>@channel.Name</span>
                                        </div>
                                    </td>
                                    <td>@channel.SubscriberCount</td>
                                    <td>@channel.PostCount</td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="3" class="text-center text-muted py-4">
                                    Ú©Ø§Ù†Ø§Ù„ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Ø¢Ø®Ø±ÛŒÙ† ØªÙ…Ø§Ø³â€ŒÙ‡Ø§ -->
    <div class="col-xl-4">
        <div class="table-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-phone-alt"></i>
                    Ø¢Ø®Ø±ÛŒÙ† ØªÙ…Ø§Ø³â€ŒÙ‡Ø§
                </h5>
                <a href="/Admin/Calls" class="view-all-btn">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                    <i class="fas fa-arrow-left"></i>
                </a>
            </div>
            <div class="table-responsive">
                <table class="dashboard-table">
                    <thead>
                        <tr>
                            <th>ØªÙ…Ø§Ø³â€ŒÚ¯ÛŒØ±Ù†Ø¯Ù‡</th>
                            <th>Ù†ÙˆØ¹</th>
                            <th>Ù…Ø¯Øª</th>
                            <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (ViewBag.RecentCalls != null)
                        {
                            foreach (var call in ViewBag.RecentCalls)
                            {
                                <tr>
                                    <td>@call.InitiatorName</td>
                                    <td>
                                        @if (call.Type == "Voice")
                                        {
                                            <i class="fas fa-phone text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="fas fa-video text-primary"></i>
                                        }
                                    </td>
                                    <td>@call.Duration</td>
                                    <td>
                                        @switch (call.Status)
                                        {
                                            case "Answered":
                                                <span class="badge bg-success">Ø¨Ø±Ù‚Ø±Ø§Ø±</span>
                                                break;
                                            case "Missed":
                                                <span class="badge bg-warning">Ø§Ø² Ø¯Ø³Øª Ø±ÙØªÙ‡</span>
                                                break;
                                            case "Rejected":
                                                <span class="badge bg-danger">Ø±Ø¯ Ø´Ø¯Ù‡</span>
                                                break;
                                            default:
                                                <span class="badge bg-secondary">@call.Status</span>
                                                break;
                                        }
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="4" class="text-center text-muted py-4">
                                    ØªÙ…Ø§Ø³ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ==================== Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø³Ø±ÛŒØ¹ ==================== -->
<div class="row g-4">
    <div class="col-12">
        <div class="chart-card">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-bolt"></i>
                    Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹
                </h5>
            </div>
            <div class="row g-3 p-3">
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Users/Create" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--primary-gradient);">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <span>Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Groups/Create" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--success-gradient);">
                            <i class="fas fa-users"></i>
                        </div>
                        <span>Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Channels/Create" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: linear-gradient(135deg, #9f7aea 0%, #805ad5 100%);">
                            <i class="fas fa-broadcast-tower"></i>
                        </div>
                        <span>Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Messages/Broadcast" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--info-gradient);">
                            <i class="fas fa-bullhorn"></i>
                        </div>
                        <span>Ù¾ÛŒØ§Ù… Ù‡Ù…Ú¯Ø§Ù†ÛŒ</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Settings" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--warning-gradient);">
                            <i class="fas fa-cog"></i>
                        </div>
                        <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
                    </a>
                </div>
                <div class="col-lg-2 col-md-3 col-sm-4 col-6">
                    <a href="/Admin/Reports" class="quick-action-btn">
                        <div class="quick-action-icon" style="background: var(--danger-gradient);">
                            <i class="fas fa-flag"></i>
                        </div>
                        <span>Ú¯Ø²Ø§Ø±Ø´Ø§Øª</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script>
        // ==================== ØªÙ†Ø¸ÛŒÙ…Ø§Øª Chart.js ====================
        Chart.defaults.font.family = 'Vazirmatn, Tahoma, sans-serif';
        Chart.defaults.color = '#718096';

        // ==================== Ù†Ù…ÙˆØ¯Ø§Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ ====================
        const messagesCtx = document.getElementById('messagesChart').getContext('2d');
        const messagesChart = new Chart(messagesCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(ViewBag.MessageChartLabels ?? "['Ø´Ù†Ø¨Ù‡', 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡']"),
                datasets: [{
                    label: 'Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§',
                    data: @Html.Raw(ViewBag.MessageChartData ?? "[120, 190, 150, 220, 180, 250, 200]"),
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4,
                    pointBackgroundColor: '#667eea',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    pointRadius: 5,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10,
                        displayColors: false
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // ==================== Ù†Ù…ÙˆØ¯Ø§Ø± Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ ====================
        const messageTypesCtx = document.getElementById('messageTypesChart').getContext('2d');
        const messageTypesChart = new Chart(messageTypesCtx, {
            type: 'doughnut',
            data: {
                labels: ['Ù…ØªÙ†ÛŒ', 'ØªØµÙˆÛŒØ±', 'ÙˆÛŒØ¯ÛŒÙˆ', 'ØµÙˆØªÛŒ', 'ÙØ§ÛŒÙ„', 'Ø³Ø§ÛŒØ±'],
                datasets: [{
                    data: @Html.Raw(ViewBag.MessageTypesData ?? "[65, 15, 8, 5, 5, 2]"),
                    backgroundColor: [
                        '#667eea',
                        '#38ef7d',
                        '#f5576c',
                        '#4facfe',
                        '#ed8936',
                        '#9f7aea'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10
                    }
                },
                cutout: '65%'
            }
        });

        // ==================== Ù†Ù…ÙˆØ¯Ø§Ø± ÙØ¹Ø§Ù„ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† ====================
        const userActivityCtx = document.getElementById('userActivityChart').getContext('2d');
        const userActivityChart = new Chart(userActivityCtx, {
            type: 'bar',
            data: {
                labels: ['00', '02', '04', '06', '08', '10', '12', '14', '16', '18', '20', '22'],
                datasets: [{
                    label: 'ÙØ¹Ø§Ù„ÛŒØª',
                    data: @Html.Raw(ViewBag.UserActivityData ?? "[10, 5, 3, 8, 45, 80, 95, 88, 92, 85, 60, 30]"),
                    backgroundColor: 'rgba(102, 126, 234, 0.8)',
                    borderRadius: 8,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10,
                        displayColors: false,
                        callbacks: {
                            title: function(context) {
                                return 'Ø³Ø§Ø¹Øª ' + context[0].label + ':00';
                            },
                            label: function(context) {
                                return context.raw + ' Ú©Ø§Ø±Ø¨Ø± ÙØ¹Ø§Ù„';
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // ==================== Ù†Ù…ÙˆØ¯Ø§Ø± ØªÙ…Ø§Ø³â€ŒÙ‡Ø§ ====================
        const callsCtx = document.getElementById('callsChart').getContext('2d');
        const callsChart = new Chart(callsCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(ViewBag.CallsChartLabels ?? "['Ø´Ù†Ø¨Ù‡', 'ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡']"),
                datasets: [
                    {
                        label: 'ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ',
                        data: @Html.Raw(ViewBag.VoiceCallsData ?? "[25, 35, 28, 42, 38, 45, 30]"),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ',
                        data: @Html.Raw(ViewBag.VideoCallsData ?? "[10, 15, 12, 18, 14, 20, 15]"),
                        borderColor: '#4299e1',
                        backgroundColor: 'rgba(66, 153, 225, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 15,
                            usePointStyle: true,
                            pointStyle: 'circle'
                        }
                    },
                    tooltip: {
                        backgroundColor: '#2d3748',
                        titleColor: '#fff',
                        bodyColor: '#fff',
                        padding: 12,
                        cornerRadius: 10
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(0,0,0,0.05)'
                        }
                    }
                }
            }
        });

        // ==================== ØªØºÛŒÛŒØ± Ø¨Ø§Ø²Ù‡ Ø²Ù…Ø§Ù†ÛŒ Ù†Ù…ÙˆØ¯Ø§Ø±Ù‡Ø§ ====================
        document.querySelectorAll('.chart-period-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const period = this.dataset.period;
                const chartType = this.dataset.chart || 'messages';

                // ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª active
                this.parentElement.querySelectorAll('.chart-period-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');

                // Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯ Ø§Ø² Ø³Ø±ÙˆØ±
                loadChartData(chartType, period);
            });
        });

        function loadChartData(chartType, period) {
            fetch(`/Admin/Dashboard/GetChartData?type=${chartType}&period=${period}`)
                .then(response => response.json())
                .then(data => {
                    if (chartType === 'messages') {
                        messagesChart.data.labels = data.labels;
                        messagesChart.data.datasets[0].data = data.values;
                        messagesChart.update();
                    } else if (chartType === 'calls') {
                        callsChart.data.labels = data.labels;
                        callsChart.data.datasets[0].data = data.voiceCalls;
                        callsChart.data.datasets[1].data = data.videoCalls;
                        callsChart.update();
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // ==================== Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¢Ù…Ø§Ø± ====================
        function updateStats() {
            fetch('/Admin/Dashboard/GetLiveStats')
                .then(response => response.json())
                .then(data => {
                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…Ø§Ø± Ø¨Ø§ Ø§Ù†ÛŒÙ…ÛŒØ´Ù†
                    updateStatValue('totalUsers', data.totalUsers);
                    updateStatValue('onlineUsers', data.onlineUsers);
                    updateStatValue('totalMessages', data.totalMessages);
                    updateStatValue('totalGroups', data.totalGroups);
                    updateStatValue('totalChannels', data.totalChannels);
                    updateStatValue('totalCalls', data.totalCalls);
                    updateStatValue('totalFiles', data.totalFiles);
                    updateStatValue('pendingReports', data.pendingReports);

                    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø²Ù…Ø§Ù†
                    document.getElementById('lastUpdated').textContent = data.lastUpdated;
                })
                .catch(error => console.error('Error updating stats:', error));
        }

        function updateStatValue(elementId, newValue) {
            const element = document.getElementById(elementId);
            if (element && element.textContent !== newValue.toString()) {
                element.textContent = newValue.toLocaleString('fa-IR');
                element.classList.add('value-updated');
                setTimeout(() => element.classList.remove('value-updated'), 500);
            }
        }

        // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ù‡Ø± 30 Ø«Ø§Ù†ÛŒÙ‡
        setInterval(updateStats, 30000);

        // ==================== Ø§Ù†ÛŒÙ…ÛŒØ´Ù† ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Øªâ€ŒÙ‡Ø§ ====================
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.stats-card, .chart-card, .table-card');
            cards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 100);
            });
        });
    </script>

    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø³Ø±ÛŒØ¹ */
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px 15px;
            background: #f7fafc;
            border-radius: 15px;
            text-decoration: none;
            color: #4a5568;
            transition: all 0.3s ease;
        }

            .quick-action-btn:hover {
                background: #edf2f7;
                transform: translateY(-5px);
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                color: #2d3748;
            }

        .quick-action-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 1.2rem;
        }

        .quick-action-btn span {
            font-size: 0.85rem;
            font-weight: 500;
            text-align: center;
        }
    </style>
}
 
 
==================== Create.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Groups\ 
 
ï»¿@model OrganizationalMessenger.Web.Models.ViewModels.GroupCreateViewModel

@{
    ViewData["Title"] = "Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()

    <div class="form-group">
        <label for="Name">Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ *</label>
        <input type="text" id="Name" name="Name" asp-for="Name" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="Description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <textarea id="Description" name="Description" asp-for="Description" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="CreatorId">Ø³Ø§Ø²Ù†Ø¯Ù‡ *</label>
        <select id="CreatorId" name="CreatorId" asp-for="CreatorId" required>
            <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
            @foreach (var user in ViewBag.Users)
            {
                <option value="@user.Id">@user.FirstName @user.LastName (@user.Username)</option>
            }
        </select>
        <span asp-validation-for="CreatorId" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="MaxMembers">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§</label>
        <input type="number" id="MaxMembers" name="MaxMembers" asp-for="MaxMembers" min="2" max="5000" value="200" />
        <span asp-validation-for="MaxMembers" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsPublic" asp-for="IsPublic" />
            Ú¯Ø±ÙˆÙ‡ Ø¹Ù…ÙˆÙ…ÛŒ
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsActive" asp-for="IsActive" checked />
            ÙØ¹Ø§Ù„
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
 
 
==================== Edit.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Groups\ 
 
ï»¿@model OrganizationalMessenger.Web.Models.ViewModels.GroupEditViewModel

@{
    ViewData["Title"] = "ÙˆÛŒØ±Ø§ÛŒØ´ Ú¯Ø±ÙˆÙ‡";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>ÙˆÛŒØ±Ø§ÛŒØ´ Ú¯Ø±ÙˆÙ‡</h2>
    <a href="@Url.Action("Index")" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
</div>

<form method="post" class="form-container">
    @Html.AntiForgeryToken()
    <input type="hidden" asp-for="Id" />
    <input type="hidden" asp-for="CreatorId" />
    <input type="hidden" asp-for="CreatedAt" />

    <div class="form-group">
        <label for="Name">Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡ *</label>
        <input type="text" id="Name" name="Name" asp-for="Name" required />
        <span asp-validation-for="Name" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="Description">ØªÙˆØ¶ÛŒØ­Ø§Øª</label>
        <textarea id="Description" name="Description" asp-for="Description" rows="3"></textarea>
        <span asp-validation-for="Description" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label for="MaxMembers">Ø­Ø¯Ø§Ú©Ø«Ø± ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§</label>
        <input type="number" id="MaxMembers" name="MaxMembers" asp-for="MaxMembers" min="2" max="5000" />
        <span asp-validation-for="MaxMembers" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsPublic" asp-for="IsPublic" />
            Ú¯Ø±ÙˆÙ‡ Ø¹Ù…ÙˆÙ…ÛŒ
        </label>
    </div>

    <div class="form-group">
        <label>
            <input type="checkbox" name="IsActive" asp-for="IsActive" />
            ÙØ¹Ø§Ù„
        </label>
    </div>

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ø§Ù†ØµØ±Ø§Ù</a>
    </div>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Groups\ 
 
ï»¿@model IEnumerable<OrganizationalMessenger.Web.Models.ViewModels.GroupListViewModel>

@{
    ViewData["Title"] = "Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="page-header">
    <h2>Ù…Ø¯ÛŒØ±ÛŒØª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</h2>
    <a href="@Url.Action("Create")" class="btn btn-primary">+ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯</a>
</div>

<div class="search-filter">
    <form method="get" class="search-form">
        <input type="text" name="searchTerm" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù… ÛŒØ§ ØªÙˆØ¶ÛŒØ­Ø§Øª..."
               value="@ViewBag.SearchTerm" />

        <select name="isActive">
            <option value="">Ù‡Ù…Ù‡ Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</option>
            <option value="true" selected="@(ViewBag.IsActive == true)">ÙØ¹Ø§Ù„</option>
            <option value="false" selected="@(ViewBag.IsActive == false)">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
        </select>

        <button type="submit" class="btn btn-secondary">Ø¬Ø³ØªØ¬Ùˆ</button>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„ØªØ±Ù‡Ø§</a>
    </form>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-error">@TempData["ErrorMessage"]</div>
}

<table>
    <thead>
        <tr>
            <th>Ù†Ø§Ù… Ú¯Ø±ÙˆÙ‡</th>
            <th>Ø³Ø§Ø²Ù†Ø¯Ù‡</th>
            <th>ØªØ¹Ø¯Ø§Ø¯ Ø§Ø¹Ø¶Ø§</th>
            <th>ÙˆØ¶Ø¹ÛŒØª</th>
            <th>Ù†ÙˆØ¹</th>
            <th>ØªØ§Ø±ÛŒØ® Ø§ÛŒØ¬Ø§Ø¯</th>
            <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var group in Model)
        {
            <tr>
                <td>@group.Name</td>
                <td>@group.CreatorName</td>
                <td>@group.MemberCount</td>
                <td>
                    <span class="badge @(group.IsActive ? "badge-active" : "badge-inactive")">
                        @(group.IsActive ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")
                    </span>
                </td>
                <td>
                    <span class="badge @(group.IsPublic ? "badge-active" : "badge-inactive")">
                        @(group.IsPublic ? "Ø¹Ù…ÙˆÙ…ÛŒ" : "Ø®ØµÙˆØµÛŒ")
                    </span>
                </td>
                <td>@group.CreatedAt.ToString("yyyy/MM/dd")</td>
                <td class="actions">
                    <a href="@Url.Action("Details", new { id = group.Id })" class="btn-icon" title="Ø¬Ø²Ø¦ÛŒØ§Øª">ğŸ‘ï¸</a>
                    <a href="@Url.Action("Members", new { id = group.Id })" class="btn-icon" title="Ø§Ø¹Ø¶Ø§">ğŸ‘¥</a>
                    <a href="@Url.Action("Edit", new { id = group.Id })" class="btn-icon" title="ÙˆÛŒØ±Ø§ÛŒØ´">âœï¸</a>
                    <form method="post" action="@Url.Action("Delete", new { id = group.Id })"
                          style="display:inline;" onsubmit="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ');">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn-icon btn-danger" title="Ø­Ø°Ù">ğŸ—‘ï¸</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <p class="no-data">Ù‡ÛŒÚ† Ú¯Ø±ÙˆÙ‡ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>
}
 
 
==================== Authentication.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }

            <form asp-action="Authentication" method="post">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Ù†ÙˆØ¹ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</label>
                            @{
                                string authType = ViewBag.AuthenticationType?.ToString() ?? "Database";
                            }
                            <select name="authenticationType" class="form-control">
                                <option value="Database" selected="@(authType == "Database")">Ø¯ÛŒØªØ§Ø¨ÛŒØ³</option>
                                <option value="ActiveDirectory" selected="@(authType == "ActiveDirectory")">Active Directory</option>
                                <option value="ERP" selected="@(authType == "ERP")">ERP</option>
                            </select>
                        </div>
                        <div class="form-group mb-3">
                            <label>Ø³Ø±ÙˆØ± AD</label>
                            <input type="text" name="adServer" value="@ViewBag.AdServer" class="form-control" />
                        </div>
                        <div class="form-group mb-3">
                            <label>Ø¯Ø§Ù…Ù†Ù‡ AD</label>
                            <input type="text" name="adDomain" value="@ViewBag.AdDomain" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>API ERP</label>
                            <input type="url" name="erpApiUrl" value="@ViewBag.ErpApiUrl"
                                   class="form-control" placeholder="https://erp.company.com/api" />
                        </div>

                        <!-- âœ… Checkbox -->
                        <div class="form-check mb-3">
                            <input type="checkbox" name="otpEnabled" value="true"
                                   class="form-check-input" id="otpEnabled"
                                   @(ViewBag.OtpEnabled == true ? "checked" : "") />
                            <label class="form-check-label" for="otpEnabled">ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ OTP</label>
                        </div>
                        <input type="hidden" name="otpEnabled" value="false" />

                        <div class="form-group mb-3">
                            <label>Ø§Ù†Ù‚Ø¶Ø§ÛŒ OTP (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                            <input type="number" name="otpExpiryMinutes"
                                   value="@ViewBag.OtpExpiryMinutes"
                                   class="form-control" min="1" max="60" />
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Ø°Ø®ÛŒØ±Ù‡</button>
                <a asp-action="Index" class="btn btn-secondary ml-2">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== FileUpload.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@model IEnumerable<OrganizationalMessenger.Domain.Entities.FileUploadSetting>
@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["Success"]
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["Error"]
            <button type="button" class="close" data-dismiss="alert">&times;</button>
        </div>
    }

    <!-- Add New File Type -->
    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <h5><i class="fas fa-plus-circle"></i> Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯</h5>
        </div>
        <div class="card-body">
            <form asp-action="AddFileType" method="post" class="row align-items-end">
                <div class="col-md-2">
                    <label class="form-label"> jpg, pdf, zipÙ†ÙˆØ¹ ÙØ§ÛŒÙ„</label>
                    <input type="text" name="fileType" placeholder="jpg"
                           class="form-control" maxlength="10" required />
                </div>

                <div class="col-md-2">
                    <label class="form-label">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</label>
                    <select name="category" class="form-control">
                        <option value="ØªØµÙˆÛŒØ±">ØªØµÙˆÛŒØ±</option>
                        <option value="ÙˆÛŒØ¯ÛŒÙˆ">ÙˆÛŒØ¯ÛŒÙˆ</option>
                        <option value="ØµÙˆØª">ØµÙˆØª</option>
                        <option value="Ø³Ù†Ø¯">Ø³Ù†Ø¯</option>
                        <option value="Ø¢Ø±Ø´ÛŒÙˆ">Ø¢Ø±Ø´ÛŒÙˆ</option>
                        <option value="Ø³Ø§ÛŒØ±">Ø³Ø§ÛŒØ±</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù… (5MB Ù¾ÛŒØ´â€ŒÙØ±Ø¶)</label>
                    <input type="number" name="maxSize" value="5242880"
                           class="form-control" min="1024" step="1024" />
                </div>

                <div class="col-md-2">
                    <label class="form-label">ÙˆØ¶Ø¹ÛŒØª</label>
                    <select name="isAllowed" class="form-control">
                        <option value="true">ÙØ¹Ø§Ù„</option>
                        <option value="false">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                    </select>
                </div>

                <div class="col-md-2">
                    <label class="form-label">&nbsp;</label>
                    <button type="submit" class="btn btn-success btn-block">
                        <i class="fas fa-plus"></i> Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- File Types Table -->
    <div class="card">
        <div class="card-header bg-info text-white">
            <h5><i class="fas fa-list"></i> ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ ØªØ¹Ø±ÛŒÙâ€ŒØ´Ø¯Ù‡ (@Model.Count())</h5>
        </div>
        <div class="card-body p-0">
            @if (!Model.Any())
            {
                <div class="alert alert-warning text-center py-5">
                    <i class="fas fa-file-upload fa-3x mb-3 text-muted"></i>
                    <h4>Ù‡ÛŒÚ† Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ÛŒ ØªØ¹Ø±ÛŒÙ Ù†Ø´Ø¯Ù‡</h4>
                    <p class="mb-0">Ø§Ø² ÙØ±Ù… Ø¨Ø§Ù„Ø§ Ø§ÙˆÙ„ÛŒÙ† Ù†ÙˆØ¹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="thead-light">
                            <tr>
                                <th style="width: 120px;">Ù†ÙˆØ¹ ÙØ§ÛŒÙ„</th>
                                <th style="width: 120px;">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ</th>
                                <th style="width: 100px;">Ø­Ø¯Ø§Ú©Ø«Ø± Ø­Ø¬Ù…</th>
                                <th style="width: 100px;">ÙˆØ¶Ø¹ÛŒØª</th>
                                <th style="width: 200px;">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td>
                                        <code class="text-dark font-weight-bold">.@item.FileType</code>
                                    </td>
                                    <td>
                                        <span class="badge badge-primary text-black px-2 py-1">
                                            @item.Category
                                        </span>
                                    </td>
                                    <td class="align-middle">
                                        <small>@(item.MaxSize / 1024 / 1024) MB</small>
                                    </td>
                                    <td class="align-middle">
                                        <span class="badge @(item.IsAllowed ? "badge-success" : "badge-danger") px-2 py-1" style="color:black">
                                            @(item.IsAllowed ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")
                                        </span>
                                    </td>
                                    <td class="align-middle">
                                        <!-- Update Form - Compact -->
                                        <div class="btn-group btn-group-sm" role="group">
                                            <form asp-action="UpdateFileType" method="post" class="d-inline">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <div class="input-group input-group-sm" style="width: 300px;">
                                                    <input type="number" name="maxSize" value="@item.MaxSize"
                                                           class="form-control form-control-sm px-1" style="height: 32px; margin-left:10px" />
                                                    @{
                                                        bool isAllowed = item.IsAllowed;
                                                    }
                                                    <select name="isAllowed" class="form-control form-control-sm px-1" style="height: 32px; border-left: 0; margin-left:10px">
                                                        <option value="true" selected="@isAllowed">ÙØ¹Ø§Ù„</option>
                                                        <option value="false" selected="@(!isAllowed)">ØºÛŒØ±ÙØ¹Ø§Ù„</option>
                                                    </select>
                                                    <div class="input-group-append">
                                                        <button type="submit" class="btn btn-primary px-2" title="Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ" style="width:74px">
                                                            <i class="fas fa-save"> Ø°Ø®ÛŒØ±Ù‡</i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </form>

                                            <!-- Delete Button -->
                                            <form asp-action="DeleteFileType" method="post" class="d-inline ml-1">
                                                <input type="hidden" name="id" value="@item.Id" />
                                                <button type="submit" class="btn btn-danger"
                                                        onclick="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ .@item.FileType Ø­Ø°Ù Ø´ÙˆØ¯')"
                                                        title="Ø­Ø°Ù">
                                                    <i class="fas fa-trash">Ø­Ø°Ù</i>
                                                </button>
                                            </form>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

    <div class="mt-4">
        <a asp-action="Index" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        </a>
    </div>
</div>

@section Scripts {
    <script>
        // Auto dismiss alerts after 5 seconds
        setTimeout(function() {
            $('.alert').fadeOut('slow');
        }, 5000);
    </script>
}
 
 
==================== ForbiddenWords.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@model IEnumerable<OrganizationalMessenger.Domain.Entities.ForbiddenWord>
@{
    ViewData["Title"] = "Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-md-9">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h4>Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡</h4>
                    <form asp-action="AddForbiddenWord" method="post" class="d-inline">
                        <div class="input-group input-group-sm" style="width: 300px;">
                            <input type="text" name="newWord" class="form-control" placeholder="Ú©Ù„Ù…Ù‡ Ø¬Ø¯ÛŒØ¯..." required />
                            <div class="input-group-append">
                                <button class="btn btn-success" type="submit">Ø§ÙØ²ÙˆØ¯Ù†</button>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="card-body">
                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div class="alert alert-success">@TempData["SuccessMessage"]</div>
                    }

                    @if (Model.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Ú©Ù„Ù…Ù‡</th>
                                        <th>Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù‡</th>
                                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        int index = 1;
                                    }
                                    @foreach (var word in Model)
                                    {
                                        <tr>
                                            <th>@index</th>
                                            <td><code>@word.Word</code></td>
                                            <td>@word.CreatedAt.ToString("yyyy/MM/dd HH:mm")</td>
                                            <td>
                                                <form asp-action="DeleteForbiddenWord" method="post" style="display:inline;"
                                                      onsubmit="return confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ');">
                                                    <input type="hidden" name="id" value="@word.Id" />
                                                    <button type="submit" class="btn btn-sm btn-danger">Ø­Ø°Ù</button>
                                                </form>
                                            </td>
                                        </tr>
                                        index++;
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-5">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Ù‡ÛŒÚ† Ú©Ù„Ù…Ù‡ Ù…Ù…Ù†ÙˆØ¹Ù‡â€ŒØ§ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</h5>
                            <p class="text-muted">Ú©Ù„Ù…Ø§Øª Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ ÙØ±Ù… Ø¨Ø§Ù„Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
    <a asp-action="Index" class="btn btn-secondary mt-3">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
</div>
 
 
==================== General.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <form asp-action="General" method="post" enctype="multipart/form-data">
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-cog"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ</h4>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Ù†Ø§Ù… Ø³Ø§Ø²Ù…Ø§Ù† <span class="text-danger">*</span></label>
                            <input type="text" name="organizationName" value="@ViewBag.OrganizationName"
                                   class="form-control" required />
                        </div>

                        <div class="form-group mb-3">
                            <label>Ù„ÙˆÚ¯ÙˆÛŒ Ø³Ø§Ø²Ù…Ø§Ù†</label>
                            <input type="file" name="logoFile" class="form-control" accept="image/*" />
                            @if (!string.IsNullOrEmpty(ViewBag.LogoUrl?.ToString()))
                            {
                                <img src="@ViewBag.LogoUrl" style="max-height:80px; border:1px solid #ddd;" />
                            }
                        </div>
                    </div>

                    <div class="col-md-6">
                        <!-- âœ… CHECKBOX 1 - Ø¯Ø±Ø³Øª -->
                        <div class="form-check mb-3">
                            <input type="checkbox" id="allowGroupCreation"
                                   name="allowUserGroupCreation" value="true"
                                   class="form-check-input"
                                   @(ViewBag.AllowUserGroupCreation ? "checked" : "") />
                            <label class="form-check-label" for="allowGroupCreation">
                                Ø§Ø¬Ø§Ø²Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                            </label>
                        </div>

                        <!-- âœ… CHECKBOX 2 - Ø¯Ø±Ø³Øª -->
                        <div class="form-check mb-3">
                            <input type="checkbox" id="allowChannelCreation"
                                   name="allowUserChannelCreation" value="true"
                                   class="form-check-input"
                                   @(ViewBag.AllowUserChannelCreation ? "checked" : "") />
                            <label class="form-check-label" for="allowChannelCreation">
                                Ø§Ø¬Ø§Ø²Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                            </label>
                        </div>

                        <div class="form-group mb-3">
                            <label>Ø­Ø¯Ø§Ú©Ø«Ø± Ø§Ø¹Ø¶Ø§ÛŒ Ú¯Ø±ÙˆÙ‡</label>
                            <input type="number" name="maxGroupMembers"
                                   value="@ViewBag.MaxGroupMembers"
                                   class="form-control" min="10" max="10000" />
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg ml-2">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </div>
        </div>
    </form>
</div>
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@model IEnumerable<OrganizationalMessenger.Domain.Entities.SystemSetting>
@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid py-4">
    <div class="row">
        <!-- Sidebar Menu - Ù…Ø¯Ø±Ù† -->
        <div class="col-xl-3 col-lg-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-gradient-primary text-white border-0">
                    <h5 class="mb-0">
                        <i class="fas fa-cogs me-2"></i>Ù…Ù†ÙˆÛŒ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                    </h5>
                </div>
                <div class="list-group list-group-flush">
                    <a asp-action="General" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("General") == true ? "active" : "")">
                        <i class="fas fa-sliders-h me-3 text-primary"></i>Ø¹Ù…ÙˆÙ…ÛŒ
                    </a>
                    <a asp-action="Authentication" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("Authentication") == true ? "active" : "")">
                        <i class="fas fa-shield-alt me-3 text-success"></i>Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
                    </a>
                    <a asp-action="MessageSettings" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("MessageSettings") == true ? "active" : "")">
                        <i class="fas fa-comment-dots me-3 text-info"></i>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
                    </a>
                    <a asp-action="Sms" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("Sms") == true ? "active" : "")">
                        <i class="fas fa-sms me-3 text-warning"></i>Ù¾ÛŒØ§Ù…Ú©
                    </a>
                    <a asp-action="VoIP" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("VoIP") == true ? "active" : "")">
                        <i class="fas fa-phone me-3 text-danger"></i>VoIP
                    </a>
                    <a asp-action="Telegram" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("Telegram") == true ? "active" : "")">
                        <i class="fab fa-telegram-plane me-3 text-primary"></i>ØªÙ„Ú¯Ø±Ø§Ù…
                    </a>
                    <a asp-action="FileUpload" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("FileUpload") == true ? "active" : "")">
                        <i class="fas fa-file-upload me-3 text-success"></i>Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
                    </a>
                    <a asp-action="ForbiddenWords" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("ForbiddenWords") == true ? "active" : "")">
                        <i class="fas fa-ban me-3 text-danger"></i>Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡
                    </a>
                    <a asp-action="ServiceLinks" class="list-group-item list-group-item-action @(Context.Request.Path.Value?.Contains("ServiceLinks") == true ? "active" : "")">
                        <i class="fas fa-link me-3 text-info"></i>Ø®Ø¯Ù…Ø§Øª
                    </a>
                    <a asp-action="Export" class="list-group-item list-group-item-action list-group-item-success">
                        <i class="fas fa-download me-3"></i>Ø®Ø±ÙˆØ¬ÛŒ JSON
                    </a>
                </div>
            </div>
        </div>

        <!-- Main Content - Ù…Ø¯Ø±Ù† -->
        <div class="col-xl-9 col-lg-8">
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-cog fa-2x text-primary mb-2"></i>
                            <h3 class="text-primary">@ViewBag.TotalSettings</h3>
                            <p class="mb-0 text-muted">Ú©Ù„ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                            <h3 class="text-warning">@(((DateTime)ViewBag.LastUpdated).ToString("HH:mm"))</h3>
                            <p class="mb-0 text-muted">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm h-100">
                        <div class="card-body text-center">
                            <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                            <h3 class="text-success">@Model.Count(s => s.Value?.ToLower() == "true")</h3>
                            <p class="mb-0 text-muted">ÙØ¹Ø§Ù„</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Table - Ø´ÛŒÚ© -->
            <div class="card shadow-lg border-0">
                <div class="card-header bg-gradient-secondary text-white py-3">
                    <h4 class="mb-0">
                        <i class="fas fa-list me-2"></i>ÙˆØ¶Ø¹ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…
                    </h4>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0 align-middle">
                            <thead class="table-dark">
                                <tr>
                                    <th class="border-0 py-3">
                                        <i class="fas fa-key me-1"></i>Ú©Ù„ÛŒØ¯
                                    </th>
                                    <th class="border-0 py-3">
                                        <i class="fas fa-cube me-1"></i>Ù…Ù‚Ø¯Ø§Ø±
                                    </th>
                                    <th class="border-0 py-3">
                                        <i class="fas fa-info-circle me-1"></i>ØªÙˆØ¶ÛŒØ­
                                    </th>
                                </tr>
                            </thead>
                            <tbody class="table-group-divider">
                                @foreach (var item in Model.OrderBy(x => x.Key))
                                {
                                    <tr class="hover-row">
                                        <td class="py-3">
                                            <code class="bg-light px-2 py-1 rounded font-monospace text-dark fw-semibold">
                                                @item.Key
                                            </code>
                                        </td>
                                        <td class="py-3">
                                            @{
                                                bool isBool = item.Value?.ToLower() == "true" || item.Value?.ToLower() == "false";
                                            }
                                            @if (isBool)
                                            {
                                                <span class="badge fs-6 px-3 py-2 @(item.Value == "true" ? "bg-success" : "bg-danger")">
                                                    @if (item.Value == "true")
                                                    {
                                                        <i class="fas fa-check-circle me-1"></i>
                                                        <span>ÙØ¹Ø§Ù„</span>
                                                    }
                                                    else
                                                    {
                                                        <i class="fas fa-times-circle me-1"></i>
                                                        <span>ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                                                    }
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-light text-dark px-3 py-2">
                                                    @item.Value
                                                </span>
                                            }
                                        </td>
                                        <td class="py-3">
                                            @if (!string.IsNullOrEmpty(item.Description))
                                            {
                                                <span class="text-muted small d-inline-block" style="max-width: 300px;" title="@item.Description">
                                                    @item.Description
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="text-muted small">â€”</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .bg-gradient-primary {
        background: var(--primary-gradient) !important;
    }

    .bg-gradient-secondary {
        background: var(--secondary-gradient) !important;
    }

    .list-group-item.active {
        background-color: var(--primary-gradient);
        border-color: transparent;
    }

    .hover-row:hover {
        background-color: rgba(0,123,255,.05);
        transform: scale(1.01);
        transition: all 0.2s ease;
    }

    .table-hover tbody tr:hover {
        --bs-table-accent-bg: rgba(0,0,0,.025);
    }

    .font-monospace {
        font-family: 'Fira Code', 'SF Mono', monospace;
        font-size: 0.875rem;
    }

    .badge {
        font-weight: 500 !important;
        border-radius: 25px;
        min-width: 80px;
        text-align: center;
    }
</style>

@section Scripts {
    <script>
        // Smooth hover animations
        document.querySelectorAll('.hover-row').forEach(row => {
            row.addEventListener('mouseenter', () => {
                row.style.transform = 'translateY(-2px)';
            });
            row.addEventListener('mouseleave', () => {
                row.style.transform = 'translateY(0)';
            });
        });
    </script>
}
 
 
==================== MessageSettings.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }

            <form asp-action="MessageSettings" method="post">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Ø²Ù…Ø§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… (Ø«Ø§Ù†ÛŒÙ‡)</label>
                            <input type="number" name="messageEditTimeLimit"
                                   value="@ViewBag.MessageEditTimeLimit"
                                   class="form-control" min="0" />
                            <small class="form-text text-muted">0 = Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª</small>
                        </div>
                        <div class="form-group mb-3">
                            <label>Ø²Ù…Ø§Ù† Ø­Ø°Ù Ù¾ÛŒØ§Ù… (Ø«Ø§Ù†ÛŒÙ‡)</label>
                            <input type="number" name="messageDeleteTimeLimit"
                                   value="@ViewBag.MessageDeleteTimeLimit"
                                   class="form-control" min="0" />
                            <small class="form-text text-muted">0 = Ø¨Ø¯ÙˆÙ† Ù…Ø­Ø¯ÙˆØ¯ÛŒØª</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <!-- âœ… Checkbox 1 + Hidden -->
                        <div class="form-check mb-3">
                            <input type="checkbox" name="allowMessageEdit" value="true"
                                   class="form-check-input" id="allowEdit"
                                   @(ViewBag.AllowMessageEdit == true ? "checked" : "") />
                            <label class="form-check-label" for="allowEdit">Ø§Ø¬Ø§Ø²Ù‡ ÙˆÛŒØ±Ø§ÛŒØ´ Ù¾ÛŒØ§Ù…</label>
                        </div>
                        <input type="hidden" name="allowMessageEdit" value="false" />

                        <!-- âœ… Checkbox 2 + Hidden -->
                        <div class="form-check mb-3">
                            <input type="checkbox" name="allowMessageDelete" value="true"
                                   class="form-check-input" id="allowDelete"
                                   @(ViewBag.AllowMessageDelete == true ? "checked" : "") />
                            <label class="form-check-label" for="allowDelete">Ø§Ø¬Ø§Ø²Ù‡ Ø­Ø°Ù Ù¾ÛŒØ§Ù…</label>
                        </div>
                        <input type="hidden" name="allowMessageDelete" value="false" />
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">Ø°Ø®ÛŒØ±Ù‡</button>
                <a asp-action="Index" class="btn btn-secondary ml-2">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== ServiceLinks.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@model IEnumerable<OrganizationalMessenger.Domain.Entities.ServiceLink>
@{
    ViewData["Title"] = "Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø®Ø¯Ù…Ø§Øª";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h4><i class="fas fa-link"></i> Ù„ÛŒÙ†Ú©â€ŒÙ‡Ø§ÛŒ Ø®Ø¯Ù…Ø§Øª (@Model.Count())</h4>

            <!-- âœ… FORM Ú©Ø§Ù…Ù„ - Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯! -->
            <form asp-action="AddServiceLink" method="post" class="input-group input-group-sm" style="max-width: 500px;">
                <input type="text" name="title" class="form-control" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø®Ø¯Ù…Øª" required />
                <input type="url" name="url" class="form-control" placeholder="https://erp.company.com" required />
                <input type="text" name="iconUrl" class="form-control" placeholder="fas fa-external-link" />
                <button type="submit" class="btn btn-success">
                    <i class="fas fa-plus"></i> Ø§ÙØ²ÙˆØ¯Ù†
                </button>
            </form>
        </div>

        <div class="card-body">
            @if (!Model.Any())
            {
                <div class="text-center py-5">
                    <i class="fas fa-link fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">Ù‡ÛŒÚ† Ù„ÛŒÙ†Ú©ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</h5>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="thead-light">
                            <tr>
                                <th style="width: 50px;">#</th>
                                <th>Ø¹Ù†ÙˆØ§Ù†</th>
                                <th style="width: 200px;">Ø¢Ø¯Ø±Ø³</th>
                                <th style="width: 120px;">Ø¢ÛŒÚ©ÙˆÙ†</th>
                                <th style="width: 100px;">Ø¹Ù…Ù„ÛŒØ§Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int index = 1;
                            }
                            @foreach (var link in Model.OrderBy(l => l.DisplayOrder))
                            {
                                <tr>
                                    <td>@index</td>
                                    <td><strong>@link.Title</strong></td>
                                    <td>
                                        <a href="@link.Url" target="_blank" class="text-truncate d-inline-block"
                                           style="max-width: 200px;" title="@link.Url">
                                            @link.Url
                                        </a>
                                    </td>
                                    <td><code>@link.IconUrl</code></td>
                                    <td>
                                        <form asp-action="DeleteServiceLink" method="post" class="d-inline">
                                            <input type="hidden" name="id" value="@link.Id" />
                                            <button type="submit" class="btn btn-sm btn-danger"
                                                    onclick="return confirm('Ø­Ø°Ù Ø´ÙˆØ¯ØŸ @link.Title')">
                                                <i class="fas fa-trash">Ø­Ø°Ù</i>
                                            </button>
                                        </form>
                                    </td>
                                </tr>
                                index++;
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>

    <a asp-action="Index" class="btn btn-secondary mt-3">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
</div>
 
 
==================== Sms.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª SMS (TopTip)";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";

    var balanceResult = ViewBag.BalanceResult;
    bool balanceSuccess = balanceResult != null && (balanceResult as dynamic).Success == true;
    decimal balance = balanceSuccess ? (decimal)(balanceResult as dynamic).Balance : 0;
    string balanceMessage = balanceSuccess ? "Ù…ÙˆÙÙ‚" : ((balanceResult as dynamic)?.Message ?? "Ù†Ø§Ù…Ø´Ø®Øµ");
}

<div class="container-fluid">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success">@TempData["Success"]</div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger">@TempData["Error"]</div>
    }

    <div class="row">
        <!-- Main Settings -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fas fa-sms"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª TopTip SMS</h4>
                </div>
                <div class="card-body">
                    <form asp-action="Sms" method="post">
                        <!-- SMS Toggle -->
                        <div class="form-check mb-4">
                            <input type="checkbox" name="smsEnabled" value="true"
                                   class="form-check-input" id="smsEnabled"
                                   @(ViewBag.SmsEnabled == true ? "checked" : "") />
                            <input type="hidden" name="smsEnabled" value="false" />
                            <label class="form-check-label" for="smsEnabled">
                                <h5>ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ SMS</h5>
                            </label>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <!-- API Key -->
                                <div class="form-group mb-3">
                                    <label>API Key <span class="text-danger">*</span></label>
                                    <input type="text" name="smsApiKey" value="@ViewBag.SmsApiKey"
                                           class="form-control" required />
                                    <small>Ø§Ø² Ù¾Ù†Ù„ TopTip Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯</small>
                                </div>

                                <!-- Sender Number -->
                                <div class="form-group mb-3">
                                    <label>Ø´Ù…Ø§Ø±Ù‡ Ø§Ø±Ø³Ø§Ù„ <span class="text-danger">*</span></label>
                                    <input type="text" name="smsSenderNumber" value="@ViewBag.SmsSenderNumber"
                                           class="form-control" placeholder="3000505" required />
                                </div>
                            </div>

                            <div class="col-md-6">
                                <!-- Username -->
                                <div class="form-group mb-3">
                                    <label>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù¾Ù†Ù„ <span class="text-danger">*</span></label>
                                    <input type="text" name="smsUsername" value="@ViewBag.SmsUsername"
                                           class="form-control" required />
                                </div>

                                <!-- Password -->
                                <div class="form-group mb-3">
                                    <label>Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù¾Ù†Ù„ <span class="text-danger">*</span></label>
                                    <input type="password" name="smsPassword" value="@ViewBag.SmsPassword"
                                           class="form-control" required />
                                </div>
                            </div>
                        </div>

                        <!-- OTP Settings -->
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ø·ÙˆÙ„ OTP</label>
                                    <input type="number" name="otpLength" value="@ViewBag.OtpLength"
                                           class="form-control" min="4" max="8" />
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label>Ø§Ù†Ù‚Ø¶Ø§ÛŒ OTP (Ø¯Ù‚ÛŒÙ‚Ù‡)</label>
                                    <input type="number" name="otpExpiryMinutes" value="@ViewBag.OtpExpiryMinutes"
                                           class="form-control" min="1" max="30" />
                                </div>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg mt-3">
                            <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª TopTip
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Balance Display -->
        <div class="col-md-4">
            <div class="card sticky-top" style="top: 20px; z-index:1!important">
                <div class="card-header bg-success text-white">
                    <h6><i class="fas fa-wallet"></i> Ù…ÙˆØ¬ÙˆØ¯ÛŒ TopTip</h6>
                </div>
                <div class="card-body text-center">
                    @if (balanceSuccess)
                    {
                        <div class="mb-3">
                            <i class="fas fa-check-circle fa-3x text-success mb-2"></i>
                            <h3 class="text-success">@balance.ToString("N0") Ø±ÛŒØ§Ù„</h3>
                            <small class="text-success">Ø§ØªØµØ§Ù„ Ù…ÙˆÙÙ‚</small>
                        </div>
                    }
                    else
                    {
                        <div class="mb-3">
                            <i class="fas fa-exclamation-triangle fa-3x text-warning mb-2"></i>
                            <h5 class="text-warning">@balanceMessage</h5>
                            <small class="text-muted">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ/Ø±Ù…Ø² Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯</small>
                        </div>
                    }

                    <hr />
                    <small class="text-muted">
                        <strong>Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ:</strong> @DateTime.Now.ToString("HH:mm:ss")
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Documentation -->
    <div class="card mt-4">
        <div class="card-header bg-info text-white">
            <h6>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ TopTip</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6>Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª:</h6>
                    <ul class="small">
                        <li><a href="https://toptip.ir" target="_blank">toptip.ir</a> â†’ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</li>
                        <li>Ù¾Ù†Ù„ â†’ Ø´Ø§Ø±Ú˜ Ø­Ø³Ø§Ø¨</li>
                        <li>ØªÙ†Ø¸ÛŒÙ…Ø§Øª â†’ API Key / Username / Password</li>
                        <li>Ø®Ø¯Ù…Ø§Øª â†’ Ø´Ù…Ø§Ø±Ù‡ Ø§Ø±Ø³Ø§Ù„ (3000505 Ùˆ...)</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>API Ø§Ø±Ø³Ø§Ù„:</h6>
                    <pre class="small bg-light p-2 rounded">
http://toptip.ir/webservice/rest/sms_send
?note_arr[]=Ø³Ù„Ø§Ù…
&api_key=YOUR_API_KEY
&receiver_number=09123456789
&sender_number=3000505
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>
 
 
==================== Telegram.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4><i class="fab fa-telegram-plane"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }

            <form asp-action="Telegram" method="post">
                <!-- âœ… Checkbox + Hidden -->
                <div class="form-check mb-3">
                    <input type="checkbox" name="telegramEnabled" value="true"
                           class="form-check-input" id="telegramEnabled"
                           @(ViewBag.TelegramEnabled == true ? "checked" : "") />
                    <label class="form-check-label" for="telegramEnabled">
                        ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…
                    </label>
                </div>
                <input type="hidden" name="telegramEnabled" value="false" />
                
                <!-- âœ… Bot Token Ø¨Ø§ Ù…Ù‚Ø¯Ø§Ø± Ù‚Ø¨Ù„ÛŒ -->
                <div class="form-group mb-3">
                    <label>Bot Token <span class="text-muted">(Ø§Ø² BotFather ØªÙ„Ú¯Ø±Ø§Ù…)</span></label>
                    <input type="text" name="botToken" 
                           value="@ViewBag.BotToken"
                           class="form-control" 
                           placeholder="123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11" />
                    <small class="form-text text-muted">
                        1. Ø¯Ø± ØªÙ„Ú¯Ø±Ø§Ù… BotFather Ø±Ø§ Ù¾ÛŒØ¯Ø§ Ú©Ù†ÛŒØ¯<br/>
                        2. /newbot â†’ Ù†Ø§Ù… Ø±Ø¨Ø§Øª â†’ username_bot<br/>
                        3. ØªÙˆÚ©Ù† Ø±Ø§ Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯ (Ù…Ø«Ø§Ù„: 123456:ABC-DEF...)
                    </small>
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg ml-2">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== VoIP.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Settings\ 
 
ï»¿@{
    ViewData["Title"] = "ØªÙ†Ø¸ÛŒÙ…Ø§Øª VoIP";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="card">
        <div class="card-header">
            <h4><i class="fas fa-phone"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª VoIP</h4>
        </div>
        <div class="card-body">
            @if (TempData["Success"] != null)
            {
                <div class="alert alert-success">@TempData["Success"]</div>
            }
            @if (TempData["Error"] != null)
            {
                <div class="alert alert-danger">@TempData["Error"]</div>
            }

            <form asp-action="VoIP" method="post">
                <!-- âœ… Checkbox + Hidden Field -->
                <div class="form-check mb-4">
                    <input type="checkbox" name="voipEnabled" value="true"
                           class="form-check-input" id="voipEnabled"
                           @(ViewBag.VoipEnabled == true ? "checked" : "") />
                    <label class="form-check-label" for="voipEnabled">
                        <h5>ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ ØªÙ…Ø§Ø³â€ŒÙ‡Ø§ÛŒ VoIP</h5>
                    </label>
                </div>
                <!-- âœ… Hidden Field -->
                <input type="hidden" name="voipEnabled" value="false" />

                <div class="alert alert-info">
                    <strong>ØªÙˆØ¬Ù‡:</strong> Ø¨Ø§ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ VoIPØŒ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ Ùˆ ØªØµÙˆÛŒØ±ÛŒ Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†Ù†Ø¯.
                </div>

                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                </button>
                <a asp-action="Index" class="btn btn-secondary btn-lg ml-2">Ø¨Ø§Ø²Ú¯Ø´Øª</a>
            </form>
        </div>
    </div>
</div>
 
 
==================== Create.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
ï»¿@model OrganizationalMessenger.Web.Areas.Admin.Models.UserCreateViewModel
@{
    ViewData["Title"] = "Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mb-3">
    <div class="col-md-12">
        <h2>
            <i class="bi bi-person-plus"></i> Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
        </h2>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form asp-action="Edit" method="post" enctype="multipart/form-data">

                    @Html.AntiForgeryToken()

                    <div class="row">
                        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡ -->
                        <div class="col-md-12 mb-3">
                            <h5 class="border-bottom pb-2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Username" class="form-label"></label>
                            <input asp-for="Username" class="form-control" />
                            <span asp-validation-for="Username" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="PhoneNumber" class="form-label"></label>
                            <input asp-for="PhoneNumber" class="form-control" placeholder="09123456789" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="FirstName" class="form-label"></label>
                            <input asp-for="FirstName" class="form-control" />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="LastName" class="form-label"></label>
                            <input asp-for="LastName" class="form-control" />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 mb-3 mt-2">
                            <h5 class="border-bottom pb-2">Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</h5>
                        </div>

                        <div class="col-md-4 mb-3 text-center">
                            <div class="mb-2">
                                @if (!string.IsNullOrEmpty(Model.AvatarUrl))
                                {
                                    <img src="@Model.AvatarUrl" alt="Avatar" class="rounded-circle border"
                                         style="width:100px;height:100px;object-fit:cover;" />
                                }
                                else
                                {
                                    <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center"
                                         style="width:100px;height:100px;font-size:32px;">
                                        @((Model.FirstName?.FirstOrDefault().ToString() ?? "ØŸ") +
                                                                            (Model.LastName?.FirstOrDefault().ToString() ?? ""))
                                </div>
                                                                }
                            </div>

                            <div class="mt-2">
                                <label class="form-label">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯</label>
                                <input asp-for="AvatarFile" type="file" class="form-control" accept="image/*" />
                                <span asp-validation-for="AvatarFile" class="text-danger"></span>
                                <small class="text-muted d-block mt-1">ÙØ±Ù…Øª Ù…Ø¬Ø§Ø²: jpg, pngØŒ Ø­Ø¯Ø§Ú©Ø«Ø± Û² Ù…Ú¯Ø§Ø¨Ø§ÛŒØª</small>
                            </div>
                        </div>

                        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ActiveDirectoryId" class="form-label"></label>
                            <input asp-for="ActiveDirectoryId" class="form-control" />
                            <span asp-validation-for="ActiveDirectoryId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ErpUserId" class="form-label"></label>
                            <input asp-for="ErpUserId" class="form-control" />
                            <span asp-validation-for="ErpUserId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="SmsCredit" class="form-label"></label>
                            <input asp-for="SmsCredit" type="number" class="form-control" />
                            <span asp-validation-for="SmsCredit" class="text-danger"></span>
                        </div>

                        <!-- Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ùˆ Ù…Ø¬ÙˆØ²Ù‡Ø§</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                <label asp-for="IsActive" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateGroup" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateGroup" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateChannel" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateChannel" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVoiceCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVoiceCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVideoCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVideoCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
                        <div class="col-md-12 mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Ø°Ø®ÛŒØ±Ù‡
                            </button>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Ø§Ù†ØµØ±Ø§Ù
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Ø±Ø§Ù‡Ù†Ù…Ø§</h5>
            </div>
            <div class="card-body">
                <h6>Ù†Ú©Ø§Øª Ù…Ù‡Ù…:</h6>
                <ul class="small">
                    <li>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ø§ÛŒØ¯ ÛŒÚ©ØªØ§ Ø¨Ø§Ø´Ø¯</li>
                    <li>Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù¾ÛŒØ§Ù…Ú©ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯</li>
                    <li>Ø´Ù†Ø§Ø³Ù‡ AD Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Active Directory</li>
                    <li>Ø´Ù†Ø§Ø³Ù‡ ERP Ø¨Ø±Ø§ÛŒ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø³ÛŒØ³ØªÙ… ERP</li>
                    <li>Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú© Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±</li>
                </ul>

                <h6 class="mt-3">Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§:</h6>
                <ul class="small">
                    <li><strong>Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡:</strong> Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ø¯</li>
                    <li><strong>Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„:</strong> Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ø¯</li>
                    <li><strong>ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ:</strong> Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†Ø¯</li>
                    <li><strong>ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ:</strong> Ú©Ø§Ø±Ø¨Ø± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ Ø¨Ø±Ù‚Ø±Ø§Ø± Ú©Ù†Ø¯</li>
                </ul>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
 
 
==================== Details.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
ï»¿@{
    ViewData["Title"] = "Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    // Helper Ø¨Ø±Ø§ÛŒ ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ
    string ToPersianDate(DateTime? date)
    {
        if (date == null) return "---";
        var persianCalendar = new System.Globalization.PersianCalendar();
        return $"{persianCalendar.GetYear(date.Value)}/{persianCalendar.GetMonth(date.Value):00}/{persianCalendar.GetDayOfMonth(date.Value):00}";
    }

    string ToPersianDateTime(DateTime? date)
    {
        if (date == null) return "---";
        var persianCalendar = new System.Globalization.PersianCalendar();
        return $"{persianCalendar.GetYear(date.Value)}/{persianCalendar.GetMonth(date.Value):00}/{persianCalendar.GetDayOfMonth(date.Value):00} {date.Value:HH:mm}";
    }
}

<div class="page-header">
    <h2>Ø¬Ø²Ø¦ÛŒØ§Øª Ú©Ø§Ø±Ø¨Ø±</h2>
    <div class="actions">
        <a href="@Url.Action("Edit", new { id = Model.Id })" class="btn btn-primary">ÙˆÛŒØ±Ø§ÛŒØ´</a>
        <a href="@Url.Action("Index")" class="btn btn-secondary">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</a>
    </div>
</div>

<div class="details-container">
    <div class="detail-card">
        <h3>Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡</h3>
        <div class="detail-row">
            <span class="label">Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ:</span>
            <span class="value">@Model.Username</span>
        </div>
        <div class="detail-row">
            <span class="label">Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ:</span>
            <span class="value">@Model.FirstName @Model.LastName</span>
        </div>
        <div class="detail-row">
            <span class="label">Ø§ÛŒÙ…ÛŒÙ„:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.Email) ? "---" : Model.Email)</span>
        </div>
        <div class="detail-row">
            <span class="label">Ø´Ù…Ø§Ø±Ù‡ ØªÙ„ÙÙ†:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.PhoneNumber) ? "---" : Model.PhoneNumber)</span>
        </div>
        <div class="detail-row">
            <span class="label">ÙˆØ¶Ø¹ÛŒØª:</span>
            <span class="badge @(Model.IsActive ? "badge-active" : "badge-inactive")">
                @(Model.IsActive ? "ÙØ¹Ø§Ù„" : "ØºÛŒØ±ÙØ¹Ø§Ù„")
            </span>
        </div>
    </div>

    <div class="detail-card">
        <h3>Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h3>
        <div class="detail-row">
            <span class="label">Active Directory ID:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.ActiveDirectoryId) ? "---" : Model.ActiveDirectoryId)</span>
        </div>
        <div class="detail-row">
            <span class="label">ERP User ID:</span>
            <span class="value">@(string.IsNullOrEmpty(Model.ErpUserId) ? "---" : Model.ErpUserId)</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>Ø§Ø¹ØªØ¨Ø§Ø±Ø§Øª Ùˆ Ù…Ø¬ÙˆØ²Ù‡Ø§</h3>
        <div class="detail-row">
            <span class="label">Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú©:</span>
            <span class="value">@Model.SmsCredit</span>
        </div>
        <div class="detail-row">
            <span class="label">Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡:</span>
            <span class="badge @(Model.CanCreateGroup ? "badge-active" : "badge-inactive")">
                @(Model.CanCreateGroup ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">Ù…Ø¬ÙˆØ² Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„:</span>
            <span class="badge @(Model.CanCreateChannel ? "badge-active" : "badge-inactive")">
                @(Model.CanCreateChannel ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">Ù…Ø¬ÙˆØ² ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ:</span>
            <span class="badge @(Model.CanMakeVoiceCall ? "badge-active" : "badge-inactive")">
                @(Model.CanMakeVoiceCall ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯")
            </span>
        </div>
        <div class="detail-row">
            <span class="label">Ù…Ø¬ÙˆØ² ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ:</span>
            <span class="badge @(Model.CanMakeVideoCall ? "badge-active" : "badge-inactive")">
                @(Model.CanMakeVideoCall ? "Ø¯Ø§Ø±Ø¯" : "Ù†Ø¯Ø§Ø±Ø¯")
            </span>
        </div>
    </div>

    <div class="detail-card">
        <h3>ÙØ¹Ø§Ù„ÛŒØªâ€ŒÙ‡Ø§</h3>
        <div class="detail-row">
            <span class="label">ØªØ§Ø±ÛŒØ® Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…:</span>
            <span class="value">@ToPersianDateTime(Model.CreatedAt)</span>
        </div>
        <div class="detail-row">
            <span class="label">Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø²Ø¯ÛŒØ¯:</span>
            <span class="value">@ToPersianDateTime(Model.LastSeenAt)</span>
        </div>
        <div class="detail-row">
            <span class="label">ØªØ¹Ø¯Ø§Ø¯ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø§Ø±Ø³Ø§Ù„ÛŒ:</span>
            <span class="value">@ViewBag.MessageCount</span>
        </div>
        <div class="detail-row">
            <span class="label">ØªØ¹Ø¯Ø§Ø¯ ØªÙ…Ø§Ø³â€ŒÙ‡Ø§:</span>
            <span class="value">@ViewBag.CallCount</span>
        </div>
    </div>

    <div class="detail-card">
        <h3>Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§ÛŒ Ø¹Ø¶Ùˆ (@Model.UserGroups.Count)</h3>
        @if (Model.UserGroups.Any())
        {
            <ul class="list-items">
                @foreach (var ug in Model.UserGroups)
                {
                    <li>
                        @ug.Group.Name
                        @if (ug.IsAdmin)
                        {
                            <span class="badge badge-admin">Ù…Ø¯ÛŒØ±</span>
                        }
                        <span class="date">Ø¹Ø¶ÙˆÛŒØª: @ToPersianDate(ug.JoinedAt)</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="no-data">Ø¹Ø¶Ùˆ Ù‡ÛŒÚ† Ú¯Ø±ÙˆÙ‡ÛŒ Ù†ÛŒØ³Øª</p>
        }
    </div>

    <div class="detail-card">
        <h3>Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§ÛŒ Ø¹Ø¶Ùˆ (@Model.UserChannels.Count)</h3>
        @if (Model.UserChannels.Any())
        {
            <ul class="list-items">
                @foreach (var uc in Model.UserChannels)
                {
                    <li>
                        @uc.Channel.Name
                        @if (uc.IsAdmin)
                        {
                            <span class="badge badge-admin">Ù…Ø¯ÛŒØ±</span>
                        }
                        <span class="date">Ø¹Ø¶ÙˆÛŒØª: @ToPersianDate(uc.JoinedAt)</span>
                    </li>
                }
            </ul>
        }
        else
        {
            <p class="no-data">Ø¹Ø¶Ùˆ Ù‡ÛŒÚ† Ú©Ø§Ù†Ø§Ù„ÛŒ Ù†ÛŒØ³Øª</p>
        }
    </div>
</div>
 
 
==================== Edit.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
ï»¿@model OrganizationalMessenger.Web.Areas.Admin.Models.UserEditViewModel
@{
    ViewData["Title"] = "ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mb-3">
    <div class="col-md-12">
        <h2>
            <i class="bi bi-pencil-square"></i> ÙˆÛŒØ±Ø§ÛŒØ´ Ú©Ø§Ø±Ø¨Ø±
        </h2>
    </div>
</div>

<div class="row">
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <form asp-action="Edit" method="post" enctype="multipart/form-data">

                    @Html.AntiForgeryToken()
                    <input type="hidden" asp-for="Id" />

                    <div class="row">
                        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡ -->
                        <div class="col-md-12 mb-3">
                            <h5 class="border-bottom pb-2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø§ÛŒÙ‡</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="Username" class="form-label"></label>
                            <input asp-for="Username" class="form-control" />
                            <span asp-validation-for="Username" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="PhoneNumber" class="form-label"></label>
                            <input asp-for="PhoneNumber" class="form-control" placeholder="09123456789" />
                            <span asp-validation-for="PhoneNumber" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="FirstName" class="form-label"></label>
                            <input asp-for="FirstName" class="form-control" />
                            <span asp-validation-for="FirstName" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="LastName" class="form-label"></label>
                            <input asp-for="LastName" class="form-control" />
                            <span asp-validation-for="LastName" class="text-danger"></span>
                        </div>

                        <div class="col-md-12 mb-3">
                            <label asp-for="Email" class="form-label"></label>
                            <input asp-for="Email" class="form-control" />
                            <span asp-validation-for="Email" class="text-danger"></span>
                        </div>
                        <div class="col-md-12 mb-3 mt-2">
                            <h5 class="border-bottom pb-2">Ø¹Ú©Ø³ Ù¾Ø±ÙˆÙØ§ÛŒÙ„</h5>
                        </div>

                        <div class="col-md-4 mb-3 text-center">
                            <div class="mb-2">
                                @if (!string.IsNullOrEmpty(Model.AvatarUrl))
                                {
                                    <img src="@Model.AvatarUrl" alt="Avatar" class="rounded-circle border"
                                         style="width:100px;height:100px;object-fit:cover;" />
                                }
                                else
                                {
                                    <div class="rounded-circle bg-secondary text-white d-flex align-items-center justify-content-center"
                                         style="width:100px;height:100px;font-size:32px;">
                                        @((Model.FirstName?.FirstOrDefault().ToString() ?? "ØŸ") +
                                                                            (Model.LastName?.FirstOrDefault().ToString() ?? ""))
                                </div>
                                                                }
                            </div>

                            <div class="mt-2">
                                <label class="form-label">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³ Ø¬Ø¯ÛŒØ¯</label>
                                <input asp-for="AvatarFile" type="file" class="form-control" accept="image/*" />
                                <span asp-validation-for="AvatarFile" class="text-danger"></span>
                                <small class="text-muted d-block mt-1">ÙØ±Ù…Øª Ù…Ø¬Ø§Ø²: jpg, pngØŒ Ø­Ø¯Ø§Ú©Ø«Ø± Û² Ù…Ú¯Ø§Ø¨Ø§ÛŒØª</small>
                            </div>
                        </div>

                        <!-- Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ActiveDirectoryId" class="form-label"></label>
                            <input asp-for="ActiveDirectoryId" class="form-control" />
                            <span asp-validation-for="ActiveDirectoryId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="ErpUserId" class="form-label"></label>
                            <input asp-for="ErpUserId" class="form-control" />
                            <span asp-validation-for="ErpUserId" class="text-danger"></span>
                        </div>

                        <div class="col-md-6 mb-3">
                            <label asp-for="SmsCredit" class="form-label"></label>
                            <input asp-for="SmsCredit" type="number" class="form-control" />
                            <span asp-validation-for="SmsCredit" class="text-danger"></span>
                        </div>

                        <!-- Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ -->
                        <div class="col-md-12 mb-3 mt-3">
                            <h5 class="border-bottom pb-2">Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ Ùˆ Ù…Ø¬ÙˆØ²Ù‡Ø§</h5>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="IsActive" class="form-check-input" type="checkbox" />
                                <label asp-for="IsActive" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateGroup" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateGroup" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanCreateChannel" class="form-check-input" type="checkbox" />
                                <label asp-for="CanCreateChannel" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVoiceCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVoiceCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input asp-for="CanMakeVideoCall" class="form-check-input" type="checkbox" />
                                <label asp-for="CanMakeVideoCall" class="form-check-label"></label>
                            </div>
                        </div>

                        <!-- Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ -->
                        <div class="col-md-12 mt-3">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-save"></i> Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª
                            </button>
                            <a asp-action="Details" asp-route-id="@Model.Id" class="btn btn-info">
                                <i class="bi bi-eye"></i> Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª
                            </a>
                            <a asp-action="Index" class="btn btn-secondary">
                                <i class="bi bi-x-circle"></i> Ø§Ù†ØµØ±Ø§Ù
                            </a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Ø±Ø§Ù‡Ù†Ù…Ø§ -->
    <div class="col-md-4">
        <div class="card bg-light">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-info-circle"></i> Ø±Ø§Ù‡Ù†Ù…Ø§</h5>
            </div>
            <div class="card-body">
                <h6>Ù†Ú©Ø§Øª ÙˆÛŒØ±Ø§ÛŒØ´:</h6>
                <ul class="small">
                    <li>ØªØºÛŒÛŒØ± Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø± Ø±ÙˆÛŒ Ø³Ø§ÛŒØ± Ø¨Ø®Ø´â€ŒÙ‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ… ØªØ£Ø«ÛŒØ± Ø¨Ú¯Ø°Ø§Ø±Ø¯</li>
                    <li>Ø¯Ø± ØµÙˆØ±Øª ØªØºÛŒÛŒØ± Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ØŒ Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø´ÙˆØ¯</li>
                    <li>ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¯Ø³ØªØ±Ø³ÛŒ Ø§Ùˆ Ø±Ø§ Ø¨Ù‡ Ø³ÛŒØ³ØªÙ… Ù‚Ø·Ø¹ Ù…ÛŒâ€ŒÚ©Ù†Ø¯</li>
                </ul>

                <h6 class="mt-3">Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§:</h6>
                <div class="alert alert-warning small p-2">
                    <i class="bi bi-exclamation-triangle"></i>
                    Ø­Ø°Ù Ø¯Ø³ØªØ±Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø§Ø¹Ø« Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø³ÛŒØ³ØªÙ… Ø´ÙˆØ¯.
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}
 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Areas\Admin\Views\Users\ 
 
ï»¿@model OrganizationalMessenger.Web.Areas.Admin.Models.UserListViewModel
@{
    ViewData["Title"] = "Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="row mb-3">
    <div class="col-md-6">
        <h2>
            <i class="bi bi-people"></i> Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
        </h2>
    </div>
    <div class="col-md-6 text-end">
        <a asp-action="Create" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
        </a>
    </div>
</div>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show">
        @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show">
        @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<!-- ÙØ±Ù… Ø¬Ø³ØªØ¬Ùˆ -->
<div class="card mb-3">
    <div class="card-body">
        <form method="get" asp-action="Index">
            <div class="row g-2">
                <div class="col-md-10">
                    <input type="text" name="search" value="@Model.SearchTerm"
                           class="form-control" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†Ø§Ù…ØŒ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒØŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„...">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> Ø¬Ø³ØªØ¬Ùˆ
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† -->
<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Ø±Ø¯ÛŒÙ</th>
                        <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
                        <th>Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ</th>
                        <th>Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„</th>
                        <th>ÙˆØ¶Ø¹ÛŒØª</th>
                        <th>ØªØ§Ø±ÛŒØ® Ø«Ø¨Øª</th>
                        <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model.Users.Any())
                    {
                        int rowNum = (Model.CurrentPage - 1) * Model.PageSize + 1;
                        foreach (var user in Model.Users)
                        {
                            <tr>
                                <td>@rowNum</td>
                                <td>@user.Username</td>
                                <td>@user.FirstName @user.LastName</td>
                                <td>@(string.IsNullOrEmpty(user.PhoneNumber) ? "---" : user.PhoneNumber)</td>
                                <td>
                                    @if (user.IsActive)
                                    {
                                        <span class="badge bg-success">ÙØ¹Ø§Ù„</span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-danger">ØºÛŒØ±ÙØ¹Ø§Ù„</span>
                                    }
                                </td>
                                <td>@user.CreatedAt.ToString("yyyy/MM/dd")</td>
                                <td>
                                   
                                    <a asp-action="Edit" asp-route-id="@user.Id"
                                       class="btn btn-sm btn-warning btn-action" title="ÙˆÛŒØ±Ø§ÛŒØ´">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <button type="button" class="btn btn-sm btn-danger btn-action"
                                            onclick="confirmDelete(@user.Id, '@user.FirstName @user.LastName')" title="Ø­Ø°Ù">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                    <button type="button" class="btn btn-sm btn-secondary btn-action"
                                            onclick="toggleStatus(@user.Id)" title="ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª">
                                        <i class="bi bi-toggle-on"></i>
                                    </button>
                                </td>
                            </tr>
                            rowNum++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7" class="text-center">Ú©Ø§Ø±Ø¨Ø±ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- ØµÙØ­Ù‡â€ŒØ¨Ù†Ø¯ÛŒ -->
        @if (Model.TotalPages > 1)
        {
            <nav>
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link" asp-action="Index"
                           asp-route-page="@(Model.CurrentPage - 1)"
                           asp-route-search="@Model.SearchTerm">Ù‚Ø¨Ù„ÛŒ</a>
                    </li>

                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a class="page-link" asp-action="Index"
                               asp-route-page="@i"
                               asp-route-search="@Model.SearchTerm">@i</a>
                        </li>
                    }

                    <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                        <a class="page-link" asp-action="Index"
                           asp-route-page="@(Model.CurrentPage + 1)"
                           asp-route-search="@Model.SearchTerm">Ø¨Ø¹Ø¯ÛŒ</a>
                    </li>
                </ul>
            </nav>

            <p class="text-center text-muted">
                Ù†Ù…Ø§ÛŒØ´ @((Model.CurrentPage - 1) * Model.PageSize + 1) ØªØ§
                @(Math.Min(Model.CurrentPage * Model.PageSize, Model.TotalCount)) Ø§Ø²
                @Model.TotalCount Ú©Ø§Ø±Ø¨Ø±
            </p>
        }
    </div>
</div>

<!-- ÙØ±Ù… Ø­Ø°Ù (Ù…Ø®ÙÛŒ) -->
<form id="deleteForm" method="post" asp-action="Delete">
    @Html.AntiForgeryToken()
    <input type="hidden" name="id" id="deleteId" />
</form>

@section Scripts {
    <script>
        function confirmDelete(id, name) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ú©Ø§Ø±Ø¨Ø± "' + name + '" Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                document.getElementById('deleteId').value = id;
                document.getElementById('deleteForm').submit();
            }
        }

        function toggleStatus(id) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø§ÛŒÙ† Ú©Ø§Ø±Ø¨Ø± Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                $.ajax({
                    url: '@Url.Action("ToggleStatus")',
                    type: 'POST',
                    data: {
                        id: id,
                        __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val()
                    },
                    success: function(response) {
                        if (response.success) {
                            location.reload();
                        }
                    }
                });
            }
        }
    </script>
}
 
 
==================== _ViewImports.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\ 
 
ï»¿@using OrganizationalMessenger.Web
@using OrganizationalMessenger.Web.Models
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
 
 
==================== _ViewStart.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\ 
 
ï»¿@{
    Layout = "_Layout";
}
 
 
==================== chat.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Account\ 
 
ï»¿@{
    ViewData["Title"] = "Ú†Øª";
}

<div class="chat-container">
    <!-- Sidebar -->
    <aside class="chat-sidebar">
        <!-- Header -->
        <div class="sidebar-header">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." id="searchInput" />
            </div>
            <div class="header-icons">
                <button class="icon-btn" title="ØªÙ…Ø§Ø³ Ø¬Ø¯ÛŒØ¯">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="icon-btn" title="Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯">
                    <i class="fas fa-users"></i>
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="sidebar-tabs">
            <button class="tab-btn active" data-tab="all">Ù‡Ù…Ù‡</button>
            <button class="tab-btn" data-tab="private">Ø®ØµÙˆØµÛŒ</button>
            <button class="tab-btn" data-tab="groups">Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</button>
            <button class="tab-btn" data-tab="channels">Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</button>
        </div>

        <!-- Conversations List -->
        <div class="conversations-list" id="conversationsList">
            <!-- Loaded via JavaScript -->
        </div>
    </aside>

    <!-- Main Chat Area -->
    <main class="chat-main">
        <!-- Chat Header -->
        <div class="chat-header" id="chatHeader">
            <div class="header-left">
                <button class="back-btn" id="backBtn">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <div class="chat-info">
                    <h2 id="chatTitle">Ø§Ù†ØªØ®Ø§Ø¨ Ú¯ÙØªÚ¯Ùˆ</h2>
                    <p id="chatStatus">Ø¢Ù†Ù„Ø§ÛŒÙ†</p>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" title="ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ" id="voiceCallBtn">
                    <i class="fas fa-phone"></i>
                </button>
                <button class="icon-btn" title="ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ" id="videoCallBtn">
                    <i class="fas fa-video"></i>
                </button>
                <button class="icon-btn" id="moreBtn">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>

        <!-- Messages Area -->
        <div class="messages-container" id="messagesContainer">
            <!-- Messages loaded via JavaScript -->
        </div>

        <!-- Typing Indicator -->
        <div class="typing-indicator" id="typingIndicator" style="display: none;">
            <p id="typingMessage"></p>
        </div>

        <!-- Message Input -->
        <div class="message-input-area">
            <div class="input-wrapper">
                <button class="input-btn" id="emojiBtn" title="Ø§ÛŒÙ…ÙˆØ¬ÛŒ">
                    <i class="fas fa-smile"></i>
                </button>

                <input type="text"
                       id="messageInput"
                       placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..."
                       class="message-input"
                       autocomplete="off" />

                <button class="input-btn" id="attachBtn" title="Ø§Ù„ØµØ§Ù‚ ÙØ§ÛŒÙ„">
                    <i class="fas fa-paperclip"></i>
                </button>

                <button class="input-btn" id="voiceRecordBtn" title="Ø¶Ø¨Ø· ØµÙˆØª">
                    <i class="fas fa-microphone"></i>
                </button>

                <button class="send-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </main>

    <!-- Profile Sidebar (Hidden) -->
    <aside class="profile-sidebar" id="profileSidebar">
        <!-- Profile content -->
    </aside>
</div>

<style>
    .chat-container {
        display: flex;
        height: 100vh;
        background: #fff;
    }

    .chat-sidebar {
        width: 320px;
        border-left: 1px solid #e2e8f0;
        display: flex;
        flex-direction: column;
        background: #f7fafc;
    }

    .sidebar-header {
        padding: 15px;
        border-bottom: 1px solid #e2e8f0;
    }

    .search-box {
        display: flex;
        align-items: center;
        background: #fff;
        border-radius: 20px;
        padding: 8px 12px;
        margin-bottom: 10px;
        border: 1px solid #e2e8f0;
    }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            margin-right: 10px;
            font-family: inherit;
        }

    .header-icons {
        display: flex;
        gap: 10px;
    }

    .icon-btn {
        background: none;
        border: none;
        font-size: 1.2rem;
        color: #667eea;
        cursor: pointer;
        padding: 8px;
        border-radius: 50%;
        transition: all 0.3s ease;
    }

        .icon-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

    .sidebar-tabs {
        display: flex;
        padding: 10px;
        gap: 10px;
        border-bottom: 1px solid #e2e8f0;
        overflow-x: auto;
    }

    .tab-btn {
        padding: 6px 12px;
        border: none;
        background: transparent;
        color: #718096;
        border-bottom: 2px solid transparent;
        cursor: pointer;
        font-size: 0.9rem;
        white-space: nowrap;
        transition: all 0.3s ease;
    }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

    .conversations-list {
        flex: 1;
        overflow-y: auto;
    }

    .conversation-item {
        padding: 12px 15px;
        border-bottom: 1px solid #e2e8f0;
        cursor: pointer;
        transition: all 0.2s ease;
        display: flex;
        gap: 12px;
        align-items: center;
    }

        .conversation-item:hover {
            background: #edf2f7;
        }

        .conversation-item.active {
            background: rgba(102, 126, 234, 0.1);
            border-left: 3px solid #667eea;
        }

    .conversation-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        position: relative;
        flex-shrink: 0;
    }

        .conversation-avatar .online-badge {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: #48bb78;
            border-radius: 50%;
            border: 2px solid white;
        }

    .conversation-content {
        flex: 1;
        min-width: 0;
    }

    .conversation-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 4px;
    }

    .conversation-name {
        font-weight: 600;
        color: #2d3748;
        margin: 0;
    }

    .conversation-time {
        font-size: 0.8rem;
        color: #a0aec0;
    }

    .conversation-message {
        font-size: 0.9rem;
        color: #718096;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

        .conversation-message.unread {
            color: #2d3748;
            font-weight: 600;
        }

    .conversation-badge {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        background: #f56565;
        color: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        font-size: 0.75rem;
        font-weight: 600;
        margin-right: 8px;
    }

    .chat-main {
        flex: 1;
        display: flex;
        flex-direction: column;
        background: #fff;
    }

    .chat-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        border-bottom: 1px solid #e2e8f0;
        background: #fff;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .back-btn {
        display: none;
        background: none;
        border: none;
        font-size: 1.3rem;
        color: #667eea;
        cursor: pointer;
    }

    .chat-info h2 {
        margin: 0;
        font-size: 1.1rem;
        color: #2d3748;
    }

    .chat-info p {
        margin: 0;
        font-size: 0.8rem;
        color: #a0aec0;
    }

    .header-actions {
        display: flex;
        gap: 10px;
    }

    .messages-container {
        flex: 1;
        overflow-y: auto;
        padding: 20px;
        background: #fff;
    }

    .message-group {
        margin-bottom: 15px;
    }

    .message-date-separator {
        text-align: center;
        margin: 20px 0;
        position: relative;
    }

        .message-date-separator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: #e2e8f0;
        }

        .message-date-separator span {
            background: #fff;
            padding: 0 10px;
            color: #a0aec0;
            font-size: 0.8rem;
            position: relative;
        }

    .message {
        display: flex;
        margin-bottom: 10px;
        align-items: flex-end;
        gap: 8px;
    }

        .message.sent {
            justify-content: flex-end;
        }

            .message.sent .message-content {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border-radius: 18px 18px 4px 18px;
            }

        .message.received .message-content {
            background: #e2e8f0;
            color: #2d3748;
            border-radius: 18px 18px 18px 4px;
        }

    .message-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #cbd5e0;
        flex-shrink: 0;
        display: none;
    }

    .message.received .message-avatar {
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .message-content {
        max-width: 60%;
        padding: 10px 14px;
        border-radius: 18px;
        word-wrap: break-word;
    }

    .message-time {
        font-size: 0.75rem;
        color: #a0aec0;
        margin-top: 4px;
    }

    .message-status {
        font-size: 0.9rem;
        margin-left: 6px;
    }

    .message-input-area {
        padding: 15px 20px;
        border-top: 1px solid #e2e8f0;
        background: #fff;
    }

    .input-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
        background: #f7fafc;
        border-radius: 25px;
        padding: 8px 12px;
        border: 1px solid #e2e8f0;
    }

    .input-btn {
        background: none;
        border: none;
        font-size: 1.2rem;
        color: #667eea;
        cursor: pointer;
        padding: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .message-input {
        flex: 1;
        border: none;
        background: transparent;
        outline: none;
        font-size: 1rem;
        font-family: inherit;
    }

    .send-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

        .send-btn:hover {
            transform: scale(1.05);
        }

        .send-btn:active {
            transform: scale(0.95);
        }

    .typing-indicator {
        padding: 10px 20px;
        color: #718096;
        font-size: 0.9rem;
        font-style: italic;
    }

    @@media (max-width: 768px) {
        .chat-sidebar

    {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 10;
        display: none;
    }

    .chat-sidebar.active {
        display: flex;
    }

    .back-btn {
        display: block;
    }

    .message-content {
        max-width: 80%;
    }

    }
</style>

<script>
    const connection = new signalR.HubConnectionBuilder()
        .withUrl("/chathub")
        .withAutomaticReconnect()
        .build();

    let currentConversation = null;
    let conversations = [];

    // ==================== SignalR Events ====================
    connection.on("ReceivePrivateMessage", (message) => {
        if (currentConversation && currentConversation.id === message.senderId) {
            displayMessage(message, 'received');
        }
    });

    connection.on("UserOnline", (userId, firstName, lastName) => {
        updateUserStatus(userId, true);
    });

    connection.on("UserOffline", (userId) => {
        updateUserStatus(userId, false);
    });

    connection.on("UserTyping", (userName) => {
        showTypingIndicator(`${userName} Ø¯Ø±Ø­Ø§Ù„ Ù†ÙˆØ´ØªÙ†...`);
    });

    connection.on("UserStoppedTyping", () => {
        hideTypingIndicator();
    });

    // ==================== Message Events ====================
    document.getElementById('sendBtn').addEventListener('click', sendMessage);
    document.getElementById('messageInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });

    document.getElementById('messageInput').addEventListener('input', () => {
        if (currentConversation && currentConversation.type === 'private') {
            connection.invoke("SendTypingNotification", currentConversation.id);
        }
    });

    // ==================== Functions ====================
    async function sendMessage() {
        const input = document.getElementById('messageInput');
        const content = input.value.trim();

        if (!content || !currentConversation) return;

        if (currentConversation.type === 'private') {
            await connection.invoke("SendPrivateMessage", currentConversation.id, content);
        } else if (currentConversation.type === 'group') {
            await connection.invoke("SendGroupMessage", currentConversation.id, content);
        }

        input.value = '';
        input.focus();
    }

    function displayMessage(message, type) {
        const container = document.getElementById('messagesContainer');
        const messageEl = document.createElement('div');
        messageEl.className = `message ${type}`;
        messageEl.innerHTML = `
            ${type === 'received' ? `<div class="message-avatar">${message.senderName[0]}</div>` : ''}
            <div>
                <div class="message-content">${escapeHtml(message.content)}</div>
                <div class="message-time">${formatTime(message.sentAt)}</div>
            </div>
        `;

        container.appendChild(messageEl);
        container.scrollTop = container.scrollHeight;
    }

    function showTypingIndicator(text) {
        const indicator = document.getElementById('typingIndicator');
        document.getElementById('typingMessage').textContent = text;
        indicator.style.display = 'block';
    }

    function hideTypingIndicator() {
        document.getElementById('typingIndicator').style.display = 'none';
    }

    function updateUserStatus(userId, isOnline) {
        const elem = document.querySelector(`[data-user-id="${userId}"]`);
        if (elem) {
            const badge = elem.querySelector('.online-badge');
            if (badge) {
                badge.style.background = isOnline ? '#48bb78' : '#cbd5e0';
            }
        }
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    function formatTime(date) {
        return new Date(date).toLocaleTimeString('fa-IR', {
            hour: '2-digit',
            minute: '2-digit'
        });
    }

    // ==================== Initialize ====================
    connection.start().catch(err => console.error(err));
</script> 
 
==================== Login.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Account\ 
 
ï»¿@{
    ViewData["Title"] = "ÙˆØ±ÙˆØ¯ - Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ";
    Layout = null;
}

<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#667eea" />
    <title>ÙˆØ±ÙˆØ¯ - Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.rtl.min.css" />
    <link rel="stylesheet" href="~/lib/font-awesome/css/all.min.css" />
    <style>
        * {
            font-family: 'Vazirmatn', Tahoma, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .login-wrapper {
            width: 100%;
            max-width: 450px;
            padding: 20px;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: slideUp 0.5s ease-out;
        }

        @@keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
        }

            .login-header .logo {
                font-size: 3rem;
                margin-bottom: 15px;
                animation: pulse 2s infinite;
            }

        @@keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .login-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            margin: 0;
        }

        .login-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .login-body {
            padding: 40px;
        }

        .alert {
            border-radius: 10px;
            border: none;
            animation: slideDown 0.4s ease-out;
        }

        @@keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-tabs {
            display: flex;
            gap: 0;
            margin-bottom: 30px;
            border-bottom: 2px solid #e2e8f0;
            border-radius: 10px 10px 0 0;
            background: #f7fafc;
            margin: -40px -40px 30px -40px;
            padding: 0;
        }

        .auth-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            color: #a0aec0;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            background: transparent;
            border: none;
            font-size: 0.95rem;
        }

            .auth-tab i {
                margin-right: 6px;
            }

            .auth-tab.active {
                color: #667eea;
                border-bottom-color: #667eea;
                background: white;
            }

            .auth-tab:hover:not(.active) {
                color: #718096;
            }

        .tab-content {
            display: none;
        }

            .tab-content.active {
                display: block;
                animation: fadeIn 0.3s ease-out;
            }

        @@keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

            .form-group label {
                color: #2d3748;
                font-weight: 600;
                margin-bottom: 8px;
                display: block;
            }

            .form-group input,
            .form-group select {
                border: 2px solid #e2e8f0;
                border-radius: 10px;
                padding: 12px 15px;
                font-size: 1rem;
                transition: all 0.3s ease;
                width: 100%;
            }

                .form-group input:focus,
                .form-group select:focus {
                    border-color: #667eea;
                    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    outline: none;
                }

                .form-group input::placeholder {
                    color: #cbd5e0;
                }

        .btn-submit {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 30px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 10px;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

            .btn-submit:hover:not(:disabled) {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
            }

            .btn-submit:disabled {
                opacity: 0.6;
                cursor: not-allowed;
            }

        .spinner-border {
            width: 18px;
            height: 18px;
            border-width: 2px;
        }

        .dev-info {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 0.85rem;
            color: #7d6608;
        }

            .dev-info strong {
                display: block;
                margin-bottom: 8px;
            }

            .dev-info code {
                background: rgba(0,0,0,0.05);
                padding: 2px 6px;
                border-radius: 4px;
                font-family: 'Courier New', monospace;
            }

        .otp-container {
            background: #f7fafc;
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .otp-label {
            color: #718096;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .otp-code {
            font-size: 2.2rem;
            color: #667eea;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            letter-spacing: 8px;
            margin: 15px 0;
            user-select: all;
        }

        .copy-btn {
            background: #e2e8f0;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

            .copy-btn:hover {
                background: #cbd5e0;
                transform: scale(1.05);
            }

        .timer {
            color: #e53e3e;
            font-weight: 600;
            margin-top: 10px;
        }

        .success-message {
            background: #c6f6d5;
            color: #22543d;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideDown 0.4s ease-out;
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            animation: slideDown 0.4s ease-out;
        }

        @@media (max-width: 480px) {
            .login-body {
                padding: 25px;
            }

            .auth-tabs {
                margin: -25px -25px 20px -25px;
            }

            .login-header {
                padding: 30px 15px;
            }

                .login-header h1 {
                    font-size: 1.5rem;
                }

                .login-header .logo {
                    font-size: 2.5rem;
                }

            .otp-code {
                font-size: 1.8rem;
                letter-spacing: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="login-wrapper">
        <div class="login-card">
            <!-- Ù‡Ø¯Ø± -->
            <div class="login-header">
                <div class="logo">ğŸ“±</div>
                <h1>Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</h1>
                <p>Ø³Ø§Ù…Ø§Ù†Ù‡ Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª Ø¯Ø§Ø®Ù„ÛŒ Ø´Ø±Ú©Øª</p>
            </div>

            <!-- Ø¨Ø¯Ù†Ù‡ -->
            <div class="login-body">
                <!-- Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ -->
                @if (TempData["Error"] != null)
                {
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-circle"></i>
                        @TempData["Error"]
                    </div>
                }

                @if (TempData["Success"] != null)
                {
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        @TempData["Success"]
                    </div>
                }

                <!-- ØªØ¨â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ -->
                <div class="auth-tabs">
                    <button type="button" class="auth-tab active" data-tab="sms">
                        <i class="fas fa-mobile-alt"></i>
                        <span class="d-none d-sm-inline">Ù¾ÛŒØ§Ù…Ú©</span>
                    </button>
                    <button type="button" class="auth-tab" data-tab="password">
                        <i class="fas fa-lock"></i>
                        <span class="d-none d-sm-inline">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</span>
                    </button>
                    <button type="button" class="auth-tab" data-tab="ad">
                        <i class="fas fa-building"></i>
                        <span class="d-none d-sm-inline">Active Directory</span>
                    </button>
                </div>

                <!-- ==================== ØªØ¨ Ù¾ÛŒØ§Ù…Ú© ==================== -->
                <div id="sms" class="tab-content active">
                    <form id="smsForm" method="post" action="@Url.Action("SendOtp")">
                        @Html.AntiForgeryToken()

                        <div class="form-group">
                            <label for="smsPhone">
                                <i class="fas fa-phone"></i> Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
                            </label>
                            <input type="tel" id="smsPhone" name="phoneNumber"
                                   class="form-control"
                                   placeholder="09123456789"
                                   pattern="0[0-9]{10}"
                                   required />
                            <small class="text-muted">ÙØ±Ù…Øª: 09123456789</small>
                        </div>

                        <button type="submit" class="btn-submit">
                            <span class="spinner-border spinner-border-sm d-none" id="smsBtnSpinner"></span>
                            Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ø¯ ØªØ§ÛŒÛŒØ¯
                        </button>
                    </form>

                    <div class="dev-info">
                        <strong>ğŸ’¡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆØ³Ø¹Ù‡:</strong>
                        Ø´Ù…Ø§Ø±Ù‡ ØªØ³ØªÛŒ: <code>09123456789</code><br />
                        Ú©Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø´Ø¯Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    </div>
                </div>

                <!-- ==================== ØªØ¨ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± ==================== -->
                <div id="password" class="tab-content">
                    <form id="passwordForm" method="post" action="@Url.Action("LoginWithPassword")">
                        @Html.AntiForgeryToken()

                        <div class="form-group">
                            <label for="pwdUsername">
                                <i class="fas fa-user"></i> Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
                            </label>
                            <input type="text" id="pwdUsername" name="username"
                                   class="form-control"
                                   placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„"
                                   required />
                        </div>

                        <div class="form-group">
                            <label for="pwdPassword">
                                <i class="fas fa-key"></i> Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
                            </label>
                            <input type="password" id="pwdPassword" name="password"
                                   class="form-control"
                                   placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
                                   required />
                        </div>

                        <button type="submit" class="btn-submit">
                            <span class="spinner-border spinner-border-sm d-none" id="pwdBtnSpinner"></span>
                            ÙˆØ±ÙˆØ¯
                        </button>
                    </form>

                    <div class="dev-info">
                        <strong>ğŸ’¡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªÙˆØ³Ø¹Ù‡:</strong>
                        Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ: <code>09123456789</code><br />
                        Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±: <code>Test123!</code>
                    </div>
                </div>

                <!-- ==================== ØªØ¨ Active Directory ==================== -->
                <div id="ad" class="tab-content">
                    <form id="adForm" method="post" action="@Url.Action("LoginWithAD")">
                        @Html.AntiForgeryToken()

                        <div class="form-group">
                            <label for="adUsername">
                                <i class="fas fa-user"></i> Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ AD
                            </label>
                            <input type="text" id="adUsername" name="username"
                                   class="form-control"
                                   placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Active Directory"
                                   required />
                        </div>

                        <div class="form-group">
                            <label for="adPassword">
                                <i class="fas fa-key"></i> Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
                            </label>
                            <input type="password" id="adPassword" name="password"
                                   class="form-control"
                                   placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±"
                                   required />
                        </div>

                        <button type="submit" class="btn-submit">
                            <span class="spinner-border spinner-border-sm d-none" id="adBtnSpinner"></span>
                            ÙˆØ±ÙˆØ¯ Ø¨Ø§ AD
                        </button>
                    </form>

                    <div class="dev-info">
                        <strong>ğŸ’¡ Active Directory:</strong>
                        Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø§Ø² Ø³Ø±ÙˆØ± AD Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
                    </div>
                </div>

                <!-- ==================== OTP Verification ==================== -->
                <div id="otpContainer" style="display: none;">
                    <form id="otpForm" method="post" action="@Url.Action("VerifyOtp")">
                        @Html.AntiForgeryToken()

                        <input type="hidden" name="phoneNumber" id="phoneNumberField" />

                        <div class="otp-container">
                            <div class="otp-label">Ú©Ø¯ ØªØ§ÛŒÛŒØ¯ 6 Ø±Ù‚Ù…ÛŒ</div>
                            <div class="otp-code" id="otpDisplay">------</div>
                            <button type="button" class="copy-btn" onclick="copyOtp()">
                                ğŸ“‹ Ú©Ù¾ÛŒ Ú©Ø¯
                            </button>
                            <div class="timer">
                                Ù…ÙˆØ§Ø±Ø¯ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯Ù‡: <span id="countdown">300</span> Ø«Ø§Ù†ÛŒÙ‡
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="otpInput">Ú©Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:</label>
                            <input type="text" id="otpInput" name="otpCode"
                                   class="form-control text-center"
                                   placeholder="000000"
                                   maxlength="6"
                                   pattern="[0-9]{6}"
                                   required
                                   autofocus />
                        </div>

                        <button type="submit" class="btn-submit">
                            <span class="spinner-border spinner-border-sm d-none" id="otpBtnSpinner"></span>
                            ØªØ§ÛŒÛŒØ¯ Ùˆ ÙˆØ±ÙˆØ¯
                        </button>

                        <button type="button" class="btn btn-outline-secondary w-100 mt-2"
                                onclick="resetToPhoneInput()">
                            Ø¨Ø§Ø²Ú¯Ø´Øª
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ù¾ÛŒÙˆÙ†Ø¯ Ù‚Ø§Ù†ÙˆÙ†ÛŒ -->
        <div class="text-center mt-4 text-white" style="font-size: 0.85rem;">
            <p>Â© 1403 - ØªÙ…Ø§Ù…ÛŒ Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸ Ø§Ø³Øª</p>
        </div>
    </div>

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ==================== ØªØ¨â€ŒØ¨Ù†Ø¯ÛŒ ====================
        $('.auth-tab').on('click', function() {
            const tabName = $(this).data('tab');

            $('.auth-tab').removeClass('active');
            $('.tab-content').removeClass('active');

            $(this).addClass('active');
            $('#' + tabName).addClass('active');

            // Ø±ÛŒØ³Øª Ú©Ø±Ø¯Ù† ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÚ¯Ø±
            resetForms();
        });

        // ==================== ÙØ±Ù… Ù¾ÛŒØ§Ù…Ú© ====================
        $('#smsForm').on('submit', function(e) {
            e.preventDefault();

            const phone = $('#smsPhone').val().trim();
            const $btn = $(this).find('.btn-submit');
            const $spinner = $('#smsBtnSpinner');

            if (!phone.match(/^0[0-9]{10}$/)) {
                showError('ÙØ±Ù…Øª Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø¯Ø±Ø³Øª Ù†ÛŒØ³Øª');
                return;
            }

            $spinner.removeClass('d-none');
            $btn.prop('disabled', true);

            $.ajax({
                url: '@Url.Action("SendOtp")',
                type: 'POST',
                data: { phoneNumber: phone },
                headers: {
                    'RequestVerificationToken': getAntiForgeryToken()
                },
                success: function(response) {
                    if (response.success) {
                        $('#phoneNumberField').val(phone);
                        $('.login-card').fadeOut(300, function() {
                            $(this).html($('#otpContainer').html());
                            $(this).fadeIn(300);
                            startCountdown();
                            if (response.otpCode) {
                                $('#otpDisplay').text(response.otpCode);
                            }
                        });
                    } else {
                        showError(response.message || 'Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ú©Ø¯');
                    }
                },
                error: function(xhr) {
                    showError('Ø®Ø·Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø·ÛŒ: ' + xhr.status);
                },
                complete: function() {
                    $spinner.addClass('d-none');
                    $btn.prop('disabled', false);
                }
            });
        });

        // ==================== Ú©Ù¾ÛŒ OTP ====================
        function copyOtp() {
            const otp = $('#otpDisplay').text().trim();
            if (otp === '------') {
                alert('Ú©Ø¯ Ù‡Ù†ÙˆØ² Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯Ù‡');
                return;
            }

            navigator.clipboard.writeText(otp).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'âœ… Ú©Ù¾ÛŒ Ø´Ø¯';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        }

        // ==================== Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ù…Ø¹Ú©ÙˆØ³ ====================
        let countdownInterval;
        function startCountdown() {
            let seconds = 300; // 5 Ø¯Ù‚ÛŒÙ‚Ù‡

            countdownInterval = setInterval(() => {
                $('#countdown').text(seconds);

                if (seconds <= 60) {
                    $('#countdown').css('color', '#e53e3e');
                }

                if (seconds <= 0) {
                    clearInterval(countdownInterval);
                    alert('Ø²Ù…Ø§Ù† Ø§Ù†Ù‚Ø¶Ø§ ÛŒØ§ÙØªÙ‡ Ø§Ø³Øª. Ù„Ø·ÙØ§Ù‹ Ø¯ÙˆØ¨Ø§Ø±Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ú©Ù†ÛŒØ¯.');
                    resetToPhoneInput();
                }

                seconds--;
            }, 1000);
        }

        // ==================== Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ ÙˆØ±ÙˆØ¯ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ ====================
        function resetToPhoneInput() {
            clearInterval(countdownInterval);
            $('.auth-tab').removeClass('active');
            $('.auth-tab[data-tab="sms"]').addClass('active');
            $('.tab-content').removeClass('active');
            $('#sms').addClass('active');
            $('#smsPhone').focus();
        }

        // ==================== ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ====================
        function getAntiForgeryToken() {
            return $('input[name="__RequestVerificationToken"]').first().val();
        }

        function showError(message) {
            const alert = `<div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle"></i> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>`;

            $('.login-body').prepend(alert);

            setTimeout(() => {
                $('.alert').fadeOut(300, function() { $(this).remove(); });
            }, 5000);
        }

        function resetForms() {
            $('#smsForm, #passwordForm, #adForm').trigger('reset');
            clearInterval(countdownInterval);
        }

        // Ø§ÛŒÙ†ØªØ± Ø¨Ø±Ø§ÛŒ OTP
        $(document).on('keypress', '#otpInput', function(e) {
            if (e.which === 13 && $(this).val().length === 6) {
                $('#otpForm').submit();
            }
        });
    </script>
</body>
</html> 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Chat\ 
 
ï»¿@{
    ViewData["Title"] = "Ú†Øª";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var currentUser = ViewBag.CurrentUser as OrganizationalMessenger.Domain.Entities.User;
}

<!-- Anti-forgery token -->
<form id="antiForgeryForm" style="display:none;">
    @Html.AntiForgeryToken()
</form>

<input type="hidden" id="currentUserId" value="@currentUser?.Id" />

<div class="chat-container">
    <!-- Sidebar -->
    <div class="chat-sidebar">
        <div class="chat-header">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬Ùˆ...">
            </div>
            <div class="header-right">
                <span class="user-name">@currentUser?.FullName</span>
                <img src="@(currentUser?.AvatarUrl ?? "/images/default-avatar.png")" class="logo">

                <!-- âœ… Ø¯Ú©Ù…Ù‡ Ù…Ù†ÙˆÛŒ Ø§ÛŒØ¬Ø§Ø¯ -->
                <button class="create-btn" id="createMenuBtn" title="Ø§ÛŒØ¬Ø§Ø¯">
                    <i class="fas fa-plus"></i>
                </button>

                <!-- âœ… Ù…Ù†ÙˆÛŒ dropdown -->
                <div class="create-menu" id="createMenu" style="display: none;">
                    <button class="create-menu-item" id="createGroupBtn">
                        <i class="fas fa-users"></i>
                        <span>Ú¯Ø±ÙˆÙ‡ Ø¬Ø¯ÛŒØ¯</span>
                    </button>
                    <button class="create-menu-item" id="createChannelBtn">
                        <i class="fas fa-bullhorn"></i>
                        <span>Ú©Ø§Ù†Ø§Ù„ Ø¬Ø¯ÛŒØ¯</span>
                    </button>
                </div>

                <!-- Ø¯Ú©Ù…Ù‡ Ø®Ø±ÙˆØ¬ -->
                <form asp-action="SignOut" asp-controller="Chat" method="post" class="logout-form">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="logout-btn" title="Ø®Ø±ÙˆØ¬">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </form>
            </div>
        </div>

        <!-- âœ… ØªØ¨â€ŒÙ‡Ø§ -->
        <div class="chat-tabs">
            <button class="tab-btn active" data-tab="all">Ù‡Ù…Ù‡</button>
            <button class="tab-btn" data-tab="private">Ø®ØµÙˆØµÛŒ</button>
            <button class="tab-btn" data-tab="groups">Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</button>
            <button class="tab-btn" data-tab="channels">Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</button>
        </div>

        <!-- Ú†Øª Ù„ÛŒØ³Øª -->
        <div class="chat-list" id="chatList">
            <!-- Ù¾Ø± Ø´Ø¯Ù‡ ØªÙˆØ³Ø· JavaScript -->
        </div>
    </div>

    <!-- Main Chat Area -->
    <div class="chat-main">
        <div class="chat-top-header" id="chatTopHeader">
            <div class="chat-info">
                <span id="chatTitle">Ú†ØªÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</span>
            </div>
            <div class="chat-actions">
                <button id="callVoiceBtn" style="display:none;" title="ØªÙ…Ø§Ø³ ØµÙˆØªÛŒ">
                    <i class="fas fa-phone"></i>
                </button>
                <button id="callVideoBtn" style="display:none;" title="ØªÙ…Ø§Ø³ ØªØµÙˆÛŒØ±ÛŒ">
                    <i class="fas fa-video"></i>
                </button>
                <button id="moreBtn" style="display:none;">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
            </div>
        </div>

        <!-- Ù¾ÛŒØ§Ù…Ù‡Ø§ -->
        <div class="messages-container" id="messagesContainer">
            <p class="empty-state">Ú†ØªÛŒ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</p>
        </div>

        <!-- Message Input -->
        <div id="replyPreviewContainer"></div>
        <div class="message-input-area" id="messageInputArea" style="display: none;">
            <div class="input-wrapper">
                <button id="micBtn" class="input-btn" title="Ù¾ÛŒØ§Ù… ØµÙˆØªÛŒ">
                    <i class="fas fa-microphone"></i>
                </button>

                <textarea id="messageInput"
                          class="message-textarea"
                          placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯... (Shift+Enter Ø¨Ø±Ø§ÛŒ Ø®Ø· Ø¬Ø¯ÛŒØ¯)"
                          rows="1"></textarea>

                <input type="file" id="fileInput" style="display:none">

                <button id="attachBtn" class="input-btn" title="ÙØ§ÛŒÙ„ Ø¶Ù…ÛŒÙ…Ù‡ Ú©Ù†ÛŒØ¯">
                    <i class="fas fa-paperclip"></i>
                </button>

                <button id="emojiBtn" class="input-btn" title="Ø§ÛŒÙ…ÙˆØ¬ÛŒ">ğŸ˜€</button>

                <button id="sendBtn" class="input-btn send-btn" title="Ø§Ø±Ø³Ø§Ù„">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
</div>

<div id="emojiPickerContainer" style="display:none;"></div>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <button class="nav-btn" data-page="profile">
        <i class="fas fa-user"></i>
        <span>Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
    </button>
    <button class="nav-btn" data-page="services">
        <i class="fas fa-th"></i>
        <span>Ø®Ø¯Ù…Ø§Øª</span>
    </button>
    <button class="nav-btn active" data-page="chat">
        <i class="fas fa-comments"></i>
        <span>Ù¾ÛŒØ§Ù…</span>
    </button>
    <button class="nav-btn" data-page="calls">
        <i class="fas fa-phone-alt"></i>
        <span>ØªÙ…Ø§Ø³Ù‡Ø§</span>
    </button>
    <button class="nav-btn" data-page="dialer">
        <i class="fas fa-keypad"></i>
        <span>Ø´Ù…Ø§Ø±Ù‡â€ŒÚ¯ÛŒØ±ÛŒ</span>
    </button>
</nav>

<script>
    const currentUserId = parseInt(document.getElementById('currentUserId')?.value || '0');
    console.log('ğŸ” Current User ID:', currentUserId);
</script>

<link href="~/css/chat.css" rel="stylesheet" />

<!-- SignalR Client -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/8.0.7/signalr.min.js"></script>

<script type="module" src="~/js/chat.js"></script> 
 
==================== Index.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Home\ 
 
ï»¿@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://learn.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>
 
 
==================== Privacy.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Home\ 
 
ï»¿@{
    ViewData["Title"] = "Privacy Policy";
}
<h1>@ViewData["Title"]</h1>

<p>Use this page to detail your site's privacy policy.</p>
 
 
==================== _AdminLayout.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
ï»¿<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</title>

    <!-- Bootstrap RTL -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet" />

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet" />

    <!-- Vazirmatn Font -->
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" />

    <!-- DataTables -->
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet" />

    <!-- Select2 -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.rtl.min.css" rel="stylesheet" />

    <!-- Toastr -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />

    <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #858796;
            --success-color: #1cc88a;
            --info-color: #36b9cc;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --sidebar-bg: #2c3e50;
            --sidebar-hover: #34495e;
            --sidebar-active: #1abc9c;
        }

        * {
            font-family: 'Vazirmatn', sans-serif !important;
        }

        body {
            background-color: #f8f9fc;
            overflow-x: hidden;
        }

        /* ==================== Sidebar ==================== */
        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 280px;
            height: 100vh;
            background: linear-gradient(180deg, #1e3a5f 0%, #152238 100%);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

            .sidebar.collapsed {
                width: 70px;
            }

        /* Sidebar Brand (Logo) - Fixed at Top */
        .sidebar-brand {
            padding: 20px 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

            .sidebar-brand img {
                width: 50px;
                height: 50px;
                border-radius: 10px;
                margin-bottom: 10px;
            }

            .sidebar-brand h5 {
                color: #fff;
                margin: 0;
                font-size: 1rem;
                font-weight: 600;
            }

        /* Sidebar Menu - Scrollable */
        .sidebar-menu {
            list-style: none;
            padding: 15px 0;
            margin: 0;
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

            .sidebar-menu::-webkit-scrollbar {
                width: 6px;
            }

            .sidebar-menu::-webkit-scrollbar-track {
                background: transparent;
            }

            .sidebar-menu::-webkit-scrollbar-thumb {
                background: rgba(255, 255, 255, 0.3);
                border-radius: 3px;
            }

                .sidebar-menu::-webkit-scrollbar-thumb:hover {
                    background: rgba(255, 255, 255, 0.5);
                }

        /* Menu Header */
        .menu-header {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            padding: 15px 20px 8px;
            letter-spacing: 0.5px;
        }

        .sidebar.collapsed .menu-header {
            display: none;
        }

        /* Menu Item */
        .menu-item {
            margin: 2px 10px;
        }

        .menu-link {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            position: relative;
        }

            .menu-link:hover {
                background: rgba(255, 255, 255, 0.1);
                color: #fff;
            }

            .menu-link.active {
                background: linear-gradient(90deg, #4e73df 0%, #224abe 100%);
                color: #fff;
                box-shadow: 0 2px 10px rgba(78, 115, 223, 0.4);
            }

            .menu-link i:first-child {
                width: 24px;
                text-align: center;
                margin-left: 12px;
                font-size: 1rem;
            }

        .menu-text {
            flex: 1;
            font-size: 0.9rem;
        }

        /* Menu Arrow */
        .menu-arrow {
            font-size: 0.7rem;
            transition: transform 0.2s ease;
        }

        .menu-item.open .menu-arrow {
            transform: rotate(-90deg);
        }

        /* Menu Badge */
        .menu-badge {
            background: #e74a3b;
            color: #fff;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 8px;
        }

        /* Submenu */
        .submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .menu-item.open .submenu {
            max-height: 500px;
        }

        .submenu-link {
            display: block;
            padding: 10px 15px 10px 50px;
            color: rgba(255, 255, 255, 0.6);
            text-decoration: none;
            font-size: 0.85rem;
            border-radius: 6px;
            margin: 2px 0;
            transition: all 0.2s ease;
        }

            .submenu-link:hover {
                color: #fff;
                background: rgba(255, 255, 255, 0.05);
            }

            .submenu-link.active {
                color: #4e73df;
                background: rgba(78, 115, 223, 0.1);
            }

            .submenu-link::before {
                content: "â—";
                font-size: 0.5rem;
                margin-left: 8px;
                opacity: 0.5;
            }

        /* Collapsed State */
        .sidebar.collapsed .sidebar-brand h5,
        .sidebar.collapsed .menu-text,
        .sidebar.collapsed .menu-arrow,
        .sidebar.collapsed .menu-badge {
            display: none;
        }

        .sidebar.collapsed .menu-link {
            justify-content: center;
            padding: 15px;
        }

            .sidebar.collapsed .menu-link i:first-child {
                margin: 0;
                font-size: 1.2rem;
            }

        .sidebar.collapsed .submenu {
            position: absolute;
            right: 70px;
            top: 0;
            background: #1e3a5f;
            min-width: 200px;
            border-radius: 8px;
            box-shadow: -5px 5px 15px rgba(0, 0, 0, 0.2);
            max-height: none;
            padding: 10px 0;
        }

        .sidebar.collapsed .submenu-link {
            padding: 10px 20px;
        }

            .sidebar.collapsed .submenu-link::before {
                display: none;
            }

        /* ==================== Main Content ==================== */
        .main-content {
            margin-right: 280px;
            min-height: 100vh;
            background: #f4f6f9;
            transition: margin-right 0.3s ease;
        }

        .sidebar.collapsed ~ .main-content {
            margin-right: 70px;
        }

        /* Top Navbar */
        .top-navbar {
            background: #fff;
            padding: 15px 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 999;
        }

        .navbar-search {
            position: relative;
            max-width: 400px;
        }

            .navbar-search input {
                padding-right: 2.5rem;
                border-radius: 20px;
                border: 1px solid #e3e6f0;
            }

            .navbar-search i {
                position: absolute;
                right: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: var(--secondary-color);
            }

        .navbar-icons {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #f8f9fc;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            color: var(--secondary-color);
            transition: all 0.2s ease;
        }

            .nav-icon-btn:hover {
                background: #eaecf4;
                color: var(--primary-color);
            }

            .nav-icon-btn .badge {
                position: absolute;
                top: -2px;
                left: -2px;
                font-size: 0.6rem;
                padding: 0.25rem 0.4rem;
            }

        .user-dropdown {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 8px;
            transition: background 0.2s ease;
        }

            .user-dropdown:hover {
                background: #f8f9fc;
            }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info {
            text-align: right;
        }

        .user-name {
            font-weight: 600;
            color: #3a3b45;
            font-size: 0.9rem;
        }

        .user-role {
            font-size: 0.75rem;
            color: var(--secondary-color);
        }

        /* Page Content */
        .page-content {
            padding: 25px;
        }

        /* Sidebar Toggle */
        .toggle-sidebar-btn {
            background: none;
            border: none;
            font-size: 1.25rem;
            color: var(--secondary-color);
            cursor: pointer;
            padding: 0.5rem;
        }

        /* Responsive */
        @@media (max-width: 992px) {
            .sidebar

        {
            right: -280px;
        }

        .sidebar.show {
            right: 0;
        }

        .main-content {
            margin-right: 0;
        }

        .sidebar-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

            .sidebar-overlay.show {
                display: block;
            }

        }

        /* Animation */
        .fade-in {
            animation: fadeIn 0.3s ease;
        }

        @@keyframes fadeIn {
            from

        {
            opacity: 0;
            transform: translateY(10px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }

        }
    </style>


    @RenderSection("Styles", required: false)
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        @await Html.PartialAsync("_SidebarMenu")
    </aside>

    <!-- Sidebar Overlay (Mobile) -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Top Navbar -->
        @await Html.PartialAsync("_TopNavbar")

        <!-- Page Content -->
        <main class="page-content fade-in">
            @RenderBody()
        </main>

        <!-- Footer -->
        <footer class="text-center py-3 text-muted" style="font-size: 0.85rem;">
            <span>Â© @DateTime.Now.Year Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ | Ù†Ø³Ø®Ù‡ 1.0.0</span>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Toastr Settings
        toastr.options = {
            "closeButton": true,
            "progressBar": true,
            "positionClass": "toast-top-left",
            "timeOut": "3000",
            "rtl": true
        };

        // Toggle Sidebar
        document.getElementById('toggleSidebar').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });

        // Mobile Sidebar Toggle
        document.getElementById('mobileSidebarToggle')?.addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('show');
        });

        document.getElementById('sidebarOverlay').addEventListener('click', function() {
            document.getElementById('sidebar').classList.remove('show');
        });

        // Submenu Toggle
        document.querySelectorAll('.has-submenu > .menu-link').forEach(function(link) {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                this.closest('.menu-item').classList.toggle('open');
            });
        });

        // DataTables Default Settings
        $.extend(true, $.fn.dataTable.defaults, {
            language: {
                "emptyTable": "Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯",
                "info": "Ù†Ù…Ø§ÛŒØ´ _START_ ØªØ§ _END_ Ø§Ø² _TOTAL_ Ø±Ø¯ÛŒÙ",
                "infoEmpty": "Ù†Ù…Ø§ÛŒØ´ 0 ØªØ§ 0 Ø§Ø² 0 Ø±Ø¯ÛŒÙ",
                "infoFiltered": "(ÙÛŒÙ„ØªØ± Ø´Ø¯Ù‡ Ø§Ø² _MAX_ Ø±Ø¯ÛŒÙ)",
                "lengthMenu": "Ù†Ù…Ø§ÛŒØ´ _MENU_ Ø±Ø¯ÛŒÙ",
                "loadingRecords": "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...",
                "processing": "Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...",
                "search": "Ø¬Ø³ØªØ¬Ùˆ:",
                "zeroRecords": "Ù†ØªÛŒØ¬Ù‡â€ŒØ§ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯",
                "paginate": {
                    "first": "Ø§ÙˆÙ„",
                    "last": "Ø¢Ø®Ø±",
                    "next": "Ø¨Ø¹Ø¯ÛŒ",
                    "previous": "Ù‚Ø¨Ù„ÛŒ"
                }
            },
            pageLength: 10,
            responsive: true
        });

        // Select2 Default
        $.fn.select2.defaults.set("theme", "bootstrap-5");
        $.fn.select2.defaults.set("dir", "rtl");
        $.fn.select2.defaults.set("language", "fa");

        // SweetAlert2 Default
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true
        });

        // Delete Confirmation
        function confirmDelete(url, itemName) {
            Swal.fire({
                title: 'Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ',
                text: `${itemName} Ø­Ø°Ù Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯!`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#e74a3b',
                cancelButtonColor: '#858796',
                confirmButtonText: 'Ø¨Ù„Ù‡ØŒ Ø­Ø°Ù Ø´ÙˆØ¯',
                cancelButtonText: 'Ø§Ù†ØµØ±Ø§Ù'
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = url;
                }
            });
        }

        // Show Success Message from TempData
        @if (TempData["Success"] != null)
        {
                <text>toastr.success('@TempData["Success"]');</text>
        }

        @if (TempData["Error"] != null)
        {
                <text>toastr.error('@TempData["Error"]');</text>
        }
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
 
 
==================== _Layout.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
ï»¿ï»¿
<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</title>

    <!-- Bootstrap RTL -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.rtl.min.css" />

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Main CSS -->
    <link rel="stylesheet" href="~/css/site.css" />

    @await RenderSectionAsync("Styles", required: false)
</head>
<body>
    <div class="app-container">
        @RenderBody()
    </div>

    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js"></script>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html> 
 
==================== _SidebarMenu.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
ï»¿@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString()?.ToLower();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString()?.ToLower();
}

<!-- Brand -->
<div class="sidebar-brand">
    @* <img src="~/images/logo.png" alt="Logo" onerror="this.src='https://via.placeholder.com/50/4e73df/ffffff?text=OM'" /> *@
    <h5>Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø³Ø§Ø²Ù…Ø§Ù†ÛŒ</h5>
</div>

<!-- Menu -->
<ul class="sidebar-menu">

    <!-- Dashboard -->
    <li class="menu-item">
        <a href="@Url.Action("Index", "Dashboard")" class="menu-link @(currentController == "dashboard" ? "active" : "")">
            <i class="fas fa-tachometer-alt"></i>
            <span class="menu-text">Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</span>
        </a>
    </li>

    <!-- User Management -->
    <li class="menu-header">Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</li>

    <li class="menu-item has-submenu @(currentController == "users" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "users" ? "active" : "")">
            <i class="fas fa-users"></i>
            <span class="menu-text">Ú©Ø§Ø±Ø¨Ø±Ø§Ù†</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Users")" class="submenu-link @(currentController == "users" && currentAction == "index" ? "active" : "")">
                    Ù„ÛŒØ³Øª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Users")" class="submenu-link @(currentController == "users" && currentAction == "create" ? "active" : "")">
                    Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±
                </a>
            </li>
            <li>
                <a href="@Url.Action("Permissions", "Users")" class="submenu-link @(currentController == "users" && currentAction == "permissions" ? "active" : "")">
                    Ù…Ø¬ÙˆØ²Ù‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("SmsCredits", "Users")" class="submenu-link @(currentController == "users" && currentAction == "smscredits" ? "active" : "")">
                    Ø§Ø¹ØªØ¨Ø§Ø± Ù¾ÛŒØ§Ù…Ú©
                </a>
            </li>
        </ul>
    </li>

    <!-- Groups -->
    <li class="menu-item has-submenu @(currentController == "groups" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "groups" ? "active" : "")">
            <i class="fas fa-user-friends"></i>
            <span class="menu-text">Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Groups")" class="submenu-link @(currentController == "groups" && currentAction == "index" ? "active" : "")">
                    Ù„ÛŒØ³Øª Ú¯Ø±ÙˆÙ‡â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Groups")" class="submenu-link @(currentController == "groups" && currentAction == "create" ? "active" : "")">
                    Ø§ÛŒØ¬Ø§Ø¯ Ú¯Ø±ÙˆÙ‡
                </a>
            </li>
        </ul>
    </li>

    <!-- Channels -->
    <li class="menu-item has-submenu @(currentController == "channels" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "channels" ? "active" : "")">
            <i class="fas fa-broadcast-tower"></i>
            <span class="menu-text">Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Channels")" class="submenu-link @(currentController == "channels" && currentAction == "index" ? "active" : "")">
                    Ù„ÛŒØ³Øª Ú©Ø§Ù†Ø§Ù„â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Channels")" class="submenu-link @(currentController == "channels" && currentAction == "create" ? "active" : "")">
                    Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ù†Ø§Ù„
                </a>
            </li>
        </ul>
    </li>

    <!-- Messages -->
    <li class="menu-header">Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ Ùˆ Ù…Ø­ØªÙˆØ§</li>

    <li class="menu-item has-submenu @(currentController == "messages" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "messages" ? "active" : "")">
            <i class="fas fa-comments"></i>
            <span class="menu-text">Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§</span>
            <span class="menu-badge" id="reportsBadge">0</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Messages")" class="submenu-link @(currentController == "messages" && currentAction == "index" ? "active" : "")">
                    ØªÙ…Ø§Ù… Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("Reports", "Messages")" class="submenu-link @(currentController == "messages" && currentAction == "reports" ? "active" : "")">
                    Ú¯Ø²Ø§Ø±Ø´Ø§Øª Ù¾ÛŒØ§Ù…
                </a>
            </li>
            <li>
                <a href="@Url.Action("ForbiddenWords", "Messages")" class="submenu-link @(currentController == "messages" && currentAction == "forbiddenwords" ? "active" : "")">
                    Ú©Ù„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ù‡
                </a>
            </li>
        </ul>
    </li>

    <!-- Polls -->
    <li class="menu-item">
        <a href="@Url.Action("Index", "Polls")" class="menu-link @(currentController == "polls" ? "active" : "")">
            <i class="fas fa-poll"></i>
            <span class="menu-text">Ù†Ø¸Ø±Ø³Ù†Ø¬ÛŒâ€ŒÙ‡Ø§</span>
        </a>
    </li>

    <!-- Calls -->
    <li class="menu-item">
        <a href="@Url.Action("Index", "Calls")" class="menu-link @(currentController == "calls" ? "active" : "")">
            <i class="fas fa-phone-alt"></i>
            <span class="menu-text">ØªÙ…Ø§Ø³â€ŒÙ‡Ø§</span>
        </a>
    </li>

    <!-- Notifications -->
    <li class="menu-header">Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</li>

    <li class="menu-item has-submenu @(currentController == "notifications" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "notifications" ? "active" : "")">
            <i class="fas fa-bell"></i>
            <span class="menu-text">Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Notifications")" class="submenu-link @(currentController == "notifications" && currentAction == "index" ? "active" : "")">
                    Ù„ÛŒØ³Øª Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "Notifications")" class="submenu-link @(currentController == "notifications" && currentAction == "create" ? "active" : "")">
                    Ø§Ø±Ø³Ø§Ù„ Ø§Ø¹Ù„Ø§Ù†
                </a>
            </li>
            <li>
                <a href="@Url.Action("SystemAlerts", "Notifications")" class="submenu-link @(currentController == "notifications" && currentAction == "systemalerts" ? "active" : "")">
                    Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø³ÛŒØ³ØªÙ…
                </a>
            </li>
        </ul>
    </li>

    <!-- Reports & Analytics -->
    <li class="menu-header">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</li>

    <li class="menu-item has-submenu @(currentController == "reports" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "reports" ? "active" : "")">
            <i class="fas fa-chart-bar"></i>
            <span class="menu-text">Ú¯Ø²Ø§Ø±Ø´Ø§Øª</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "index" ? "active" : "")">
                    Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ú¯Ø²Ø§Ø±Ø´Ø§Øª
                </a>
            </li>
            <li>
                <a href="@Url.Action("UserActivity", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "useractivity" ? "active" : "")">
                    ÙØ¹Ø§Ù„ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù†
                </a>
            </li>
            <li>
                <a href="@Url.Action("MessageStats", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "messagestats" ? "active" : "")">
                    Ø¢Ù…Ø§Ø± Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("CallLogs", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "calllogs" ? "active" : "")">
                    Ù„Ø§Ú¯ ØªÙ…Ø§Ø³â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("LoginHistory", "Reports")" class="submenu-link @(currentController == "reports" && currentAction == "loginhistory" ? "active" : "")">
                    ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ±ÙˆØ¯
                </a>
            </li>
        </ul>
    </li>

    <!-- Settings -->
    <li class="menu-header">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</li>

    <li class="menu-item has-submenu @(currentController == "settings" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "settings" ? "active" : "")">
            <i class="fas fa-cogs"></i>
            <span class="menu-text">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "index" ? "active" : "")">
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ
                </a>
            </li>
            <li>
                <a href="@Url.Action("Authentication", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "authentication" ? "active" : "")">
                    Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª
                </a>
            </li>
            <li>
                <a href="@Url.Action("VoIP", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "voip" ? "active" : "")">
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª VoIP
                </a>
            </li>
            <li>
                <a href="@Url.Action("FileUpload", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "fileupload" ? "active" : "")">
                    Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„
                </a>
            </li>
            <li>
                <a href="@Url.Action("MessageSettings", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "messagesettings" ? "active" : "")">
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ§Ù…
                </a>
            </li>
            <li>
                <a href="@Url.Action("ServiceLinks", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "servicelinks" ? "active" : "")">
                    Ù„ÛŒÙ†Ú© Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§
                </a>
            </li>
            <li>
                <a href="@Url.Action("Telegram", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "telegram" ? "active" : "")">
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª ØªÙ„Ú¯Ø±Ø§Ù…
                </a>
            </li>
            <li>
                <a href="@Url.Action("Sms", "Settings")" class="submenu-link @(currentController == "settings" && currentAction == "sms" ? "active" : "")">
                    ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù¾ÛŒØ§Ù…Ú©
                </a>
            </li>
        </ul>
    </li>

    <!-- Admin Users -->
    <li class="menu-item has-submenu @(currentController == "adminusers" ? "open" : "")">
        <a href="#" class="menu-link @(currentController == "adminusers" ? "active" : "")">
            <i class="fas fa-user-shield"></i>
            <span class="menu-text">Ù…Ø¯ÛŒØ±Ø§Ù† Ø³ÛŒØ³ØªÙ…</span>
            <i class="fas fa-chevron-left menu-arrow"></i>
        </a>
        <ul class="submenu">
            <li>
                <a href="@Url.Action("Index", "AdminUsers")" class="submenu-link @(currentController == "adminusers" && currentAction == "index" ? "active" : "")">
                    Ù„ÛŒØ³Øª Ù…Ø¯ÛŒØ±Ø§Ù†
                </a>
            </li>
            <li>
                <a href="@Url.Action("Create", "AdminUsers")" class="submenu-link @(currentController == "adminusers" && currentAction == "create" ? "active" : "")">
                    Ø§ÙØ²ÙˆØ¯Ù† Ù…Ø¯ÛŒØ±
                </a>
            </li>
        </ul>
    </li>

</ul>
 
 
==================== _TopNavbar.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
ï»¿@{
    var adminName = Context.Session.GetString("AdminName") ?? "Ù…Ø¯ÛŒØ± Ø³ÛŒØ³ØªÙ…";
    var adminRole = Context.Session.GetString("IsSuperAdmin") == "True" ? "Ù…Ø¯ÛŒØ± Ø§Ø±Ø´Ø¯" : "Ù…Ø¯ÛŒØ±";
}

<nav class="top-navbar">
    <div class="d-flex align-items-center gap-3">
        <!-- Sidebar Toggle -->
        <button class="toggle-sidebar-btn d-none d-lg-block" id="toggleSidebar">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Mobile Toggle -->
        <button class="toggle-sidebar-btn d-lg-none" id="mobileSidebarToggle">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Search -->
        <div class="navbar-search d-none d-md-block">
            <i class="fas fa-search"></i>
            <input type="text" class="form-control" placeholder="Ø¬Ø³ØªØ¬Ùˆ..." id="globalSearch" />
        </div>
    </div>

    <div class="navbar-icons">
        <!-- Refresh -->
        <button class="nav-icon-btn" title="Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ" onclick="location.reload()">
            <i class="fas fa-sync-alt"></i>
        </button>

        <!-- Notifications -->
        <div class="dropdown">
            <button class="nav-icon-btn" data-bs-toggle="dropdown" title="Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§">
                <i class="fas fa-bell"></i>
                <span class="badge bg-danger" id="notificationCount">3</span>
            </button>
            <div class="dropdown-menu dropdown-menu-start p-0" style="min-width: 320px;">
                <div class="p-3 border-bottom bg-light">
                    <strong>Ø§Ø¹Ù„Ø§Ù†â€ŒÙ‡Ø§</strong>
                </div>
                <div class="notification-list" style="max-height: 300px; overflow-y: auto;">
                    <a href="#" class="dropdown-item d-flex align-items-start py-2">
                        <div class="me-3">
                            <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-user-plus"></i>
                            </div>
                        </div>
                        <div>
                            <div class="small text-gray-500">12:00</div>
                            <span>Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯</span>
                        </div>
                    </a>
                    <a href="#" class="dropdown-item d-flex align-items-start py-2">
                        <div class="me-3">
                            <div class="rounded-circle bg-warning text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div>
                            <div class="small text-gray-500">11:30</div>
                            <span>Ú¯Ø²Ø§Ø±Ø´ Ù¾ÛŒØ§Ù… Ø¬Ø¯ÛŒØ¯</span>
                        </div>
                    </a>
                    <a href="#" class="dropdown-item d-flex align-items-start py-2">
                        <div class="me-3">
                            <div class="rounded-circle bg-success text-white d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-check"></i>
                            </div>
                        </div>
                        <div>
                            <div class="small text-gray-500">10:00</div>
                            <span>Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ø§Ù…Ù„ Ø´Ø¯</span>
                        </div>
                    </a>
                </div>
                <a href="@Url.Action("Index", "Notifications")" class="dropdown-item text-center py-2 border-top">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                </a>
            </div>
        </div>

        <!-- Messages -->
        <div class="dropdown">
            <button class="nav-icon-btn" data-bs-toggle="dropdown" title="Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§">
                <i class="fas fa-envelope"></i>
                <span class="badge bg-warning" id="messageCount">5</span>
            </button>
            <div class="dropdown-menu dropdown-menu-start p-0" style="min-width: 320px;">
                <div class="p-3 border-bottom bg-light">
                    <strong>Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ú¯Ø²Ø§Ø±Ø´ Ø´Ø¯Ù‡</strong>
                </div>
                <div class="message-list" style="max-height: 300px; overflow-y: auto;">
                    <a href="#" class="dropdown-item py-2">
                        <div class="d-flex justify-content-between">
                            <span class="fw-bold">Ø¹Ù„ÛŒ Ù…Ø­Ù…Ø¯ÛŒ</span>
                            <small class="text-muted">10 Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´</small>
                        </div>
                        <div class="small text-truncate">Ù…Ø­ØªÙˆØ§ÛŒ Ù†Ø§Ù…Ù†Ø§Ø³Ø¨ Ú¯Ø²Ø§Ø±Ø´ Ø´Ø¯Ù‡...</div>
                    </a>
                </div>
                <a href="@Url.Action("Reports", "Messages")" class="dropdown-item text-center py-2 border-top">
                    Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù‡Ù…Ù‡
                </a>
            </div>
        </div>

        <!-- User Menu -->
        <div class="dropdown">
            <div class="user-dropdown" data-bs-toggle="dropdown">
                <img src="https://via.placeholder.com/42/4e73df/ffffff?text=A" alt="Avatar" class="user-avatar" />
                <div class="user-info d-none d-md-block">
                    <div class="user-name">@adminName</div>
                    <div class="user-role">@adminRole</div>
                </div>
                <i class="fas fa-chevron-down text-muted d-none d-md-block"></i>
            </div>
            <ul class="dropdown-menu dropdown-menu-start">
                <li>
                    <a class="dropdown-item" href="@Url.Action("Profile", "Account")">
                        <i class="fas fa-user fa-fw me-2"></i> Ù¾Ø±ÙˆÙØ§ÛŒÙ„
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="@Url.Action("Index", "Settings")">
                        <i class="fas fa-cog fa-fw me-2"></i> ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                    </a>
                </li>
                <li>
                    <a class="dropdown-item" href="@Url.Action("LoginHistory", "Reports")">
                        <i class="fas fa-history fa-fw me-2"></i> ØªØ§Ø±ÛŒØ®Ú†Ù‡ ÙˆØ±ÙˆØ¯
                    </a>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                    <a class="dropdown-item text-danger" href="@Url.Action("Logout", "Account")">
                        <i class="fas fa-sign-out-alt fa-fw me-2"></i> Ø®Ø±ÙˆØ¬
                    </a>
                </li>
            </ul>
        </div>
    </div>
</nav>
 
 
==================== _ValidationScriptsPartial.cshtml ==================== 
Path: F:\OrgMessenger\OrganizationalMessenger.Web\Views\Shared\ 
 
ï»¿<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
 
 
Total Files: 149 